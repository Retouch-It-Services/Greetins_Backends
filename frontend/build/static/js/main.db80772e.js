/*! For license information please see main.db80772e.js.LICENSE.txt */
(()=>{var e={16:(e,t,n)=>{"use strict";e.exports=n(958)},43:(e,t,n)=>{"use strict";e.exports=n(202)},62:(e,t)=>{"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var i=n-1>>>1,r=e[i];if(!(0<s(r,t)))break e;e[i]=t,e[n]=r,n=i}}function i(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var i=0,r=e.length,a=r>>>1;i<a;){var o=2*(i+1)-1,l=e[o],c=o+1,u=e[c];if(0>s(l,n))c<r&&0>s(u,l)?(e[i]=u,e[c]=n,i=c):(e[i]=l,e[o]=n,i=o);else{if(!(c<r&&0>s(u,n)))break e;e[i]=u,e[c]=n,i=c}}}return t}function s(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var a=performance;t.unstable_now=function(){return a.now()}}else{var o=Date,l=o.now();t.unstable_now=function(){return o.now()-l}}var c=[],u=[],h=1,d=null,f=3,p=!1,m=!1,g=!1,v="function"===typeof setTimeout?setTimeout:null,y="function"===typeof clearTimeout?clearTimeout:null,b="undefined"!==typeof setImmediate?setImmediate:null;function x(e){for(var t=i(u);null!==t;){if(null===t.callback)r(u);else{if(!(t.startTime<=e))break;r(u),t.sortIndex=t.expirationTime,n(c,t)}t=i(u)}}function _(e){if(g=!1,x(e),!m)if(null!==i(c))m=!0,k(S);else{var t=i(u);null!==t&&D(_,t.startTime-e)}}function S(e,n){m=!1,g&&(g=!1,y(A),A=-1),p=!0;var s=f;try{for(x(n),d=i(c);null!==d&&(!(d.expirationTime>n)||e&&!C());){var a=d.callback;if("function"===typeof a){d.callback=null,f=d.priorityLevel;var o=a(d.expirationTime<=n);n=t.unstable_now(),"function"===typeof o?d.callback=o:d===i(c)&&r(c),x(n)}else r(c);d=i(c)}if(null!==d)var l=!0;else{var h=i(u);null!==h&&D(_,h.startTime-n),l=!1}return l}finally{d=null,f=s,p=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var E,T=!1,w=null,A=-1,M=5,R=-1;function C(){return!(t.unstable_now()-R<M)}function L(){if(null!==w){var e=t.unstable_now();R=e;var n=!0;try{n=w(!0,e)}finally{n?E():(T=!1,w=null)}}else T=!1}if("function"===typeof b)E=function(){b(L)};else if("undefined"!==typeof MessageChannel){var I=new MessageChannel,P=I.port2;I.port1.onmessage=L,E=function(){P.postMessage(null)}}else E=function(){v(L,0)};function k(e){w=e,T||(T=!0,E())}function D(e,n){A=v(function(){e(t.unstable_now())},n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){m||p||(m=!0,k(S))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):M=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return i(c)},t.unstable_next=function(e){switch(f){case 1:case 2:case 3:var t=3;break;default:t=f}var n=f;f=t;try{return e()}finally{f=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=f;f=e;try{return t()}finally{f=n}},t.unstable_scheduleCallback=function(e,r,s){var a=t.unstable_now();switch("object"===typeof s&&null!==s?s="number"===typeof(s=s.delay)&&0<s?a+s:a:s=a,e){case 1:var o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}return e={id:h++,callback:r,priorityLevel:e,startTime:s,expirationTime:o=s+o,sortIndex:-1},s>a?(e.sortIndex=s,n(u,e),null===i(c)&&e===i(u)&&(g?(y(A),A=-1):g=!0,D(_,s-a))):(e.sortIndex=o,n(c,e),m||p||(m=!0,k(S))),e},t.unstable_shouldYield=C,t.unstable_wrapCallback=function(e){var t=f;return function(){var n=f;f=t;try{return e.apply(this,arguments)}finally{f=n}}}},153:(e,t,n)=>{"use strict";var i=n(43),r=Symbol.for("react.element"),s=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,o=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var i,s={},c=null,u=null;for(i in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)a.call(t,i)&&!l.hasOwnProperty(i)&&(s[i]=t[i]);if(e&&e.defaultProps)for(i in t=e.defaultProps)void 0===s[i]&&(s[i]=t[i]);return{$$typeof:r,type:e,key:c,ref:u,props:s,_owner:o.current}}t.Fragment=s,t.jsx=c,t.jsxs=c},202:(e,t)=>{"use strict";var n=Symbol.for("react.element"),i=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),f=Symbol.iterator;var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,g={};function v(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||p}function y(){}function b(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||p}v.prototype.isReactComponent={},v.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},v.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=v.prototype;var x=b.prototype=new y;x.constructor=b,m(x,v.prototype),x.isPureReactComponent=!0;var _=Array.isArray,S=Object.prototype.hasOwnProperty,E={current:null},T={key:!0,ref:!0,__self:!0,__source:!0};function w(e,t,i){var r,s={},a=null,o=null;if(null!=t)for(r in void 0!==t.ref&&(o=t.ref),void 0!==t.key&&(a=""+t.key),t)S.call(t,r)&&!T.hasOwnProperty(r)&&(s[r]=t[r]);var l=arguments.length-2;if(1===l)s.children=i;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];s.children=c}if(e&&e.defaultProps)for(r in l=e.defaultProps)void 0===s[r]&&(s[r]=l[r]);return{$$typeof:n,type:e,key:a,ref:o,props:s,_owner:E.current}}function A(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var M=/\/+/g;function R(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function C(e,t,r,s,a){var o=typeof e;"undefined"!==o&&"boolean"!==o||(e=null);var l=!1;if(null===e)l=!0;else switch(o){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case n:case i:l=!0}}if(l)return a=a(l=e),e=""===s?"."+R(l,0):s,_(a)?(r="",null!=e&&(r=e.replace(M,"$&/")+"/"),C(a,t,r,"",function(e){return e})):null!=a&&(A(a)&&(a=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(a,r+(!a.key||l&&l.key===a.key?"":(""+a.key).replace(M,"$&/")+"/")+e)),t.push(a)),1;if(l=0,s=""===s?".":s+":",_(e))for(var c=0;c<e.length;c++){var u=s+R(o=e[c],c);l+=C(o,t,r,u,a)}else if(u=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=f&&e[f]||e["@@iterator"])?e:null}(e),"function"===typeof u)for(e=u.call(e),c=0;!(o=e.next()).done;)l+=C(o=o.value,t,r,u=s+R(o,c++),a);else if("object"===o)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function L(e,t,n){if(null==e)return e;var i=[],r=0;return C(e,i,"","",function(e){return t.call(n,e,r++)}),i}function I(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var P={current:null},k={transition:null},D={ReactCurrentDispatcher:P,ReactCurrentBatchConfig:k,ReactCurrentOwner:E};function N(){throw Error("act(...) is not supported in production builds of React.")}t.Children={map:L,forEach:function(e,t,n){L(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return L(e,function(){t++}),t},toArray:function(e){return L(e,function(e){return e})||[]},only:function(e){if(!A(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=v,t.Fragment=r,t.Profiler=a,t.PureComponent=b,t.StrictMode=s,t.Suspense=u,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=D,t.act=N,t.cloneElement=function(e,t,i){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=m({},e.props),s=e.key,a=e.ref,o=e._owner;if(null!=t){if(void 0!==t.ref&&(a=t.ref,o=E.current),void 0!==t.key&&(s=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)S.call(t,c)&&!T.hasOwnProperty(c)&&(r[c]=void 0===t[c]&&void 0!==l?l[c]:t[c])}var c=arguments.length-2;if(1===c)r.children=i;else if(1<c){l=Array(c);for(var u=0;u<c;u++)l[u]=arguments[u+2];r.children=l}return{$$typeof:n,type:e.type,key:s,ref:a,props:r,_owner:o}},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:o,_context:e},e.Consumer=e},t.createElement=w,t.createFactory=function(e){var t=w.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=A,t.lazy=function(e){return{$$typeof:d,_payload:{_status:-1,_result:e},_init:I}},t.memo=function(e,t){return{$$typeof:h,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=k.transition;k.transition={};try{e()}finally{k.transition=t}},t.unstable_act=N,t.useCallback=function(e,t){return P.current.useCallback(e,t)},t.useContext=function(e){return P.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return P.current.useDeferredValue(e)},t.useEffect=function(e,t){return P.current.useEffect(e,t)},t.useId=function(){return P.current.useId()},t.useImperativeHandle=function(e,t,n){return P.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return P.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return P.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return P.current.useMemo(e,t)},t.useReducer=function(e,t,n){return P.current.useReducer(e,t,n)},t.useRef=function(e){return P.current.useRef(e)},t.useState=function(e){return P.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return P.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return P.current.useTransition()},t.version="18.3.1"},205:(e,t,n)=>{"use strict";e.exports=n(302)},234:(e,t)=>{"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var i=n-1>>>1,r=e[i];if(!(0<s(r,t)))break e;e[i]=t,e[n]=r,n=i}}function i(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var i=0,r=e.length,a=r>>>1;i<a;){var o=2*(i+1)-1,l=e[o],c=o+1,u=e[c];if(0>s(l,n))c<r&&0>s(u,l)?(e[i]=u,e[c]=n,i=c):(e[i]=l,e[o]=n,i=o);else{if(!(c<r&&0>s(u,n)))break e;e[i]=u,e[c]=n,i=c}}}return t}function s(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var a=performance;t.unstable_now=function(){return a.now()}}else{var o=Date,l=o.now();t.unstable_now=function(){return o.now()-l}}var c=[],u=[],h=1,d=null,f=3,p=!1,m=!1,g=!1,v="function"===typeof setTimeout?setTimeout:null,y="function"===typeof clearTimeout?clearTimeout:null,b="undefined"!==typeof setImmediate?setImmediate:null;function x(e){for(var t=i(u);null!==t;){if(null===t.callback)r(u);else{if(!(t.startTime<=e))break;r(u),t.sortIndex=t.expirationTime,n(c,t)}t=i(u)}}function _(e){if(g=!1,x(e),!m)if(null!==i(c))m=!0,k(S);else{var t=i(u);null!==t&&D(_,t.startTime-e)}}function S(e,n){m=!1,g&&(g=!1,y(A),A=-1),p=!0;var s=f;try{for(x(n),d=i(c);null!==d&&(!(d.expirationTime>n)||e&&!C());){var a=d.callback;if("function"===typeof a){d.callback=null,f=d.priorityLevel;var o=a(d.expirationTime<=n);n=t.unstable_now(),"function"===typeof o?d.callback=o:d===i(c)&&r(c),x(n)}else r(c);d=i(c)}if(null!==d)var l=!0;else{var h=i(u);null!==h&&D(_,h.startTime-n),l=!1}return l}finally{d=null,f=s,p=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var E,T=!1,w=null,A=-1,M=5,R=-1;function C(){return!(t.unstable_now()-R<M)}function L(){if(null!==w){var e=t.unstable_now();R=e;var n=!0;try{n=w(!0,e)}finally{n?E():(T=!1,w=null)}}else T=!1}if("function"===typeof b)E=function(){b(L)};else if("undefined"!==typeof MessageChannel){var I=new MessageChannel,P=I.port2;I.port1.onmessage=L,E=function(){P.postMessage(null)}}else E=function(){v(L,0)};function k(e){w=e,T||(T=!0,E())}function D(e,n){A=v(function(){e(t.unstable_now())},n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){m||p||(m=!0,k(S))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):M=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return i(c)},t.unstable_next=function(e){switch(f){case 1:case 2:case 3:var t=3;break;default:t=f}var n=f;f=t;try{return e()}finally{f=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=f;f=e;try{return t()}finally{f=n}},t.unstable_scheduleCallback=function(e,r,s){var a=t.unstable_now();switch("object"===typeof s&&null!==s?s="number"===typeof(s=s.delay)&&0<s?a+s:a:s=a,e){case 1:var o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}return e={id:h++,callback:r,priorityLevel:e,startTime:s,expirationTime:o=s+o,sortIndex:-1},s>a?(e.sortIndex=s,n(u,e),null===i(c)&&e===i(u)&&(g?(y(A),A=-1):g=!0,D(_,s-a))):(e.sortIndex=o,n(c,e),m||p||(m=!0,k(S))),e},t.unstable_shouldYield=C,t.unstable_wrapCallback=function(e){var t=f;return function(){var n=f;f=t;try{return e.apply(this,arguments)}finally{f=n}}}},302:(e,t)=>{"use strict";t.ConcurrentRoot=1,t.ContinuousEventPriority=4,t.DefaultEventPriority=16,t.DiscreteEventPriority=1},391:(e,t,n)=>{"use strict";var i=n(950);t.createRoot=i.createRoot,t.hydrateRoot=i.hydrateRoot},513:(e,t,n)=>{"use strict";e.exports=n(62)},555:(e,t,n)=>{"use strict";function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function r(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=i(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==i(t)?t:t+""}function s(e,t,n){return(t=r(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach(function(t){s(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}n.d(t,{A:()=>o})},579:(e,t,n)=>{"use strict";e.exports=n(153)},722:(e,t,n)=>{"use strict";n.d(t,{A:()=>Mt});var i={};function r(e,t){return function(){return e.apply(t,arguments)}}n.r(i),n.d(i,{hasBrowserEnv:()=>ue,hasStandardBrowserEnv:()=>de,hasStandardBrowserWebWorkerEnv:()=>fe,navigator:()=>he,origin:()=>pe});const{toString:s}=Object.prototype,{getPrototypeOf:a}=Object,{iterator:o,toStringTag:l}=Symbol,c=(u=Object.create(null),e=>{const t=s.call(e);return u[t]||(u[t]=t.slice(8,-1).toLowerCase())});var u;const h=e=>(e=e.toLowerCase(),t=>c(t)===e),d=e=>t=>typeof t===e,{isArray:f}=Array,p=d("undefined");function m(e){return null!==e&&!p(e)&&null!==e.constructor&&!p(e.constructor)&&y(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const g=h("ArrayBuffer");const v=d("string"),y=d("function"),b=d("number"),x=e=>null!==e&&"object"===typeof e,_=e=>{if("object"!==c(e))return!1;const t=a(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&!(l in e)&&!(o in e)},S=h("Date"),E=h("File"),T=h("Blob"),w=h("FileList"),A=h("URLSearchParams"),[M,R,C,L]=["ReadableStream","Request","Response","Headers"].map(h);function I(e,t){let n,i,{allOwnKeys:r=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(null!==e&&"undefined"!==typeof e)if("object"!==typeof e&&(e=[e]),f(e))for(n=0,i=e.length;n<i;n++)t.call(null,e[n],n,e);else{if(m(e))return;const i=r?Object.getOwnPropertyNames(e):Object.keys(e),s=i.length;let a;for(n=0;n<s;n++)a=i[n],t.call(null,e[a],a,e)}}function P(e,t){if(m(e))return null;t=t.toLowerCase();const n=Object.keys(e);let i,r=n.length;for(;r-- >0;)if(i=n[r],t===i.toLowerCase())return i;return null}const k="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:"undefined"!==typeof window?window:n.g,D=e=>!p(e)&&e!==k;const N=(O="undefined"!==typeof Uint8Array&&a(Uint8Array),e=>O&&e instanceof O);var O;const F=h("HTMLFormElement"),U=(e=>{let{hasOwnProperty:t}=e;return(e,n)=>t.call(e,n)})(Object.prototype),B=h("RegExp"),z=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),i={};I(n,(n,r)=>{let s;!1!==(s=t(n,r,e))&&(i[r]=s||n)}),Object.defineProperties(e,i)};const j=h("AsyncFunction"),G=((e,t)=>{return e?setImmediate:t?(n="axios@".concat(Math.random()),i=[],k.addEventListener("message",e=>{let{source:t,data:r}=e;t===k&&r===n&&i.length&&i.shift()()},!1),e=>{i.push(e),k.postMessage(n,"*")}):e=>setTimeout(e);var n,i})("function"===typeof setImmediate,y(k.postMessage)),V="undefined"!==typeof queueMicrotask?queueMicrotask.bind(k):"undefined"!==typeof process&&process.nextTick||G,H={isArray:f,isArrayBuffer:g,isBuffer:m,isFormData:e=>{let t;return e&&("function"===typeof FormData&&e instanceof FormData||y(e.append)&&("formdata"===(t=c(e))||"object"===t&&y(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){let t;return t="undefined"!==typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&g(e.buffer),t},isString:v,isNumber:b,isBoolean:e=>!0===e||!1===e,isObject:x,isPlainObject:_,isEmptyObject:e=>{if(!x(e)||m(e))return!1;try{return 0===Object.keys(e).length&&Object.getPrototypeOf(e)===Object.prototype}catch(t){return!1}},isReadableStream:M,isRequest:R,isResponse:C,isHeaders:L,isUndefined:p,isDate:S,isFile:E,isBlob:T,isRegExp:B,isFunction:y,isStream:e=>x(e)&&y(e.pipe),isURLSearchParams:A,isTypedArray:N,isFileList:w,forEach:I,merge:function e(){const{caseless:t,skipUndefined:n}=D(this)&&this||{},i={},r=(r,s)=>{const a=t&&P(i,s)||s;_(i[a])&&_(r)?i[a]=e(i[a],r):_(r)?i[a]=e({},r):f(r)?i[a]=r.slice():n&&p(r)||(i[a]=r)};for(let s=0,a=arguments.length;s<a;s++)arguments[s]&&I(arguments[s],r);return i},extend:function(e,t,n){let{allOwnKeys:i}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return I(t,(t,i)=>{n&&y(t)?e[i]=r(t,n):e[i]=t},{allOwnKeys:i}),e},trim:e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,n,i)=>{e.prototype=Object.create(t.prototype,i),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,i)=>{let r,s,o;const l={};if(t=t||{},null==e)return t;do{for(r=Object.getOwnPropertyNames(e),s=r.length;s-- >0;)o=r[s],i&&!i(o,e,t)||l[o]||(t[o]=e[o],l[o]=!0);e=!1!==n&&a(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:c,kindOfTest:h,endsWith:(e,t,n)=>{e=String(e),(void 0===n||n>e.length)&&(n=e.length),n-=t.length;const i=e.indexOf(t,n);return-1!==i&&i===n},toArray:e=>{if(!e)return null;if(f(e))return e;let t=e.length;if(!b(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{const n=(e&&e[o]).call(e);let i;for(;(i=n.next())&&!i.done;){const n=i.value;t.call(e,n[0],n[1])}},matchAll:(e,t)=>{let n;const i=[];for(;null!==(n=e.exec(t));)i.push(n);return i},isHTMLForm:F,hasOwnProperty:U,hasOwnProp:U,reduceDescriptors:z,freezeMethods:e=>{z(e,(t,n)=>{if(y(e)&&-1!==["arguments","caller","callee"].indexOf(n))return!1;const i=e[n];y(i)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))})},toObjectSet:(e,t)=>{const n={},i=e=>{e.forEach(e=>{n[e]=!0})};return f(e)?i(e):i(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,t,n){return t.toUpperCase()+n}),noop:()=>{},toFiniteNumber:(e,t)=>null!=e&&Number.isFinite(e=+e)?e:t,findKey:P,global:k,isContextDefined:D,isSpecCompliantForm:function(e){return!!(e&&y(e.append)&&"FormData"===e[l]&&e[o])},toJSONObject:e=>{const t=new Array(10),n=(e,i)=>{if(x(e)){if(t.indexOf(e)>=0)return;if(m(e))return e;if(!("toJSON"in e)){t[i]=e;const r=f(e)?[]:{};return I(e,(e,t)=>{const s=n(e,i+1);!p(s)&&(r[t]=s)}),t[i]=void 0,r}}return e};return n(e,0)},isAsyncFn:j,isThenable:e=>e&&(x(e)||y(e))&&y(e.then)&&y(e.catch),setImmediate:G,asap:V,isIterable:e=>null!=e&&y(e[o])};function W(e,t,n,i,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),i&&(this.request=i),r&&(this.response=r,this.status=r.status?r.status:null)}H.inherits(W,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:H.toJSONObject(this.config),code:this.code,status:this.status}}});const Y=W.prototype,X={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{X[e]={value:e}}),Object.defineProperties(W,X),Object.defineProperty(Y,"isAxiosError",{value:!0}),W.from=(e,t,n,i,r,s)=>{const a=Object.create(Y);H.toFlatObject(e,a,function(e){return e!==Error.prototype},e=>"isAxiosError"!==e);const o=e&&e.message?e.message:"Error",l=null==t&&e?e.code:t;return W.call(a,o,l,n,i,r),e&&null==a.cause&&Object.defineProperty(a,"cause",{value:e,configurable:!0}),a.name=e&&e.name||"Error",s&&Object.assign(a,s),a};const q=W;function K(e){return H.isPlainObject(e)||H.isArray(e)}function Z(e){return H.endsWith(e,"[]")?e.slice(0,-2):e}function J(e,t,n){return e?e.concat(t).map(function(e,t){return e=Z(e),!n&&t?"["+e+"]":e}).join(n?".":""):t}const Q=H.toFlatObject(H,{},null,function(e){return/^is[A-Z]/.test(e)});const $=function(e,t,n){if(!H.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const i=(n=H.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(e,t){return!H.isUndefined(t[e])})).metaTokens,r=n.visitor||c,s=n.dots,a=n.indexes,o=(n.Blob||"undefined"!==typeof Blob&&Blob)&&H.isSpecCompliantForm(t);if(!H.isFunction(r))throw new TypeError("visitor must be a function");function l(e){if(null===e)return"";if(H.isDate(e))return e.toISOString();if(H.isBoolean(e))return e.toString();if(!o&&H.isBlob(e))throw new q("Blob is not supported. Use a Buffer instead.");return H.isArrayBuffer(e)||H.isTypedArray(e)?o&&"function"===typeof Blob?new Blob([e]):Buffer.from(e):e}function c(e,n,r){let o=e;if(e&&!r&&"object"===typeof e)if(H.endsWith(n,"{}"))n=i?n:n.slice(0,-2),e=JSON.stringify(e);else if(H.isArray(e)&&function(e){return H.isArray(e)&&!e.some(K)}(e)||(H.isFileList(e)||H.endsWith(n,"[]"))&&(o=H.toArray(e)))return n=Z(n),o.forEach(function(e,i){!H.isUndefined(e)&&null!==e&&t.append(!0===a?J([n],i,s):null===a?n:n+"[]",l(e))}),!1;return!!K(e)||(t.append(J(r,n,s),l(e)),!1)}const u=[],h=Object.assign(Q,{defaultVisitor:c,convertValue:l,isVisitable:K});if(!H.isObject(e))throw new TypeError("data must be an object");return function e(n,i){if(!H.isUndefined(n)){if(-1!==u.indexOf(n))throw Error("Circular reference detected in "+i.join("."));u.push(n),H.forEach(n,function(n,s){!0===(!(H.isUndefined(n)||null===n)&&r.call(t,n,H.isString(s)?s.trim():s,i,h))&&e(n,i?i.concat(s):[s])}),u.pop()}}(e),t};function ee(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(e){return t[e]})}function te(e,t){this._pairs=[],e&&$(e,this,t)}const ne=te.prototype;ne.append=function(e,t){this._pairs.push([e,t])},ne.toString=function(e){const t=e?function(t){return e.call(this,t,ee)}:ee;return this._pairs.map(function(e){return t(e[0])+"="+t(e[1])},"").join("&")};const ie=te;function re(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function se(e,t,n){if(!t)return e;const i=n&&n.encode||re;H.isFunction(n)&&(n={serialize:n});const r=n&&n.serialize;let s;if(s=r?r(t,n):H.isURLSearchParams(t)?t.toString():new ie(t,n).toString(i),s){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+s}return e}const ae=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){H.forEach(this.handlers,function(t){null!==t&&e(t)})}},oe={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1};var le=n(555);const ce={isBrowser:!0,classes:{URLSearchParams:"undefined"!==typeof URLSearchParams?URLSearchParams:ie,FormData:"undefined"!==typeof FormData?FormData:null,Blob:"undefined"!==typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]},ue="undefined"!==typeof window&&"undefined"!==typeof document,he="object"===typeof navigator&&navigator||void 0,de=ue&&(!he||["ReactNative","NativeScript","NS"].indexOf(he.product)<0),fe="undefined"!==typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"===typeof self.importScripts,pe=ue&&window.location.href||"http://localhost",me=(0,le.A)((0,le.A)({},i),ce);const ge=function(e){function t(e,n,i,r){let s=e[r++];if("__proto__"===s)return!0;const a=Number.isFinite(+s),o=r>=e.length;if(s=!s&&H.isArray(i)?i.length:s,o)return H.hasOwnProp(i,s)?i[s]=[i[s],n]:i[s]=n,!a;i[s]&&H.isObject(i[s])||(i[s]=[]);return t(e,n,i[s],r)&&H.isArray(i[s])&&(i[s]=function(e){const t={},n=Object.keys(e);let i;const r=n.length;let s;for(i=0;i<r;i++)s=n[i],t[s]=e[s];return t}(i[s])),!a}if(H.isFormData(e)&&H.isFunction(e.entries)){const n={};return H.forEachEntry(e,(e,i)=>{t(function(e){return H.matchAll(/\w+|\[(\w*)]/g,e).map(e=>"[]"===e[0]?"":e[1]||e[0])}(e),i,n,0)}),n}return null};const ve={transitional:oe,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const n=t.getContentType()||"",i=n.indexOf("application/json")>-1,r=H.isObject(e);r&&H.isHTMLForm(e)&&(e=new FormData(e));if(H.isFormData(e))return i?JSON.stringify(ge(e)):e;if(H.isArrayBuffer(e)||H.isBuffer(e)||H.isStream(e)||H.isFile(e)||H.isBlob(e)||H.isReadableStream(e))return e;if(H.isArrayBufferView(e))return e.buffer;if(H.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let s;if(r){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return $(e,new me.classes.URLSearchParams,(0,le.A)({visitor:function(e,t,n,i){return me.isNode&&H.isBuffer(e)?(this.append(t,e.toString("base64")),!1):i.defaultVisitor.apply(this,arguments)}},t))}(e,this.formSerializer).toString();if((s=H.isFileList(e))||n.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return $(s?{"files[]":e}:e,t&&new t,this.formSerializer)}}return r||i?(t.setContentType("application/json",!1),function(e,t,n){if(H.isString(e))try{return(t||JSON.parse)(e),H.trim(e)}catch(i){if("SyntaxError"!==i.name)throw i}return(n||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){const t=this.transitional||ve.transitional,n=t&&t.forcedJSONParsing,i="json"===this.responseType;if(H.isResponse(e)||H.isReadableStream(e))return e;if(e&&H.isString(e)&&(n&&!this.responseType||i)){const n=!(t&&t.silentJSONParsing)&&i;try{return JSON.parse(e,this.parseReviver)}catch(r){if(n){if("SyntaxError"===r.name)throw q.from(r,q.ERR_BAD_RESPONSE,this,null,this.response);throw r}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:me.classes.FormData,Blob:me.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};H.forEach(["delete","get","head","post","put","patch"],e=>{ve.headers[e]={}});const ye=ve,be=H.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),xe=Symbol("internals");function _e(e){return e&&String(e).trim().toLowerCase()}function Se(e){return!1===e||null==e?e:H.isArray(e)?e.map(Se):String(e)}function Ee(e,t,n,i,r){return H.isFunction(i)?i.call(this,t,n):(r&&(t=n),H.isString(t)?H.isString(i)?-1!==t.indexOf(i):H.isRegExp(i)?i.test(t):void 0:void 0)}class Te{constructor(e){e&&this.set(e)}set(e,t,n){const i=this;function r(e,t,n){const r=_e(t);if(!r)throw new Error("header name must be a non-empty string");const s=H.findKey(i,r);(!s||void 0===i[s]||!0===n||void 0===n&&!1!==i[s])&&(i[s||t]=Se(e))}const s=(e,t)=>H.forEach(e,(e,n)=>r(e,n,t));if(H.isPlainObject(e)||e instanceof this.constructor)s(e,t);else if(H.isString(e)&&(e=e.trim())&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim()))s((e=>{const t={};let n,i,r;return e&&e.split("\n").forEach(function(e){r=e.indexOf(":"),n=e.substring(0,r).trim().toLowerCase(),i=e.substring(r+1).trim(),!n||t[n]&&be[n]||("set-cookie"===n?t[n]?t[n].push(i):t[n]=[i]:t[n]=t[n]?t[n]+", "+i:i)}),t})(e),t);else if(H.isObject(e)&&H.isIterable(e)){let n,i,r={};for(const t of e){if(!H.isArray(t))throw TypeError("Object iterator must return a key-value pair");r[i=t[0]]=(n=r[i])?H.isArray(n)?[...n,t[1]]:[n,t[1]]:t[1]}s(r,t)}else null!=e&&r(t,e,n);return this}get(e,t){if(e=_e(e)){const n=H.findKey(this,e);if(n){const e=this[n];if(!t)return e;if(!0===t)return function(e){const t=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let i;for(;i=n.exec(e);)t[i[1]]=i[2];return t}(e);if(H.isFunction(t))return t.call(this,e,n);if(H.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=_e(e)){const n=H.findKey(this,e);return!(!n||void 0===this[n]||t&&!Ee(0,this[n],n,t))}return!1}delete(e,t){const n=this;let i=!1;function r(e){if(e=_e(e)){const r=H.findKey(n,e);!r||t&&!Ee(0,n[r],r,t)||(delete n[r],i=!0)}}return H.isArray(e)?e.forEach(r):r(e),i}clear(e){const t=Object.keys(this);let n=t.length,i=!1;for(;n--;){const r=t[n];e&&!Ee(0,this[r],r,e,!0)||(delete this[r],i=!0)}return i}normalize(e){const t=this,n={};return H.forEach(this,(i,r)=>{const s=H.findKey(n,r);if(s)return t[s]=Se(i),void delete t[r];const a=e?function(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,n)=>t.toUpperCase()+n)}(r):String(r).trim();a!==r&&delete t[r],t[a]=Se(i),n[a]=!0}),this}concat(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.constructor.concat(this,...t)}toJSON(e){const t=Object.create(null);return H.forEach(this,(n,i)=>{null!=n&&!1!==n&&(t[i]=e&&H.isArray(n)?n.join(", "):n)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(e=>{let[t,n]=e;return t+": "+n}).join("\n")}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e){const t=new this(e);for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return i.forEach(e=>t.set(e)),t}static accessor(e){const t=(this[xe]=this[xe]={accessors:{}}).accessors,n=this.prototype;function i(e){const i=_e(e);t[i]||(!function(e,t){const n=H.toCamelCase(" "+t);["get","set","has"].forEach(i=>{Object.defineProperty(e,i+n,{value:function(e,n,r){return this[i].call(this,t,e,n,r)},configurable:!0})})}(n,e),t[i]=!0)}return H.isArray(e)?e.forEach(i):i(e),this}}Te.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),H.reduceDescriptors(Te.prototype,(e,t)=>{let{value:n}=e,i=t[0].toUpperCase()+t.slice(1);return{get:()=>n,set(e){this[i]=e}}}),H.freezeMethods(Te);const we=Te;function Ae(e,t){const n=this||ye,i=t||n,r=we.from(i.headers);let s=i.data;return H.forEach(e,function(e){s=e.call(n,s,r.normalize(),t?t.status:void 0)}),r.normalize(),s}function Me(e){return!(!e||!e.__CANCEL__)}function Re(e,t,n){q.call(this,null==e?"canceled":e,q.ERR_CANCELED,t,n),this.name="CanceledError"}H.inherits(Re,q,{__CANCEL__:!0});const Ce=Re;function Le(e,t,n){const i=n.config.validateStatus;n.status&&i&&!i(n.status)?t(new q("Request failed with status code "+n.status,[q.ERR_BAD_REQUEST,q.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}const Ie=function(e,t){e=e||10;const n=new Array(e),i=new Array(e);let r,s=0,a=0;return t=void 0!==t?t:1e3,function(o){const l=Date.now(),c=i[a];r||(r=l),n[s]=o,i[s]=l;let u=a,h=0;for(;u!==s;)h+=n[u++],u%=e;if(s=(s+1)%e,s===a&&(a=(a+1)%e),l-r<t)return;const d=c&&l-c;return d?Math.round(1e3*h/d):void 0}};const Pe=function(e,t){let n,i,r=0,s=1e3/t;const a=function(t){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now();r=s,n=null,i&&(clearTimeout(i),i=null),e(...t)};return[function(){const e=Date.now(),t=e-r;for(var o=arguments.length,l=new Array(o),c=0;c<o;c++)l[c]=arguments[c];t>=s?a(l,e):(n=l,i||(i=setTimeout(()=>{i=null,a(n)},s-t)))},()=>n&&a(n)]},ke=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,i=0;const r=Ie(50,250);return Pe(n=>{const s=n.loaded,a=n.lengthComputable?n.total:void 0,o=s-i,l=r(o);i=s;e({loaded:s,total:a,progress:a?s/a:void 0,bytes:o,rate:l||void 0,estimated:l&&a&&s<=a?(a-s)/l:void 0,event:n,lengthComputable:null!=a,[t?"download":"upload"]:!0})},n)},De=(e,t)=>{const n=null!=e;return[i=>t[0]({lengthComputable:n,total:e,loaded:i}),t[1]]},Ne=e=>function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return H.asap(()=>e(...n))},Oe=me.hasStandardBrowserEnv?((e,t)=>n=>(n=new URL(n,me.origin),e.protocol===n.protocol&&e.host===n.host&&(t||e.port===n.port)))(new URL(me.origin),me.navigator&&/(msie|trident)/i.test(me.navigator.userAgent)):()=>!0,Fe=me.hasStandardBrowserEnv?{write(e,t,n,i,r,s,a){if("undefined"===typeof document)return;const o=["".concat(e,"=").concat(encodeURIComponent(t))];H.isNumber(n)&&o.push("expires=".concat(new Date(n).toUTCString())),H.isString(i)&&o.push("path=".concat(i)),H.isString(r)&&o.push("domain=".concat(r)),!0===s&&o.push("secure"),H.isString(a)&&o.push("SameSite=".concat(a)),document.cookie=o.join("; ")},read(e){if("undefined"===typeof document)return null;const t=document.cookie.match(new RegExp("(?:^|; )"+e+"=([^;]*)"));return t?decodeURIComponent(t[1]):null},remove(e){this.write(e,"",Date.now()-864e5,"/")}}:{write(){},read:()=>null,remove(){}};function Ue(e,t,n){let i=!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t);return e&&(i||0==n)?function(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}const Be=e=>e instanceof we?(0,le.A)({},e):e;function ze(e,t){t=t||{};const n={};function i(e,t,n,i){return H.isPlainObject(e)&&H.isPlainObject(t)?H.merge.call({caseless:i},e,t):H.isPlainObject(t)?H.merge({},t):H.isArray(t)?t.slice():t}function r(e,t,n,r){return H.isUndefined(t)?H.isUndefined(e)?void 0:i(void 0,e,0,r):i(e,t,0,r)}function s(e,t){if(!H.isUndefined(t))return i(void 0,t)}function a(e,t){return H.isUndefined(t)?H.isUndefined(e)?void 0:i(void 0,e):i(void 0,t)}function o(n,r,s){return s in t?i(n,r):s in e?i(void 0,n):void 0}const l={url:s,method:s,data:s,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:o,headers:(e,t,n)=>r(Be(e),Be(t),0,!0)};return H.forEach(Object.keys((0,le.A)((0,le.A)({},e),t)),function(i){const s=l[i]||r,a=s(e[i],t[i],i);H.isUndefined(a)&&s!==o||(n[i]=a)}),n}const je=e=>{const t=ze({},e);let{data:n,withXSRFToken:i,xsrfHeaderName:r,xsrfCookieName:s,headers:a,auth:o}=t;if(t.headers=a=we.from(a),t.url=se(Ue(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),o&&a.set("Authorization","Basic "+btoa((o.username||"")+":"+(o.password?unescape(encodeURIComponent(o.password)):""))),H.isFormData(n))if(me.hasStandardBrowserEnv||me.hasStandardBrowserWebWorkerEnv)a.setContentType(void 0);else if(H.isFunction(n.getHeaders)){const e=n.getHeaders(),t=["content-type","content-length"];Object.entries(e).forEach(e=>{let[n,i]=e;t.includes(n.toLowerCase())&&a.set(n,i)})}if(me.hasStandardBrowserEnv&&(i&&H.isFunction(i)&&(i=i(t)),i||!1!==i&&Oe(t.url))){const e=r&&s&&Fe.read(s);e&&a.set(r,e)}return t},Ge="undefined"!==typeof XMLHttpRequest&&function(e){return new Promise(function(t,n){const i=je(e);let r=i.data;const s=we.from(i.headers).normalize();let a,o,l,c,u,{responseType:h,onUploadProgress:d,onDownloadProgress:f}=i;function p(){c&&c(),u&&u(),i.cancelToken&&i.cancelToken.unsubscribe(a),i.signal&&i.signal.removeEventListener("abort",a)}let m=new XMLHttpRequest;function g(){if(!m)return;const i=we.from("getAllResponseHeaders"in m&&m.getAllResponseHeaders());Le(function(e){t(e),p()},function(e){n(e),p()},{data:h&&"text"!==h&&"json"!==h?m.response:m.responseText,status:m.status,statusText:m.statusText,headers:i,config:e,request:m}),m=null}m.open(i.method.toUpperCase(),i.url,!0),m.timeout=i.timeout,"onloadend"in m?m.onloadend=g:m.onreadystatechange=function(){m&&4===m.readyState&&(0!==m.status||m.responseURL&&0===m.responseURL.indexOf("file:"))&&setTimeout(g)},m.onabort=function(){m&&(n(new q("Request aborted",q.ECONNABORTED,e,m)),m=null)},m.onerror=function(t){const i=t&&t.message?t.message:"Network Error",r=new q(i,q.ERR_NETWORK,e,m);r.event=t||null,n(r),m=null},m.ontimeout=function(){let t=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const r=i.transitional||oe;i.timeoutErrorMessage&&(t=i.timeoutErrorMessage),n(new q(t,r.clarifyTimeoutError?q.ETIMEDOUT:q.ECONNABORTED,e,m)),m=null},void 0===r&&s.setContentType(null),"setRequestHeader"in m&&H.forEach(s.toJSON(),function(e,t){m.setRequestHeader(t,e)}),H.isUndefined(i.withCredentials)||(m.withCredentials=!!i.withCredentials),h&&"json"!==h&&(m.responseType=i.responseType),f&&([l,u]=ke(f,!0),m.addEventListener("progress",l)),d&&m.upload&&([o,c]=ke(d),m.upload.addEventListener("progress",o),m.upload.addEventListener("loadend",c)),(i.cancelToken||i.signal)&&(a=t=>{m&&(n(!t||t.type?new Ce(null,e,m):t),m.abort(),m=null)},i.cancelToken&&i.cancelToken.subscribe(a),i.signal&&(i.signal.aborted?a():i.signal.addEventListener("abort",a)));const v=function(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(i.url);v&&-1===me.protocols.indexOf(v)?n(new q("Unsupported protocol "+v+":",q.ERR_BAD_REQUEST,e)):m.send(r||null)})},Ve=(e,t)=>{const{length:n}=e=e?e.filter(Boolean):[];if(t||n){let n,i=new AbortController;const r=function(e){if(!n){n=!0,a();const t=e instanceof Error?e:this.reason;i.abort(t instanceof q?t:new Ce(t instanceof Error?t.message:t))}};let s=t&&setTimeout(()=>{s=null,r(new q("timeout ".concat(t," of ms exceeded"),q.ETIMEDOUT))},t);const a=()=>{e&&(s&&clearTimeout(s),s=null,e.forEach(e=>{e.unsubscribe?e.unsubscribe(r):e.removeEventListener("abort",r)}),e=null)};e.forEach(e=>e.addEventListener("abort",r));const{signal:o}=i;return o.unsubscribe=()=>H.asap(a),o}};function He(e,t){this.v=e,this.k=t}function We(e){return function(){return new Ye(e.apply(this,arguments))}}function Ye(e){var t,n;function i(t,n){try{var s=e[t](n),a=s.value,o=a instanceof He;Promise.resolve(o?a.v:a).then(function(n){if(o){var l="return"===t?"return":"next";if(!a.k||n.done)return i(l,n);n=e[l](n).value}r(s.done?"return":"normal",n)},function(e){i("throw",e)})}catch(e){r("throw",e)}}function r(e,r){switch(e){case"return":t.resolve({value:r,done:!0});break;case"throw":t.reject(r);break;default:t.resolve({value:r,done:!1})}(t=t.next)?i(t.key,t.arg):n=null}this._invoke=function(e,r){return new Promise(function(s,a){var o={key:e,arg:r,resolve:s,reject:a,next:null};n?n=n.next=o:(t=n=o,i(e,r))})},"function"!=typeof e.return&&(this.return=void 0)}function Xe(e){return new He(e,0)}function qe(e){var t={},n=!1;function i(t,i){return n=!0,i=new Promise(function(n){n(e[t](i))}),{done:!1,value:new He(i,1)}}return t["undefined"!=typeof Symbol&&Symbol.iterator||"@@iterator"]=function(){return this},t.next=function(e){return n?(n=!1,e):i("next",e)},"function"==typeof e.throw&&(t.throw=function(e){if(n)throw n=!1,e;return i("throw",e)}),"function"==typeof e.return&&(t.return=function(e){return n?(n=!1,e):i("return",e)}),t}function Ke(e){var t,n,i,r=2;for("undefined"!=typeof Symbol&&(n=Symbol.asyncIterator,i=Symbol.iterator);r--;){if(n&&null!=(t=e[n]))return t.call(e);if(i&&null!=(t=e[i]))return new Ze(t.call(e));n="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function Ze(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then(function(e){return{value:e,done:t}})}return Ze=function(e){this.s=e,this.n=e.next},Ze.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?Promise.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?Promise.reject(e):t(n.apply(this.s,arguments))}},new Ze(e)}Ye.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},Ye.prototype.next=function(e){return this._invoke("next",e)},Ye.prototype.throw=function(e){return this._invoke("throw",e)},Ye.prototype.return=function(e){return this._invoke("return",e)};const Je=function*(e,t){let n=e.byteLength;if(!t||n<t)return void(yield e);let i,r=0;for(;r<n;)i=r+t,yield e.slice(r,i),r=i},Qe=function(){var e=We(function*(e,t){var n,i=!1,r=!1;try{for(var s,a=Ke($e(e));i=!(s=yield Xe(a.next())).done;i=!1){const e=s.value;yield*qe(Ke(Je(e,t)))}}catch(o){r=!0,n=o}finally{try{i&&null!=a.return&&(yield Xe(a.return()))}finally{if(r)throw n}}});return function(t,n){return e.apply(this,arguments)}}(),$e=function(){var e=We(function*(e){if(e[Symbol.asyncIterator])return void(yield*qe(Ke(e)));const t=e.getReader();try{for(;;){const{done:e,value:n}=yield Xe(t.read());if(e)break;yield n}}finally{yield Xe(t.cancel())}});return function(t){return e.apply(this,arguments)}}(),et=(e,t,n,i)=>{const r=Qe(e,t);let s,a=0,o=e=>{s||(s=!0,i&&i(e))};return new ReadableStream({async pull(e){try{const{done:t,value:i}=await r.next();if(t)return o(),void e.close();let s=i.byteLength;if(n){let e=a+=s;n(e)}e.enqueue(new Uint8Array(i))}catch(t){throw o(t),t}},cancel:e=>(o(e),r.return())},{highWaterMark:2})},{isFunction:tt}=H,nt=(e=>{let{Request:t,Response:n}=e;return{Request:t,Response:n}})(H.global),{ReadableStream:it,TextEncoder:rt}=H.global,st=function(e){try{for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return!!e(...n)}catch(r){return!1}},at=e=>{e=H.merge.call({skipUndefined:!0},nt,e);const{fetch:t,Request:n,Response:i}=e,r=t?tt(t):"function"===typeof fetch,s=tt(n),a=tt(i);if(!r)return!1;const o=r&&tt(it),l=r&&("function"===typeof rt?(c=new rt,e=>c.encode(e)):async e=>new Uint8Array(await new n(e).arrayBuffer()));var c;const u=s&&o&&st(()=>{let e=!1;const t=new n(me.origin,{body:new it,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),h=a&&o&&st(()=>H.isReadableStream(new i("").body)),d={stream:h&&(e=>e.body)};r&&["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!d[e]&&(d[e]=(t,n)=>{let i=t&&t[e];if(i)return i.call(t);throw new q("Response type '".concat(e,"' is not supported"),q.ERR_NOT_SUPPORT,n)})});const f=async(e,t)=>{const i=H.toFiniteNumber(e.getContentLength());return null==i?(async e=>{if(null==e)return 0;if(H.isBlob(e))return e.size;if(H.isSpecCompliantForm(e)){const t=new n(me.origin,{method:"POST",body:e});return(await t.arrayBuffer()).byteLength}return H.isArrayBufferView(e)||H.isArrayBuffer(e)?e.byteLength:(H.isURLSearchParams(e)&&(e+=""),H.isString(e)?(await l(e)).byteLength:void 0)})(t):i};return async e=>{let{url:r,method:a,data:o,signal:l,cancelToken:c,timeout:p,onDownloadProgress:m,onUploadProgress:g,responseType:v,headers:y,withCredentials:b="same-origin",fetchOptions:x}=je(e),_=t||fetch;v=v?(v+"").toLowerCase():"text";let S=Ve([l,c&&c.toAbortSignal()],p),E=null;const T=S&&S.unsubscribe&&(()=>{S.unsubscribe()});let w;try{if(g&&u&&"get"!==a&&"head"!==a&&0!==(w=await f(y,o))){let e,t=new n(r,{method:"POST",body:o,duplex:"half"});if(H.isFormData(o)&&(e=t.headers.get("content-type"))&&y.setContentType(e),t.body){const[e,n]=De(w,ke(Ne(g)));o=et(t.body,65536,e,n)}}H.isString(b)||(b=b?"include":"omit");const t=s&&"credentials"in n.prototype,l=(0,le.A)((0,le.A)({},x),{},{signal:S,method:a.toUpperCase(),headers:y.normalize().toJSON(),body:o,duplex:"half",credentials:t?b:void 0});E=s&&new n(r,l);let c=await(s?_(E,x):_(r,l));const p=h&&("stream"===v||"response"===v);if(h&&(m||p&&T)){const e={};["status","statusText","headers"].forEach(t=>{e[t]=c[t]});const t=H.toFiniteNumber(c.headers.get("content-length")),[n,r]=m&&De(t,ke(Ne(m),!0))||[];c=new i(et(c.body,65536,n,()=>{r&&r(),T&&T()}),e)}v=v||"text";let A=await d[H.findKey(d,v)||"text"](c,e);return!p&&T&&T(),await new Promise((t,n)=>{Le(t,n,{data:A,headers:we.from(c.headers),status:c.status,statusText:c.statusText,config:e,request:E})})}catch(A){if(T&&T(),A&&"TypeError"===A.name&&/Load failed|fetch/i.test(A.message))throw Object.assign(new q("Network Error",q.ERR_NETWORK,e,E),{cause:A.cause||A});throw q.from(A,A&&A.code,e,E)}}},ot=new Map,lt=e=>{let t=e&&e.env||{};const{fetch:n,Request:i,Response:r}=t,s=[i,r,n];let a,o,l=s.length,c=ot;for(;l--;)a=s[l],o=c.get(a),void 0===o&&c.set(a,o=l?new Map:at(t)),c=o;return o},ct=(lt(),{http:null,xhr:Ge,fetch:{get:lt}});H.forEach(ct,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(n){}Object.defineProperty(e,"adapterName",{value:t})}});const ut=e=>"- ".concat(e),ht=e=>H.isFunction(e)||null===e||!1===e;const dt={getAdapter:function(e,t){e=H.isArray(e)?e:[e];const{length:n}=e;let i,r;const s={};for(let a=0;a<n;a++){let n;if(i=e[a],r=i,!ht(i)&&(r=ct[(n=String(i)).toLowerCase()],void 0===r))throw new q("Unknown adapter '".concat(n,"'"));if(r&&(H.isFunction(r)||(r=r.get(t))))break;s[n||"#"+a]=r}if(!r){const e=Object.entries(s).map(e=>{let[t,n]=e;return"adapter ".concat(t," ")+(!1===n?"is not supported by the environment":"is not available in the build")});let t=n?e.length>1?"since :\n"+e.map(ut).join("\n"):" "+ut(e[0]):"as no adapter specified";throw new q("There is no suitable adapter to dispatch the request "+t,"ERR_NOT_SUPPORT")}return r},adapters:ct};function ft(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Ce(null,e)}function pt(e){ft(e),e.headers=we.from(e.headers),e.data=Ae.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1);return dt.getAdapter(e.adapter||ye.adapter,e)(e).then(function(t){return ft(e),t.data=Ae.call(e,e.transformResponse,t),t.headers=we.from(t.headers),t},function(t){return Me(t)||(ft(e),t&&t.response&&(t.response.data=Ae.call(e,e.transformResponse,t.response),t.response.headers=we.from(t.response.headers))),Promise.reject(t)})}const mt="1.13.2",gt={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{gt[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}});const vt={};gt.transitional=function(e,t,n){function i(e,t){return"[Axios v"+mt+"] Transitional option '"+e+"'"+t+(n?". "+n:"")}return(n,r,s)=>{if(!1===e)throw new q(i(r," has been removed"+(t?" in "+t:"")),q.ERR_DEPRECATED);return t&&!vt[r]&&(vt[r]=!0,console.warn(i(r," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,r,s)}},gt.spelling=function(e){return(t,n)=>(console.warn("".concat(n," is likely a misspelling of ").concat(e)),!0)};const yt={assertOptions:function(e,t,n){if("object"!==typeof e)throw new q("options must be an object",q.ERR_BAD_OPTION_VALUE);const i=Object.keys(e);let r=i.length;for(;r-- >0;){const s=i[r],a=t[s];if(a){const t=e[s],n=void 0===t||a(t,s,e);if(!0!==n)throw new q("option "+s+" must be "+n,q.ERR_BAD_OPTION_VALUE);continue}if(!0!==n)throw new q("Unknown option "+s,q.ERR_BAD_OPTION)}},validators:gt},bt=yt.validators;class xt{constructor(e){this.defaults=e||{},this.interceptors={request:new ae,response:new ae}}async request(e,t){try{return await this._request(e,t)}catch(n){if(n instanceof Error){let e={};Error.captureStackTrace?Error.captureStackTrace(e):e=new Error;const t=e.stack?e.stack.replace(/^.+\n/,""):"";try{n.stack?t&&!String(n.stack).endsWith(t.replace(/^.+\n.+\n/,""))&&(n.stack+="\n"+t):n.stack=t}catch(i){}}throw n}}_request(e,t){"string"===typeof e?(t=t||{}).url=e:t=e||{},t=ze(this.defaults,t);const{transitional:n,paramsSerializer:i,headers:r}=t;void 0!==n&&yt.assertOptions(n,{silentJSONParsing:bt.transitional(bt.boolean),forcedJSONParsing:bt.transitional(bt.boolean),clarifyTimeoutError:bt.transitional(bt.boolean)},!1),null!=i&&(H.isFunction(i)?t.paramsSerializer={serialize:i}:yt.assertOptions(i,{encode:bt.function,serialize:bt.function},!0)),void 0!==t.allowAbsoluteUrls||(void 0!==this.defaults.allowAbsoluteUrls?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),yt.assertOptions(t,{baseUrl:bt.spelling("baseURL"),withXsrfToken:bt.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let s=r&&H.merge(r.common,r[t.method]);r&&H.forEach(["delete","get","head","post","put","patch","common"],e=>{delete r[e]}),t.headers=we.concat(s,r);const a=[];let o=!0;this.interceptors.request.forEach(function(e){"function"===typeof e.runWhen&&!1===e.runWhen(t)||(o=o&&e.synchronous,a.unshift(e.fulfilled,e.rejected))});const l=[];let c;this.interceptors.response.forEach(function(e){l.push(e.fulfilled,e.rejected)});let u,h=0;if(!o){const e=[pt.bind(this),void 0];for(e.unshift(...a),e.push(...l),u=e.length,c=Promise.resolve(t);h<u;)c=c.then(e[h++],e[h++]);return c}u=a.length;let d=t;for(;h<u;){const e=a[h++],t=a[h++];try{d=e(d)}catch(f){t.call(this,f);break}}try{c=pt.call(this,d)}catch(f){return Promise.reject(f)}for(h=0,u=l.length;h<u;)c=c.then(l[h++],l[h++]);return c}getUri(e){return se(Ue((e=ze(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}}H.forEach(["delete","get","head","options"],function(e){xt.prototype[e]=function(t,n){return this.request(ze(n||{},{method:e,url:t,data:(n||{}).data}))}}),H.forEach(["post","put","patch"],function(e){function t(t){return function(n,i,r){return this.request(ze(r||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:n,data:i}))}}xt.prototype[e]=t(),xt.prototype[e+"Form"]=t(!0)});const _t=xt;class St{constructor(e){if("function"!==typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(e){t=e});const n=this;this.promise.then(e=>{if(!n._listeners)return;let t=n._listeners.length;for(;t-- >0;)n._listeners[t](e);n._listeners=null}),this.promise.then=e=>{let t;const i=new Promise(e=>{n.subscribe(e),t=e}).then(e);return i.cancel=function(){n.unsubscribe(t)},i},e(function(e,i,r){n.reason||(n.reason=new Ce(e,i,r),t(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=t=>{e.abort(t)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new St(function(t){e=t}),cancel:e}}}const Et=St;const Tt={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(Tt).forEach(e=>{let[t,n]=e;Tt[n]=t});const wt=Tt;const At=function e(t){const n=new _t(t),i=r(_t.prototype.request,n);return H.extend(i,_t.prototype,n,{allOwnKeys:!0}),H.extend(i,n,null,{allOwnKeys:!0}),i.create=function(n){return e(ze(t,n))},i}(ye);At.Axios=_t,At.CanceledError=Ce,At.CancelToken=Et,At.isCancel=Me,At.VERSION=mt,At.toFormData=$,At.AxiosError=q,At.Cancel=At.CanceledError,At.all=function(e){return Promise.all(e)},At.spread=function(e){return function(t){return e.apply(null,t)}},At.isAxiosError=function(e){return H.isObject(e)&&!0===e.isAxiosError},At.mergeConfig=ze,At.AxiosHeaders=we,At.formToJSON=e=>ge(H.isHTMLForm(e)?new FormData(e):e),At.getAdapter=dt.getAdapter,At.HttpStatusCode=wt,At.default=At;const Mt=At},730:(e,t,n)=>{"use strict";var i=n(43),r=n(853);function s(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=new Set,o={};function l(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(o[e]=t,e=0;e<t.length;e++)a.add(t[e])}var u=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),h=Object.prototype.hasOwnProperty,d=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,f={},p={};function m(e,t,n,i,r,s,a){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=s,this.removeEmptyString=a}var g={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){g[e]=new m(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];g[t]=new m(t,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){g[e]=new m(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){g[e]=new m(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){g[e]=new m(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){g[e]=new m(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){g[e]=new m(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){g[e]=new m(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){g[e]=new m(e,5,!1,e.toLowerCase(),null,!1,!1)});var v=/[\-:]([a-z])/g;function y(e){return e[1].toUpperCase()}function b(e,t,n,i){var r=g.hasOwnProperty(t)?g[t]:null;(null!==r?0!==r.type:i||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,i){if(null===t||"undefined"===typeof t||function(e,t,n,i){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!i&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,i))return!0;if(i)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,r,i)&&(n=null),i||null===r?function(e){return!!h.call(p,e)||!h.call(f,e)&&(d.test(e)?p[e]=!0:(f[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):r.mustUseProperty?e[r.propertyName]=null===n?3!==r.type&&"":n:(t=r.attributeName,i=r.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(r=r.type)||4===r&&!0===n?"":""+n,i?e.setAttributeNS(i,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(v,y);g[t]=new m(t,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(v,y);g[t]=new m(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(v,y);g[t]=new m(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){g[e]=new m(e,1,!1,e.toLowerCase(),null,!1,!1)}),g.xlinkHref=new m("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){g[e]=new m(e,1,!1,e.toLowerCase(),null,!0,!0)});var x=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,_=Symbol.for("react.element"),S=Symbol.for("react.portal"),E=Symbol.for("react.fragment"),T=Symbol.for("react.strict_mode"),w=Symbol.for("react.profiler"),A=Symbol.for("react.provider"),M=Symbol.for("react.context"),R=Symbol.for("react.forward_ref"),C=Symbol.for("react.suspense"),L=Symbol.for("react.suspense_list"),I=Symbol.for("react.memo"),P=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var k=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var D=Symbol.iterator;function N(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=D&&e[D]||e["@@iterator"])?e:null}var O,F=Object.assign;function U(e){if(void 0===O)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);O=t&&t[1]||""}return"\n"+O+e}var B=!1;function z(e,t){if(!e||B)return"";B=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var i=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){i=c}e.call(t.prototype)}else{try{throw Error()}catch(c){i=c}e()}}catch(c){if(c&&i&&"string"===typeof c.stack){for(var r=c.stack.split("\n"),s=i.stack.split("\n"),a=r.length-1,o=s.length-1;1<=a&&0<=o&&r[a]!==s[o];)o--;for(;1<=a&&0<=o;a--,o--)if(r[a]!==s[o]){if(1!==a||1!==o)do{if(a--,0>--o||r[a]!==s[o]){var l="\n"+r[a].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=a&&0<=o);break}}}finally{B=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?U(e):""}function j(e){switch(e.tag){case 5:return U(e.type);case 16:return U("Lazy");case 13:return U("Suspense");case 19:return U("SuspenseList");case 0:case 2:case 15:return e=z(e.type,!1);case 11:return e=z(e.type.render,!1);case 1:return e=z(e.type,!0);default:return""}}function G(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case E:return"Fragment";case S:return"Portal";case w:return"Profiler";case T:return"StrictMode";case C:return"Suspense";case L:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case M:return(e.displayName||"Context")+".Consumer";case A:return(e._context.displayName||"Context")+".Provider";case R:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case I:return null!==(t=e.displayName||null)?t:G(e.type)||"Memo";case P:t=e._payload,e=e._init;try{return G(e(t))}catch(n){}}return null}function V(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return G(t);case 8:return t===T?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function H(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function W(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function Y(e){e._valueTracker||(e._valueTracker=function(e){var t=W(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),i=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var r=n.get,s=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(e){i=""+e,s.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(e){i=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function X(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),i="";return e&&(i=W(e)?e.checked?"true":"false":e.value),(e=i)!==n&&(t.setValue(e),!0)}function q(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function K(e,t){var n=t.checked;return F({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function Z(e,t){var n=null==t.defaultValue?"":t.defaultValue,i=null!=t.checked?t.checked:t.defaultChecked;n=H(null!=t.value?t.value:n),e._wrapperState={initialChecked:i,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function J(e,t){null!=(t=t.checked)&&b(e,"checked",t,!1)}function Q(e,t){J(e,t);var n=H(t.value),i=t.type;if(null!=n)"number"===i?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===i||"reset"===i)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,H(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function $(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var i=t.type;if(!("submit"!==i&&"reset"!==i||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&q(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,i){if(e=e.options,t){t={};for(var r=0;r<n.length;r++)t["$"+n[r]]=!0;for(n=0;n<e.length;n++)r=t.hasOwnProperty("$"+e[n].value),e[n].selected!==r&&(e[n].selected=r),r&&i&&(e[n].defaultSelected=!0)}else{for(n=""+H(n),t=null,r=0;r<e.length;r++){if(e[r].value===n)return e[r].selected=!0,void(i&&(e[r].defaultSelected=!0));null!==t||e[r].disabled||(t=e[r])}null!==t&&(t.selected=!0)}}function ie(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(s(91));return F({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function re(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(s(92));if(te(n)){if(1<n.length)throw Error(s(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:H(n)}}function se(e,t){var n=H(t.value),i=H(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=i&&(e.defaultValue=""+i)}function ae(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function oe(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function le(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?oe(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,ue,he=(ue=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,i){MSApp.execUnsafeLocalFunction(function(){return ue(e,t)})}:ue);function de(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var fe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},pe=["Webkit","ms","Moz","O"];function me(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||fe.hasOwnProperty(e)&&fe[e]?(""+t).trim():t+"px"}function ge(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var i=0===n.indexOf("--"),r=me(n,t[n],i);"float"===n&&(n="cssFloat"),i?e.setProperty(n,r):e[n]=r}}Object.keys(fe).forEach(function(e){pe.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),fe[t]=fe[e]})});var ve=F({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ye(e,t){if(t){if(ve[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(s(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(s(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(s(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(s(62))}}function be(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var xe=null;function _e(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Se=null,Ee=null,Te=null;function we(e){if(e=br(e)){if("function"!==typeof Se)throw Error(s(280));var t=e.stateNode;t&&(t=_r(t),Se(e.stateNode,e.type,t))}}function Ae(e){Ee?Te?Te.push(e):Te=[e]:Ee=e}function Me(){if(Ee){var e=Ee,t=Te;if(Te=Ee=null,we(e),t)for(e=0;e<t.length;e++)we(t[e])}}function Re(e,t){return e(t)}function Ce(){}var Le=!1;function Ie(e,t,n){if(Le)return e(t,n);Le=!0;try{return Re(e,t,n)}finally{Le=!1,(null!==Ee||null!==Te)&&(Ce(),Me())}}function Pe(e,t){var n=e.stateNode;if(null===n)return null;var i=_r(n);if(null===i)return null;n=i[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(i=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!i;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(s(231,t,typeof n));return n}var ke=!1;if(u)try{var De={};Object.defineProperty(De,"passive",{get:function(){ke=!0}}),window.addEventListener("test",De,De),window.removeEventListener("test",De,De)}catch(ue){ke=!1}function Ne(e,t,n,i,r,s,a,o,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(u){this.onError(u)}}var Oe=!1,Fe=null,Ue=!1,Be=null,ze={onError:function(e){Oe=!0,Fe=e}};function je(e,t,n,i,r,s,a,o,l){Oe=!1,Fe=null,Ne.apply(ze,arguments)}function Ge(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function Ve(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function He(e){if(Ge(e)!==e)throw Error(s(188))}function We(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=Ge(e)))throw Error(s(188));return t!==e?null:e}for(var n=e,i=t;;){var r=n.return;if(null===r)break;var a=r.alternate;if(null===a){if(null!==(i=r.return)){n=i;continue}break}if(r.child===a.child){for(a=r.child;a;){if(a===n)return He(r),e;if(a===i)return He(r),t;a=a.sibling}throw Error(s(188))}if(n.return!==i.return)n=r,i=a;else{for(var o=!1,l=r.child;l;){if(l===n){o=!0,n=r,i=a;break}if(l===i){o=!0,i=r,n=a;break}l=l.sibling}if(!o){for(l=a.child;l;){if(l===n){o=!0,n=a,i=r;break}if(l===i){o=!0,i=a,n=r;break}l=l.sibling}if(!o)throw Error(s(189))}}if(n.alternate!==i)throw Error(s(190))}if(3!==n.tag)throw Error(s(188));return n.stateNode.current===n?e:t}(e))?Ye(e):null}function Ye(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=Ye(e);if(null!==t)return t;e=e.sibling}return null}var Xe=r.unstable_scheduleCallback,qe=r.unstable_cancelCallback,Ke=r.unstable_shouldYield,Ze=r.unstable_requestPaint,Je=r.unstable_now,Qe=r.unstable_getCurrentPriorityLevel,$e=r.unstable_ImmediatePriority,et=r.unstable_UserBlockingPriority,tt=r.unstable_NormalPriority,nt=r.unstable_LowPriority,it=r.unstable_IdlePriority,rt=null,st=null;var at=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(ot(e)/lt|0)|0},ot=Math.log,lt=Math.LN2;var ct=64,ut=4194304;function ht(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function dt(e,t){var n=e.pendingLanes;if(0===n)return 0;var i=0,r=e.suspendedLanes,s=e.pingedLanes,a=268435455&n;if(0!==a){var o=a&~r;0!==o?i=ht(o):0!==(s&=a)&&(i=ht(s))}else 0!==(a=n&~r)?i=ht(a):0!==s&&(i=ht(s));if(0===i)return 0;if(0!==t&&t!==i&&0===(t&r)&&((r=i&-i)>=(s=t&-t)||16===r&&0!==(4194240&s)))return t;if(0!==(4&i)&&(i|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=i;0<t;)r=1<<(n=31-at(t)),i|=e[n],t&=~r;return i}function ft(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function pt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function mt(){var e=ct;return 0===(4194240&(ct<<=1))&&(ct=64),e}function gt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function vt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-at(t)]=n}function yt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var i=31-at(n),r=1<<i;r&t|e[i]&t&&(e[i]|=t),n&=~r}}var bt=0;function xt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var _t,St,Et,Tt,wt,At=!1,Mt=[],Rt=null,Ct=null,Lt=null,It=new Map,Pt=new Map,kt=[],Dt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Nt(e,t){switch(e){case"focusin":case"focusout":Rt=null;break;case"dragenter":case"dragleave":Ct=null;break;case"mouseover":case"mouseout":Lt=null;break;case"pointerover":case"pointerout":It.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pt.delete(t.pointerId)}}function Ot(e,t,n,i,r,s){return null===e||e.nativeEvent!==s?(e={blockedOn:t,domEventName:n,eventSystemFlags:i,nativeEvent:s,targetContainers:[r]},null!==t&&(null!==(t=br(t))&&St(t)),e):(e.eventSystemFlags|=i,t=e.targetContainers,null!==r&&-1===t.indexOf(r)&&t.push(r),e)}function Ft(e){var t=yr(e.target);if(null!==t){var n=Ge(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=Ve(n)))return e.blockedOn=t,void wt(e.priority,function(){Et(n)})}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Ut(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Kt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=br(n))&&St(t),e.blockedOn=n,!1;var i=new(n=e.nativeEvent).constructor(n.type,n);xe=i,n.target.dispatchEvent(i),xe=null,t.shift()}return!0}function Bt(e,t,n){Ut(e)&&n.delete(t)}function zt(){At=!1,null!==Rt&&Ut(Rt)&&(Rt=null),null!==Ct&&Ut(Ct)&&(Ct=null),null!==Lt&&Ut(Lt)&&(Lt=null),It.forEach(Bt),Pt.forEach(Bt)}function jt(e,t){e.blockedOn===t&&(e.blockedOn=null,At||(At=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,zt)))}function Gt(e){function t(t){return jt(t,e)}if(0<Mt.length){jt(Mt[0],e);for(var n=1;n<Mt.length;n++){var i=Mt[n];i.blockedOn===e&&(i.blockedOn=null)}}for(null!==Rt&&jt(Rt,e),null!==Ct&&jt(Ct,e),null!==Lt&&jt(Lt,e),It.forEach(t),Pt.forEach(t),n=0;n<kt.length;n++)(i=kt[n]).blockedOn===e&&(i.blockedOn=null);for(;0<kt.length&&null===(n=kt[0]).blockedOn;)Ft(n),null===n.blockedOn&&kt.shift()}var Vt=x.ReactCurrentBatchConfig,Ht=!0;function Wt(e,t,n,i){var r=bt,s=Vt.transition;Vt.transition=null;try{bt=1,Xt(e,t,n,i)}finally{bt=r,Vt.transition=s}}function Yt(e,t,n,i){var r=bt,s=Vt.transition;Vt.transition=null;try{bt=4,Xt(e,t,n,i)}finally{bt=r,Vt.transition=s}}function Xt(e,t,n,i){if(Ht){var r=Kt(e,t,n,i);if(null===r)Hi(e,t,i,qt,n),Nt(e,i);else if(function(e,t,n,i,r){switch(t){case"focusin":return Rt=Ot(Rt,e,t,n,i,r),!0;case"dragenter":return Ct=Ot(Ct,e,t,n,i,r),!0;case"mouseover":return Lt=Ot(Lt,e,t,n,i,r),!0;case"pointerover":var s=r.pointerId;return It.set(s,Ot(It.get(s)||null,e,t,n,i,r)),!0;case"gotpointercapture":return s=r.pointerId,Pt.set(s,Ot(Pt.get(s)||null,e,t,n,i,r)),!0}return!1}(r,e,t,n,i))i.stopPropagation();else if(Nt(e,i),4&t&&-1<Dt.indexOf(e)){for(;null!==r;){var s=br(r);if(null!==s&&_t(s),null===(s=Kt(e,t,n,i))&&Hi(e,t,i,qt,n),s===r)break;r=s}null!==r&&i.stopPropagation()}else Hi(e,t,i,null,n)}}var qt=null;function Kt(e,t,n,i){if(qt=null,null!==(e=yr(e=_e(i))))if(null===(t=Ge(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=Ve(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return qt=e,null}function Zt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Qe()){case $e:return 1;case et:return 4;case tt:case nt:return 16;case it:return 536870912;default:return 16}default:return 16}}var Jt=null,Qt=null,$t=null;function en(){if($t)return $t;var e,t,n=Qt,i=n.length,r="value"in Jt?Jt.value:Jt.textContent,s=r.length;for(e=0;e<i&&n[e]===r[e];e++);var a=i-e;for(t=1;t<=a&&n[i-t]===r[s-t];t++);return $t=r.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function rn(){return!1}function sn(e){function t(t,n,i,r,s){for(var a in this._reactName=t,this._targetInst=i,this.type=n,this.nativeEvent=r,this.target=s,this.currentTarget=null,e)e.hasOwnProperty(a)&&(t=e[a],this[a]=t?t(r):r[a]);return this.isDefaultPrevented=(null!=r.defaultPrevented?r.defaultPrevented:!1===r.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return F(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var an,on,ln,cn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},un=sn(cn),hn=F({},cn,{view:0,detail:0}),dn=sn(hn),fn=F({},hn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:wn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ln&&(ln&&"mousemove"===e.type?(an=e.screenX-ln.screenX,on=e.screenY-ln.screenY):on=an=0,ln=e),an)},movementY:function(e){return"movementY"in e?e.movementY:on}}),pn=sn(fn),mn=sn(F({},fn,{dataTransfer:0})),gn=sn(F({},hn,{relatedTarget:0})),vn=sn(F({},cn,{animationName:0,elapsedTime:0,pseudoElement:0})),yn=F({},cn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),bn=sn(yn),xn=sn(F({},cn,{data:0})),_n={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Sn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},En={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Tn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=En[e])&&!!t[e]}function wn(){return Tn}var An=F({},hn,{key:function(e){if(e.key){var t=_n[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?Sn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:wn,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Mn=sn(An),Rn=sn(F({},fn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Cn=sn(F({},hn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:wn})),Ln=sn(F({},cn,{propertyName:0,elapsedTime:0,pseudoElement:0})),In=F({},fn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Pn=sn(In),kn=[9,13,27,32],Dn=u&&"CompositionEvent"in window,Nn=null;u&&"documentMode"in document&&(Nn=document.documentMode);var On=u&&"TextEvent"in window&&!Nn,Fn=u&&(!Dn||Nn&&8<Nn&&11>=Nn),Un=String.fromCharCode(32),Bn=!1;function zn(e,t){switch(e){case"keyup":return-1!==kn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function jn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Gn=!1;var Vn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Hn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Vn[e.type]:"textarea"===t}function Wn(e,t,n,i){Ae(i),0<(t=Yi(t,"onChange")).length&&(n=new un("onChange","change",null,n,i),e.push({event:n,listeners:t}))}var Yn=null,Xn=null;function qn(e){Ui(e,0)}function Kn(e){if(X(xr(e)))return e}function Zn(e,t){if("change"===e)return t}var Jn=!1;if(u){var Qn;if(u){var $n="oninput"in document;if(!$n){var ei=document.createElement("div");ei.setAttribute("oninput","return;"),$n="function"===typeof ei.oninput}Qn=$n}else Qn=!1;Jn=Qn&&(!document.documentMode||9<document.documentMode)}function ti(){Yn&&(Yn.detachEvent("onpropertychange",ni),Xn=Yn=null)}function ni(e){if("value"===e.propertyName&&Kn(Xn)){var t=[];Wn(t,Xn,e,_e(e)),Ie(qn,t)}}function ii(e,t,n){"focusin"===e?(ti(),Xn=n,(Yn=t).attachEvent("onpropertychange",ni)):"focusout"===e&&ti()}function ri(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Kn(Xn)}function si(e,t){if("click"===e)return Kn(t)}function ai(e,t){if("input"===e||"change"===e)return Kn(t)}var oi="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function li(e,t){if(oi(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!h.call(t,r)||!oi(e[r],t[r]))return!1}return!0}function ci(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function ui(e,t){var n,i=ci(e);for(e=0;i;){if(3===i.nodeType){if(n=e+i.textContent.length,e<=t&&n>=t)return{node:i,offset:t-e};e=n}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=ci(i)}}function hi(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?hi(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function di(){for(var e=window,t=q();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(i){n=!1}if(!n)break;t=q((e=t.contentWindow).document)}return t}function fi(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function pi(e){var t=di(),n=e.focusedElem,i=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&hi(n.ownerDocument.documentElement,n)){if(null!==i&&fi(n))if(t=i.start,void 0===(e=i.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var r=n.textContent.length,s=Math.min(i.start,r);i=void 0===i.end?s:Math.min(i.end,r),!e.extend&&s>i&&(r=i,i=s,s=r),r=ui(n,s);var a=ui(n,i);r&&a&&(1!==e.rangeCount||e.anchorNode!==r.node||e.anchorOffset!==r.offset||e.focusNode!==a.node||e.focusOffset!==a.offset)&&((t=t.createRange()).setStart(r.node,r.offset),e.removeAllRanges(),s>i?(e.addRange(t),e.extend(a.node,a.offset)):(t.setEnd(a.node,a.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var mi=u&&"documentMode"in document&&11>=document.documentMode,gi=null,vi=null,yi=null,bi=!1;function xi(e,t,n){var i=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;bi||null==gi||gi!==q(i)||("selectionStart"in(i=gi)&&fi(i)?i={start:i.selectionStart,end:i.selectionEnd}:i={anchorNode:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset},yi&&li(yi,i)||(yi=i,0<(i=Yi(vi,"onSelect")).length&&(t=new un("onSelect","select",null,t,n),e.push({event:t,listeners:i}),t.target=gi)))}function _i(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Si={animationend:_i("Animation","AnimationEnd"),animationiteration:_i("Animation","AnimationIteration"),animationstart:_i("Animation","AnimationStart"),transitionend:_i("Transition","TransitionEnd")},Ei={},Ti={};function wi(e){if(Ei[e])return Ei[e];if(!Si[e])return e;var t,n=Si[e];for(t in n)if(n.hasOwnProperty(t)&&t in Ti)return Ei[e]=n[t];return e}u&&(Ti=document.createElement("div").style,"AnimationEvent"in window||(delete Si.animationend.animation,delete Si.animationiteration.animation,delete Si.animationstart.animation),"TransitionEvent"in window||delete Si.transitionend.transition);var Ai=wi("animationend"),Mi=wi("animationiteration"),Ri=wi("animationstart"),Ci=wi("transitionend"),Li=new Map,Ii="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Pi(e,t){Li.set(e,t),l(t,[e])}for(var ki=0;ki<Ii.length;ki++){var Di=Ii[ki];Pi(Di.toLowerCase(),"on"+(Di[0].toUpperCase()+Di.slice(1)))}Pi(Ai,"onAnimationEnd"),Pi(Mi,"onAnimationIteration"),Pi(Ri,"onAnimationStart"),Pi("dblclick","onDoubleClick"),Pi("focusin","onFocus"),Pi("focusout","onBlur"),Pi(Ci,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ni="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Oi=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ni));function Fi(e,t,n){var i=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,i,r,a,o,l,c){if(je.apply(this,arguments),Oe){if(!Oe)throw Error(s(198));var u=Fe;Oe=!1,Fe=null,Ue||(Ue=!0,Be=u)}}(i,t,void 0,e),e.currentTarget=null}function Ui(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var i=e[n],r=i.event;i=i.listeners;e:{var s=void 0;if(t)for(var a=i.length-1;0<=a;a--){var o=i[a],l=o.instance,c=o.currentTarget;if(o=o.listener,l!==s&&r.isPropagationStopped())break e;Fi(r,o,c),s=l}else for(a=0;a<i.length;a++){if(l=(o=i[a]).instance,c=o.currentTarget,o=o.listener,l!==s&&r.isPropagationStopped())break e;Fi(r,o,c),s=l}}}if(Ue)throw e=Be,Ue=!1,Be=null,e}function Bi(e,t){var n=t[mr];void 0===n&&(n=t[mr]=new Set);var i=e+"__bubble";n.has(i)||(Vi(t,e,2,!1),n.add(i))}function zi(e,t,n){var i=0;t&&(i|=4),Vi(n,e,i,t)}var ji="_reactListening"+Math.random().toString(36).slice(2);function Gi(e){if(!e[ji]){e[ji]=!0,a.forEach(function(t){"selectionchange"!==t&&(Oi.has(t)||zi(t,!1,e),zi(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[ji]||(t[ji]=!0,zi("selectionchange",!1,t))}}function Vi(e,t,n,i){switch(Zt(t)){case 1:var r=Wt;break;case 4:r=Yt;break;default:r=Xt}n=r.bind(null,t,n,e),r=void 0,!ke||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(r=!0),i?void 0!==r?e.addEventListener(t,n,{capture:!0,passive:r}):e.addEventListener(t,n,!0):void 0!==r?e.addEventListener(t,n,{passive:r}):e.addEventListener(t,n,!1)}function Hi(e,t,n,i,r){var s=i;if(0===(1&t)&&0===(2&t)&&null!==i)e:for(;;){if(null===i)return;var a=i.tag;if(3===a||4===a){var o=i.stateNode.containerInfo;if(o===r||8===o.nodeType&&o.parentNode===r)break;if(4===a)for(a=i.return;null!==a;){var l=a.tag;if((3===l||4===l)&&((l=a.stateNode.containerInfo)===r||8===l.nodeType&&l.parentNode===r))return;a=a.return}for(;null!==o;){if(null===(a=yr(o)))return;if(5===(l=a.tag)||6===l){i=s=a;continue e}o=o.parentNode}}i=i.return}Ie(function(){var i=s,r=_e(n),a=[];e:{var o=Li.get(e);if(void 0!==o){var l=un,c=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":l=Mn;break;case"focusin":c="focus",l=gn;break;case"focusout":c="blur",l=gn;break;case"beforeblur":case"afterblur":l=gn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=pn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=mn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=Cn;break;case Ai:case Mi:case Ri:l=vn;break;case Ci:l=Ln;break;case"scroll":l=dn;break;case"wheel":l=Pn;break;case"copy":case"cut":case"paste":l=bn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=Rn}var u=0!==(4&t),h=!u&&"scroll"===e,d=u?null!==o?o+"Capture":null:o;u=[];for(var f,p=i;null!==p;){var m=(f=p).stateNode;if(5===f.tag&&null!==m&&(f=m,null!==d&&(null!=(m=Pe(p,d))&&u.push(Wi(p,m,f)))),h)break;p=p.return}0<u.length&&(o=new l(o,c,null,n,r),a.push({event:o,listeners:u}))}}if(0===(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(o="mouseover"===e||"pointerover"===e)||n===xe||!(c=n.relatedTarget||n.fromElement)||!yr(c)&&!c[pr])&&(l||o)&&(o=r.window===r?r:(o=r.ownerDocument)?o.defaultView||o.parentWindow:window,l?(l=i,null!==(c=(c=n.relatedTarget||n.toElement)?yr(c):null)&&(c!==(h=Ge(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=i),l!==c)){if(u=pn,m="onMouseLeave",d="onMouseEnter",p="mouse","pointerout"!==e&&"pointerover"!==e||(u=Rn,m="onPointerLeave",d="onPointerEnter",p="pointer"),h=null==l?o:xr(l),f=null==c?o:xr(c),(o=new u(m,p+"leave",l,n,r)).target=h,o.relatedTarget=f,m=null,yr(r)===i&&((u=new u(d,p+"enter",c,n,r)).target=f,u.relatedTarget=h,m=u),h=m,l&&c)e:{for(d=c,p=0,f=u=l;f;f=Xi(f))p++;for(f=0,m=d;m;m=Xi(m))f++;for(;0<p-f;)u=Xi(u),p--;for(;0<f-p;)d=Xi(d),f--;for(;p--;){if(u===d||null!==d&&u===d.alternate)break e;u=Xi(u),d=Xi(d)}u=null}else u=null;null!==l&&qi(a,o,l,u,!1),null!==c&&null!==h&&qi(a,h,c,u,!0)}if("select"===(l=(o=i?xr(i):window).nodeName&&o.nodeName.toLowerCase())||"input"===l&&"file"===o.type)var g=Zn;else if(Hn(o))if(Jn)g=ai;else{g=ri;var v=ii}else(l=o.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===o.type||"radio"===o.type)&&(g=si);switch(g&&(g=g(e,i))?Wn(a,g,n,r):(v&&v(e,o,i),"focusout"===e&&(v=o._wrapperState)&&v.controlled&&"number"===o.type&&ee(o,"number",o.value)),v=i?xr(i):window,e){case"focusin":(Hn(v)||"true"===v.contentEditable)&&(gi=v,vi=i,yi=null);break;case"focusout":yi=vi=gi=null;break;case"mousedown":bi=!0;break;case"contextmenu":case"mouseup":case"dragend":bi=!1,xi(a,n,r);break;case"selectionchange":if(mi)break;case"keydown":case"keyup":xi(a,n,r)}var y;if(Dn)e:{switch(e){case"compositionstart":var b="onCompositionStart";break e;case"compositionend":b="onCompositionEnd";break e;case"compositionupdate":b="onCompositionUpdate";break e}b=void 0}else Gn?zn(e,n)&&(b="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(b="onCompositionStart");b&&(Fn&&"ko"!==n.locale&&(Gn||"onCompositionStart"!==b?"onCompositionEnd"===b&&Gn&&(y=en()):(Qt="value"in(Jt=r)?Jt.value:Jt.textContent,Gn=!0)),0<(v=Yi(i,b)).length&&(b=new xn(b,e,null,n,r),a.push({event:b,listeners:v}),y?b.data=y:null!==(y=jn(n))&&(b.data=y))),(y=On?function(e,t){switch(e){case"compositionend":return jn(t);case"keypress":return 32!==t.which?null:(Bn=!0,Un);case"textInput":return(e=t.data)===Un&&Bn?null:e;default:return null}}(e,n):function(e,t){if(Gn)return"compositionend"===e||!Dn&&zn(e,t)?(e=en(),$t=Qt=Jt=null,Gn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Fn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(i=Yi(i,"onBeforeInput")).length&&(r=new xn("onBeforeInput","beforeinput",null,n,r),a.push({event:r,listeners:i}),r.data=y))}Ui(a,t)})}function Wi(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Yi(e,t){for(var n=t+"Capture",i=[];null!==e;){var r=e,s=r.stateNode;5===r.tag&&null!==s&&(r=s,null!=(s=Pe(e,n))&&i.unshift(Wi(e,s,r)),null!=(s=Pe(e,t))&&i.push(Wi(e,s,r))),e=e.return}return i}function Xi(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function qi(e,t,n,i,r){for(var s=t._reactName,a=[];null!==n&&n!==i;){var o=n,l=o.alternate,c=o.stateNode;if(null!==l&&l===i)break;5===o.tag&&null!==c&&(o=c,r?null!=(l=Pe(n,s))&&a.unshift(Wi(n,l,o)):r||null!=(l=Pe(n,s))&&a.push(Wi(n,l,o))),n=n.return}0!==a.length&&e.push({event:t,listeners:a})}var Ki=/\r\n?/g,Zi=/\u0000|\uFFFD/g;function Ji(e){return("string"===typeof e?e:""+e).replace(Ki,"\n").replace(Zi,"")}function Qi(e,t,n){if(t=Ji(t),Ji(e)!==t&&n)throw Error(s(425))}function $i(){}var er=null,tr=null;function nr(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ir="function"===typeof setTimeout?setTimeout:void 0,rr="function"===typeof clearTimeout?clearTimeout:void 0,sr="function"===typeof Promise?Promise:void 0,ar="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof sr?function(e){return sr.resolve(null).then(e).catch(or)}:ir;function or(e){setTimeout(function(){throw e})}function lr(e,t){var n=t,i=0;do{var r=n.nextSibling;if(e.removeChild(n),r&&8===r.nodeType)if("/$"===(n=r.data)){if(0===i)return e.removeChild(r),void Gt(t);i--}else"$"!==n&&"$?"!==n&&"$!"!==n||i++;n=r}while(n);Gt(t)}function cr(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function ur(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var hr=Math.random().toString(36).slice(2),dr="__reactFiber$"+hr,fr="__reactProps$"+hr,pr="__reactContainer$"+hr,mr="__reactEvents$"+hr,gr="__reactListeners$"+hr,vr="__reactHandles$"+hr;function yr(e){var t=e[dr];if(t)return t;for(var n=e.parentNode;n;){if(t=n[pr]||n[dr]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=ur(e);null!==e;){if(n=e[dr])return n;e=ur(e)}return t}n=(e=n).parentNode}return null}function br(e){return!(e=e[dr]||e[pr])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function xr(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(s(33))}function _r(e){return e[fr]||null}var Sr=[],Er=-1;function Tr(e){return{current:e}}function wr(e){0>Er||(e.current=Sr[Er],Sr[Er]=null,Er--)}function Ar(e,t){Er++,Sr[Er]=e.current,e.current=t}var Mr={},Rr=Tr(Mr),Cr=Tr(!1),Lr=Mr;function Ir(e,t){var n=e.type.contextTypes;if(!n)return Mr;var i=e.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===t)return i.__reactInternalMemoizedMaskedChildContext;var r,s={};for(r in n)s[r]=t[r];return i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=s),s}function Pr(e){return null!==(e=e.childContextTypes)&&void 0!==e}function kr(){wr(Cr),wr(Rr)}function Dr(e,t,n){if(Rr.current!==Mr)throw Error(s(168));Ar(Rr,t),Ar(Cr,n)}function Nr(e,t,n){var i=e.stateNode;if(t=t.childContextTypes,"function"!==typeof i.getChildContext)return n;for(var r in i=i.getChildContext())if(!(r in t))throw Error(s(108,V(e)||"Unknown",r));return F({},n,i)}function Or(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Mr,Lr=Rr.current,Ar(Rr,e),Ar(Cr,Cr.current),!0}function Fr(e,t,n){var i=e.stateNode;if(!i)throw Error(s(169));n?(e=Nr(e,t,Lr),i.__reactInternalMemoizedMergedChildContext=e,wr(Cr),wr(Rr),Ar(Rr,e)):wr(Cr),Ar(Cr,n)}var Ur=null,Br=!1,zr=!1;function jr(e){null===Ur?Ur=[e]:Ur.push(e)}function Gr(){if(!zr&&null!==Ur){zr=!0;var e=0,t=bt;try{var n=Ur;for(bt=1;e<n.length;e++){var i=n[e];do{i=i(!0)}while(null!==i)}Ur=null,Br=!1}catch(r){throw null!==Ur&&(Ur=Ur.slice(e+1)),Xe($e,Gr),r}finally{bt=t,zr=!1}}return null}var Vr=[],Hr=0,Wr=null,Yr=0,Xr=[],qr=0,Kr=null,Zr=1,Jr="";function Qr(e,t){Vr[Hr++]=Yr,Vr[Hr++]=Wr,Wr=e,Yr=t}function $r(e,t,n){Xr[qr++]=Zr,Xr[qr++]=Jr,Xr[qr++]=Kr,Kr=e;var i=Zr;e=Jr;var r=32-at(i)-1;i&=~(1<<r),n+=1;var s=32-at(t)+r;if(30<s){var a=r-r%5;s=(i&(1<<a)-1).toString(32),i>>=a,r-=a,Zr=1<<32-at(t)+r|n<<r|i,Jr=s+e}else Zr=1<<s|n<<r|i,Jr=e}function es(e){null!==e.return&&(Qr(e,1),$r(e,1,0))}function ts(e){for(;e===Wr;)Wr=Vr[--Hr],Vr[Hr]=null,Yr=Vr[--Hr],Vr[Hr]=null;for(;e===Kr;)Kr=Xr[--qr],Xr[qr]=null,Jr=Xr[--qr],Xr[qr]=null,Zr=Xr[--qr],Xr[qr]=null}var ns=null,is=null,rs=!1,ss=null;function as(e,t){var n=Ic(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function os(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,ns=e,is=cr(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,ns=e,is=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Kr?{id:Zr,overflow:Jr}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Ic(18,null,null,0)).stateNode=t,n.return=e,e.child=n,ns=e,is=null,!0);default:return!1}}function ls(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function cs(e){if(rs){var t=is;if(t){var n=t;if(!os(e,t)){if(ls(e))throw Error(s(418));t=cr(n.nextSibling);var i=ns;t&&os(e,t)?as(i,n):(e.flags=-4097&e.flags|2,rs=!1,ns=e)}}else{if(ls(e))throw Error(s(418));e.flags=-4097&e.flags|2,rs=!1,ns=e}}}function us(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;ns=e}function hs(e){if(e!==ns)return!1;if(!rs)return us(e),rs=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!nr(e.type,e.memoizedProps)),t&&(t=is)){if(ls(e))throw ds(),Error(s(418));for(;t;)as(e,t),t=cr(t.nextSibling)}if(us(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(s(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){is=cr(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}is=null}}else is=ns?cr(e.stateNode.nextSibling):null;return!0}function ds(){for(var e=is;e;)e=cr(e.nextSibling)}function fs(){is=ns=null,rs=!1}function ps(e){null===ss?ss=[e]:ss.push(e)}var ms=x.ReactCurrentBatchConfig;function gs(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(s(309));var i=n.stateNode}if(!i)throw Error(s(147,e));var r=i,a=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===a?t.ref:(t=function(e){var t=r.refs;null===e?delete t[a]:t[a]=e},t._stringRef=a,t)}if("string"!==typeof e)throw Error(s(284));if(!n._owner)throw Error(s(290,e))}return e}function vs(e,t){throw e=Object.prototype.toString.call(t),Error(s(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function ys(e){return(0,e._init)(e._payload)}function bs(e){function t(t,n){if(e){var i=t.deletions;null===i?(t.deletions=[n],t.flags|=16):i.push(n)}}function n(n,i){if(!e)return null;for(;null!==i;)t(n,i),i=i.sibling;return null}function i(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function r(e,t){return(e=kc(e,t)).index=0,e.sibling=null,e}function a(t,n,i){return t.index=i,e?null!==(i=t.alternate)?(i=i.index)<n?(t.flags|=2,n):i:(t.flags|=2,n):(t.flags|=1048576,n)}function o(t){return e&&null===t.alternate&&(t.flags|=2),t}function l(e,t,n,i){return null===t||6!==t.tag?((t=Fc(n,e.mode,i)).return=e,t):((t=r(t,n)).return=e,t)}function c(e,t,n,i){var s=n.type;return s===E?h(e,t,n.props.children,i,n.key):null!==t&&(t.elementType===s||"object"===typeof s&&null!==s&&s.$$typeof===P&&ys(s)===t.type)?((i=r(t,n.props)).ref=gs(e,t,n),i.return=e,i):((i=Dc(n.type,n.key,n.props,null,e.mode,i)).ref=gs(e,t,n),i.return=e,i)}function u(e,t,n,i){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Uc(n,e.mode,i)).return=e,t):((t=r(t,n.children||[])).return=e,t)}function h(e,t,n,i,s){return null===t||7!==t.tag?((t=Nc(n,e.mode,i,s)).return=e,t):((t=r(t,n)).return=e,t)}function d(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Fc(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case _:return(n=Dc(t.type,t.key,t.props,null,e.mode,n)).ref=gs(e,null,t),n.return=e,n;case S:return(t=Uc(t,e.mode,n)).return=e,t;case P:return d(e,(0,t._init)(t._payload),n)}if(te(t)||N(t))return(t=Nc(t,e.mode,n,null)).return=e,t;vs(e,t)}return null}function f(e,t,n,i){var r=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==r?null:l(e,t,""+n,i);if("object"===typeof n&&null!==n){switch(n.$$typeof){case _:return n.key===r?c(e,t,n,i):null;case S:return n.key===r?u(e,t,n,i):null;case P:return f(e,t,(r=n._init)(n._payload),i)}if(te(n)||N(n))return null!==r?null:h(e,t,n,i,null);vs(e,n)}return null}function p(e,t,n,i,r){if("string"===typeof i&&""!==i||"number"===typeof i)return l(t,e=e.get(n)||null,""+i,r);if("object"===typeof i&&null!==i){switch(i.$$typeof){case _:return c(t,e=e.get(null===i.key?n:i.key)||null,i,r);case S:return u(t,e=e.get(null===i.key?n:i.key)||null,i,r);case P:return p(e,t,n,(0,i._init)(i._payload),r)}if(te(i)||N(i))return h(t,e=e.get(n)||null,i,r,null);vs(t,i)}return null}function m(r,s,o,l){for(var c=null,u=null,h=s,m=s=0,g=null;null!==h&&m<o.length;m++){h.index>m?(g=h,h=null):g=h.sibling;var v=f(r,h,o[m],l);if(null===v){null===h&&(h=g);break}e&&h&&null===v.alternate&&t(r,h),s=a(v,s,m),null===u?c=v:u.sibling=v,u=v,h=g}if(m===o.length)return n(r,h),rs&&Qr(r,m),c;if(null===h){for(;m<o.length;m++)null!==(h=d(r,o[m],l))&&(s=a(h,s,m),null===u?c=h:u.sibling=h,u=h);return rs&&Qr(r,m),c}for(h=i(r,h);m<o.length;m++)null!==(g=p(h,r,m,o[m],l))&&(e&&null!==g.alternate&&h.delete(null===g.key?m:g.key),s=a(g,s,m),null===u?c=g:u.sibling=g,u=g);return e&&h.forEach(function(e){return t(r,e)}),rs&&Qr(r,m),c}function g(r,o,l,c){var u=N(l);if("function"!==typeof u)throw Error(s(150));if(null==(l=u.call(l)))throw Error(s(151));for(var h=u=null,m=o,g=o=0,v=null,y=l.next();null!==m&&!y.done;g++,y=l.next()){m.index>g?(v=m,m=null):v=m.sibling;var b=f(r,m,y.value,c);if(null===b){null===m&&(m=v);break}e&&m&&null===b.alternate&&t(r,m),o=a(b,o,g),null===h?u=b:h.sibling=b,h=b,m=v}if(y.done)return n(r,m),rs&&Qr(r,g),u;if(null===m){for(;!y.done;g++,y=l.next())null!==(y=d(r,y.value,c))&&(o=a(y,o,g),null===h?u=y:h.sibling=y,h=y);return rs&&Qr(r,g),u}for(m=i(r,m);!y.done;g++,y=l.next())null!==(y=p(m,r,g,y.value,c))&&(e&&null!==y.alternate&&m.delete(null===y.key?g:y.key),o=a(y,o,g),null===h?u=y:h.sibling=y,h=y);return e&&m.forEach(function(e){return t(r,e)}),rs&&Qr(r,g),u}return function e(i,s,a,l){if("object"===typeof a&&null!==a&&a.type===E&&null===a.key&&(a=a.props.children),"object"===typeof a&&null!==a){switch(a.$$typeof){case _:e:{for(var c=a.key,u=s;null!==u;){if(u.key===c){if((c=a.type)===E){if(7===u.tag){n(i,u.sibling),(s=r(u,a.props.children)).return=i,i=s;break e}}else if(u.elementType===c||"object"===typeof c&&null!==c&&c.$$typeof===P&&ys(c)===u.type){n(i,u.sibling),(s=r(u,a.props)).ref=gs(i,u,a),s.return=i,i=s;break e}n(i,u);break}t(i,u),u=u.sibling}a.type===E?((s=Nc(a.props.children,i.mode,l,a.key)).return=i,i=s):((l=Dc(a.type,a.key,a.props,null,i.mode,l)).ref=gs(i,s,a),l.return=i,i=l)}return o(i);case S:e:{for(u=a.key;null!==s;){if(s.key===u){if(4===s.tag&&s.stateNode.containerInfo===a.containerInfo&&s.stateNode.implementation===a.implementation){n(i,s.sibling),(s=r(s,a.children||[])).return=i,i=s;break e}n(i,s);break}t(i,s),s=s.sibling}(s=Uc(a,i.mode,l)).return=i,i=s}return o(i);case P:return e(i,s,(u=a._init)(a._payload),l)}if(te(a))return m(i,s,a,l);if(N(a))return g(i,s,a,l);vs(i,a)}return"string"===typeof a&&""!==a||"number"===typeof a?(a=""+a,null!==s&&6===s.tag?(n(i,s.sibling),(s=r(s,a)).return=i,i=s):(n(i,s),(s=Fc(a,i.mode,l)).return=i,i=s),o(i)):n(i,s)}}var xs=bs(!0),_s=bs(!1),Ss=Tr(null),Es=null,Ts=null,ws=null;function As(){ws=Ts=Es=null}function Ms(e){var t=Ss.current;wr(Ss),e._currentValue=t}function Rs(e,t,n){for(;null!==e;){var i=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==i&&(i.childLanes|=t)):null!==i&&(i.childLanes&t)!==t&&(i.childLanes|=t),e===n)break;e=e.return}}function Cs(e,t){Es=e,ws=Ts=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(bo=!0),e.firstContext=null)}function Ls(e){var t=e._currentValue;if(ws!==e)if(e={context:e,memoizedValue:t,next:null},null===Ts){if(null===Es)throw Error(s(308));Ts=e,Es.dependencies={lanes:0,firstContext:e}}else Ts=Ts.next=e;return t}var Is=null;function Ps(e){null===Is?Is=[e]:Is.push(e)}function ks(e,t,n,i){var r=t.interleaved;return null===r?(n.next=n,Ps(t)):(n.next=r.next,r.next=n),t.interleaved=n,Ds(e,i)}function Ds(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var Ns=!1;function Os(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Fs(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Us(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Bs(e,t,n){var i=e.updateQueue;if(null===i)return null;if(i=i.shared,0!==(2&Rl)){var r=i.pending;return null===r?t.next=t:(t.next=r.next,r.next=t),i.pending=t,Ds(e,n)}return null===(r=i.interleaved)?(t.next=t,Ps(i)):(t.next=r.next,r.next=t),i.interleaved=t,Ds(e,n)}function zs(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,yt(e,n)}}function js(e,t){var n=e.updateQueue,i=e.alternate;if(null!==i&&n===(i=i.updateQueue)){var r=null,s=null;if(null!==(n=n.firstBaseUpdate)){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===s?r=s=a:s=s.next=a,n=n.next}while(null!==n);null===s?r=s=t:s=s.next=t}else r=s=t;return n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:s,shared:i.shared,effects:i.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Gs(e,t,n,i){var r=e.updateQueue;Ns=!1;var s=r.firstBaseUpdate,a=r.lastBaseUpdate,o=r.shared.pending;if(null!==o){r.shared.pending=null;var l=o,c=l.next;l.next=null,null===a?s=c:a.next=c,a=l;var u=e.alternate;null!==u&&((o=(u=u.updateQueue).lastBaseUpdate)!==a&&(null===o?u.firstBaseUpdate=c:o.next=c,u.lastBaseUpdate=l))}if(null!==s){var h=r.baseState;for(a=0,u=c=l=null,o=s;;){var d=o.lane,f=o.eventTime;if((i&d)===d){null!==u&&(u=u.next={eventTime:f,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var p=e,m=o;switch(d=t,f=n,m.tag){case 1:if("function"===typeof(p=m.payload)){h=p.call(f,h,d);break e}h=p;break e;case 3:p.flags=-65537&p.flags|128;case 0:if(null===(d="function"===typeof(p=m.payload)?p.call(f,h,d):p)||void 0===d)break e;h=F({},h,d);break e;case 2:Ns=!0}}null!==o.callback&&0!==o.lane&&(e.flags|=64,null===(d=r.effects)?r.effects=[o]:d.push(o))}else f={eventTime:f,lane:d,tag:o.tag,payload:o.payload,callback:o.callback,next:null},null===u?(c=u=f,l=h):u=u.next=f,a|=d;if(null===(o=o.next)){if(null===(o=r.shared.pending))break;o=(d=o).next,d.next=null,r.lastBaseUpdate=d,r.shared.pending=null}}if(null===u&&(l=h),r.baseState=l,r.firstBaseUpdate=c,r.lastBaseUpdate=u,null!==(t=r.shared.interleaved)){r=t;do{a|=r.lane,r=r.next}while(r!==t)}else null===s&&(r.shared.lanes=0);Ol|=a,e.lanes=a,e.memoizedState=h}}function Vs(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var i=e[t],r=i.callback;if(null!==r){if(i.callback=null,i=n,"function"!==typeof r)throw Error(s(191,r));r.call(i)}}}var Hs={},Ws=Tr(Hs),Ys=Tr(Hs),Xs=Tr(Hs);function qs(e){if(e===Hs)throw Error(s(174));return e}function Ks(e,t){switch(Ar(Xs,t),Ar(Ys,e),Ar(Ws,Hs),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:le(null,"");break;default:t=le(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}wr(Ws),Ar(Ws,t)}function Zs(){wr(Ws),wr(Ys),wr(Xs)}function Js(e){qs(Xs.current);var t=qs(Ws.current),n=le(t,e.type);t!==n&&(Ar(Ys,e),Ar(Ws,n))}function Qs(e){Ys.current===e&&(wr(Ws),wr(Ys))}var $s=Tr(0);function ea(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var ta=[];function na(){for(var e=0;e<ta.length;e++)ta[e]._workInProgressVersionPrimary=null;ta.length=0}var ia=x.ReactCurrentDispatcher,ra=x.ReactCurrentBatchConfig,sa=0,aa=null,oa=null,la=null,ca=!1,ua=!1,ha=0,da=0;function fa(){throw Error(s(321))}function pa(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!oi(e[n],t[n]))return!1;return!0}function ma(e,t,n,i,r,a){if(sa=a,aa=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ia.current=null===e||null===e.memoizedState?Qa:$a,e=n(i,r),ua){a=0;do{if(ua=!1,ha=0,25<=a)throw Error(s(301));a+=1,la=oa=null,t.updateQueue=null,ia.current=eo,e=n(i,r)}while(ua)}if(ia.current=Ja,t=null!==oa&&null!==oa.next,sa=0,la=oa=aa=null,ca=!1,t)throw Error(s(300));return e}function ga(){var e=0!==ha;return ha=0,e}function va(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===la?aa.memoizedState=la=e:la=la.next=e,la}function ya(){if(null===oa){var e=aa.alternate;e=null!==e?e.memoizedState:null}else e=oa.next;var t=null===la?aa.memoizedState:la.next;if(null!==t)la=t,oa=e;else{if(null===e)throw Error(s(310));e={memoizedState:(oa=e).memoizedState,baseState:oa.baseState,baseQueue:oa.baseQueue,queue:oa.queue,next:null},null===la?aa.memoizedState=la=e:la=la.next=e}return la}function ba(e,t){return"function"===typeof t?t(e):t}function xa(e){var t=ya(),n=t.queue;if(null===n)throw Error(s(311));n.lastRenderedReducer=e;var i=oa,r=i.baseQueue,a=n.pending;if(null!==a){if(null!==r){var o=r.next;r.next=a.next,a.next=o}i.baseQueue=r=a,n.pending=null}if(null!==r){a=r.next,i=i.baseState;var l=o=null,c=null,u=a;do{var h=u.lane;if((sa&h)===h)null!==c&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),i=u.hasEagerState?u.eagerState:e(i,u.action);else{var d={lane:h,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===c?(l=c=d,o=i):c=c.next=d,aa.lanes|=h,Ol|=h}u=u.next}while(null!==u&&u!==a);null===c?o=i:c.next=l,oi(i,t.memoizedState)||(bo=!0),t.memoizedState=i,t.baseState=o,t.baseQueue=c,n.lastRenderedState=i}if(null!==(e=n.interleaved)){r=e;do{a=r.lane,aa.lanes|=a,Ol|=a,r=r.next}while(r!==e)}else null===r&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function _a(e){var t=ya(),n=t.queue;if(null===n)throw Error(s(311));n.lastRenderedReducer=e;var i=n.dispatch,r=n.pending,a=t.memoizedState;if(null!==r){n.pending=null;var o=r=r.next;do{a=e(a,o.action),o=o.next}while(o!==r);oi(a,t.memoizedState)||(bo=!0),t.memoizedState=a,null===t.baseQueue&&(t.baseState=a),n.lastRenderedState=a}return[a,i]}function Sa(){}function Ea(e,t){var n=aa,i=ya(),r=t(),a=!oi(i.memoizedState,r);if(a&&(i.memoizedState=r,bo=!0),i=i.queue,Na(Aa.bind(null,n,i,e),[e]),i.getSnapshot!==t||a||null!==la&&1&la.memoizedState.tag){if(n.flags|=2048,La(9,wa.bind(null,n,i,r,t),void 0,null),null===Cl)throw Error(s(349));0!==(30&sa)||Ta(n,t,r)}return r}function Ta(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=aa.updateQueue)?(t={lastEffect:null,stores:null},aa.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function wa(e,t,n,i){t.value=n,t.getSnapshot=i,Ma(t)&&Ra(e)}function Aa(e,t,n){return n(function(){Ma(t)&&Ra(e)})}function Ma(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!oi(e,n)}catch(i){return!0}}function Ra(e){var t=Ds(e,1);null!==t&&nc(t,e,1,-1)}function Ca(e){var t=va();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ba,lastRenderedState:e},t.queue=e,e=e.dispatch=Xa.bind(null,aa,e),[t.memoizedState,e]}function La(e,t,n,i){return e={tag:e,create:t,destroy:n,deps:i,next:null},null===(t=aa.updateQueue)?(t={lastEffect:null,stores:null},aa.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(i=n.next,n.next=e,e.next=i,t.lastEffect=e),e}function Ia(){return ya().memoizedState}function Pa(e,t,n,i){var r=va();aa.flags|=e,r.memoizedState=La(1|t,n,void 0,void 0===i?null:i)}function ka(e,t,n,i){var r=ya();i=void 0===i?null:i;var s=void 0;if(null!==oa){var a=oa.memoizedState;if(s=a.destroy,null!==i&&pa(i,a.deps))return void(r.memoizedState=La(t,n,s,i))}aa.flags|=e,r.memoizedState=La(1|t,n,s,i)}function Da(e,t){return Pa(8390656,8,e,t)}function Na(e,t){return ka(2048,8,e,t)}function Oa(e,t){return ka(4,2,e,t)}function Fa(e,t){return ka(4,4,e,t)}function Ua(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Ba(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,ka(4,4,Ua.bind(null,t,e),n)}function za(){}function ja(e,t){var n=ya();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&pa(t,i[1])?i[0]:(n.memoizedState=[e,t],e)}function Ga(e,t){var n=ya();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&pa(t,i[1])?i[0]:(e=e(),n.memoizedState=[e,t],e)}function Va(e,t,n){return 0===(21&sa)?(e.baseState&&(e.baseState=!1,bo=!0),e.memoizedState=n):(oi(n,t)||(n=mt(),aa.lanes|=n,Ol|=n,e.baseState=!0),t)}function Ha(e,t){var n=bt;bt=0!==n&&4>n?n:4,e(!0);var i=ra.transition;ra.transition={};try{e(!1),t()}finally{bt=n,ra.transition=i}}function Wa(){return ya().memoizedState}function Ya(e,t,n){var i=tc(e);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},qa(e))Ka(t,n);else if(null!==(n=ks(e,t,n,i))){nc(n,e,i,ec()),Za(n,t,i)}}function Xa(e,t,n){var i=tc(e),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(qa(e))Ka(t,r);else{var s=e.alternate;if(0===e.lanes&&(null===s||0===s.lanes)&&null!==(s=t.lastRenderedReducer))try{var a=t.lastRenderedState,o=s(a,n);if(r.hasEagerState=!0,r.eagerState=o,oi(o,a)){var l=t.interleaved;return null===l?(r.next=r,Ps(t)):(r.next=l.next,l.next=r),void(t.interleaved=r)}}catch(c){}null!==(n=ks(e,t,r,i))&&(nc(n,e,i,r=ec()),Za(n,t,i))}}function qa(e){var t=e.alternate;return e===aa||null!==t&&t===aa}function Ka(e,t){ua=ca=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Za(e,t,n){if(0!==(4194240&n)){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,yt(e,n)}}var Ja={readContext:Ls,useCallback:fa,useContext:fa,useEffect:fa,useImperativeHandle:fa,useInsertionEffect:fa,useLayoutEffect:fa,useMemo:fa,useReducer:fa,useRef:fa,useState:fa,useDebugValue:fa,useDeferredValue:fa,useTransition:fa,useMutableSource:fa,useSyncExternalStore:fa,useId:fa,unstable_isNewReconciler:!1},Qa={readContext:Ls,useCallback:function(e,t){return va().memoizedState=[e,void 0===t?null:t],e},useContext:Ls,useEffect:Da,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Pa(4194308,4,Ua.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Pa(4194308,4,e,t)},useInsertionEffect:function(e,t){return Pa(4,2,e,t)},useMemo:function(e,t){var n=va();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var i=va();return t=void 0!==n?n(t):t,i.memoizedState=i.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},i.queue=e,e=e.dispatch=Ya.bind(null,aa,e),[i.memoizedState,e]},useRef:function(e){return e={current:e},va().memoizedState=e},useState:Ca,useDebugValue:za,useDeferredValue:function(e){return va().memoizedState=e},useTransition:function(){var e=Ca(!1),t=e[0];return e=Ha.bind(null,e[1]),va().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var i=aa,r=va();if(rs){if(void 0===n)throw Error(s(407));n=n()}else{if(n=t(),null===Cl)throw Error(s(349));0!==(30&sa)||Ta(i,t,n)}r.memoizedState=n;var a={value:n,getSnapshot:t};return r.queue=a,Da(Aa.bind(null,i,a,e),[e]),i.flags|=2048,La(9,wa.bind(null,i,a,n,t),void 0,null),n},useId:function(){var e=va(),t=Cl.identifierPrefix;if(rs){var n=Jr;t=":"+t+"R"+(n=(Zr&~(1<<32-at(Zr)-1)).toString(32)+n),0<(n=ha++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=da++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},$a={readContext:Ls,useCallback:ja,useContext:Ls,useEffect:Na,useImperativeHandle:Ba,useInsertionEffect:Oa,useLayoutEffect:Fa,useMemo:Ga,useReducer:xa,useRef:Ia,useState:function(){return xa(ba)},useDebugValue:za,useDeferredValue:function(e){return Va(ya(),oa.memoizedState,e)},useTransition:function(){return[xa(ba)[0],ya().memoizedState]},useMutableSource:Sa,useSyncExternalStore:Ea,useId:Wa,unstable_isNewReconciler:!1},eo={readContext:Ls,useCallback:ja,useContext:Ls,useEffect:Na,useImperativeHandle:Ba,useInsertionEffect:Oa,useLayoutEffect:Fa,useMemo:Ga,useReducer:_a,useRef:Ia,useState:function(){return _a(ba)},useDebugValue:za,useDeferredValue:function(e){var t=ya();return null===oa?t.memoizedState=e:Va(t,oa.memoizedState,e)},useTransition:function(){return[_a(ba)[0],ya().memoizedState]},useMutableSource:Sa,useSyncExternalStore:Ea,useId:Wa,unstable_isNewReconciler:!1};function to(e,t){if(e&&e.defaultProps){for(var n in t=F({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}function no(e,t,n,i){n=null===(n=n(i,t=e.memoizedState))||void 0===n?t:F({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var io={isMounted:function(e){return!!(e=e._reactInternals)&&Ge(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var i=ec(),r=tc(e),s=Us(i,r);s.payload=t,void 0!==n&&null!==n&&(s.callback=n),null!==(t=Bs(e,s,r))&&(nc(t,e,r,i),zs(t,e,r))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var i=ec(),r=tc(e),s=Us(i,r);s.tag=1,s.payload=t,void 0!==n&&null!==n&&(s.callback=n),null!==(t=Bs(e,s,r))&&(nc(t,e,r,i),zs(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=ec(),i=tc(e),r=Us(n,i);r.tag=2,void 0!==t&&null!==t&&(r.callback=t),null!==(t=Bs(e,r,i))&&(nc(t,e,i,n),zs(t,e,i))}};function ro(e,t,n,i,r,s,a){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(i,s,a):!t.prototype||!t.prototype.isPureReactComponent||(!li(n,i)||!li(r,s))}function so(e,t,n){var i=!1,r=Mr,s=t.contextType;return"object"===typeof s&&null!==s?s=Ls(s):(r=Pr(t)?Lr:Rr.current,s=(i=null!==(i=t.contextTypes)&&void 0!==i)?Ir(e,r):Mr),t=new t(n,s),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=io,e.stateNode=t,t._reactInternals=e,i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=r,e.__reactInternalMemoizedMaskedChildContext=s),t}function ao(e,t,n,i){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,i),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,i),t.state!==e&&io.enqueueReplaceState(t,t.state,null)}function oo(e,t,n,i){var r=e.stateNode;r.props=n,r.state=e.memoizedState,r.refs={},Os(e);var s=t.contextType;"object"===typeof s&&null!==s?r.context=Ls(s):(s=Pr(t)?Lr:Rr.current,r.context=Ir(e,s)),r.state=e.memoizedState,"function"===typeof(s=t.getDerivedStateFromProps)&&(no(e,t,s,n),r.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof r.getSnapshotBeforeUpdate||"function"!==typeof r.UNSAFE_componentWillMount&&"function"!==typeof r.componentWillMount||(t=r.state,"function"===typeof r.componentWillMount&&r.componentWillMount(),"function"===typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount(),t!==r.state&&io.enqueueReplaceState(r,r.state,null),Gs(e,n,r,i),r.state=e.memoizedState),"function"===typeof r.componentDidMount&&(e.flags|=4194308)}function lo(e,t){try{var n="",i=t;do{n+=j(i),i=i.return}while(i);var r=n}catch(s){r="\nError generating stack: "+s.message+"\n"+s.stack}return{value:e,source:t,stack:r,digest:null}}function co(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function uo(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var ho="function"===typeof WeakMap?WeakMap:Map;function fo(e,t,n){(n=Us(-1,n)).tag=3,n.payload={element:null};var i=t.value;return n.callback=function(){Hl||(Hl=!0,Wl=i),uo(0,t)},n}function po(e,t,n){(n=Us(-1,n)).tag=3;var i=e.type.getDerivedStateFromError;if("function"===typeof i){var r=t.value;n.payload=function(){return i(r)},n.callback=function(){uo(0,t)}}var s=e.stateNode;return null!==s&&"function"===typeof s.componentDidCatch&&(n.callback=function(){uo(0,t),"function"!==typeof i&&(null===Yl?Yl=new Set([this]):Yl.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function mo(e,t,n){var i=e.pingCache;if(null===i){i=e.pingCache=new ho;var r=new Set;i.set(t,r)}else void 0===(r=i.get(t))&&(r=new Set,i.set(t,r));r.has(n)||(r.add(n),e=wc.bind(null,e,t,n),t.then(e,e))}function go(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function vo(e,t,n,i,r){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Us(-1,1)).tag=2,Bs(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=r,e)}var yo=x.ReactCurrentOwner,bo=!1;function xo(e,t,n,i){t.child=null===e?_s(t,null,n,i):xs(t,e.child,n,i)}function _o(e,t,n,i,r){n=n.render;var s=t.ref;return Cs(t,r),i=ma(e,t,n,i,s,r),n=ga(),null===e||bo?(rs&&n&&es(t),t.flags|=1,xo(e,t,i,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Ho(e,t,r))}function So(e,t,n,i,r){if(null===e){var s=n.type;return"function"!==typeof s||Pc(s)||void 0!==s.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Dc(n.type,null,i,t,t.mode,r)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=s,Eo(e,t,s,i,r))}if(s=e.child,0===(e.lanes&r)){var a=s.memoizedProps;if((n=null!==(n=n.compare)?n:li)(a,i)&&e.ref===t.ref)return Ho(e,t,r)}return t.flags|=1,(e=kc(s,i)).ref=t.ref,e.return=t,t.child=e}function Eo(e,t,n,i,r){if(null!==e){var s=e.memoizedProps;if(li(s,i)&&e.ref===t.ref){if(bo=!1,t.pendingProps=i=s,0===(e.lanes&r))return t.lanes=e.lanes,Ho(e,t,r);0!==(131072&e.flags)&&(bo=!0)}}return Ao(e,t,n,i,r)}function To(e,t,n){var i=t.pendingProps,r=i.children,s=null!==e?e.memoizedState:null;if("hidden"===i.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ar(kl,Pl),Pl|=n;else{if(0===(1073741824&n))return e=null!==s?s.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Ar(kl,Pl),Pl|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=null!==s?s.baseLanes:n,Ar(kl,Pl),Pl|=i}else null!==s?(i=s.baseLanes|n,t.memoizedState=null):i=n,Ar(kl,Pl),Pl|=i;return xo(e,t,r,n),t.child}function wo(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Ao(e,t,n,i,r){var s=Pr(n)?Lr:Rr.current;return s=Ir(t,s),Cs(t,r),n=ma(e,t,n,i,s,r),i=ga(),null===e||bo?(rs&&i&&es(t),t.flags|=1,xo(e,t,n,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Ho(e,t,r))}function Mo(e,t,n,i,r){if(Pr(n)){var s=!0;Or(t)}else s=!1;if(Cs(t,r),null===t.stateNode)Vo(e,t),so(t,n,i),oo(t,n,i,r),i=!0;else if(null===e){var a=t.stateNode,o=t.memoizedProps;a.props=o;var l=a.context,c=n.contextType;"object"===typeof c&&null!==c?c=Ls(c):c=Ir(t,c=Pr(n)?Lr:Rr.current);var u=n.getDerivedStateFromProps,h="function"===typeof u||"function"===typeof a.getSnapshotBeforeUpdate;h||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(o!==i||l!==c)&&ao(t,a,i,c),Ns=!1;var d=t.memoizedState;a.state=d,Gs(t,i,a,r),l=t.memoizedState,o!==i||d!==l||Cr.current||Ns?("function"===typeof u&&(no(t,n,u,i),l=t.memoizedState),(o=Ns||ro(t,n,o,i,d,l,c))?(h||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||("function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"===typeof a.componentDidMount&&(t.flags|=4194308)):("function"===typeof a.componentDidMount&&(t.flags|=4194308),t.memoizedProps=i,t.memoizedState=l),a.props=i,a.state=l,a.context=c,i=o):("function"===typeof a.componentDidMount&&(t.flags|=4194308),i=!1)}else{a=t.stateNode,Fs(e,t),o=t.memoizedProps,c=t.type===t.elementType?o:to(t.type,o),a.props=c,h=t.pendingProps,d=a.context,"object"===typeof(l=n.contextType)&&null!==l?l=Ls(l):l=Ir(t,l=Pr(n)?Lr:Rr.current);var f=n.getDerivedStateFromProps;(u="function"===typeof f||"function"===typeof a.getSnapshotBeforeUpdate)||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(o!==h||d!==l)&&ao(t,a,i,l),Ns=!1,d=t.memoizedState,a.state=d,Gs(t,i,a,r);var p=t.memoizedState;o!==h||d!==p||Cr.current||Ns?("function"===typeof f&&(no(t,n,f,i),p=t.memoizedState),(c=Ns||ro(t,n,c,i,d,p,l)||!1)?(u||"function"!==typeof a.UNSAFE_componentWillUpdate&&"function"!==typeof a.componentWillUpdate||("function"===typeof a.componentWillUpdate&&a.componentWillUpdate(i,p,l),"function"===typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(i,p,l)),"function"===typeof a.componentDidUpdate&&(t.flags|=4),"function"===typeof a.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof a.componentDidUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=i,t.memoizedState=p),a.props=i,a.state=p,a.context=l,i=c):("function"!==typeof a.componentDidUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),i=!1)}return Ro(e,t,n,i,s,r)}function Ro(e,t,n,i,r,s){wo(e,t);var a=0!==(128&t.flags);if(!i&&!a)return r&&Fr(t,n,!1),Ho(e,t,s);i=t.stateNode,yo.current=t;var o=a&&"function"!==typeof n.getDerivedStateFromError?null:i.render();return t.flags|=1,null!==e&&a?(t.child=xs(t,e.child,null,s),t.child=xs(t,null,o,s)):xo(e,t,o,s),t.memoizedState=i.state,r&&Fr(t,n,!0),t.child}function Co(e){var t=e.stateNode;t.pendingContext?Dr(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Dr(0,t.context,!1),Ks(e,t.containerInfo)}function Lo(e,t,n,i,r){return fs(),ps(r),t.flags|=256,xo(e,t,n,i),t.child}var Io,Po,ko,Do,No={dehydrated:null,treeContext:null,retryLane:0};function Oo(e){return{baseLanes:e,cachePool:null,transitions:null}}function Fo(e,t,n){var i,r=t.pendingProps,a=$s.current,o=!1,l=0!==(128&t.flags);if((i=l)||(i=(null===e||null!==e.memoizedState)&&0!==(2&a)),i?(o=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(a|=1),Ar($s,1&a),null===e)return cs(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(l=r.children,e=r.fallback,o?(r=t.mode,o=t.child,l={mode:"hidden",children:l},0===(1&r)&&null!==o?(o.childLanes=0,o.pendingProps=l):o=Oc(l,r,0,null),e=Nc(e,r,n,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=Oo(n),t.memoizedState=No,e):Uo(t,l));if(null!==(a=e.memoizedState)&&null!==(i=a.dehydrated))return function(e,t,n,i,r,a,o){if(n)return 256&t.flags?(t.flags&=-257,Bo(e,t,o,i=co(Error(s(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(a=i.fallback,r=t.mode,i=Oc({mode:"visible",children:i.children},r,0,null),(a=Nc(a,r,o,null)).flags|=2,i.return=t,a.return=t,i.sibling=a,t.child=i,0!==(1&t.mode)&&xs(t,e.child,null,o),t.child.memoizedState=Oo(o),t.memoizedState=No,a);if(0===(1&t.mode))return Bo(e,t,o,null);if("$!"===r.data){if(i=r.nextSibling&&r.nextSibling.dataset)var l=i.dgst;return i=l,Bo(e,t,o,i=co(a=Error(s(419)),i,void 0))}if(l=0!==(o&e.childLanes),bo||l){if(null!==(i=Cl)){switch(o&-o){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}0!==(r=0!==(r&(i.suspendedLanes|o))?0:r)&&r!==a.retryLane&&(a.retryLane=r,Ds(e,r),nc(i,e,r,-1))}return mc(),Bo(e,t,o,i=co(Error(s(421))))}return"$?"===r.data?(t.flags|=128,t.child=e.child,t=Mc.bind(null,e),r._reactRetry=t,null):(e=a.treeContext,is=cr(r.nextSibling),ns=t,rs=!0,ss=null,null!==e&&(Xr[qr++]=Zr,Xr[qr++]=Jr,Xr[qr++]=Kr,Zr=e.id,Jr=e.overflow,Kr=t),t=Uo(t,i.children),t.flags|=4096,t)}(e,t,l,r,i,a,n);if(o){o=r.fallback,l=t.mode,i=(a=e.child).sibling;var c={mode:"hidden",children:r.children};return 0===(1&l)&&t.child!==a?((r=t.child).childLanes=0,r.pendingProps=c,t.deletions=null):(r=kc(a,c)).subtreeFlags=14680064&a.subtreeFlags,null!==i?o=kc(i,o):(o=Nc(o,l,n,null)).flags|=2,o.return=t,r.return=t,r.sibling=o,t.child=r,r=o,o=t.child,l=null===(l=e.child.memoizedState)?Oo(n):{baseLanes:l.baseLanes|n,cachePool:null,transitions:l.transitions},o.memoizedState=l,o.childLanes=e.childLanes&~n,t.memoizedState=No,r}return e=(o=e.child).sibling,r=kc(o,{mode:"visible",children:r.children}),0===(1&t.mode)&&(r.lanes=n),r.return=t,r.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=r,t.memoizedState=null,r}function Uo(e,t){return(t=Oc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Bo(e,t,n,i){return null!==i&&ps(i),xs(t,e.child,null,n),(e=Uo(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function zo(e,t,n){e.lanes|=t;var i=e.alternate;null!==i&&(i.lanes|=t),Rs(e.return,t,n)}function jo(e,t,n,i,r){var s=e.memoizedState;null===s?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(s.isBackwards=t,s.rendering=null,s.renderingStartTime=0,s.last=i,s.tail=n,s.tailMode=r)}function Go(e,t,n){var i=t.pendingProps,r=i.revealOrder,s=i.tail;if(xo(e,t,i.children,n),0!==(2&(i=$s.current)))i=1&i|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&zo(e,n,t);else if(19===e.tag)zo(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}if(Ar($s,i),0===(1&t.mode))t.memoizedState=null;else switch(r){case"forwards":for(n=t.child,r=null;null!==n;)null!==(e=n.alternate)&&null===ea(e)&&(r=n),n=n.sibling;null===(n=r)?(r=t.child,t.child=null):(r=n.sibling,n.sibling=null),jo(t,!1,r,n,s);break;case"backwards":for(n=null,r=t.child,t.child=null;null!==r;){if(null!==(e=r.alternate)&&null===ea(e)){t.child=r;break}e=r.sibling,r.sibling=n,n=r,r=e}jo(t,!0,n,null,s);break;case"together":jo(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Vo(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Ho(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Ol|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(s(153));if(null!==t.child){for(n=kc(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=kc(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Wo(e,t){if(!rs)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var i=null;null!==n;)null!==n.alternate&&(i=n),n=n.sibling;null===i?t||null===e.tail?e.tail=null:e.tail.sibling=null:i.sibling=null}}function Yo(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,i=0;if(t)for(var r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=14680064&r.subtreeFlags,i|=14680064&r.flags,r.return=e,r=r.sibling;else for(r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=e,r=r.sibling;return e.subtreeFlags|=i,e.childLanes=n,t}function Xo(e,t,n){var i=t.pendingProps;switch(ts(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Yo(t),null;case 1:case 17:return Pr(t.type)&&kr(),Yo(t),null;case 3:return i=t.stateNode,Zs(),wr(Cr),wr(Rr),na(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),null!==e&&null!==e.child||(hs(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==ss&&(ac(ss),ss=null))),Po(e,t),Yo(t),null;case 5:Qs(t);var r=qs(Xs.current);if(n=t.type,null!==e&&null!=t.stateNode)ko(e,t,n,i,r),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!i){if(null===t.stateNode)throw Error(s(166));return Yo(t),null}if(e=qs(Ws.current),hs(t)){i=t.stateNode,n=t.type;var a=t.memoizedProps;switch(i[dr]=t,i[fr]=a,e=0!==(1&t.mode),n){case"dialog":Bi("cancel",i),Bi("close",i);break;case"iframe":case"object":case"embed":Bi("load",i);break;case"video":case"audio":for(r=0;r<Ni.length;r++)Bi(Ni[r],i);break;case"source":Bi("error",i);break;case"img":case"image":case"link":Bi("error",i),Bi("load",i);break;case"details":Bi("toggle",i);break;case"input":Z(i,a),Bi("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!a.multiple},Bi("invalid",i);break;case"textarea":re(i,a),Bi("invalid",i)}for(var l in ye(n,a),r=null,a)if(a.hasOwnProperty(l)){var c=a[l];"children"===l?"string"===typeof c?i.textContent!==c&&(!0!==a.suppressHydrationWarning&&Qi(i.textContent,c,e),r=["children",c]):"number"===typeof c&&i.textContent!==""+c&&(!0!==a.suppressHydrationWarning&&Qi(i.textContent,c,e),r=["children",""+c]):o.hasOwnProperty(l)&&null!=c&&"onScroll"===l&&Bi("scroll",i)}switch(n){case"input":Y(i),$(i,a,!0);break;case"textarea":Y(i),ae(i);break;case"select":case"option":break;default:"function"===typeof a.onClick&&(i.onclick=$i)}i=r,t.updateQueue=i,null!==i&&(t.flags|=4)}else{l=9===r.nodeType?r:r.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=oe(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof i.is?e=l.createElement(n,{is:i.is}):(e=l.createElement(n),"select"===n&&(l=e,i.multiple?l.multiple=!0:i.size&&(l.size=i.size))):e=l.createElementNS(e,n),e[dr]=t,e[fr]=i,Io(e,t,!1,!1),t.stateNode=e;e:{switch(l=be(n,i),n){case"dialog":Bi("cancel",e),Bi("close",e),r=i;break;case"iframe":case"object":case"embed":Bi("load",e),r=i;break;case"video":case"audio":for(r=0;r<Ni.length;r++)Bi(Ni[r],e);r=i;break;case"source":Bi("error",e),r=i;break;case"img":case"image":case"link":Bi("error",e),Bi("load",e),r=i;break;case"details":Bi("toggle",e),r=i;break;case"input":Z(e,i),r=K(e,i),Bi("invalid",e);break;case"option":default:r=i;break;case"select":e._wrapperState={wasMultiple:!!i.multiple},r=F({},i,{value:void 0}),Bi("invalid",e);break;case"textarea":re(e,i),r=ie(e,i),Bi("invalid",e)}for(a in ye(n,r),c=r)if(c.hasOwnProperty(a)){var u=c[a];"style"===a?ge(e,u):"dangerouslySetInnerHTML"===a?null!=(u=u?u.__html:void 0)&&he(e,u):"children"===a?"string"===typeof u?("textarea"!==n||""!==u)&&de(e,u):"number"===typeof u&&de(e,""+u):"suppressContentEditableWarning"!==a&&"suppressHydrationWarning"!==a&&"autoFocus"!==a&&(o.hasOwnProperty(a)?null!=u&&"onScroll"===a&&Bi("scroll",e):null!=u&&b(e,a,u,l))}switch(n){case"input":Y(e),$(e,i,!1);break;case"textarea":Y(e),ae(e);break;case"option":null!=i.value&&e.setAttribute("value",""+H(i.value));break;case"select":e.multiple=!!i.multiple,null!=(a=i.value)?ne(e,!!i.multiple,a,!1):null!=i.defaultValue&&ne(e,!!i.multiple,i.defaultValue,!0);break;default:"function"===typeof r.onClick&&(e.onclick=$i)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Yo(t),null;case 6:if(e&&null!=t.stateNode)Do(e,t,e.memoizedProps,i);else{if("string"!==typeof i&&null===t.stateNode)throw Error(s(166));if(n=qs(Xs.current),qs(Ws.current),hs(t)){if(i=t.stateNode,n=t.memoizedProps,i[dr]=t,(a=i.nodeValue!==n)&&null!==(e=ns))switch(e.tag){case 3:Qi(i.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Qi(i.nodeValue,n,0!==(1&e.mode))}a&&(t.flags|=4)}else(i=(9===n.nodeType?n:n.ownerDocument).createTextNode(i))[dr]=t,t.stateNode=i}return Yo(t),null;case 13:if(wr($s),i=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(rs&&null!==is&&0!==(1&t.mode)&&0===(128&t.flags))ds(),fs(),t.flags|=98560,a=!1;else if(a=hs(t),null!==i&&null!==i.dehydrated){if(null===e){if(!a)throw Error(s(318));if(!(a=null!==(a=t.memoizedState)?a.dehydrated:null))throw Error(s(317));a[dr]=t}else fs(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Yo(t),a=!1}else null!==ss&&(ac(ss),ss=null),a=!0;if(!a)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((i=null!==i)!==(null!==e&&null!==e.memoizedState)&&i&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&$s.current)?0===Dl&&(Dl=3):mc())),null!==t.updateQueue&&(t.flags|=4),Yo(t),null);case 4:return Zs(),Po(e,t),null===e&&Gi(t.stateNode.containerInfo),Yo(t),null;case 10:return Ms(t.type._context),Yo(t),null;case 19:if(wr($s),null===(a=t.memoizedState))return Yo(t),null;if(i=0!==(128&t.flags),null===(l=a.rendering))if(i)Wo(a,!1);else{if(0!==Dl||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(l=ea(e))){for(t.flags|=128,Wo(a,!1),null!==(i=l.updateQueue)&&(t.updateQueue=i,t.flags|=4),t.subtreeFlags=0,i=n,n=t.child;null!==n;)e=i,(a=n).flags&=14680066,null===(l=a.alternate)?(a.childLanes=0,a.lanes=e,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=l.childLanes,a.lanes=l.lanes,a.child=l.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=l.memoizedProps,a.memoizedState=l.memoizedState,a.updateQueue=l.updateQueue,a.type=l.type,e=l.dependencies,a.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Ar($s,1&$s.current|2),t.child}e=e.sibling}null!==a.tail&&Je()>Gl&&(t.flags|=128,i=!0,Wo(a,!1),t.lanes=4194304)}else{if(!i)if(null!==(e=ea(l))){if(t.flags|=128,i=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Wo(a,!0),null===a.tail&&"hidden"===a.tailMode&&!l.alternate&&!rs)return Yo(t),null}else 2*Je()-a.renderingStartTime>Gl&&1073741824!==n&&(t.flags|=128,i=!0,Wo(a,!1),t.lanes=4194304);a.isBackwards?(l.sibling=t.child,t.child=l):(null!==(n=a.last)?n.sibling=l:t.child=l,a.last=l)}return null!==a.tail?(t=a.tail,a.rendering=t,a.tail=t.sibling,a.renderingStartTime=Je(),t.sibling=null,n=$s.current,Ar($s,i?1&n|2:1&n),t):(Yo(t),null);case 22:case 23:return hc(),i=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==i&&(t.flags|=8192),i&&0!==(1&t.mode)?0!==(1073741824&Pl)&&(Yo(t),6&t.subtreeFlags&&(t.flags|=8192)):Yo(t),null;case 24:case 25:return null}throw Error(s(156,t.tag))}function qo(e,t){switch(ts(t),t.tag){case 1:return Pr(t.type)&&kr(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Zs(),wr(Cr),wr(Rr),na(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return Qs(t),null;case 13:if(wr($s),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(s(340));fs()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return wr($s),null;case 4:return Zs(),null;case 10:return Ms(t.type._context),null;case 22:case 23:return hc(),null;default:return null}}Io=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Po=function(){},ko=function(e,t,n,i){var r=e.memoizedProps;if(r!==i){e=t.stateNode,qs(Ws.current);var s,a=null;switch(n){case"input":r=K(e,r),i=K(e,i),a=[];break;case"select":r=F({},r,{value:void 0}),i=F({},i,{value:void 0}),a=[];break;case"textarea":r=ie(e,r),i=ie(e,i),a=[];break;default:"function"!==typeof r.onClick&&"function"===typeof i.onClick&&(e.onclick=$i)}for(u in ye(n,i),n=null,r)if(!i.hasOwnProperty(u)&&r.hasOwnProperty(u)&&null!=r[u])if("style"===u){var l=r[u];for(s in l)l.hasOwnProperty(s)&&(n||(n={}),n[s]="")}else"dangerouslySetInnerHTML"!==u&&"children"!==u&&"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&"autoFocus"!==u&&(o.hasOwnProperty(u)?a||(a=[]):(a=a||[]).push(u,null));for(u in i){var c=i[u];if(l=null!=r?r[u]:void 0,i.hasOwnProperty(u)&&c!==l&&(null!=c||null!=l))if("style"===u)if(l){for(s in l)!l.hasOwnProperty(s)||c&&c.hasOwnProperty(s)||(n||(n={}),n[s]="");for(s in c)c.hasOwnProperty(s)&&l[s]!==c[s]&&(n||(n={}),n[s]=c[s])}else n||(a||(a=[]),a.push(u,n)),n=c;else"dangerouslySetInnerHTML"===u?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(a=a||[]).push(u,c)):"children"===u?"string"!==typeof c&&"number"!==typeof c||(a=a||[]).push(u,""+c):"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&(o.hasOwnProperty(u)?(null!=c&&"onScroll"===u&&Bi("scroll",e),a||l===c||(a=[])):(a=a||[]).push(u,c))}n&&(a=a||[]).push("style",n);var u=a;(t.updateQueue=u)&&(t.flags|=4)}},Do=function(e,t,n,i){n!==i&&(t.flags|=4)};var Ko=!1,Zo=!1,Jo="function"===typeof WeakSet?WeakSet:Set,Qo=null;function $o(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(i){Tc(e,t,i)}else n.current=null}function el(e,t,n){try{n()}catch(i){Tc(e,t,i)}}var tl=!1;function nl(e,t,n){var i=t.updateQueue;if(null!==(i=null!==i?i.lastEffect:null)){var r=i=i.next;do{if((r.tag&e)===e){var s=r.destroy;r.destroy=void 0,void 0!==s&&el(t,n,s)}r=r.next}while(r!==i)}}function il(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var i=n.create;n.destroy=i()}n=n.next}while(n!==t)}}function rl(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function sl(e){var t=e.alternate;null!==t&&(e.alternate=null,sl(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[dr],delete t[fr],delete t[mr],delete t[gr],delete t[vr])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function al(e){return 5===e.tag||3===e.tag||4===e.tag}function ol(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||al(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function ll(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=$i));else if(4!==i&&null!==(e=e.child))for(ll(e,t,n),e=e.sibling;null!==e;)ll(e,t,n),e=e.sibling}function cl(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==i&&null!==(e=e.child))for(cl(e,t,n),e=e.sibling;null!==e;)cl(e,t,n),e=e.sibling}var ul=null,hl=!1;function dl(e,t,n){for(n=n.child;null!==n;)fl(e,t,n),n=n.sibling}function fl(e,t,n){if(st&&"function"===typeof st.onCommitFiberUnmount)try{st.onCommitFiberUnmount(rt,n)}catch(o){}switch(n.tag){case 5:Zo||$o(n,t);case 6:var i=ul,r=hl;ul=null,dl(e,t,n),hl=r,null!==(ul=i)&&(hl?(e=ul,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):ul.removeChild(n.stateNode));break;case 18:null!==ul&&(hl?(e=ul,n=n.stateNode,8===e.nodeType?lr(e.parentNode,n):1===e.nodeType&&lr(e,n),Gt(e)):lr(ul,n.stateNode));break;case 4:i=ul,r=hl,ul=n.stateNode.containerInfo,hl=!0,dl(e,t,n),ul=i,hl=r;break;case 0:case 11:case 14:case 15:if(!Zo&&(null!==(i=n.updateQueue)&&null!==(i=i.lastEffect))){r=i=i.next;do{var s=r,a=s.destroy;s=s.tag,void 0!==a&&(0!==(2&s)||0!==(4&s))&&el(n,t,a),r=r.next}while(r!==i)}dl(e,t,n);break;case 1:if(!Zo&&($o(n,t),"function"===typeof(i=n.stateNode).componentWillUnmount))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(o){Tc(n,t,o)}dl(e,t,n);break;case 21:dl(e,t,n);break;case 22:1&n.mode?(Zo=(i=Zo)||null!==n.memoizedState,dl(e,t,n),Zo=i):dl(e,t,n);break;default:dl(e,t,n)}}function pl(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Jo),t.forEach(function(t){var i=Rc.bind(null,e,t);n.has(t)||(n.add(t),t.then(i,i))})}}function ml(e,t){var n=t.deletions;if(null!==n)for(var i=0;i<n.length;i++){var r=n[i];try{var a=e,o=t,l=o;e:for(;null!==l;){switch(l.tag){case 5:ul=l.stateNode,hl=!1;break e;case 3:case 4:ul=l.stateNode.containerInfo,hl=!0;break e}l=l.return}if(null===ul)throw Error(s(160));fl(a,o,r),ul=null,hl=!1;var c=r.alternate;null!==c&&(c.return=null),r.return=null}catch(u){Tc(r,t,u)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)gl(t,e),t=t.sibling}function gl(e,t){var n=e.alternate,i=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(ml(t,e),vl(e),4&i){try{nl(3,e,e.return),il(3,e)}catch(g){Tc(e,e.return,g)}try{nl(5,e,e.return)}catch(g){Tc(e,e.return,g)}}break;case 1:ml(t,e),vl(e),512&i&&null!==n&&$o(n,n.return);break;case 5:if(ml(t,e),vl(e),512&i&&null!==n&&$o(n,n.return),32&e.flags){var r=e.stateNode;try{de(r,"")}catch(g){Tc(e,e.return,g)}}if(4&i&&null!=(r=e.stateNode)){var a=e.memoizedProps,o=null!==n?n.memoizedProps:a,l=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===l&&"radio"===a.type&&null!=a.name&&J(r,a),be(l,o);var u=be(l,a);for(o=0;o<c.length;o+=2){var h=c[o],d=c[o+1];"style"===h?ge(r,d):"dangerouslySetInnerHTML"===h?he(r,d):"children"===h?de(r,d):b(r,h,d,u)}switch(l){case"input":Q(r,a);break;case"textarea":se(r,a);break;case"select":var f=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!a.multiple;var p=a.value;null!=p?ne(r,!!a.multiple,p,!1):f!==!!a.multiple&&(null!=a.defaultValue?ne(r,!!a.multiple,a.defaultValue,!0):ne(r,!!a.multiple,a.multiple?[]:"",!1))}r[fr]=a}catch(g){Tc(e,e.return,g)}}break;case 6:if(ml(t,e),vl(e),4&i){if(null===e.stateNode)throw Error(s(162));r=e.stateNode,a=e.memoizedProps;try{r.nodeValue=a}catch(g){Tc(e,e.return,g)}}break;case 3:if(ml(t,e),vl(e),4&i&&null!==n&&n.memoizedState.isDehydrated)try{Gt(t.containerInfo)}catch(g){Tc(e,e.return,g)}break;case 4:default:ml(t,e),vl(e);break;case 13:ml(t,e),vl(e),8192&(r=e.child).flags&&(a=null!==r.memoizedState,r.stateNode.isHidden=a,!a||null!==r.alternate&&null!==r.alternate.memoizedState||(jl=Je())),4&i&&pl(e);break;case 22:if(h=null!==n&&null!==n.memoizedState,1&e.mode?(Zo=(u=Zo)||h,ml(t,e),Zo=u):ml(t,e),vl(e),8192&i){if(u=null!==e.memoizedState,(e.stateNode.isHidden=u)&&!h&&0!==(1&e.mode))for(Qo=e,h=e.child;null!==h;){for(d=Qo=h;null!==Qo;){switch(p=(f=Qo).child,f.tag){case 0:case 11:case 14:case 15:nl(4,f,f.return);break;case 1:$o(f,f.return);var m=f.stateNode;if("function"===typeof m.componentWillUnmount){i=f,n=f.return;try{t=i,m.props=t.memoizedProps,m.state=t.memoizedState,m.componentWillUnmount()}catch(g){Tc(i,n,g)}}break;case 5:$o(f,f.return);break;case 22:if(null!==f.memoizedState){_l(d);continue}}null!==p?(p.return=f,Qo=p):_l(d)}h=h.sibling}e:for(h=null,d=e;;){if(5===d.tag){if(null===h){h=d;try{r=d.stateNode,u?"function"===typeof(a=r.style).setProperty?a.setProperty("display","none","important"):a.display="none":(l=d.stateNode,o=void 0!==(c=d.memoizedProps.style)&&null!==c&&c.hasOwnProperty("display")?c.display:null,l.style.display=me("display",o))}catch(g){Tc(e,e.return,g)}}}else if(6===d.tag){if(null===h)try{d.stateNode.nodeValue=u?"":d.memoizedProps}catch(g){Tc(e,e.return,g)}}else if((22!==d.tag&&23!==d.tag||null===d.memoizedState||d===e)&&null!==d.child){d.child.return=d,d=d.child;continue}if(d===e)break e;for(;null===d.sibling;){if(null===d.return||d.return===e)break e;h===d&&(h=null),d=d.return}h===d&&(h=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:ml(t,e),vl(e),4&i&&pl(e);case 21:}}function vl(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(al(n)){var i=n;break e}n=n.return}throw Error(s(160))}switch(i.tag){case 5:var r=i.stateNode;32&i.flags&&(de(r,""),i.flags&=-33),cl(e,ol(e),r);break;case 3:case 4:var a=i.stateNode.containerInfo;ll(e,ol(e),a);break;default:throw Error(s(161))}}catch(o){Tc(e,e.return,o)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function yl(e,t,n){Qo=e,bl(e,t,n)}function bl(e,t,n){for(var i=0!==(1&e.mode);null!==Qo;){var r=Qo,s=r.child;if(22===r.tag&&i){var a=null!==r.memoizedState||Ko;if(!a){var o=r.alternate,l=null!==o&&null!==o.memoizedState||Zo;o=Ko;var c=Zo;if(Ko=a,(Zo=l)&&!c)for(Qo=r;null!==Qo;)l=(a=Qo).child,22===a.tag&&null!==a.memoizedState?Sl(r):null!==l?(l.return=a,Qo=l):Sl(r);for(;null!==s;)Qo=s,bl(s,t,n),s=s.sibling;Qo=r,Ko=o,Zo=c}xl(e)}else 0!==(8772&r.subtreeFlags)&&null!==s?(s.return=r,Qo=s):xl(e)}}function xl(e){for(;null!==Qo;){var t=Qo;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Zo||il(5,t);break;case 1:var i=t.stateNode;if(4&t.flags&&!Zo)if(null===n)i.componentDidMount();else{var r=t.elementType===t.type?n.memoizedProps:to(t.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var a=t.updateQueue;null!==a&&Vs(t,a,i);break;case 3:var o=t.updateQueue;if(null!==o){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}Vs(t,o,n)}break;case 5:var l=t.stateNode;if(null===n&&4&t.flags){n=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var u=t.alternate;if(null!==u){var h=u.memoizedState;if(null!==h){var d=h.dehydrated;null!==d&&Gt(d)}}}break;default:throw Error(s(163))}Zo||512&t.flags&&rl(t)}catch(f){Tc(t,t.return,f)}}if(t===e){Qo=null;break}if(null!==(n=t.sibling)){n.return=t.return,Qo=n;break}Qo=t.return}}function _l(e){for(;null!==Qo;){var t=Qo;if(t===e){Qo=null;break}var n=t.sibling;if(null!==n){n.return=t.return,Qo=n;break}Qo=t.return}}function Sl(e){for(;null!==Qo;){var t=Qo;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{il(4,t)}catch(l){Tc(t,n,l)}break;case 1:var i=t.stateNode;if("function"===typeof i.componentDidMount){var r=t.return;try{i.componentDidMount()}catch(l){Tc(t,r,l)}}var s=t.return;try{rl(t)}catch(l){Tc(t,s,l)}break;case 5:var a=t.return;try{rl(t)}catch(l){Tc(t,a,l)}}}catch(l){Tc(t,t.return,l)}if(t===e){Qo=null;break}var o=t.sibling;if(null!==o){o.return=t.return,Qo=o;break}Qo=t.return}}var El,Tl=Math.ceil,wl=x.ReactCurrentDispatcher,Al=x.ReactCurrentOwner,Ml=x.ReactCurrentBatchConfig,Rl=0,Cl=null,Ll=null,Il=0,Pl=0,kl=Tr(0),Dl=0,Nl=null,Ol=0,Fl=0,Ul=0,Bl=null,zl=null,jl=0,Gl=1/0,Vl=null,Hl=!1,Wl=null,Yl=null,Xl=!1,ql=null,Kl=0,Zl=0,Jl=null,Ql=-1,$l=0;function ec(){return 0!==(6&Rl)?Je():-1!==Ql?Ql:Ql=Je()}function tc(e){return 0===(1&e.mode)?1:0!==(2&Rl)&&0!==Il?Il&-Il:null!==ms.transition?(0===$l&&($l=mt()),$l):0!==(e=bt)?e:e=void 0===(e=window.event)?16:Zt(e.type)}function nc(e,t,n,i){if(50<Zl)throw Zl=0,Jl=null,Error(s(185));vt(e,n,i),0!==(2&Rl)&&e===Cl||(e===Cl&&(0===(2&Rl)&&(Fl|=n),4===Dl&&oc(e,Il)),ic(e,i),1===n&&0===Rl&&0===(1&t.mode)&&(Gl=Je()+500,Br&&Gr()))}function ic(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,i=e.pingedLanes,r=e.expirationTimes,s=e.pendingLanes;0<s;){var a=31-at(s),o=1<<a,l=r[a];-1===l?0!==(o&n)&&0===(o&i)||(r[a]=ft(o,t)):l<=t&&(e.expiredLanes|=o),s&=~o}}(e,t);var i=dt(e,e===Cl?Il:0);if(0===i)null!==n&&qe(n),e.callbackNode=null,e.callbackPriority=0;else if(t=i&-i,e.callbackPriority!==t){if(null!=n&&qe(n),1===t)0===e.tag?function(e){Br=!0,jr(e)}(lc.bind(null,e)):jr(lc.bind(null,e)),ar(function(){0===(6&Rl)&&Gr()}),n=null;else{switch(xt(i)){case 1:n=$e;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=it}n=Cc(n,rc.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function rc(e,t){if(Ql=-1,$l=0,0!==(6&Rl))throw Error(s(327));var n=e.callbackNode;if(Sc()&&e.callbackNode!==n)return null;var i=dt(e,e===Cl?Il:0);if(0===i)return null;if(0!==(30&i)||0!==(i&e.expiredLanes)||t)t=gc(e,i);else{t=i;var r=Rl;Rl|=2;var a=pc();for(Cl===e&&Il===t||(Vl=null,Gl=Je()+500,dc(e,t));;)try{yc();break}catch(l){fc(e,l)}As(),wl.current=a,Rl=r,null!==Ll?t=0:(Cl=null,Il=0,t=Dl)}if(0!==t){if(2===t&&(0!==(r=pt(e))&&(i=r,t=sc(e,r))),1===t)throw n=Nl,dc(e,0),oc(e,i),ic(e,Je()),n;if(6===t)oc(e,i);else{if(r=e.current.alternate,0===(30&i)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var i=0;i<n.length;i++){var r=n[i],s=r.getSnapshot;r=r.value;try{if(!oi(s(),r))return!1}catch(o){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(r)&&(2===(t=gc(e,i))&&(0!==(a=pt(e))&&(i=a,t=sc(e,a))),1===t))throw n=Nl,dc(e,0),oc(e,i),ic(e,Je()),n;switch(e.finishedWork=r,e.finishedLanes=i,t){case 0:case 1:throw Error(s(345));case 2:case 5:_c(e,zl,Vl);break;case 3:if(oc(e,i),(130023424&i)===i&&10<(t=jl+500-Je())){if(0!==dt(e,0))break;if(((r=e.suspendedLanes)&i)!==i){ec(),e.pingedLanes|=e.suspendedLanes&r;break}e.timeoutHandle=ir(_c.bind(null,e,zl,Vl),t);break}_c(e,zl,Vl);break;case 4:if(oc(e,i),(4194240&i)===i)break;for(t=e.eventTimes,r=-1;0<i;){var o=31-at(i);a=1<<o,(o=t[o])>r&&(r=o),i&=~a}if(i=r,10<(i=(120>(i=Je()-i)?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*Tl(i/1960))-i)){e.timeoutHandle=ir(_c.bind(null,e,zl,Vl),i);break}_c(e,zl,Vl);break;default:throw Error(s(329))}}}return ic(e,Je()),e.callbackNode===n?rc.bind(null,e):null}function sc(e,t){var n=Bl;return e.current.memoizedState.isDehydrated&&(dc(e,t).flags|=256),2!==(e=gc(e,t))&&(t=zl,zl=n,null!==t&&ac(t)),e}function ac(e){null===zl?zl=e:zl.push.apply(zl,e)}function oc(e,t){for(t&=~Ul,t&=~Fl,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-at(t),i=1<<n;e[n]=-1,t&=~i}}function lc(e){if(0!==(6&Rl))throw Error(s(327));Sc();var t=dt(e,0);if(0===(1&t))return ic(e,Je()),null;var n=gc(e,t);if(0!==e.tag&&2===n){var i=pt(e);0!==i&&(t=i,n=sc(e,i))}if(1===n)throw n=Nl,dc(e,0),oc(e,t),ic(e,Je()),n;if(6===n)throw Error(s(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,_c(e,zl,Vl),ic(e,Je()),null}function cc(e,t){var n=Rl;Rl|=1;try{return e(t)}finally{0===(Rl=n)&&(Gl=Je()+500,Br&&Gr())}}function uc(e){null!==ql&&0===ql.tag&&0===(6&Rl)&&Sc();var t=Rl;Rl|=1;var n=Ml.transition,i=bt;try{if(Ml.transition=null,bt=1,e)return e()}finally{bt=i,Ml.transition=n,0===(6&(Rl=t))&&Gr()}}function hc(){Pl=kl.current,wr(kl)}function dc(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,rr(n)),null!==Ll)for(n=Ll.return;null!==n;){var i=n;switch(ts(i),i.tag){case 1:null!==(i=i.type.childContextTypes)&&void 0!==i&&kr();break;case 3:Zs(),wr(Cr),wr(Rr),na();break;case 5:Qs(i);break;case 4:Zs();break;case 13:case 19:wr($s);break;case 10:Ms(i.type._context);break;case 22:case 23:hc()}n=n.return}if(Cl=e,Ll=e=kc(e.current,null),Il=Pl=t,Dl=0,Nl=null,Ul=Fl=Ol=0,zl=Bl=null,null!==Is){for(t=0;t<Is.length;t++)if(null!==(i=(n=Is[t]).interleaved)){n.interleaved=null;var r=i.next,s=n.pending;if(null!==s){var a=s.next;s.next=r,i.next=a}n.pending=i}Is=null}return e}function fc(e,t){for(;;){var n=Ll;try{if(As(),ia.current=Ja,ca){for(var i=aa.memoizedState;null!==i;){var r=i.queue;null!==r&&(r.pending=null),i=i.next}ca=!1}if(sa=0,la=oa=aa=null,ua=!1,ha=0,Al.current=null,null===n||null===n.return){Dl=1,Nl=t,Ll=null;break}e:{var a=e,o=n.return,l=n,c=t;if(t=Il,l.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var u=c,h=l,d=h.tag;if(0===(1&h.mode)&&(0===d||11===d||15===d)){var f=h.alternate;f?(h.updateQueue=f.updateQueue,h.memoizedState=f.memoizedState,h.lanes=f.lanes):(h.updateQueue=null,h.memoizedState=null)}var p=go(o);if(null!==p){p.flags&=-257,vo(p,o,l,0,t),1&p.mode&&mo(a,u,t),c=u;var m=(t=p).updateQueue;if(null===m){var g=new Set;g.add(c),t.updateQueue=g}else m.add(c);break e}if(0===(1&t)){mo(a,u,t),mc();break e}c=Error(s(426))}else if(rs&&1&l.mode){var v=go(o);if(null!==v){0===(65536&v.flags)&&(v.flags|=256),vo(v,o,l,0,t),ps(lo(c,l));break e}}a=c=lo(c,l),4!==Dl&&(Dl=2),null===Bl?Bl=[a]:Bl.push(a),a=o;do{switch(a.tag){case 3:a.flags|=65536,t&=-t,a.lanes|=t,js(a,fo(0,c,t));break e;case 1:l=c;var y=a.type,b=a.stateNode;if(0===(128&a.flags)&&("function"===typeof y.getDerivedStateFromError||null!==b&&"function"===typeof b.componentDidCatch&&(null===Yl||!Yl.has(b)))){a.flags|=65536,t&=-t,a.lanes|=t,js(a,po(a,l,t));break e}}a=a.return}while(null!==a)}xc(n)}catch(x){t=x,Ll===n&&null!==n&&(Ll=n=n.return);continue}break}}function pc(){var e=wl.current;return wl.current=Ja,null===e?Ja:e}function mc(){0!==Dl&&3!==Dl&&2!==Dl||(Dl=4),null===Cl||0===(268435455&Ol)&&0===(268435455&Fl)||oc(Cl,Il)}function gc(e,t){var n=Rl;Rl|=2;var i=pc();for(Cl===e&&Il===t||(Vl=null,dc(e,t));;)try{vc();break}catch(r){fc(e,r)}if(As(),Rl=n,wl.current=i,null!==Ll)throw Error(s(261));return Cl=null,Il=0,Dl}function vc(){for(;null!==Ll;)bc(Ll)}function yc(){for(;null!==Ll&&!Ke();)bc(Ll)}function bc(e){var t=El(e.alternate,e,Pl);e.memoizedProps=e.pendingProps,null===t?xc(e):Ll=t,Al.current=null}function xc(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=Xo(n,t,Pl)))return void(Ll=n)}else{if(null!==(n=qo(n,t)))return n.flags&=32767,void(Ll=n);if(null===e)return Dl=6,void(Ll=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Ll=t);Ll=t=e}while(null!==t);0===Dl&&(Dl=5)}function _c(e,t,n){var i=bt,r=Ml.transition;try{Ml.transition=null,bt=1,function(e,t,n,i){do{Sc()}while(null!==ql);if(0!==(6&Rl))throw Error(s(327));n=e.finishedWork;var r=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(s(177));e.callbackNode=null,e.callbackPriority=0;var a=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var i=e.eventTimes;for(e=e.expirationTimes;0<n;){var r=31-at(n),s=1<<r;t[r]=0,i[r]=-1,e[r]=-1,n&=~s}}(e,a),e===Cl&&(Ll=Cl=null,Il=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||Xl||(Xl=!0,Cc(tt,function(){return Sc(),null})),a=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||a){a=Ml.transition,Ml.transition=null;var o=bt;bt=1;var l=Rl;Rl|=4,Al.current=null,function(e,t){if(er=Ht,fi(e=di())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var i=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(i&&0!==i.rangeCount){n=i.anchorNode;var r=i.anchorOffset,a=i.focusNode;i=i.focusOffset;try{n.nodeType,a.nodeType}catch(_){n=null;break e}var o=0,l=-1,c=-1,u=0,h=0,d=e,f=null;t:for(;;){for(var p;d!==n||0!==r&&3!==d.nodeType||(l=o+r),d!==a||0!==i&&3!==d.nodeType||(c=o+i),3===d.nodeType&&(o+=d.nodeValue.length),null!==(p=d.firstChild);)f=d,d=p;for(;;){if(d===e)break t;if(f===n&&++u===r&&(l=o),f===a&&++h===i&&(c=o),null!==(p=d.nextSibling))break;f=(d=f).parentNode}d=p}n=-1===l||-1===c?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(tr={focusedElem:e,selectionRange:n},Ht=!1,Qo=t;null!==Qo;)if(e=(t=Qo).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,Qo=e;else for(;null!==Qo;){t=Qo;try{var m=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==m){var g=m.memoizedProps,v=m.memoizedState,y=t.stateNode,b=y.getSnapshotBeforeUpdate(t.elementType===t.type?g:to(t.type,g),v);y.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var x=t.stateNode.containerInfo;1===x.nodeType?x.textContent="":9===x.nodeType&&x.documentElement&&x.removeChild(x.documentElement);break;default:throw Error(s(163))}}catch(_){Tc(t,t.return,_)}if(null!==(e=t.sibling)){e.return=t.return,Qo=e;break}Qo=t.return}m=tl,tl=!1}(e,n),gl(n,e),pi(tr),Ht=!!er,tr=er=null,e.current=n,yl(n,e,r),Ze(),Rl=l,bt=o,Ml.transition=a}else e.current=n;if(Xl&&(Xl=!1,ql=e,Kl=r),a=e.pendingLanes,0===a&&(Yl=null),function(e){if(st&&"function"===typeof st.onCommitFiberRoot)try{st.onCommitFiberRoot(rt,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),ic(e,Je()),null!==t)for(i=e.onRecoverableError,n=0;n<t.length;n++)r=t[n],i(r.value,{componentStack:r.stack,digest:r.digest});if(Hl)throw Hl=!1,e=Wl,Wl=null,e;0!==(1&Kl)&&0!==e.tag&&Sc(),a=e.pendingLanes,0!==(1&a)?e===Jl?Zl++:(Zl=0,Jl=e):Zl=0,Gr()}(e,t,n,i)}finally{Ml.transition=r,bt=i}return null}function Sc(){if(null!==ql){var e=xt(Kl),t=Ml.transition,n=bt;try{if(Ml.transition=null,bt=16>e?16:e,null===ql)var i=!1;else{if(e=ql,ql=null,Kl=0,0!==(6&Rl))throw Error(s(331));var r=Rl;for(Rl|=4,Qo=e.current;null!==Qo;){var a=Qo,o=a.child;if(0!==(16&Qo.flags)){var l=a.deletions;if(null!==l){for(var c=0;c<l.length;c++){var u=l[c];for(Qo=u;null!==Qo;){var h=Qo;switch(h.tag){case 0:case 11:case 15:nl(8,h,a)}var d=h.child;if(null!==d)d.return=h,Qo=d;else for(;null!==Qo;){var f=(h=Qo).sibling,p=h.return;if(sl(h),h===u){Qo=null;break}if(null!==f){f.return=p,Qo=f;break}Qo=p}}}var m=a.alternate;if(null!==m){var g=m.child;if(null!==g){m.child=null;do{var v=g.sibling;g.sibling=null,g=v}while(null!==g)}}Qo=a}}if(0!==(2064&a.subtreeFlags)&&null!==o)o.return=a,Qo=o;else e:for(;null!==Qo;){if(0!==(2048&(a=Qo).flags))switch(a.tag){case 0:case 11:case 15:nl(9,a,a.return)}var y=a.sibling;if(null!==y){y.return=a.return,Qo=y;break e}Qo=a.return}}var b=e.current;for(Qo=b;null!==Qo;){var x=(o=Qo).child;if(0!==(2064&o.subtreeFlags)&&null!==x)x.return=o,Qo=x;else e:for(o=b;null!==Qo;){if(0!==(2048&(l=Qo).flags))try{switch(l.tag){case 0:case 11:case 15:il(9,l)}}catch(S){Tc(l,l.return,S)}if(l===o){Qo=null;break e}var _=l.sibling;if(null!==_){_.return=l.return,Qo=_;break e}Qo=l.return}}if(Rl=r,Gr(),st&&"function"===typeof st.onPostCommitFiberRoot)try{st.onPostCommitFiberRoot(rt,e)}catch(S){}i=!0}return i}finally{bt=n,Ml.transition=t}}return!1}function Ec(e,t,n){e=Bs(e,t=fo(0,t=lo(n,t),1),1),t=ec(),null!==e&&(vt(e,1,t),ic(e,t))}function Tc(e,t,n){if(3===e.tag)Ec(e,e,n);else for(;null!==t;){if(3===t.tag){Ec(t,e,n);break}if(1===t.tag){var i=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof i.componentDidCatch&&(null===Yl||!Yl.has(i))){t=Bs(t,e=po(t,e=lo(n,e),1),1),e=ec(),null!==t&&(vt(t,1,e),ic(t,e));break}}t=t.return}}function wc(e,t,n){var i=e.pingCache;null!==i&&i.delete(t),t=ec(),e.pingedLanes|=e.suspendedLanes&n,Cl===e&&(Il&n)===n&&(4===Dl||3===Dl&&(130023424&Il)===Il&&500>Je()-jl?dc(e,0):Ul|=n),ic(e,t)}function Ac(e,t){0===t&&(0===(1&e.mode)?t=1:(t=ut,0===(130023424&(ut<<=1))&&(ut=4194304)));var n=ec();null!==(e=Ds(e,t))&&(vt(e,t,n),ic(e,n))}function Mc(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Ac(e,n)}function Rc(e,t){var n=0;switch(e.tag){case 13:var i=e.stateNode,r=e.memoizedState;null!==r&&(n=r.retryLane);break;case 19:i=e.stateNode;break;default:throw Error(s(314))}null!==i&&i.delete(t),Ac(e,n)}function Cc(e,t){return Xe(e,t)}function Lc(e,t,n,i){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ic(e,t,n,i){return new Lc(e,t,n,i)}function Pc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function kc(e,t){var n=e.alternate;return null===n?((n=Ic(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Dc(e,t,n,i,r,a){var o=2;if(i=e,"function"===typeof e)Pc(e)&&(o=1);else if("string"===typeof e)o=5;else e:switch(e){case E:return Nc(n.children,r,a,t);case T:o=8,r|=8;break;case w:return(e=Ic(12,n,t,2|r)).elementType=w,e.lanes=a,e;case C:return(e=Ic(13,n,t,r)).elementType=C,e.lanes=a,e;case L:return(e=Ic(19,n,t,r)).elementType=L,e.lanes=a,e;case k:return Oc(n,r,a,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case A:o=10;break e;case M:o=9;break e;case R:o=11;break e;case I:o=14;break e;case P:o=16,i=null;break e}throw Error(s(130,null==e?e:typeof e,""))}return(t=Ic(o,n,t,r)).elementType=e,t.type=i,t.lanes=a,t}function Nc(e,t,n,i){return(e=Ic(7,e,i,t)).lanes=n,e}function Oc(e,t,n,i){return(e=Ic(22,e,i,t)).elementType=k,e.lanes=n,e.stateNode={isHidden:!1},e}function Fc(e,t,n){return(e=Ic(6,e,null,t)).lanes=n,e}function Uc(e,t,n){return(t=Ic(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Bc(e,t,n,i,r){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gt(0),this.expirationTimes=gt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gt(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function zc(e,t,n,i,r,s,a,o,l){return e=new Bc(e,t,n,o,l),1===t?(t=1,!0===s&&(t|=8)):t=0,s=Ic(3,null,null,t),e.current=s,s.stateNode=e,s.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Os(s),e}function jc(e){if(!e)return Mr;e:{if(Ge(e=e._reactInternals)!==e||1!==e.tag)throw Error(s(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Pr(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(s(171))}if(1===e.tag){var n=e.type;if(Pr(n))return Nr(e,n,t)}return t}function Gc(e,t,n,i,r,s,a,o,l){return(e=zc(n,i,!0,e,0,s,0,o,l)).context=jc(null),n=e.current,(s=Us(i=ec(),r=tc(n))).callback=void 0!==t&&null!==t?t:null,Bs(n,s,r),e.current.lanes=r,vt(e,r,i),ic(e,i),e}function Vc(e,t,n,i){var r=t.current,s=ec(),a=tc(r);return n=jc(n),null===t.context?t.context=n:t.pendingContext=n,(t=Us(s,a)).payload={element:e},null!==(i=void 0===i?null:i)&&(t.callback=i),null!==(e=Bs(r,t,a))&&(nc(e,r,a,s),zs(e,r,a)),a}function Hc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Wc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Yc(e,t){Wc(e,t),(e=e.alternate)&&Wc(e,t)}El=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Cr.current)bo=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return bo=!1,function(e,t,n){switch(t.tag){case 3:Co(t),fs();break;case 5:Js(t);break;case 1:Pr(t.type)&&Or(t);break;case 4:Ks(t,t.stateNode.containerInfo);break;case 10:var i=t.type._context,r=t.memoizedProps.value;Ar(Ss,i._currentValue),i._currentValue=r;break;case 13:if(null!==(i=t.memoizedState))return null!==i.dehydrated?(Ar($s,1&$s.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Fo(e,t,n):(Ar($s,1&$s.current),null!==(e=Ho(e,t,n))?e.sibling:null);Ar($s,1&$s.current);break;case 19:if(i=0!==(n&t.childLanes),0!==(128&e.flags)){if(i)return Go(e,t,n);t.flags|=128}if(null!==(r=t.memoizedState)&&(r.rendering=null,r.tail=null,r.lastEffect=null),Ar($s,$s.current),i)break;return null;case 22:case 23:return t.lanes=0,To(e,t,n)}return Ho(e,t,n)}(e,t,n);bo=0!==(131072&e.flags)}else bo=!1,rs&&0!==(1048576&t.flags)&&$r(t,Yr,t.index);switch(t.lanes=0,t.tag){case 2:var i=t.type;Vo(e,t),e=t.pendingProps;var r=Ir(t,Rr.current);Cs(t,n),r=ma(null,t,i,e,r,n);var a=ga();return t.flags|=1,"object"===typeof r&&null!==r&&"function"===typeof r.render&&void 0===r.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Pr(i)?(a=!0,Or(t)):a=!1,t.memoizedState=null!==r.state&&void 0!==r.state?r.state:null,Os(t),r.updater=io,t.stateNode=r,r._reactInternals=t,oo(t,i,e,n),t=Ro(null,t,i,!0,a,n)):(t.tag=0,rs&&a&&es(t),xo(null,t,r,n),t=t.child),t;case 16:i=t.elementType;e:{switch(Vo(e,t),e=t.pendingProps,i=(r=i._init)(i._payload),t.type=i,r=t.tag=function(e){if("function"===typeof e)return Pc(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===R)return 11;if(e===I)return 14}return 2}(i),e=to(i,e),r){case 0:t=Ao(null,t,i,e,n);break e;case 1:t=Mo(null,t,i,e,n);break e;case 11:t=_o(null,t,i,e,n);break e;case 14:t=So(null,t,i,to(i.type,e),n);break e}throw Error(s(306,i,""))}return t;case 0:return i=t.type,r=t.pendingProps,Ao(e,t,i,r=t.elementType===i?r:to(i,r),n);case 1:return i=t.type,r=t.pendingProps,Mo(e,t,i,r=t.elementType===i?r:to(i,r),n);case 3:e:{if(Co(t),null===e)throw Error(s(387));i=t.pendingProps,r=(a=t.memoizedState).element,Fs(e,t),Gs(t,i,null,n);var o=t.memoizedState;if(i=o.element,a.isDehydrated){if(a={element:i,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},t.updateQueue.baseState=a,t.memoizedState=a,256&t.flags){t=Lo(e,t,i,n,r=lo(Error(s(423)),t));break e}if(i!==r){t=Lo(e,t,i,n,r=lo(Error(s(424)),t));break e}for(is=cr(t.stateNode.containerInfo.firstChild),ns=t,rs=!0,ss=null,n=_s(t,null,i,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(fs(),i===r){t=Ho(e,t,n);break e}xo(e,t,i,n)}t=t.child}return t;case 5:return Js(t),null===e&&cs(t),i=t.type,r=t.pendingProps,a=null!==e?e.memoizedProps:null,o=r.children,nr(i,r)?o=null:null!==a&&nr(i,a)&&(t.flags|=32),wo(e,t),xo(e,t,o,n),t.child;case 6:return null===e&&cs(t),null;case 13:return Fo(e,t,n);case 4:return Ks(t,t.stateNode.containerInfo),i=t.pendingProps,null===e?t.child=xs(t,null,i,n):xo(e,t,i,n),t.child;case 11:return i=t.type,r=t.pendingProps,_o(e,t,i,r=t.elementType===i?r:to(i,r),n);case 7:return xo(e,t,t.pendingProps,n),t.child;case 8:case 12:return xo(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(i=t.type._context,r=t.pendingProps,a=t.memoizedProps,o=r.value,Ar(Ss,i._currentValue),i._currentValue=o,null!==a)if(oi(a.value,o)){if(a.children===r.children&&!Cr.current){t=Ho(e,t,n);break e}}else for(null!==(a=t.child)&&(a.return=t);null!==a;){var l=a.dependencies;if(null!==l){o=a.child;for(var c=l.firstContext;null!==c;){if(c.context===i){if(1===a.tag){(c=Us(-1,n&-n)).tag=2;var u=a.updateQueue;if(null!==u){var h=(u=u.shared).pending;null===h?c.next=c:(c.next=h.next,h.next=c),u.pending=c}}a.lanes|=n,null!==(c=a.alternate)&&(c.lanes|=n),Rs(a.return,n,t),l.lanes|=n;break}c=c.next}}else if(10===a.tag)o=a.type===t.type?null:a.child;else if(18===a.tag){if(null===(o=a.return))throw Error(s(341));o.lanes|=n,null!==(l=o.alternate)&&(l.lanes|=n),Rs(o,n,t),o=a.sibling}else o=a.child;if(null!==o)o.return=a;else for(o=a;null!==o;){if(o===t){o=null;break}if(null!==(a=o.sibling)){a.return=o.return,o=a;break}o=o.return}a=o}xo(e,t,r.children,n),t=t.child}return t;case 9:return r=t.type,i=t.pendingProps.children,Cs(t,n),i=i(r=Ls(r)),t.flags|=1,xo(e,t,i,n),t.child;case 14:return r=to(i=t.type,t.pendingProps),So(e,t,i,r=to(i.type,r),n);case 15:return Eo(e,t,t.type,t.pendingProps,n);case 17:return i=t.type,r=t.pendingProps,r=t.elementType===i?r:to(i,r),Vo(e,t),t.tag=1,Pr(i)?(e=!0,Or(t)):e=!1,Cs(t,n),so(t,i,r),oo(t,i,r,n),Ro(null,t,i,!0,e,n);case 19:return Go(e,t,n);case 22:return To(e,t,n)}throw Error(s(156,t.tag))};var Xc="function"===typeof reportError?reportError:function(e){console.error(e)};function qc(e){this._internalRoot=e}function Kc(e){this._internalRoot=e}function Zc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Jc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Qc(){}function $c(e,t,n,i,r){var s=n._reactRootContainer;if(s){var a=s;if("function"===typeof r){var o=r;r=function(){var e=Hc(a);o.call(e)}}Vc(t,a,e,r)}else a=function(e,t,n,i,r){if(r){if("function"===typeof i){var s=i;i=function(){var e=Hc(a);s.call(e)}}var a=Gc(t,i,e,0,null,!1,0,"",Qc);return e._reactRootContainer=a,e[pr]=a.current,Gi(8===e.nodeType?e.parentNode:e),uc(),a}for(;r=e.lastChild;)e.removeChild(r);if("function"===typeof i){var o=i;i=function(){var e=Hc(l);o.call(e)}}var l=zc(e,0,!1,null,0,!1,0,"",Qc);return e._reactRootContainer=l,e[pr]=l.current,Gi(8===e.nodeType?e.parentNode:e),uc(function(){Vc(t,l,n,i)}),l}(n,t,e,r,i);return Hc(a)}Kc.prototype.render=qc.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(s(409));Vc(e,t,null,null)},Kc.prototype.unmount=qc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;uc(function(){Vc(null,e,null,null)}),t[pr]=null}},Kc.prototype.unstable_scheduleHydration=function(e){if(e){var t=Tt();e={blockedOn:null,target:e,priority:t};for(var n=0;n<kt.length&&0!==t&&t<kt[n].priority;n++);kt.splice(n,0,e),0===n&&Ft(e)}},_t=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=ht(t.pendingLanes);0!==n&&(yt(t,1|n),ic(t,Je()),0===(6&Rl)&&(Gl=Je()+500,Gr()))}break;case 13:uc(function(){var t=Ds(e,1);if(null!==t){var n=ec();nc(t,e,1,n)}}),Yc(e,1)}},St=function(e){if(13===e.tag){var t=Ds(e,134217728);if(null!==t)nc(t,e,134217728,ec());Yc(e,134217728)}},Et=function(e){if(13===e.tag){var t=tc(e),n=Ds(e,t);if(null!==n)nc(n,e,t,ec());Yc(e,t)}},Tt=function(){return bt},wt=function(e,t){var n=bt;try{return bt=e,t()}finally{bt=n}},Se=function(e,t,n){switch(t){case"input":if(Q(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var i=n[t];if(i!==e&&i.form===e.form){var r=_r(i);if(!r)throw Error(s(90));X(i),Q(i,r)}}}break;case"textarea":se(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},Re=cc,Ce=uc;var eu={usingClientEntryPoint:!1,Events:[br,xr,_r,Ae,Me,cc]},tu={findFiberByHostInstance:yr,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},nu={bundleType:tu.bundleType,version:tu.version,rendererPackageName:tu.rendererPackageName,rendererConfig:tu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:x.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=We(e))?null:e.stateNode},findFiberByHostInstance:tu.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var iu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!iu.isDisabled&&iu.supportsFiber)try{rt=iu.inject(nu),st=iu}catch(ue){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=eu,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Zc(t))throw Error(s(200));return function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:S,key:null==i?null:""+i,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!Zc(e))throw Error(s(299));var n=!1,i="",r=Xc;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(i=t.identifierPrefix),void 0!==t.onRecoverableError&&(r=t.onRecoverableError)),t=zc(e,1,!1,null,0,n,0,i,r),e[pr]=t.current,Gi(8===e.nodeType?e.parentNode:e),new qc(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(s(188));throw e=Object.keys(e).join(","),Error(s(268,e))}return e=null===(e=We(t))?null:e.stateNode},t.flushSync=function(e){return uc(e)},t.hydrate=function(e,t,n){if(!Jc(t))throw Error(s(200));return $c(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!Zc(e))throw Error(s(405));var i=null!=n&&n.hydratedSources||null,r=!1,a="",o=Xc;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(r=!0),void 0!==n.identifierPrefix&&(a=n.identifierPrefix),void 0!==n.onRecoverableError&&(o=n.onRecoverableError)),t=Gc(t,null,e,1,null!=n?n:null,r,0,a,o),e[pr]=t.current,Gi(e),i)for(e=0;e<i.length;e++)r=(r=(n=i[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,r]:t.mutableSourceEagerHydrationData.push(n,r);return new Kc(t)},t.render=function(e,t,n){if(!Jc(t))throw Error(s(200));return $c(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Jc(e))throw Error(s(40));return!!e._reactRootContainer&&(uc(function(){$c(null,null,e,!1,function(){e._reactRootContainer=null,e[pr]=null})}),!0)},t.unstable_batchedUpdates=cc,t.unstable_renderSubtreeIntoContainer=function(e,t,n,i){if(!Jc(n))throw Error(s(200));if(null==e||void 0===e._reactInternals)throw Error(s(38));return $c(e,t,n,!1,i)},t.version="18.3.1-next-f1338f8080-20240426"},784:(e,t,n)=>{"use strict";e.exports=n(813)},788:(e,t,n)=>{"use strict";n.r(t),n.d(t,{AbrController:()=>it,AttrList:()=>Jt,AudioStreamController:()=>Jr,AudioTrackController:()=>ns,BasePlaylistController:()=>Qr,BaseSegment:()=>z,BaseStreamController:()=>bi,BufferController:()=>os,CMCDController:()=>ra,CapLevelController:()=>us,ChunkMetadata:()=>jt,ContentSteeringController:()=>sa,Cues:()=>Do,DateRange:()=>en,EMEController:()=>la,ErrorActionFlags:()=>yt,ErrorController:()=>bt,ErrorDetails:()=>o,ErrorTypes:()=>a,Events:()=>l,FPSController:()=>fa,FetchLoader:()=>Fo,Fragment:()=>G,Hls:()=>ul,HlsSkip:()=>Ge,HlsUrlParameters:()=>He,KeySystemFormats:()=>fn,KeySystems:()=>dn,Level:()=>We,LevelDetails:()=>tn,LevelKey:()=>_n,LoadStats:()=>O,M3U8Parser:()=>Rn,MetadataSchema:()=>Ki,NetworkErrorAction:()=>vt,Part:()=>V,PlaylistLevelType:()=>f,SubtitleStreamController:()=>Na,SubtitleTrackController:()=>ba,TimelineController:()=>Co,XhrLoader:()=>jo,default:()=>ul,fetchSupported:()=>No,getMediaSource:()=>M,isMSESupported:()=>nl,isSupported:()=>il,requestMediaKeySystemAccess:()=>vn});const i=Number.isFinite||function(e){return"number"===typeof e&&isFinite(e)},r=Number.isSafeInteger||function(e){return"number"===typeof e&&Math.abs(e)<=s},s=Number.MAX_SAFE_INTEGER||9007199254740991;let a=function(e){return e.NETWORK_ERROR="networkError",e.MEDIA_ERROR="mediaError",e.KEY_SYSTEM_ERROR="keySystemError",e.MUX_ERROR="muxError",e.OTHER_ERROR="otherError",e}({}),o=function(e){return e.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",e.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",e.KEY_SYSTEM_NO_SESSION="keySystemNoSession",e.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",e.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",e.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",e.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",e.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",e.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",e.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",e.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",e.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",e.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",e.MANIFEST_LOAD_ERROR="manifestLoadError",e.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",e.MANIFEST_PARSING_ERROR="manifestParsingError",e.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",e.LEVEL_EMPTY_ERROR="levelEmptyError",e.LEVEL_LOAD_ERROR="levelLoadError",e.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",e.LEVEL_PARSING_ERROR="levelParsingError",e.LEVEL_SWITCH_ERROR="levelSwitchError",e.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",e.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",e.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",e.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",e.FRAG_LOAD_ERROR="fragLoadError",e.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",e.FRAG_DECRYPT_ERROR="fragDecryptError",e.FRAG_PARSING_ERROR="fragParsingError",e.FRAG_GAP="fragGap",e.REMUX_ALLOC_ERROR="remuxAllocError",e.KEY_LOAD_ERROR="keyLoadError",e.KEY_LOAD_TIMEOUT="keyLoadTimeOut",e.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",e.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",e.BUFFER_APPEND_ERROR="bufferAppendError",e.BUFFER_APPENDING_ERROR="bufferAppendingError",e.BUFFER_STALLED_ERROR="bufferStalledError",e.BUFFER_FULL_ERROR="bufferFullError",e.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",e.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",e.ASSET_LIST_LOAD_ERROR="assetListLoadError",e.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",e.ASSET_LIST_PARSING_ERROR="assetListParsingError",e.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",e.INTERNAL_EXCEPTION="internalException",e.INTERNAL_ABORTED="aborted",e.ATTACH_MEDIA_ERROR="attachMediaError",e.UNKNOWN="unknown",e}({}),l=function(e){return e.MEDIA_ATTACHING="hlsMediaAttaching",e.MEDIA_ATTACHED="hlsMediaAttached",e.MEDIA_DETACHING="hlsMediaDetaching",e.MEDIA_DETACHED="hlsMediaDetached",e.MEDIA_ENDED="hlsMediaEnded",e.STALL_RESOLVED="hlsStallResolved",e.BUFFER_RESET="hlsBufferReset",e.BUFFER_CODECS="hlsBufferCodecs",e.BUFFER_CREATED="hlsBufferCreated",e.BUFFER_APPENDING="hlsBufferAppending",e.BUFFER_APPENDED="hlsBufferAppended",e.BUFFER_EOS="hlsBufferEos",e.BUFFERED_TO_END="hlsBufferedToEnd",e.BUFFER_FLUSHING="hlsBufferFlushing",e.BUFFER_FLUSHED="hlsBufferFlushed",e.MANIFEST_LOADING="hlsManifestLoading",e.MANIFEST_LOADED="hlsManifestLoaded",e.MANIFEST_PARSED="hlsManifestParsed",e.LEVEL_SWITCHING="hlsLevelSwitching",e.LEVEL_SWITCHED="hlsLevelSwitched",e.LEVEL_LOADING="hlsLevelLoading",e.LEVEL_LOADED="hlsLevelLoaded",e.LEVEL_UPDATED="hlsLevelUpdated",e.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",e.LEVELS_UPDATED="hlsLevelsUpdated",e.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",e.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",e.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",e.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",e.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",e.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",e.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",e.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",e.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",e.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",e.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",e.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",e.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",e.CUES_PARSED="hlsCuesParsed",e.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",e.INIT_PTS_FOUND="hlsInitPtsFound",e.FRAG_LOADING="hlsFragLoading",e.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",e.FRAG_LOADED="hlsFragLoaded",e.FRAG_DECRYPTED="hlsFragDecrypted",e.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",e.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",e.FRAG_PARSING_METADATA="hlsFragParsingMetadata",e.FRAG_PARSED="hlsFragParsed",e.FRAG_BUFFERED="hlsFragBuffered",e.FRAG_CHANGED="hlsFragChanged",e.FPS_DROP="hlsFpsDrop",e.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",e.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",e.ERROR="hlsError",e.DESTROYING="hlsDestroying",e.KEY_LOADING="hlsKeyLoading",e.KEY_LOADED="hlsKeyLoaded",e.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",e.BACK_BUFFER_REACHED="hlsBackBufferReached",e.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",e.ASSET_LIST_LOADING="hlsAssetListLoading",e.ASSET_LIST_LOADED="hlsAssetListLoaded",e.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",e.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",e.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",e.INTERSTITIAL_STARTED="hlsInterstitialStarted",e.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",e.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",e.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",e.INTERSTITIAL_ENDED="hlsInterstitialEnded",e.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",e.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",e.EVENT_CUE_ENTER="hlsEventCueEnter",e}({});var c="manifest",u="level",h="audioTrack",d="subtitleTrack",f={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class p{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=n}sample(e,t){const n=Math.pow(this.alpha_,e);this.estimate_=t*(1-n)+n*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class m{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100;this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=n,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new p(e),this.fast_=new p(t),this.defaultTTFB_=i,this.ttfb_=new p(e)}update(e,t){const{slow_:n,fast_:i,ttfb_:r}=this;n.halfLife!==e&&(this.slow_=new p(e,n.getEstimate(),n.getTotalWeight())),i.halfLife!==t&&(this.fast_=new p(t,i.getEstimate(),i.getTotalWeight())),r.halfLife!==e&&(this.ttfb_=new p(e,r.getEstimate(),r.getTotalWeight()))}sample(e,t){const n=(e=Math.max(e,this.minDelayMs_))/1e3,i=8*t/n;this.fast_.sample(n,i),this.slow_.sample(n,i)}sampleTTFB(e){const t=e/1e3,n=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(n,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function g(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t);if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function v(){return v=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},v.apply(null,arguments)}function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(Object(n),!0).forEach(function(t){g(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}class x{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const n="[".concat(e,"]:");this.trace=_,this.debug=t.debug.bind(null,n),this.log=t.log.bind(null,n),this.warn=t.warn.bind(null,n),this.info=t.info.bind(null,n),this.error=t.error.bind(null,n)}}const _=function(){},S={trace:_,debug:_,log:_,warn:_,info:_,error:_};function E(){return v({},S)}function T(e,t,n){return t[e]?t[e].bind(t):function(e,t){const n=self.console[e];return n?n.bind(self.console,"".concat(t?"["+t+"] ":"","[").concat(e,"] >")):_}(e,n)}const w=E();const A=w;function M(){if("undefined"===typeof self)return;return(!(arguments.length>0&&void 0!==arguments[0])||arguments[0]||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function R(e,t){const n=Object.keys(e),i=Object.keys(t),r=n.length,s=i.length;return!r||!s||r===s&&!n.some(e=>-1===i.indexOf(e))}function C(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("undefined"!==typeof TextDecoder){const n=new TextDecoder("utf-8").decode(e);if(t){const e=n.indexOf("\0");return-1!==e?n.substring(0,e):n}return n.replace(/\0/g,"")}const n=e.length;let i,r,s,a="",o=0;for(;o<n;){if(i=e[o++],0===i&&t)return a;if(0!==i&&3!==i)switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a+=String.fromCharCode(i);break;case 12:case 13:r=e[o++],a+=String.fromCharCode((31&i)<<6|63&r);break;case 14:r=e[o++],s=e[o++],a+=String.fromCharCode((15&i)<<12|(63&r)<<6|63&s)}}return a}function L(e){let t="";for(let n=0;n<e.length;n++){let i=e[n].toString(16);i.length<2&&(i="0"+i),t+=i}return t}function I(e){return Uint8Array.from(e.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function P(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var k,D={exports:{}};var N=function(){return k||(k=1,e=D,function(){var t=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,n=/^(?=([^\/?#]*))\1([^]*)$/,i=/(?:\/|^)\.(?=\/)/g,r=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,s={buildAbsoluteURL:function(e,t,i){if(i=i||{},e=e.trim(),!(t=t.trim())){if(!i.alwaysNormalize)return e;var r=s.parseURL(e);if(!r)throw new Error("Error trying to parse base URL.");return r.path=s.normalizePath(r.path),s.buildURLFromParts(r)}var a=s.parseURL(t);if(!a)throw new Error("Error trying to parse relative URL.");if(a.scheme)return i.alwaysNormalize?(a.path=s.normalizePath(a.path),s.buildURLFromParts(a)):t;var o=s.parseURL(e);if(!o)throw new Error("Error trying to parse base URL.");if(!o.netLoc&&o.path&&"/"!==o.path[0]){var l=n.exec(o.path);o.netLoc=l[1],o.path=l[2]}o.netLoc&&!o.path&&(o.path="/");var c={scheme:o.scheme,netLoc:a.netLoc,path:null,params:a.params,query:a.query,fragment:a.fragment};if(!a.netLoc&&(c.netLoc=o.netLoc,"/"!==a.path[0]))if(a.path){var u=o.path,h=u.substring(0,u.lastIndexOf("/")+1)+a.path;c.path=s.normalizePath(h)}else c.path=o.path,a.params||(c.params=o.params,a.query||(c.query=o.query));return null===c.path&&(c.path=i.alwaysNormalize?s.normalizePath(a.path):a.path),s.buildURLFromParts(c)},parseURL:function(e){var n=t.exec(e);return n?{scheme:n[1]||"",netLoc:n[2]||"",path:n[3]||"",params:n[4]||"",query:n[5]||"",fragment:n[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(i,"");e.length!==(e=e.replace(r,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}};e.exports=s}()),D.exports;var e}();class O{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var F="audio",U="video",B="audiovideo";class z{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,"string"===typeof e&&(e={url:e}),this.base=e,function(e,t){const n=H(e,t);n&&(n.enumerable=!0,Object.defineProperty(e,t,n))}(this,"stats")}setByteRange(e,t){const n=e.split("@",2);let i;i=1===n.length?(null==t?void 0:t.byteRangeEndOffset)||0:parseInt(n[1]),this._byteRange=[i,parseInt(n[0])+i]}get baseurl(){return this.base.url}get byteRange(){return null===this._byteRange?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return null===this._streams&&(this._streams={[F]:null,[U]:null,[B]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return null!==this._stats}get hasStreams(){return null!==this._streams}get stats(){return null===this._stats&&(this._stats=new O),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=N.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[F]=null,e[U]=null,e[B]=null}}function j(e){return"initSegment"!==e.sn}class G extends z{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange.length){const e=this.byteRange[0],t=this.byteRange[1];if(i(e)&&i(t))return t-e}return null}get bitrate(){return this.byteLength?8*this.byteLength/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){var e;const{levelkeys:t}=this;if(!t||t.NONE)return null;if(t.identity)this._decryptdata||(this._decryptdata=t.identity.getDecryptData(this.sn));else if(null==(e=this._decryptdata)||!e.keyId){const e=Object.keys(t);if(1===e.length){const n=this._decryptdata=t[e[0]]||null;n&&(this._decryptdata=n.getDecryptData(this.sn,t))}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(null===this.programDateTime)return null;const e=i(this.duration)?this.duration:0;return this.programDateTime+1e3*e}get encrypted(){var e;if(null!=(e=this._decryptdata)&&e.encrypted)return!0;if(this.levelkeys){var t;const e=Object.keys(this.levelkeys),n=e.length;if(n>1||1===n&&null!=(t=this.levelkeys[e[0]])&&t.encrypted)return!0}return!1}get programDateTime(){return null===this._programDateTime&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){i(e)?this._programDateTime=e:this._programDateTime=this.rawProgramDateTime=null}get ref(){return j(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){const t=this.levelkeys;if(t){var n;const i=t[e];!i||null!=(n=this._decryptdata)&&n.keyId||(this._decryptdata=i.getDecryptData(this.sn,t))}}abortRequests(){var e,t;null==(e=this.loader)||e.abort(),null==(t=this.keyLoader)||t.abort()}setElementaryStreamInfo(e,t,n,i,r){let s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const{elementaryStreams:a}=this,o=a[e];o?(o.startPTS=Math.min(o.startPTS,t),o.endPTS=Math.max(o.endPTS,n),o.startDTS=Math.min(o.startDTS,i),o.endDTS=Math.max(o.endDTS,r)):a[e]={startPTS:t,endPTS:n,startDTS:i,endDTS:r,partial:s}}}class V extends z{constructor(e,t,n,i,r){super(n),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=i;const s=e.enumeratedString("BYTERANGE");s&&this.setByteRange(s,r),r&&(this.fragOffset=r.fragOffset+r.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function H(e,t){const n=Object.getPrototypeOf(e);if(n){const e=Object.getOwnPropertyDescriptor(n,t);return e||H(n,t)}}const W=Math.pow(2,32)-1,Y=[].push,X={video:1,audio:2,id3:3,text:4};function q(e){return String.fromCharCode.apply(null,e)}function K(e,t){const n=e[t]<<8|e[t+1];return n<0?65536+n:n}function Z(e,t){const n=Q(e,t);return n<0?4294967296+n:n}function J(e,t){let n=Z(e,t);return n*=Math.pow(2,32),n+=Z(e,t+4),n}function Q(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}function $(e,t){const n=[];if(!t.length)return n;const i=e.byteLength;for(let r=0;r<i;){const s=Z(e,r),a=s>1?r+s:i;if(q(e.subarray(r+4,r+8))===t[0])if(1===t.length)n.push(e.subarray(r+8,a));else{const i=$(e.subarray(r+8,a),t.slice(1));i.length&&Y.apply(n,i)}r=a}return n}function ee(e){const t=[],n=e[0];let i=8;const r=Z(e,i);i+=4;let s=0,a=0;0===n?(s=Z(e,i),a=Z(e,i+4),i+=8):(s=J(e,i),a=J(e,i+8),i+=16),i+=2;let o=e.length+a;const l=K(e,i);i+=2;for(let c=0;c<l;c++){let n=i;const s=Z(e,n);n+=4;const a=2147483647&s;if(1===(2147483648&s)>>>31)return A.warn("SIDX has hierarchical references (not supported)"),null;const l=Z(e,n);n+=4,t.push({referenceSize:a,subsegmentDuration:l,info:{duration:l/r,start:o,end:o+a-1}}),o+=a,n+=4,i=n}return{earliestPresentationTime:s,timescale:r,version:n,referencesCount:l,references:t}}function te(e){const t=[],n=$(e,["moov","trak"]);for(let i=0;i<n.length;i++){const e=n[i],r=$(e,["tkhd"])[0];if(r){let n=r[0];const i=Z(r,0===n?12:20),s=$(e,["mdia","mdhd"])[0];if(s){n=s[0];const r=Z(s,0===n?12:20),a=$(e,["mdia","hdlr"])[0];if(a){const n=q(a.subarray(8,12)),s={soun:F,vide:U}[n],o=ne($(e,["mdia","minf","stbl","stsd"])[0]);s?(t[i]={timescale:r,type:s,stsd:o},t[s]=b({timescale:r,id:i},o)):t[i]={timescale:r,type:n,stsd:o}}}}}return $(e,["moov","mvex","trex"]).forEach(e=>{const n=Z(e,4),i=t[n];i&&(i.default={duration:Z(e,12),flags:Z(e,20)})}),t}function ne(e){const t=e.subarray(8),n=t.subarray(86),i=q(t.subarray(4,8));let r,s=i;const a="enca"===i||"encv"===i;if(a){const e=$(t,[i])[0];$(e.subarray("enca"===i?28:78),["sinf"]).forEach(e=>{const t=$(e,["schm"])[0];if(t){const n=q(t.subarray(4,8));if("cbcs"===n||"cenc"===n){const t=$(e,["frma"])[0];t&&(s=q(t))}}})}const o=s;switch(s){case"avc1":case"avc2":case"avc3":case"avc4":{const e=$(n,["avcC"])[0];e&&e.length>3&&(s+="."+se(e[1])+se(e[2])+se(e[3]),r=ie("avc1"===o?"dva1":"dvav",n));break}case"mp4a":{const e=$(t,[i])[0],n=$(e.subarray(28),["esds"])[0];if(n&&n.length>7){let e=4;if(3!==n[e++])break;e=re(n,e),e+=2;const t=n[e++];if(128&t&&(e+=2),64&t&&(e+=n[e++]),4!==n[e++])break;e=re(n,e);const i=n[e++];if(64!==i)break;if(s+="."+se(i),e+=12,5!==n[e++])break;e=re(n,e);const r=n[e++];let a=(248&r)>>3;31===a&&(a+=1+((7&r)<<3)+((224&n[e])>>5)),s+="."+a}break}case"hvc1":case"hev1":{const e=$(n,["hvcC"])[0];if(e&&e.length>12){const t=e[1],n=["","A","B","C"][t>>6],i=31&t,r=Z(e,2),a=(32&t)>>5?"H":"L",o=e[12],l=e.subarray(6,12);s+="."+n+i,s+="."+function(e){let t=0;for(let n=0;n<32;n++)t|=(e>>n&1)<<31-n;return t>>>0}(r).toString(16).toUpperCase(),s+="."+a+o;let c="";for(let e=l.length;e--;){const t=l[e];if(t||c){c="."+t.toString(16).toUpperCase()+c}}s+=c}r=ie("hev1"==o?"dvhe":"dvh1",n);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":s=ie(s,n)||s;break;case"vp09":{const e=$(n,["vpcC"])[0];if(e&&e.length>6){const t=e[4],n=e[5],i=e[6]>>4&15;s+="."+ae(t)+"."+ae(n)+"."+ae(i)}break}case"av01":{const e=$(n,["av1C"])[0];if(e&&e.length>2){const t=e[1]>>>5,i=31&e[1],a=e[2]>>>7?"H":"M",o=(64&e[2])>>6,l=(32&e[2])>>5,c=2===t&&o?l?12:10:o?10:8,u=(16&e[2])>>4,h=(8&e[2])>>3,d=(4&e[2])>>2,f=3&e[2],p=1,m=1,g=1,v=0;s+="."+t+"."+ae(i)+a+"."+ae(c)+"."+u+"."+h+d+f+"."+ae(p)+"."+ae(m)+"."+ae(g)+"."+v,r=ie("dav1",n)}break}}return{codec:s,encrypted:a,supplemental:r}}function ie(e,t){const n=$(t,["dvvC"]),i=n.length?n[0]:$(t,["dvcC"])[0];if(i){const t=i[2]>>1&127,n=i[2]<<5&32|i[3]>>3&31;return e+"."+ae(t)+"."+ae(n)}}function re(e,t){const n=t+5;for(;128&e[t++]&&t<n;);return t}function se(e){return("0"+e.toString(16).toUpperCase()).slice(-2)}function ae(e){return(e<10?"0":"")+e}function oe(e,t){$(e,["moov","trak"]).forEach(e=>{const n=$(e,["mdia","minf","stbl","stsd"])[0];if(!n)return;const i=n.subarray(8);let r=$(i,["enca"]);const s=r.length>0;s||(r=$(i,["encv"])),r.forEach(e=>{$(s?e.subarray(28):e.subarray(78),["sinf"]).forEach(e=>{const n=le(e);n&&t(n,s)})})})}function le(e){const t=$(e,["schm"])[0];if(t){const n=q(t.subarray(4,8));if("cbcs"===n||"cenc"===n){const t=$(e,["schi","tenc"])[0];if(t)return t}}}function ce(e,t){const n=new Uint8Array(e.length+t.length);return n.set(e),n.set(t,e.length),n}function ue(e,t){const n=[],i=t.samples,r=t.timescale,s=t.id;let a=!1;return $(i,["moof"]).map(o=>{const l=o.byteOffset-8;$(o,["traf"]).map(o=>{const c=$(o,["tfdt"]).map(e=>{const t=e[0];let n=Z(e,4);return 1===t&&(n*=Math.pow(2,32),n+=Z(e,8)),n/r})[0];return void 0!==c&&(e=c),$(o,["tfhd"]).map(c=>{const u=Z(c,4),h=16777215&Z(c,0);let d=0;const f=0!==(16&h);let p=0;const m=0!==(32&h);let g=8;u===s&&(0!==(1&h)&&(g+=8),0!==(2&h)&&(g+=4),0!==(8&h)&&(d=Z(c,g),g+=4),f&&(p=Z(c,g),g+=4),m&&(g+=4),"video"===t.type&&(a=he(t.codec)),$(o,["trun"]).map(s=>{const o=s[0],c=16777215&Z(s,0),u=0!==(1&c);let h=0;const f=0!==(4&c),m=0!==(256&c);let g=0;const v=0!==(512&c);let y=0;const b=0!==(1024&c),x=0!==(2048&c);let _=0;const S=Z(s,4);let E=8;u&&(h=Z(s,E),E+=4),f&&(E+=4);let T=h+l;for(let l=0;l<S;l++){if(m?(g=Z(s,E),E+=4):g=d,v?(y=Z(s,E),E+=4):y=p,b&&(E+=4),x&&(_=0===o?Z(s,E):Q(s,E),E+=4),t.type===U){let t=0;for(;t<y;){const s=Z(i,T);if(T+=4,de(a,i[T])){fe(i.subarray(T,T+s),a?2:1,e+_/r,n)}T+=s,t+=s+4}}e+=g/r}}))})})}),n}function he(e){if(!e)return!1;const t=e.substring(0,4);return"hvc1"===t||"hev1"===t||"dvh1"===t||"dvhe"===t}function de(e,t){if(e){const e=t>>1&63;return 39===e||40===e}return 6===(31&t)}function fe(e,t,n,i){const r=pe(e);let s=0;s+=t;let a=0,o=0,l=0;for(;s<r.length;){a=0;do{if(s>=r.length)break;l=r[s++],a+=l}while(255===l);o=0;do{if(s>=r.length)break;l=r[s++],o+=l}while(255===l);const e=r.length-s;let t=s;if(o<e)s+=o;else if(o>e){A.error("Malformed SEI payload. ".concat(o," is too small, only ").concat(e," bytes left to parse."));break}if(4===a){if(181===r[t++]){const e=K(r,t);if(t+=2,49===e){const e=Z(r,t);if(t+=4,1195456820===e){const e=r[t++];if(3===e){const s=r[t++],o=64&s,l=o?2+3*(31&s):0,c=new Uint8Array(l);if(o){c[0]=s;for(let e=1;e<l;e++)c[e]=r[t++]}i.push({type:e,payloadType:a,pts:n,bytes:c})}}}}}else if(5===a&&o>16){const e=[];for(let n=0;n<16;n++){const i=r[t++].toString(16);e.push(1==i.length?"0"+i:i),3!==n&&5!==n&&7!==n&&9!==n||e.push("-")}const s=o-16,l=new Uint8Array(s);for(let n=0;n<s;n++)l[n]=r[t++];i.push({payloadType:a,pts:n,uuid:e.join(""),userData:C(l),userDataBytes:l})}}}function pe(e){const t=e.byteLength,n=[];let i=1;for(;i<t-2;)0===e[i]&&0===e[i+1]&&3===e[i+2]?(n.push(i+2),i+=2):i++;if(0===n.length)return e;const r=t-n.length,s=new Uint8Array(r);let a=0;for(i=0;i<r;a++,i++)a===n[0]&&(a++,n.shift()),s[i]=e[a];return s}function me(e,t,n){if(16!==e.byteLength)throw new RangeError("Invalid system id");let i,r,s;i=0,r=new Uint8Array,s=new Uint8Array;const a=new Uint8Array(4);return n.byteLength>0&&new DataView(a.buffer).setUint32(0,n.byteLength,!1),function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];const r=n.length;let s=8,a=r;for(;a--;)s+=n[a].byteLength;const o=new Uint8Array(s);for(o[0]=s>>24&255,o[1]=s>>16&255,o[2]=s>>8&255,o[3]=255&s,o.set(e,4),a=0,s=8;a<r;a++)o.set(n[a],s),s+=n[a].byteLength;return o}([112,115,115,104],new Uint8Array([0,0,0,0]),e,s,r,a,n)}function ge(e){const t=e.getUint32(0),n=e.byteOffset,i=e.byteLength;if(i<t)return{offset:n,size:i};if(1886614376!==e.getUint32(4))return{offset:n,size:t};const r=e.getUint32(8)>>>24;if(0!==r&&1!==r)return{offset:n,size:t};const s=e.buffer,a=L(new Uint8Array(s,n+12,16));let o=null,l=null,c=0;if(0===r)c=28;else{const r=e.getUint32(28);if(!r||i<32+16*r)return{offset:n,size:t};o=[];for(let e=0;e<r;e++)o.push(new Uint8Array(s,n+32+16*e,16));c=32+16*r}if(!c)return{offset:n,size:t};const u=e.getUint32(c);return t-32<u?{offset:n,size:t}:(l=new Uint8Array(s,n+c+4,u),{version:r,systemId:a,kids:o,data:l,offset:n,size:t})}const ve=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),ye={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function be(e,t){const n=ye[t];return!!n&&!!n[e.slice(0,4)]}function xe(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return!e.split(",").some(e=>!_e(e,t,n))}function _e(e,t){var n;const i=M(!(arguments.length>2&&void 0!==arguments[2])||arguments[2]);return null!=(n=null==i?void 0:i.isTypeSupported(Se(e,t)))&&n}function Se(e,t){return"".concat(t,"/mp4;codecs=").concat(e)}function Ee(e){if(e){const t=e.substring(0,4);return ye.video[t]}return 2}function Te(e){const t=ve();return e.split(",").reduce((e,n)=>{const i=t&&he(n)?9:ye.video[n];return i?(2*i+e)/(e?3:2):(ye.audio[n]+e)/(e?2:1)},0)}const we={};const Ae=/flac|opus|mp4a\.40\.34/i;function Me(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return e.replace(Ae,e=>function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(we[e])return we[e];const n={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[e];for(let r=0;r<n.length;r++){var i;if(_e(n[r],"audio",t))return we[e]=n[r],n[r];if("mp3"===n[r]&&null!=(i=M(t))&&i.isTypeSupported("audio/mpeg"))return""}return e}(e.toLowerCase(),t))}function Re(e,t){if(e&&(e.length>4||-1!==["ac-3","ec-3","alac","fLaC","Opus"].indexOf(e))&&(Ce(e,"audio")||Ce(e,"video")))return e;if(t){const n=t.split(",");if(n.length>1){if(e)for(let t=n.length;t--;)if(n[t].substring(0,4)===e.substring(0,4))return n[t];return n[0]}}return t||e}function Ce(e,t){return be(e,t)&&_e(e,t)}function Le(e){if(e.startsWith("av01.")){const t=e.split("."),n=["0","111","01","01","01","0"];for(let e=t.length;e>4&&e<10;e++)t[e]=n[e-4];return t.join(".")}return e}function Ie(e){const t=M(e)||{isTypeSupported:()=>!1};return{mpeg:t.isTypeSupported("audio/mpeg"),mp3:t.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:t.isTypeSupported('audio/mp4; codecs="ac-3"')}}function Pe(e){return e.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const ke={supported:!1,smooth:!1,powerEfficient:!1},De={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]};function Ne(e,t){return{supported:!1,configurations:t,decodingInfoResults:[ke],error:e}}function Oe(e,t,n,r,s,a){const o=e.videoCodec,l=e.audioCodec?e.audioGroups:null,c=null==a?void 0:a.audioCodec,u=null==a?void 0:a.channels,h=u?parseInt(u):c?1/0:2;let d=null;if(null!=l&&l.length)try{d=1===l.length&&l[0]?t.groups[l[0]].channels:l.reduce((e,n)=>{if(n){const i=t.groups[n];if(!i)throw new Error("Audio track group ".concat(n," not found"));Object.keys(i.channels).forEach(t=>{e[t]=(e[t]||0)+i.channels[t]})}return e},{2:0})}catch(f){return!0}return void 0!==o&&(o.split(",").some(e=>he(e))||e.width>1920&&e.height>1088||e.height>1920&&e.width>1088||e.frameRate>Math.max(r,30)||"SDR"!==e.videoRange&&e.videoRange!==n||e.bitrate>Math.max(s,8e6))||!!d&&i(h)&&Object.keys(d).some(e=>parseInt(e)>h)}function Fe(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const r=e.videoCodec;if(!r&&!e.audioCodec||!n)return Promise.resolve(De);const s=[],a=function(e){var t;const n=null==(t=e.videoCodec)?void 0:t.split(","),i=Be(e),r=e.width||640,s=e.height||480,a=e.frameRate||30,o=e.videoRange.toLowerCase();return n?n.map(e=>{const t={contentType:Se(Le(e),"video"),width:r,height:s,bitrate:i,framerate:a};return"sdr"!==o&&(t.transferFunction=o),t}):[]}(e),o=a.length,l=function(e,t,n){var i;const r=null==(i=e.audioCodec)?void 0:i.split(","),s=Be(e);if(r&&e.audioGroups)return e.audioGroups.reduce((e,i)=>{var a;const o=i?null==(a=t.groups[i])?void 0:a.tracks:null;return o?o.reduce((e,t)=>{if(t.groupId===i){const i=parseFloat(t.channels||"");r.forEach(t=>{const r={contentType:Se(t,"audio"),bitrate:n?Ue(t,s):s};i&&(r.channels=""+i),e.push(r)})}return e},e):e},[]);return[]}(e,t,o>0),c=l.length;for(let u=o||1*c||1;u--;){const e={type:"media-source"};if(o&&(e.video=a[u%o]),c){e.audio=l[u%c];const t=e.audio.bitrate;e.video&&t&&(e.video.bitrate-=t)}s.push(e)}if(r){const e=navigator.userAgent;if(r.split(",").some(e=>he(e))&&ve())return Promise.resolve(Ne(new Error("Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (".concat(e,")")),s))}return Promise.all(s.map(e=>{const t=function(e){let t="";const{audio:n,video:i}=e;if(i){const e=Pe(i.contentType);t+="".concat(e,"_r").concat(i.height,"x").concat(i.width,"f").concat(Math.ceil(i.framerate)).concat(i.transferFunction||"sd","_").concat(Math.ceil(i.bitrate/1e5))}if(n){const e=Pe(n.contentType);t+="".concat(i?"_":"").concat(e,"_c").concat(n.channels)}return t}(e);return i[t]||(i[t]=n.decodingInfo(e))})).then(e=>({supported:!e.some(e=>!e.supported),configurations:s,decodingInfoResults:e})).catch(e=>({supported:!1,configurations:s,decodingInfoResults:[],error:e}))}function Ue(e,t){if(t<=1)return 1;let n=128e3;return"ec-3"===e?n=768e3:"ac-3"===e&&(n=64e4),Math.min(t/2,n)}function Be(e){return 1e3*Math.ceil(Math.max(.9*e.bitrate,e.averageBitrate)/1e3)||1}const ze=["NONE","TYPE-0","TYPE-1",null];const je=["SDR","PQ","HLG"];var Ge={No:"",Yes:"YES",v2:"v2"};function Ve(e){const{canSkipUntil:t,canSkipDateRanges:n,age:i}=e;return t&&i<t/2?n?Ge.v2:Ge.Yes:Ge.No}class He{constructor(e,t,n){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=n}addDirectives(e){const t=new self.URL(e);return void 0!==this.msn&&t.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class We{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(e=>!!e).map(e=>e.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const n=null==(t=e.supplemental)?void 0:t.videoCodec;n&&n!==e.videoCodec&&(this.codecSet+=",".concat(n.substring(0,4)))}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return Ye(this._audioGroups,e)}hasSubtitleGroup(e){return Ye(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t)if("audio"===e){let e=this._audioGroups;e||(e=this._audioGroups=[]),-1===e.indexOf(t)&&e.push(t)}else if("text"===e){let e=this._subtitleGroups;e||(e=this._subtitleGroups=[]),-1===e.indexOf(t)&&e.push(t)}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return null==(e=this.audioGroups)?void 0:e[0]}get textGroupId(){var e;return null==(e=this.subtitleGroups)?void 0:e[0]}addFallback(){}}function Ye(e,t){return!(!t||!e)&&-1!==e.indexOf(t)}function Xe(e,t){let n=!1,i=[];if(e&&(n="SDR"!==e,i=[e]),t){i=t.allowedVideoRanges||je.slice(0);const e="SDR"!==i.join("")&&!t.videoCodec;n=void 0!==t.preferHDR?t.preferHDR:e&&function(){if("function"===typeof matchMedia){const e=matchMedia("(dynamic-range: high)"),t=matchMedia("bad query");if(e.media!==t.media)return!0===e.matches}return!1}(),n||(i=["SDR"])}return{preferHDR:n,allowedVideoRanges:i}}const qe=(e,t)=>JSON.stringify(e,(e=>{const t=new WeakSet;return(n,i)=>{if(e&&(i=e(n,i)),"object"===typeof i&&null!==i){if(t.has(i))return;t.add(i)}return i}})(t));function Ke(e,t){A.log('[abr] start candidates with "'.concat(e,'" ignored because ').concat(t))}function Ze(e){return e.reduce((e,t)=>{let n=e.groups[t.groupId];n||(n=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),n.tracks.push(t);const i=t.channels||"2";return n.channels[i]=(n.channels[i]||0)+1,n.hasDefault=n.hasDefault||t.default,n.hasAutoSelect=n.hasAutoSelect||t.autoselect,n.hasDefault&&(e.hasDefaultAudio=!0),n.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function Je(e){if(!e)return e;const{lang:t,assocLang:n,characteristics:i,channels:r,audioCodec:s}=e;return{lang:t,assocLang:n,characteristics:i,channels:r,audioCodec:s}}function Qe(e,t,n){if("attrs"in e){const n=t.indexOf(e);if(-1!==n)return n}for(let i=0;i<t.length;i++){if($e(e,t[i],n))return i}return-1}function $e(e,t,n){const{groupId:i,name:r,lang:s,assocLang:a,default:o}=e,l=e.forced;return(void 0===i||t.groupId===i)&&(void 0===r||t.name===r)&&(void 0===s||function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"--";if(e.length===t.length)return e===t;return e.startsWith(t)||t.startsWith(e)}(s,t.lang))&&(void 0===s||t.assocLang===a)&&(void 0===o||t.default===o)&&(void 0===l||t.forced===l)&&(!("characteristics"in e)||function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const n=e.split(","),i=t.split(",");return n.length===i.length&&!n.some(e=>-1===i.indexOf(e))}(e.characteristics||"",t.characteristics))&&(void 0===n||n(e,t))}function et(e,t){const{audioCodec:n,channels:i}=e;return(void 0===n||(t.audioCodec||"").substring(0,4)===n.substring(0,4))&&(void 0===i||i===(t.channels||"2"))}function tt(e,t,n){for(let i=t;i>-1;i--)if(n(e[i]))return i;for(let i=t+1;i<e.length;i++)if(n(e[i]))return i;return-1}function nt(e,t){var n;return!!e&&e!==(null==(n=t.loadLevelObj)?void 0:n.uri)}class it extends x{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=e=>{var t;const{fragCurrent:n,partCurrent:r,hls:s}=this,{autoLevelEnabled:a,media:o}=s;if(!n||!o)return;const c=performance.now(),u=r?r.stats:n.stats,h=r?r.duration:n.duration,d=c-u.loading.start,f=s.minAutoLevel,p=n.level,m=this._nextAutoLevel;if(u.aborted||u.loaded&&u.loaded===u.total||p<=f)return this.clearTimer(),void(this._nextAutoLevel=-1);if(!a)return;const g=m>-1&&m!==p,v=!!e||g;if(!v&&(o.paused||!o.playbackRate||!o.readyState))return;const y=s.mainForwardBufferInfo;if(!v&&null===y)return;const b=this.bwEstimator.getEstimateTTFB(),x=Math.abs(o.playbackRate);if(d<=Math.max(b,h/(2*x)*1e3))return;const _=y?y.len/x:0,S=u.loading.first?u.loading.first-u.loading.start:-1,E=u.loaded&&S>-1,T=this.getBwEstimate(),w=s.levels,A=w[p],M=Math.max(u.loaded,Math.round(h*(n.bitrate||A.averageBitrate)/8));let R=E?d-S:d;R<1&&E&&(R=Math.min(d,8*u.loaded/T));const C=E?1e3*u.loaded/R:0,L=b/1e3,I=C?(M-u.loaded)/C:8*M/T+L;if(I<=_)return;const P=C?8*C:T,k=!0===(null==(t=(null==e?void 0:e.details)||this.hls.latestLevelDetails)?void 0:t.live),D=this.hls.config.abrBandWidthUpFactor;let N,O=Number.POSITIVE_INFINITY;for(N=p-1;N>f;N--){const e=w[N].maxBitrate,t=!w[N].details||k;if(O=this.getTimeToLoadFrag(L,P,h*e,t),O<Math.min(_,h+L))break}if(O>=I)return;if(O>10*h)return;E?this.bwEstimator.sample(d-Math.min(b,S),u.loaded):this.bwEstimator.sampleTTFB(d);const F=w[N].maxBitrate;this.getBwEstimate()*D>F&&this.resetEstimator(F);const U=this.findBestLevel(F,f,N,0,_,1,1);U>-1&&(N=U),this.warn("Fragment ".concat(n.sn).concat(r?" part "+r.index:""," of level ").concat(p," is loading too slowly;\n      Fragment duration: ").concat(n.duration.toFixed(3),"\n      Time to underbuffer: ").concat(_.toFixed(3)," s\n      Estimated load time for current fragment: ").concat(I.toFixed(3)," s\n      Estimated load time for down switch fragment: ").concat(O.toFixed(3)," s\n      TTFB estimate: ").concat(0|S," ms\n      Current BW estimate: ").concat(i(T)?0|T:"Unknown"," bps\n      New BW estimate: ").concat(0|this.getBwEstimate()," bps\n      Switching to level ").concat(N," @ ").concat(0|F," bps")),s.nextLoadLevel=s.nextAutoLevel=N,this.clearTimer();const B=()=>{if(this.clearTimer(),this.fragCurrent===n&&this.hls.loadLevel===N&&N>0){const e=this.getStarvationDelay();if(this.warn("Aborting inflight request ".concat(N>0?"and switching down":"","\n      Fragment duration: ").concat(n.duration.toFixed(3)," s\n      Time to underbuffer: ").concat(e.toFixed(3)," s")),n.abortRequests(),this.fragCurrent=this.partCurrent=null,N>f){let t=this.findBestLevel(this.hls.levels[f].bitrate,f,N,0,e,1,1);-1===t&&(t=f),this.hls.nextLoadLevel=this.hls.nextAutoLevel=t,this.resetEstimator(this.hls.levels[t].bitrate)}}};g||I>2*O?B():this.timer=self.setInterval(B,1e3*O),s.trigger(l.FRAG_LOAD_EMERGENCY_ABORTED,{frag:n,part:r,stats:u})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log("setting initial bwe to ".concat(e)),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new m(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(l.MANIFEST_LOADING,this.onManifestLoading,this),e.on(l.FRAG_LOADING,this.onFragLoading,this),e.on(l.FRAG_LOADED,this.onFragLoaded,this),e.on(l.FRAG_BUFFERED,this.onFragBuffered,this),e.on(l.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(l.LEVEL_LOADED,this.onLevelLoaded,this),e.on(l.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(l.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(l.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(l.MANIFEST_LOADING,this.onManifestLoading,this),e.off(l.FRAG_LOADING,this.onFragLoading,this),e.off(l.FRAG_LOADED,this.onFragLoaded,this),e.off(l.FRAG_BUFFERED,this.onFragBuffered,this),e.off(l.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(l.LEVEL_LOADED,this.onLevelLoaded,this),e.off(l.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(l.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(l.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const n=t.frag;if(!this.ignoreFragment(n)){var i;if(!n.bitrateTest)this.fragCurrent=n,this.partCurrent=null!=(i=t.part)?i:null;this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case o.BUFFER_ADD_CODEC_ERROR:case o.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case o.FRAG_LOAD_TIMEOUT:{const e=t.frag,{fragCurrent:n,partCurrent:i}=this;if(e&&n&&e.sn===n.sn&&e.level===n.level){const t=performance.now(),n=i?i.stats:e.stats,r=t-n.loading.start,s=n.loading.first?n.loading.first-n.loading.start:-1;if(n.loaded&&s>-1){const e=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(r-Math.min(e,s),n.loaded)}else this.bwEstimator.sampleTTFB(r)}break}}}getTimeToLoadFrag(e,t,n,i){return e+n/t+(i?e+this.lastLevelLoadSec:0)}onLevelLoaded(e,t){const n=this.hls.config,{loading:r}=t.stats,s=r.end-r.first;i(s)&&(this.lastLevelLoadSec=s/1e3),t.details.live?this.bwEstimator.update(n.abrEwmaSlowLive,n.abrEwmaFastLive):this.bwEstimator.update(n.abrEwmaSlowVoD,n.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,t){let{frag:n,part:i}=t;const r=i?i.stats:n.stats;if(n.type===f.MAIN&&this.bwEstimator.sampleTTFB(r.loading.first-r.loading.start),!this.ignoreFragment(n)){if(this.clearTimer(),n.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const e=i?i.duration:n.duration,t=this.hls.levels[n.level],s=(t.loaded?t.loaded.bytes:0)+r.loaded,a=(t.loaded?t.loaded.duration:0)+e;t.loaded={bytes:s,duration:a},t.realBitrate=Math.round(8*s/a)}if(n.bitrateTest){const e={stats:r,frag:n,part:i,id:n.type};this.onFragBuffered(l.FRAG_BUFFERED,e),n.bitrateTest=!1}else this.lastLoadedFragLevel=n.level}}onFragBuffered(e,t){const{frag:n,part:i}=t,r=null!=i&&i.stats.loaded?i.stats:n.stats;if(r.aborted)return;if(this.ignoreFragment(n))return;const s=r.parsing.end-r.loading.start-Math.min(r.loading.first-r.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(s,r.loaded),r.bwEstimate=this.getBwEstimate(),n.bitrateTest?this.bitrateTestDelay=s/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==f.MAIN||"initSegment"===e.sn}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,n=this.getBwEstimate(),i=this.hls.config.maxStarvationDelay,r=this.findBestLevel(n,t,e,0,i,1,1);if(r>-1)return r;const s=this.hls.firstLevel,a=Math.min(Math.max(s,t),e);return this.warn("Could not find best starting auto level. Defaulting to first in playlist ".concat(s," clamped to ").concat(a)),a}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,t=this.bwEstimator.canEstimate(),n=this.lastLoadedFragLevel>-1;if(-1!==e&&(!t||!n||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const i=t&&n?this.getNextABRAutoLevel():this.firstAutoLevel;if(-1!==e){const t=this.hls.levels;if(t.length>Math.max(e,i)&&t[e].loadError<=t[i].loadError)return e}return this._nextAutoLevel=i,this.nextAutoLevelKey=this.getAutoLevelKey(),i}getAutoLevelKey(){return"".concat(this.getBwEstimate(),"_").concat(this.getStarvationDelay().toFixed(2))}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:n}=this;if(n.levels.length<=1)return n.loadLevel;const{maxAutoLevel:i,config:r,minAutoLevel:s}=n,a=t?t.duration:e?e.duration:0,o=this.getBwEstimate(),l=this.getStarvationDelay();let c=r.abrBandWidthFactor,u=r.abrBandWidthUpFactor;if(l){const e=this.findBestLevel(o,s,i,l,0,c,u);if(e>=0)return this.rebufferNotice=-1,e}let h=a?Math.min(a,r.maxStarvationDelay):r.maxStarvationDelay;if(!l){const e=this.bitrateTestDelay;if(e){h=(a?Math.min(a,r.maxLoadingDelay):r.maxLoadingDelay)-e,this.info("bitrate test took ".concat(Math.round(1e3*e),"ms, set first fragment max fetchDuration to ").concat(Math.round(1e3*h)," ms")),c=u=1}}const d=this.findBestLevel(o,s,i,l,h,c,u);if(this.rebufferNotice!==d&&(this.rebufferNotice=d,this.info("".concat(l?"rebuffering expected":"buffer is empty",", optimal quality level ").concat(d))),d>-1)return d;const f=n.levels[s],p=n.loadLevelObj;return p&&(null==f?void 0:f.bitrate)<p.bitrate?s:n.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const n=t&&0!==t.playbackRate?Math.abs(t.playbackRate):1,i=e.mainForwardBufferInfo;return(i?i.len:0)/n}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,n,r,s,a,o){var l;const c=r+s,u=this.lastLoadedFragLevel,h=-1===u?this.hls.firstLevel:u,{fragCurrent:d,partCurrent:f}=this,{levels:p,allAudioTracks:m,loadLevel:g,config:v}=this.hls;if(1===p.length)return 0;const y=p[h],b=!(null==(l=this.hls.latestLevelDetails)||!l.live),x=-1===g||-1===u;let _,S="SDR",E=(null==y?void 0:y.frameRate)||0;const{audioPreference:T,videoPreference:w}=v,A=this.audioTracksByGroup||(this.audioTracksByGroup=Ze(m));let M=-1;if(x){if(-1!==this.firstSelection)return this.firstSelection;const r=this.codecTiers||(this.codecTiers=function(e,t,n,i){return e.slice(n,i+1).reduce((e,n,i)=>{if(!n.codecSet)return e;const r=n.audioGroups;let s=e[n.codecSet];s||(e[n.codecSet]=s={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:i,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!r,fragmentError:0}),s.minBitrate=Math.min(s.minBitrate,n.bitrate);const a=Math.min(n.height,n.width);return s.minHeight=Math.min(s.minHeight,a),s.minFramerate=Math.min(s.minFramerate,n.frameRate),s.minIndex=Math.min(s.minIndex,i),s.maxScore=Math.max(s.maxScore,n.score),s.fragmentError+=n.fragmentError,s.videoRanges[n.videoRange]=(s.videoRanges[n.videoRange]||0)+1,r&&r.forEach(e=>{if(!e)return;const n=t.groups[e];n&&(s.hasDefaultAudio=s.hasDefaultAudio||t.hasDefaultAudio?n.hasDefault:n.hasAutoSelect||!t.hasDefaultAudio&&!t.hasAutoSelectAudio,Object.keys(n.channels).forEach(e=>{s.channels[e]=(s.channels[e]||0)+n.channels[e]}))}),e},{})}(p,A,t,n)),s=function(e,t,n,r,s){const a=Object.keys(e),o=null==r?void 0:r.channels,l=null==r?void 0:r.audioCodec,c=null==s?void 0:s.videoCodec,u=o&&2===parseInt(o);let h=!1,d=!1,f=1/0,p=1/0,m=1/0,g=1/0,v=0,y=[];const{preferHDR:b,allowedVideoRanges:x}=Xe(t,s);for(let i=a.length;i--;){const t=e[a[i]];h||(h=t.channels[2]>0),f=Math.min(f,t.minHeight),p=Math.min(p,t.minFramerate),m=Math.min(m,t.minBitrate),x.filter(e=>t.videoRanges[e]>0).length>0&&(d=!0)}f=i(f)?f:0,p=i(p)?p:0;const _=Math.max(1080,f),S=Math.max(30,p);m=i(m)?m:n,n=Math.max(m,n),d||(t=void 0);const E=a.length>1;return{codecSet:a.reduce((t,i)=>{const r=e[i];if(i===t)return t;if(y=d?x.filter(e=>r.videoRanges[e]>0):[],E){if(r.minBitrate>n)return Ke(i,"min bitrate of ".concat(r.minBitrate," > current estimate of ").concat(n)),t;if(!r.hasDefaultAudio)return Ke(i,"no renditions with default or auto-select sound found"),t;if(l&&i.indexOf(l.substring(0,4))%5!==0)return Ke(i,'audio codec preference "'.concat(l,'" not found')),t;if(o&&!u){if(!r.channels[o])return Ke(i,"no renditions with ".concat(o," channel sound found (channels options: ").concat(Object.keys(r.channels),")")),t}else if((!l||u)&&h&&0===r.channels[2])return Ke(i,"no renditions with stereo sound found"),t;if(r.minHeight>_)return Ke(i,"min resolution of ".concat(r.minHeight," > maximum of ").concat(_)),t;if(r.minFramerate>S)return Ke(i,"min framerate of ".concat(r.minFramerate," > maximum of ").concat(S)),t;if(!y.some(e=>r.videoRanges[e]>0))return Ke(i,"no variants with VIDEO-RANGE of ".concat(qe(y)," found")),t;if(c&&i.indexOf(c.substring(0,4))%5!==0)return Ke(i,'video codec preference "'.concat(c,'" not found')),t;if(r.maxScore<v)return Ke(i,"max score of ".concat(r.maxScore," < selected max of ").concat(v)),t}return t&&(Te(i)>=Te(t)||r.fragmentError>e[t].fragmentError)?t:(g=r.minIndex,v=r.maxScore,i)},void 0),videoRanges:y,preferHDR:b,minFramerate:p,minBitrate:m,minIndex:g}}(r,S,e,T,w),{codecSet:a,videoRanges:o,minFramerate:l,minBitrate:c,minIndex:u,preferHDR:h}=s;M=u,_=a,S=h?o[o.length-1]:o[0],E=l,e=Math.max(e,c),this.log("picked start tier ".concat(qe(s)))}else _=null==y?void 0:y.codecSet,S=null==y?void 0:y.videoRange;const R=f?f.duration:d?d.duration:0,C=this.bwEstimator.getEstimateTTFB()/1e3,L=[];for(let P=n;P>=t;P--){var I;const t=p[P],l=P>h;if(!t)continue;if(v.useMediaCapabilities&&!t.supportedResult&&!t.supportedPromise){const n=navigator.mediaCapabilities;"function"===typeof(null==n?void 0:n.decodingInfo)&&Oe(t,A,S,E,e,T)?(t.supportedPromise=Fe(t,A,n,this.supportedCache),t.supportedPromise.then(e=>{if(!this.hls)return;t.supportedResult=e;const n=this.hls.levels,i=n.indexOf(t);e.error?this.warn('MediaCapabilities decodingInfo error: "'.concat(e.error,'" for level ').concat(i," ").concat(qe(e))):e.supported?e.decodingInfoResults.some(e=>!1===e.smooth||!1===e.powerEfficient)&&this.log("MediaCapabilities decodingInfo for level ".concat(i," not smooth or powerEfficient: ").concat(qe(e))):(this.warn("Unsupported MediaCapabilities decodingInfo result for level ".concat(i," ").concat(qe(e))),i>-1&&n.length>1&&(this.log("Removing unsupported level ".concat(i)),this.hls.removeLevel(i),-1===this.hls.loadLevel&&(this.hls.nextLoadLevel=0)))}).catch(e=>{this.warn("Error handling MediaCapabilities decodingInfo: ".concat(e))})):t.supportedResult=De}if((_&&t.codecSet!==_||S&&t.videoRange!==S||l&&E>t.frameRate||!l&&E>0&&E<t.frameRate||null!=(I=t.supportedResult)&&null!=(I=I.decodingInfoResults)&&I.some(e=>!1===e.smooth))&&(!x||P!==M)){L.push(P);continue}const d=t.details,m=(f?null==d?void 0:d.partTarget:null==d?void 0:d.averagetargetduration)||R;let y;y=l?o*e:a*e;const w=R&&r>=2*R&&0===s?t.averageBitrate:t.maxBitrate,k=this.getTimeToLoadFrag(C,y,w*m,void 0===d);if(y>=w&&(P===u||0===t.loadError&&0===t.fragmentError)&&(k<=C||!i(k)||b&&!this.bitrateTestDelay||k<c)){const e=this.forcedAutoLevel;return P===g||-1!==e&&e===g||(L.length&&this.trace("Skipped level(s) ".concat(L.join(",")," of ").concat(n,' max with CODECS and VIDEO-RANGE:"').concat(p[L[0]].codecs,'" ').concat(p[L[0]].videoRange,'; not compatible with "').concat(_,'" ').concat(S)),this.info("switch candidate:".concat(h,"->").concat(P," adjustedbw(").concat(Math.round(y),")-bitrate=").concat(Math.round(y-w)," ttfb:").concat(C.toFixed(1)," avgDuration:").concat(m.toFixed(1)," maxFetchDuration:").concat(c.toFixed(1)," fetchDuration:").concat(k.toFixed(1)," firstSelection:").concat(x," codecSet:").concat(t.codecSet," videoRange:").concat(t.videoRange," hls.loadLevel:").concat(g))),x&&(this.firstSelection=P),P}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:n}=this.hls;return Math.min(Math.max(e,n),t)}}const rt=function(e,t){let n=0,i=e.length-1,r=null,s=null;for(;n<=i;){r=(n+i)/2|0,s=e[r];const a=t(s);if(a>0)n=r+1;else{if(!(a<0))return s;i=r-1}}return null};function st(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.005,s=null;if(e){s=t[1+e.sn-t[0].sn]||null;const i=e.endDTS-n;i>0&&i<15e-7&&(n+=15e-7),s&&e.level!==s.level&&s.end<=e.end&&(s=t[2+e.sn-t[0].sn]||null)}else 0===n&&0===t[0].start&&(s=t[0]);if(s&&((!e||e.level===s.level)&&0===at(n,i,s)||function(e,t,n){if(t&&0===t.start&&t.level<e.level&&(t.endPTS||0)>0){const i=t.tagList.reduce((e,t)=>("INF"===t[0]&&(e+=parseFloat(t[1])),e),n);return e.start<=i}return!1}(s,e,Math.min(r,i))))return s;const a=rt(t,at.bind(null,n,i));return!a||a===e&&s?s:a}function at(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(n.start<=e&&n.start+n.duration>e)return 0;const i=Math.min(t,n.duration+(n.deltaPTS?n.deltaPTS:0));return n.start+n.duration-i<=e?1:n.start-i>e&&n.start?-1:0}function ot(e,t,n){const i=1e3*Math.min(t,n.duration+(n.deltaPTS?n.deltaPTS:0));return(n.endProgramDateTime||0)-i>e}function lt(e,t,n){if(e&&e.startCC<=t&&e.endCC>=t){let i=e.fragments;const{fragmentHint:r}=e;let s;return r&&(i=i.concat(r)),rt(i,e=>e.cc<t?1:e.cc>t?-1:(s=e,e.end<=n?1:e.start>n?-1:0)),s||null}return null}function ct(e){switch(e.details){case o.FRAG_LOAD_TIMEOUT:case o.KEY_LOAD_TIMEOUT:case o.LEVEL_LOAD_TIMEOUT:case o.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function ut(e){return e.details.startsWith("key")}function ht(e){return ut(e)&&!!e.frag&&!e.frag.decryptdata}function dt(e,t){const n=ct(t);return e.default["".concat(n?"timeout":"error","Retry")]}function ft(e,t){const n="linear"===e.backoff?1:Math.pow(2,t);return Math.min(n*e.retryDelayMs,e.maxRetryDelayMs)}function pt(e){return b(b({},e),{errorRetry:null,timeoutRetry:null})}function mt(e,t,n,i){if(!e)return!1;const r=null==i?void 0:i.code,s=t<e.maxNumRetry&&(function(e){return gt(e)||!!e&&(e<400||e>499)}(r)||!!n);return e.shouldRetry?e.shouldRetry(e,t,n,i,s):s}function gt(e){return 0===e&&!1===navigator.onLine}var vt={DoNothing:0,SendEndCallback:1,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,InsertDiscontinuity:4,RetryRequest:5},yt={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,MoveAllAlternatesMatchingKey:4,SwitchToSDR:8};class bt extends x{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(l.ERROR,this.onError,this),e.on(l.MANIFEST_LOADING,this.onManifestLoading,this),e.on(l.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(l.ERROR,this.onError,this),e.off(l.ERROR,this.onErrorOut,this),e.off(l.MANIFEST_LOADING,this.onManifestLoading,this),e.off(l.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(null==e?void 0:e.type)===f.MAIN?e.level:this.getVariantIndex()}getVariantIndex(){var e;const t=this.hls,n=t.currentLevel;return null!=(e=t.loadLevelObj)&&e.details||-1===n?t.loadLevel:n}variantHasKey(e,t){if(e){var n;if(null!=(n=e.details)&&n.hasKey(t))return!0;const i=e.audioGroups;if(i){return this.hls.allAudioTracks.filter(e=>i.indexOf(e.groupId)>=0).some(e=>{var n;return null==(n=e.details)?void 0:n.hasKey(t)})}}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,t){var n;if(t.fatal)return;const i=this.hls,r=t.context;switch(t.details){case o.FRAG_LOAD_ERROR:case o.FRAG_LOAD_TIMEOUT:case o.KEY_LOAD_ERROR:case o.KEY_LOAD_TIMEOUT:return void(t.errorAction=this.getFragRetryOrSwitchAction(t));case o.FRAG_PARSING_ERROR:if(null!=(n=t.frag)&&n.gap)return void(t.errorAction=xt());case o.FRAG_GAP:case o.FRAG_DECRYPT_ERROR:return t.errorAction=this.getFragRetryOrSwitchAction(t),void(t.errorAction.action=vt.SendAlternateToPenaltyBox);case o.LEVEL_EMPTY_ERROR:case o.LEVEL_PARSING_ERROR:{var s;const e=t.parent===f.MAIN?t.level:i.loadLevel;t.details===o.LEVEL_EMPTY_ERROR&&null!=(s=t.context)&&null!=(s=s.levelDetails)&&s.live?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,e):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,e))}return;case o.LEVEL_LOAD_ERROR:case o.LEVEL_LOAD_TIMEOUT:return void("number"===typeof(null==r?void 0:r.level)&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,r.level)));case o.AUDIO_TRACK_LOAD_ERROR:case o.AUDIO_TRACK_LOAD_TIMEOUT:case o.SUBTITLE_LOAD_ERROR:case o.SUBTITLE_TRACK_LOAD_TIMEOUT:if(r){const e=i.loadLevelObj;if(e&&(r.type===h&&e.hasAudioGroup(r.groupId)||r.type===d&&e.hasSubtitleGroup(r.groupId)))return t.errorAction=this.getPlaylistRetryOrSwitchAction(t,i.loadLevel),t.errorAction.action=vt.SendAlternateToPenaltyBox,void(t.errorAction.flags=yt.MoveAllAlternatesMatchingHost)}return;case o.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:return void(t.errorAction={action:vt.SendAlternateToPenaltyBox,flags:yt.MoveAllAlternatesMatchingHDCP});case o.KEY_SYSTEM_SESSION_UPDATE_FAILED:case o.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case o.KEY_SYSTEM_NO_SESSION:return void(t.errorAction={action:vt.SendAlternateToPenaltyBox,flags:yt.MoveAllAlternatesMatchingKey});case o.BUFFER_ADD_CODEC_ERROR:case o.REMUX_ALLOC_ERROR:case o.BUFFER_APPEND_ERROR:var l;if(!t.errorAction)t.errorAction=this.getLevelSwitchAction(t,null!=(l=t.level)?l:i.loadLevel);return;case o.INTERNAL_EXCEPTION:case o.BUFFER_APPENDING_ERROR:case o.BUFFER_FULL_ERROR:case o.LEVEL_SWITCH_ERROR:case o.BUFFER_STALLED_ERROR:case o.BUFFER_SEEK_OVER_HOLE:case o.BUFFER_NUDGE_ON_STALL:return void(t.errorAction=xt())}t.type===a.KEY_SYSTEM_ERROR&&(t.levelRetry=!1,t.errorAction=xt())}getPlaylistRetryOrSwitchAction(e,t){const n=dt(this.hls.config.playlistLoadPolicy,e),i=this.playlistError++;if(mt(n,i,ct(e),e.response))return{action:vt.RetryRequest,flags:yt.None,retryConfig:n,retryCount:i};const r=this.getLevelSwitchAction(e,t);return n&&(r.retryConfig=n,r.retryCount=i),r}getFragRetryOrSwitchAction(e){const t=this.hls,n=this.getVariantLevelIndex(e.frag),i=t.levels[n],{fragLoadPolicy:r,keyLoadPolicy:s}=t.config,a=dt(ut(e)?s:r,e),l=t.levels.reduce((e,t)=>e+t.fragmentError,0);if(i&&(e.details!==o.FRAG_GAP&&i.fragmentError++,!ht(e))){if(mt(a,l,ct(e),e.response))return{action:vt.RetryRequest,flags:yt.None,retryConfig:a,retryCount:l}}const c=this.getLevelSwitchAction(e,n);return a&&(c.retryConfig=a,c.retryCount=l),c}getLevelSwitchAction(e,t){const n=this.hls;null!==t&&void 0!==t||(t=n.loadLevel);const i=this.hls.levels[t];if(i){var r,s;const t=e.details;i.loadError++,t===o.BUFFER_APPEND_ERROR&&i.fragmentError++;let c=-1;const{levels:u,loadLevel:p,minAutoLevel:m,maxAutoLevel:g}=n;n.autoLevelEnabled||n.config.preserveManualLevelOnError||(n.loadLevel=-1);const v=null==(r=e.frag)?void 0:r.type,y=(v===f.AUDIO&&t===o.FRAG_PARSING_ERROR||"audio"===e.sourceBufferName&&(t===o.BUFFER_ADD_CODEC_ERROR||t===o.BUFFER_APPEND_ERROR))&&u.some(e=>{let{audioCodec:t}=e;return i.audioCodec!==t}),b="video"===e.sourceBufferName&&(t===o.BUFFER_ADD_CODEC_ERROR||t===o.BUFFER_APPEND_ERROR)&&u.some(e=>{let{codecSet:t,audioCodec:n}=e;return i.codecSet!==t&&i.audioCodec===n}),{type:x,groupId:_}=null!=(s=e.context)?s:{};for(let n=u.length;n--;){const r=(n+p)%u.length;if(r!==p&&r>=m&&r<=g&&0===u[r].loadError){var a,l;const n=u[r];if(t===o.FRAG_GAP&&v===f.MAIN&&e.frag){const t=u[r].details;if(t){const n=st(e.frag,t.fragments,e.frag.start);if(null!=n&&n.gap)continue}}else{if(x===h&&n.hasAudioGroup(_)||x===d&&n.hasSubtitleGroup(_))continue;if(v===f.AUDIO&&null!=(a=i.audioGroups)&&a.some(e=>n.hasAudioGroup(e))||v===f.SUBTITLE&&null!=(l=i.subtitleGroups)&&l.some(e=>n.hasSubtitleGroup(e))||y&&i.audioCodec===n.audioCodec||b&&i.codecSet===n.codecSet||!y&&i.codecSet!==n.codecSet)continue}c=r;break}}if(c>-1&&n.loadLevel!==c)return e.levelRetry=!0,this.playlistError=0,{action:vt.SendAlternateToPenaltyBox,flags:yt.None,nextAutoLevel:c}}return{action:vt.SendAlternateToPenaltyBox,flags:yt.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var n;switch(null==(n=t.errorAction)?void 0:n.action){case vt.DoNothing:break;case vt.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),t.errorAction.resolved||t.details===o.FRAG_GAP?/MediaSource readyState: ended/.test(t.error.message)&&(this.warn('MediaSource ended after "'.concat(t.sourceBufferName,'" sourceBuffer append error. Attempting to recover from media error.')),this.hls.recoverMediaError()):t.fatal=!0;case vt.RetryRequest:}t.fatal&&this.hls.stopLoad()}sendAlternateToPenaltyBox(e){const t=this.hls,n=e.errorAction;if(!n)return;const{flags:i}=n,r=n.nextAutoLevel;switch(i){case yt.None:this.switchLevel(e,r);break;case yt.MoveAllAlternatesMatchingHDCP:{const i=this.getVariantLevelIndex(e.frag),r=t.levels[i],s=null==r?void 0:r.attrs["HDCP-LEVEL"];if(n.hdcpLevel=s,"NONE"===s)this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(s){t.maxHdcpLevel=ze[ze.indexOf(s)-1],n.resolved=!0,this.warn('Restricting playback to HDCP-LEVEL of "'.concat(t.maxHdcpLevel,'" or lower'));break}}case yt.MoveAllAlternatesMatchingKey:{const t=e.decryptdata;if(t){const i=this.hls.levels,r=i.length;for(let n=r;n--;){var s,a;if(this.variantHasKey(i[n],t))this.log("Banned key found in level ".concat(n," (").concat(i[n].bitrate,'bps) or audio group "').concat(null==(s=i[n].audioGroups)?void 0:s.join(","),'" (').concat(null==(a=e.frag)?void 0:a.type," fragment) ").concat(L(t.keyId||[]))),i[n].fragmentError++,i[n].loadError++,this.log("Removing level ".concat(n," with key error (").concat(e.error,")")),this.hls.removeLevel(n)}const o=e.frag;if(this.hls.levels.length<r)n.resolved=!0;else if(o&&o.type!==f.MAIN){const e=o.decryptdata;e&&!t.matches(e)&&(n.resolved=!0)}}break}}n.resolved||this.switchLevel(e,r)}switchLevel(e,t){if(void 0!==t&&e.errorAction&&(this.warn("switching to level ".concat(t," after ").concat(e.details)),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===o.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&"audiovideo"!==e.sourceBufferName)){const t=Pe(e.mimeType),n=this.hls.levels;for(let i=n.length;i--;)n[i]["".concat(e.sourceBufferName,"Codec")]===t&&(this.log("Removing level ".concat(i," for ").concat(e.details,' ("').concat(t,'" not supported)')),this.hls.removeLevel(i))}}}function xt(e){const t={action:vt.DoNothing,flags:yt.None};return e&&(t.resolved=!0),t}var _t="NOT_LOADED",St="APPENDING",Et="PARTIAL",Tt="OK";class wt{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e&&(e.on(l.MANIFEST_LOADING,this.onManifestLoading,this),e.on(l.BUFFER_APPENDED,this.onBufferAppended,this),e.on(l.FRAG_BUFFERED,this.onFragBuffered,this),e.on(l.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(l.MANIFEST_LOADING,this.onManifestLoading,this),e.off(l.BUFFER_APPENDED,this.onBufferAppended,this),e.off(l.FRAG_BUFFERED,this.onFragBuffered,this),e.off(l.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const n=this.activePartLists[t];if(n)for(let i=n.length;i--;){const t=n[i];if(!t)break;if(t.start<=e&&e<=t.end&&t.loaded)return t}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,n){const{fragments:i}=this,r=Object.keys(i);for(let s=r.length;s--;){const a=i[r[s]];if((null==a?void 0:a.body.type)===t&&(!n||a.buffered)){const t=a.body;if(t.start<=e&&e<=t.end)return t}}return null}detectEvictedFragments(e,t,n,i,r){this.timeRanges&&(this.timeRanges[e]=t);const s=(null==i?void 0:i.fragment.sn)||-1;Object.keys(this.fragments).forEach(i=>{const a=this.fragments[i];if(!a)return;if(s>=a.body.sn)return;if(!a.buffered&&(!a.loaded||r))return void(a.body.type===n&&this.removeFragment(a.body));const o=a.range[e];o&&(0!==o.time.length?o.time.some(e=>{const n=!this.isTimeBuffered(e.startPTS,e.endPTS,t);return n&&this.removeFragment(a.body),n}):this.removeFragment(a.body))})}detectPartialFragments(e){const t=this.timeRanges;if(!t||"initSegment"===e.frag.sn)return;const n=e.frag,i=Mt(n),r=this.fragments[i];if(!r||r.buffered&&n.gap)return;const s=!n.relurl;Object.keys(t).forEach(i=>{const a=n.elementaryStreams[i];if(!a)return;const o=t[i],l=s||!0===a.partial;r.range[i]=this.getBufferedTimes(n,e.part,l,o)}),r.loaded=null,Object.keys(r.range).length?(this.bufferedEnd(r,n),At(r)||this.removeParts(n.sn-1,n.type)):this.removeFragment(r.body)}bufferedEnd(e,t){e.buffered=!0;(e.body.endList=t.endList||e.body.endList)&&(this.endListFragments[e.body.type]=e)}removeParts(e,t){const n=this.activePartLists[t];n&&(this.activePartLists[t]=Rt(n,t=>t.fragment.sn>=e))}fragBuffered(e,t){const n=Mt(e);let i=this.fragments[n];!i&&t&&(i=this.fragments[n]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),i&&(i.loaded=null,this.bufferedEnd(i,e))}getBufferedTimes(e,t,n,i){const r={time:[],partial:n},s=e.start,a=e.end,o=e.minEndPTS||a,l=e.maxStartPTS||s;for(let c=0;c<i.length;c++){const e=i.start(c)-this.bufferPadding,t=i.end(c)+this.bufferPadding;if(l>=e&&o<=t){r.time.push({startPTS:Math.max(s,i.start(c)),endPTS:Math.min(a,i.end(c))});break}if(s<t&&a>e){const e=Math.max(s,i.start(c)),t=Math.min(a,i.end(c));t>e&&(r.partial=!0,r.time.push({startPTS:e,endPTS:t}))}else if(a<=e)break}return r}getPartialFragment(e){let t,n,i,r=null,s=0;const{bufferPadding:a,fragments:o}=this;return Object.keys(o).forEach(l=>{const c=o[l];c&&At(c)&&(n=c.body.start-a,i=c.body.end+a,e>=n&&e<=i&&(t=Math.min(e-n,i-e),s<=t&&(r=c.body,s=t)))}),r}isEndListAppended(e){const t=this.endListFragments[e];return void 0!==t&&(t.buffered||At(t))}getState(e){const t=Mt(e),n=this.fragments[t];return n?n.buffered?At(n)?Et:Tt:St:_t}isTimeBuffered(e,t,n){let i,r;for(let s=0;s<n.length;s++){if(i=n.start(s)-this.bufferPadding,r=n.end(s)+this.bufferPadding,e>=i&&t<=r)return!0;if(t<=i)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if("initSegment"===t.frag.sn||t.frag.bitrateTest)return;const n=t.frag,i=t.part?null:t,r=Mt(n);this.fragments[r]={body:n,appendedPTS:null,loaded:i,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:n,part:i,timeRanges:r,type:s}=t;if("initSegment"===n.sn)return;const a=n.type;if(i){let e=this.activePartLists[a];e||(this.activePartLists[a]=e=[]),e.push(i)}this.timeRanges=r;const o=r[s];this.detectEvictedFragments(s,o,a,i)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=Mt(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,n=Object.keys(t);if(!e)return n.length>0;for(let i=n.length;i--;){const r=t[n[i]];if((null==r?void 0:r.body.type)===e)return!0}return!1}hasParts(e){var t;return!(null==(t=this.activePartLists[e])||!t.length)}removeFragmentsInRange(e,t,n,i,r){i&&!this.hasGaps||Object.keys(this.fragments).forEach(s=>{const a=this.fragments[s];if(!a)return;const o=a.body;o.type!==n||i&&!o.gap||o.start<t&&o.end>e&&(a.buffered||r)&&this.removeFragment(o)})}removeFragment(e){const t=Mt(e);e.clearElementaryStreamInfo();const n=this.activePartLists[e.type];if(n){const t=e.sn;this.activePartLists[e.type]=Rt(n,e=>e.fragment.sn!==t)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const t=null==(e=this.hls)||null==(e=e.latestLevelDetails)?void 0:e.partList;t&&t.forEach(e=>e.clearElementaryStreamInfo())}}function At(e){var t,n,i;return e.buffered&&!!(e.body.gap||null!=(t=e.range.video)&&t.partial||null!=(n=e.range.audio)&&n.partial||null!=(i=e.range.audiovideo)&&i.partial)}function Mt(e){return"".concat(e.type,"_").concat(e.level,"_").concat(e.sn)}function Rt(e,t){return e.filter(e=>{const n=t(e);return n||e.clearElementaryStreamInfo(),n})}var Ct=0,Lt=1;class It{constructor(e,t,n){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=n}decrypt(e,t){switch(this.aesMode){case Ct:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case Lt:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error("[AESCrypto] invalid aes mode ".concat(this.aesMode))}}}class Pt{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),n=new Uint32Array(4);for(let i=0;i<4;i++)n[i]=t.getUint32(4*i);return n}initTable(){const e=this.sBox,t=this.invSBox,n=this.subMix,i=n[0],r=n[1],s=n[2],a=n[3],o=this.invSubMix,l=o[0],c=o[1],u=o[2],h=o[3],d=new Uint32Array(256);let f=0,p=0,m=0;for(m=0;m<256;m++)d[m]=m<128?m<<1:m<<1^283;for(m=0;m<256;m++){let n=p^p<<1^p<<2^p<<3^p<<4;n=n>>>8^255&n^99,e[f]=n,t[n]=f;const o=d[f],m=d[o],g=d[m];let v=257*d[n]^16843008*n;i[f]=v<<24|v>>>8,r[f]=v<<16|v>>>16,s[f]=v<<8|v>>>24,a[f]=v,v=16843009*g^65537*m^257*o^16843008*f,l[n]=v<<24|v>>>8,c[n]=v<<16|v>>>16,u[n]=v<<8|v>>>24,h[n]=v,f?(f=o^d[d[d[g^o]]],p^=d[d[p]]):f=p=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let n=!0,i=0;for(;i<t.length&&n;)n=t[i]===this.key[i],i++;if(n)return;this.key=t;const r=this.keySize=t.length;if(4!==r&&6!==r&&8!==r)throw new Error("Invalid aes key size="+r);const s=this.ksRows=4*(r+6+1);let a,o;const l=this.keySchedule=new Uint32Array(s),c=this.invKeySchedule=new Uint32Array(s),u=this.sBox,h=this.rcon,d=this.invSubMix,f=d[0],p=d[1],m=d[2],g=d[3];let v,y;for(a=0;a<s;a++)a<r?v=l[a]=t[a]:(y=v,a%r===0?(y=y<<8|y>>>24,y=u[y>>>24]<<24|u[y>>>16&255]<<16|u[y>>>8&255]<<8|u[255&y],y^=h[a/r|0]<<24):r>6&&a%r===4&&(y=u[y>>>24]<<24|u[y>>>16&255]<<16|u[y>>>8&255]<<8|u[255&y]),l[a]=v=(l[a-r]^y)>>>0);for(o=0;o<s;o++)a=s-o,y=3&o?l[a]:l[a-4],c[o]=o<4||a<=4?y:f[u[y>>>24]]^p[u[y>>>16&255]]^m[u[y>>>8&255]]^g[u[255&y]],c[o]=c[o]>>>0}networkToHostOrderSwap(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24}decrypt(e,t,n){const i=this.keySize+6,r=this.invKeySchedule,s=this.invSBox,a=this.invSubMix,o=a[0],l=a[1],c=a[2],u=a[3],h=this.uint8ArrayToUint32Array_(n);let d=h[0],f=h[1],p=h[2],m=h[3];const g=new Int32Array(e),v=new Int32Array(g.length);let y,b,x,_,S,E,T,w,A,M,R,C,L,I;const P=this.networkToHostOrderSwap;for(;t<g.length;){for(A=P(g[t]),M=P(g[t+1]),R=P(g[t+2]),C=P(g[t+3]),S=A^r[0],E=C^r[1],T=R^r[2],w=M^r[3],L=4,I=1;I<i;I++)y=o[S>>>24]^l[E>>16&255]^c[T>>8&255]^u[255&w]^r[L],b=o[E>>>24]^l[T>>16&255]^c[w>>8&255]^u[255&S]^r[L+1],x=o[T>>>24]^l[w>>16&255]^c[S>>8&255]^u[255&E]^r[L+2],_=o[w>>>24]^l[S>>16&255]^c[E>>8&255]^u[255&T]^r[L+3],S=y,E=b,T=x,w=_,L+=4;y=s[S>>>24]<<24^s[E>>16&255]<<16^s[T>>8&255]<<8^s[255&w]^r[L],b=s[E>>>24]<<24^s[T>>16&255]<<16^s[w>>8&255]<<8^s[255&S]^r[L+1],x=s[T>>>24]<<24^s[w>>16&255]<<16^s[S>>8&255]<<8^s[255&E]^r[L+2],_=s[w>>>24]<<24^s[S>>16&255]<<16^s[E>>8&255]<<8^s[255&T]^r[L+3],v[t]=P(y^d),v[t+1]=P(_^f),v[t+2]=P(x^p),v[t+3]=P(b^m),d=A,f=M,p=R,m=C,t+=4}return v.buffer}}class kt{constructor(e,t,n){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=n}expandKey(){const e=function(e){switch(e){case Ct:return"AES-CBC";case Lt:return"AES-CTR";default:throw new Error("[FastAESKey] invalid aes mode ".concat(e))}}(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}class Dt{constructor(e){let{removePKCS7Padding:t=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const e=self.crypto;e&&(this.subtle=e.subtle||e.webkitSubtle)}catch(n){}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const n=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?function(e){const t=e.byteLength,n=t&&new DataView(e.buffer).getUint8(t-1);return n?e.slice(0,t-n):e}(n):n}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,n,i){return this.useSoftware?new Promise((r,s)=>{const a=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(a,t,n,i);const o=this.flush();o?r(o.buffer):s(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,n,i)}softwareDecrypt(e,t,n,i){const{currentIV:r,currentResult:s,remainderData:a}=this;if(i!==Ct||16!==t.byteLength)return A.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),a&&(e=ce(a,e),this.remainderData=null);const o=this.getValidChunk(e);if(!o.length)return null;r&&(n=r);let l=this.softwareDecrypter;l||(l=this.softwareDecrypter=new Pt),l.expandKey(t);const c=s;return this.currentResult=l.decrypt(o.buffer,0,n),this.currentIV=o.slice(-16).buffer,c||null}webCryptoDecrypt(e,t,n,i){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,n,i));this.key=t,this.fastAesKey=new kt(this.subtle,t,i)}return this.fastAesKey.expandKey().then(t=>{if(!this.subtle)return Promise.reject(new Error("web crypto not initialized"));this.logOnce("WebCrypto AES decrypt");return new It(this.subtle,new Uint8Array(n),i).decrypt(e.buffer,t)}).catch(r=>(A.warn("[decrypter]: WebCrypto Error, disable WebCrypto API, ".concat(r.name,": ").concat(r.message)),this.onWebCryptoError(e,t,n,i)))}onWebCryptoError(e,t,n,i){const r=this.enableSoftwareAES;if(r){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,n,i);const r=this.flush();if(r)return r.buffer}throw new Error("WebCrypto"+(r?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const n=e.length-e.length%16;return n!==e.length&&(t=e.slice(0,n),this.remainderData=e.slice(n)),t}logOnce(e){this.logEnabled&&(A.log("[decrypter]: ".concat(e)),this.logEnabled=!1)}}const Nt=Math.pow(2,17);class Ot{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const n=e.url;if(!n)return Promise.reject(new Bt({type:a.NETWORK_ERROR,details:o.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error("Fragment does not have a ".concat(n?"part list":"url")),networkDetails:null}));this.abort();const i=this.config,r=i.fLoader,s=i.loader;return new Promise((l,c)=>{if(this.loader&&this.loader.destroy(),e.gap){if(e.tagList.some(e=>"GAP"===e[0]))return void c(Ut(e));e.gap=!1}const u=this.loader=r?new r(i):new s(i),h=Ft(e);e.loader=u;const d=pt(i.fragLoadPolicy.default),f={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:"initSegment"===e.sn?1/0:Nt};e.stats=u.stats;const p={onSuccess:(t,n,i,r)=>{this.resetLoader(e,u);let s=t.data;i.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(s.slice(0,16)),s=s.slice(16)),l({frag:e,part:null,payload:s,networkDetails:r})},onError:(t,i,r,s)=>{this.resetLoader(e,u),c(new Bt({type:a.NETWORK_ERROR,details:o.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:b({url:n,data:void 0},t),error:new Error("HTTP Error ".concat(t.code," ").concat(t.text)),networkDetails:r,stats:s}))},onAbort:(t,n,i)=>{this.resetLoader(e,u),c(new Bt({type:a.NETWORK_ERROR,details:o.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:i,stats:t}))},onTimeout:(t,n,i)=>{this.resetLoader(e,u),c(new Bt({type:a.NETWORK_ERROR,details:o.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error("Timeout after ".concat(f.timeout,"ms")),networkDetails:i,stats:t}))}};t&&(p.onProgress=(n,i,r,s)=>t({frag:e,part:null,payload:r,networkDetails:s})),u.load(h,f,p)})}loadPart(e,t,n){this.abort();const i=this.config,r=i.fLoader,s=i.loader;return new Promise((l,c)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap)return void c(Ut(e,t));const u=this.loader=r?new r(i):new s(i),h=Ft(e,t);e.loader=u;const d=pt(i.fragLoadPolicy.default),f={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:Nt};t.stats=u.stats,u.load(h,f,{onSuccess:(i,r,s,a)=>{this.resetLoader(e,u),this.updateStatsFromPart(e,t);const o={frag:e,part:t,payload:i.data,networkDetails:a};n(o),l(o)},onError:(n,i,r,s)=>{this.resetLoader(e,u),c(new Bt({type:a.NETWORK_ERROR,details:o.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:b({url:h.url,data:void 0},n),error:new Error("HTTP Error ".concat(n.code," ").concat(n.text)),networkDetails:r,stats:s}))},onAbort:(n,i,r)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,u),c(new Bt({type:a.NETWORK_ERROR,details:o.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:r,stats:n}))},onTimeout:(n,i,r)=>{this.resetLoader(e,u),c(new Bt({type:a.NETWORK_ERROR,details:o.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error("Timeout after ".concat(f.timeout,"ms")),networkDetails:r,stats:n}))}})})}updateStatsFromPart(e,t){const n=e.stats,i=t.stats,r=i.total;if(n.loaded+=i.loaded,r){const i=Math.round(e.duration/t.duration),s=Math.min(Math.round(n.loaded/r),i),a=(i-s)*Math.round(n.loaded/s);n.total=n.loaded+a}else n.total=Math.max(n.loaded,n.total);const s=n.loading,a=i.loading;s.start?s.first+=a.first-a.start:(s.start=a.start,s.first=a.first),s.end=a.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function Ft(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=t||e,r={frag:e,part:t,responseType:"arraybuffer",url:n.url,headers:{},rangeStart:0,rangeEnd:0},s=n.byteRangeStartOffset,a=n.byteRangeEndOffset;if(i(s)&&i(a)){var o;let t=s,n=a;if("initSegment"===e.sn&&("AES-128"===(l=null==(o=e.decryptdata)?void 0:o.method)||"AES-256"===l)){const e=a-s;e%16&&(n=a+(16-e%16)),0!==s&&(r.resetIV=!0,t=s-16)}r.rangeStart=t,r.rangeEnd=n}var l;return r}function Ut(e,t){const n=new Error("GAP ".concat(e.gap?"tag":"attribute"," found")),i={type:a.MEDIA_ERROR,details:o.FRAG_GAP,fatal:!1,frag:e,error:n,networkDetails:null};return t&&(i.part=t),(t||e).stats.aborted=!0,new Bt(i)}class Bt extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class zt extends x{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return!this._tickInterval&&(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)}clearNextTick(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)}tick(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class jt{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:-1,s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=e,this.sn=t,this.id=n,this.size=i,this.part=r,this.partial=s}}const Gt={length:0,start:()=>0,end:()=>0};class Vt{static isBuffered(e,t){if(e){const n=Vt.getBuffered(e);for(let e=n.length;e--;)if(t>=n.start(e)&&t<=n.end(e))return!0}return!1}static bufferedRanges(e){if(e){const t=Vt.getBuffered(e);return Vt.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let n=0;n<e.length;n++)t.push({start:e.start(n),end:e.end(n)});return t}static bufferInfo(e,t,n){if(e){const i=Vt.bufferedRanges(e);if(i.length)return Vt.bufferedInfo(i,t,n)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,n){t=Math.max(0,t),e.length>1&&e.sort((e,t)=>e.start-t.start||t.end-e.end);let i=-1,r=[];if(n)for(let c=0;c<e.length;c++){t>=e[c].start&&t<=e[c].end&&(i=c);const s=r.length;if(s){const t=r[s-1].end;e[c].start-t<n?e[c].end>t&&(r[s-1].end=e[c].end):r.push(e[c])}else r.push(e[c])}else r=e;let s,a=0,o=t,l=t;for(let c=0;c<r.length;c++){const e=r[c].start,u=r[c].end;if(-1===i&&t>=e&&t<=u&&(i=c),t+n>=e&&t<u)o=e,l=u,a=l-t;else if(t+n<e){s=e;break}}return{len:a,start:o||0,end:l||0,nextStart:s,buffered:e,bufferedIndex:i}}static getBuffered(e){try{return e.buffered||Gt}catch(t){return A.log("failed to get media.buffered",t),Gt}}}const Ht=/\{\$([a-zA-Z0-9-_]+)\}/g;function Wt(e){return Ht.test(e)}function Yt(e,t){if(null!==e.variableList||e.hasVariableRefs){const n=e.variableList;return t.replace(Ht,t=>{const i=t.substring(2,t.length-1),r=null==n?void 0:n[i];return void 0===r?(e.playlistParsingError||(e.playlistParsingError=new Error('Missing preceding EXT-X-DEFINE tag for Variable Reference: "'.concat(i,'"'))),t):r})}return t}function Xt(e,t,n){let i,r,s=e.variableList;if(s||(e.variableList=s={}),"QUERYPARAM"in t){i=t.QUERYPARAM;try{const e=new self.URL(n).searchParams;if(!e.has(i))throw new Error('"'.concat(i,'" does not match any query parameter in URI: "').concat(n,'"'));r=e.get(i)}catch(a){e.playlistParsingError||(e.playlistParsingError=new Error("EXT-X-DEFINE QUERYPARAM: ".concat(a.message)))}}else i=t.NAME,r=t.VALUE;i in s?e.playlistParsingError||(e.playlistParsingError=new Error('EXT-X-DEFINE duplicate Variable Name declarations: "'.concat(i,'"'))):s[i]=r||""}function qt(e,t,n){const i=t.IMPORT;if(n&&i in n){let t=e.variableList;t||(e.variableList=t={}),t[i]=n[i]}else e.playlistParsingError||(e.playlistParsingError=new Error('EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "'.concat(i,'"')))}const Kt=/^(\d+)x(\d+)$/,Zt=/(.+?)=(".*?"|.*?)(?:,|$)/g;class Jt{constructor(e,t){"string"===typeof e&&(e=Jt.parseAttrList(e,t)),v(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>"X-"===e.substring(0,2))}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;const n=new Uint8Array(t.length/2);for(let e=0;e<t.length/2;e++)n[e]=parseInt(t.slice(2*e,2*e+2),16);return n}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const n=this[e];return n?parseFloat(n):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const n=this[e];return(n?n.split(/[ ,]+/):[]).reduce((e,t)=>(e[t.toLowerCase()]=!0,e),t)}bool(e){return"YES"===this[e]}decimalResolution(e){const t=Kt.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let n;const i={};for(Zt.lastIndex=0;null!==(n=Zt.exec(e));){const r=n[1].trim();let s=n[2];const a=0===s.indexOf('"')&&s.lastIndexOf('"')===s.length-1;let o=!1;if(a)s=s.slice(1,-1);else switch(r){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":o=!0}if(t&&(a||o))s=Yt(t,s);else if(!o&&!a)switch(r){case"CLOSED-CAPTIONS":if("NONE"===s)break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":A.warn("".concat(e,": attribute ").concat(r," is missing quotes"))}i[r]=s}return i}}function Qt(e){return"ID"!==e&&"CLASS"!==e&&"CUE"!==e&&"START-DATE"!==e&&"DURATION"!==e&&"END-DATE"!==e&&"END-ON-NEXT"!==e}function $t(e){return"SCTE35-OUT"===e||"SCTE35-IN"===e||"SCTE35-CMD"===e}class en{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;var r;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(null==t?void 0:t.tagAnchor)||null,this.tagOrder=null!=(r=null==t?void 0:t.tagOrder)?r:n,t){const n=t.attr;for(const t in n)if(Object.prototype.hasOwnProperty.call(e,t)&&e[t]!==n[t]){A.warn('DATERANGE tag attribute: "'.concat(t,'" does not match for tags with ID: "').concat(e.ID,'"')),this._badValueForSameId=t;break}e=v(new Jt({}),n,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const e=(null==t?void 0:t.endDate)||new Date(this.attr["END-DATE"]);i(e.getTime())&&(this._endDate=e)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return void 0===e?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return null===e||null===e.programDateTime?(A.warn('Expected tagAnchor Fragment with PDT set for DateRange "'.concat(this.id,'": ').concat(e)),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return null!==t?this._dateAtEnd=new Date(this._startDate.getTime()+1e3*t):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(i(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return"com.apple.hls.interstitial"===this.class}get isValid(){return!!this.id&&!this._badValueForSameId&&i(this.startDate.getTime())&&(null===this.duration||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}class tn{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e)return this.advanced=!0,void(this.updated=!0);const t=this.lastPartSn-e.lastPartSn,n=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!n||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||0===t&&n>0,this.updated||this.advanced?this.misses=Math.floor(.6*e.misses):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(t=>{let n=t.decryptdata;return n||(t.setKeyFormat(e.keyFormat),n=t.decryptdata),!!n&&e.matches(n)})}get hasProgramDateTime(){return!!this.fragments.length&&i(this.fragments[this.fragments.length-1].programDateTime)}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||10}get drift(){const e=this.driftEndTime-this.driftStartTime;if(e>0){return 1e3*(this.driftEnd-this.driftStart)/e}return 1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(-1!==t){for(let n=e.length;n--;)if(e[n].index>t)return e[n].index;return t}}return 0}get lastPartSn(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function nn(e,t){return e.length===t.length&&!e.some((e,n)=>e!==t[n])}function rn(e,t){return!e&&!t||!(!e||!t)&&nn(e,t)}function sn(e){return"AES-128"===e||"AES-256"===e||"AES-256-CTR"===e}function an(e){switch(e){case"AES-128":case"AES-256":return Ct;case"AES-256-CTR":return Lt;default:throw new Error("invalid full segment method ".concat(e))}}function on(e){return Uint8Array.from(atob(e),e=>e.charCodeAt(0))}function ln(e){return Uint8Array.from(unescape(encodeURIComponent(e)),e=>e.charCodeAt(0))}function cn(e){const t=function(e,t,n){const i=e[t];e[t]=e[n],e[n]=i};t(e,0,3),t(e,1,2),t(e,4,5),t(e,6,7)}function un(e){const t=e.split(":");let n=null;if("data"===t[0]&&2===t.length){const e=t[1].split(";"),i=e[e.length-1].split(",");if(2===i.length){const t="base64"===i[0],r=i[1];t?(e.splice(-1,1),n=on(r)):n=function(e){const t=ln(e).subarray(0,16),n=new Uint8Array(16);return n.set(t,16-t.length),n}(r)}}return n}const hn="undefined"!==typeof self?self:void 0;var dn={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},fn={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function pn(e){switch(e){case fn.FAIRPLAY:return dn.FAIRPLAY;case fn.PLAYREADY:return dn.PLAYREADY;case fn.WIDEVINE:return dn.WIDEVINE;case fn.CLEARKEY:return dn.CLEARKEY}}function mn(e){switch(e){case dn.FAIRPLAY:return fn.FAIRPLAY;case dn.PLAYREADY:return fn.PLAYREADY;case dn.WIDEVINE:return fn.WIDEVINE;case dn.CLEARKEY:return fn.CLEARKEY}}function gn(e){const{drmSystems:t,widevineLicenseUrl:n}=e,i=t?[dn.FAIRPLAY,dn.WIDEVINE,dn.PLAYREADY,dn.CLEARKEY].filter(e=>!!t[e]):[];return!i[dn.WIDEVINE]&&n&&i.push(dn.WIDEVINE),i}const vn=null!=hn&&null!=(yn=hn.navigator)&&yn.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null;var yn;function bn(e){const t=new Uint16Array(e.buffer,e.byteOffset,e.byteLength/2),n=String.fromCharCode.apply(null,Array.from(t)),i=n.substring(n.indexOf("<"),n.length),r=(new DOMParser).parseFromString(i,"text/xml").getElementsByTagName("KID")[0];if(r){const e=r.childNodes[0]?r.childNodes[0].nodeValue:r.getAttribute("VALUE");if(e){const t=on(e).subarray(0,16);return cn(t),t}}return null}let xn={};class _n{static clearKeyUriToKeyIdMap(){xn={}}static setKeyIdForUri(e,t){xn[e]=t}static addKeyIdForUri(e){const t=Object.keys(xn).length%Number.MAX_SAFE_INTEGER,n=new Uint8Array(16);return new DataView(n.buffer,12,4).setUint32(0,t),xn[e]=n,n}constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5?arguments[5]:void 0;this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=n,this.keyFormatVersions=i,this.iv=r,this.encrypted=!!e&&"NONE"!==e,this.isCommonEncryption=this.encrypted&&!sn(e),null!=s&&s.startsWith("0x")&&(this.keyId=new Uint8Array(I(s)))}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&nn(e.keyFormatVersions,this.keyFormatVersions)&&rn(e.iv,this.iv)&&rn(e.keyId,this.keyId)}isSupported(){if(this.method){if(sn(this.method)||"NONE"===this.method)return!0;if("identity"===this.keyFormat)return"SAMPLE-AES"===this.method;switch(this.keyFormat){case fn.FAIRPLAY:case fn.WIDEVINE:case fn.PLAYREADY:case fn.CLEARKEY:return-1!==["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)}}return!1}getDecryptData(e,t){if(!this.encrypted||!this.uri)return null;if(sn(this.method)){let t=this.iv;t||("number"!==typeof e&&(A.warn('missing IV for initialization segment with method="'.concat(this.method,'" - compliance issue')),e=0),t=function(e){const t=new Uint8Array(16);for(let n=12;n<16;n++)t[n]=e>>8*(15-n)&255;return t}(e));return new _n(this.method,this.uri,"identity",this.keyFormatVersions,t)}if(this.keyId){const e=xn[this.uri];if(e&&!nn(this.keyId,e)&&_n.setKeyIdForUri(this.uri,this.keyId),this.pssh)return this}const n=un(this.uri);if(n)switch(this.keyFormat){case fn.WIDEVINE:if(this.pssh=n,!this.keyId){const e=function(e){const t=[];if(e instanceof ArrayBuffer){const n=e.byteLength;let i=0;for(;i+32<n;){const n=ge(new DataView(e,i));t.push(n),i+=n.size}}return t}(n.buffer);if(e.length){var i;const t=e[0];this.keyId=null!=(i=t.kids)&&i.length?t.kids[0]:null}}this.keyId||(this.keyId=Sn(t));break;case fn.PLAYREADY:{const e=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=me(e,0,n),this.keyId=bn(n);break}default:{let e=n.subarray(0,16);if(16!==e.length){const t=new Uint8Array(16);t.set(e,16-e.length),e=t}this.keyId=e;break}}if(!this.keyId||16!==this.keyId.byteLength){let e;e=function(e){const t=null==e?void 0:e[fn.WIDEVINE];if(t)return t.keyId;return null}(t),e||(e=Sn(t),e||(e=xn[this.uri])),e&&(this.keyId=e,_n.setKeyIdForUri(this.uri,e))}return this}}function Sn(e){const t=null==e?void 0:e[fn.PLAYREADY];if(t){const e=un(t.uri);if(e)return bn(e)}return null}const En=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,Tn=/#EXT-X-MEDIA:(.*)/g,wn=/^#EXT(?:INF|-X-TARGETDURATION):/m,An=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),Mn=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class Rn{static findGroup(e,t){for(let n=0;n<e.length;n++){const i=e[n];if(i.id===t)return i}}static resolve(e,t){return N.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return wn.test(e)}static parseMasterPlaylist(e,t){const n={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:Wt(e)},i=[];if(En.lastIndex=0,!e.startsWith("#EXTM3U"))return n.playlistParsingError=new Error("no EXTM3U delimiter"),n;let r;for(;null!=(r=En.exec(e));)if(r[1]){var s;const e=new Jt(r[1],n),a=Yt(n,r[2]),o={attrs:e,bitrate:e.decimalInteger("BANDWIDTH")||e.decimalInteger("AVERAGE-BANDWIDTH"),name:e.NAME,url:Rn.resolve(a,t)},l=e.decimalResolution("RESOLUTION");l&&(o.width=l.width,o.height=l.height),kn(e.CODECS,o);const c=e["SUPPLEMENTAL-CODECS"];c&&(o.supplemental={},kn(c,o.supplemental)),null!=(s=o.unknownCodecs)&&s.length||i.push(o),n.levels.push(o)}else if(r[3]){const e=r[3],i=r[4];switch(e){case"SESSION-DATA":{const e=new Jt(i,n),t=e["DATA-ID"];t&&(null===n.sessionData&&(n.sessionData={}),n.sessionData[t]=e);break}case"SESSION-KEY":{const e=In(i,t,n);e.encrypted&&e.isSupported()?(null===n.sessionKeys&&(n.sessionKeys=[]),n.sessionKeys.push(e)):A.warn('[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "'.concat(i,'"'));break}case"DEFINE":Xt(n,new Jt(i,n),t);break;case"CONTENT-STEERING":{const e=new Jt(i,n);n.contentSteering={uri:Rn.resolve(e["SERVER-URI"],t),pathwayId:e["PATHWAY-ID"]||"."};break}case"START":n.startTimeOffset=Pn(i)}}const a=i.length>0&&i.length<n.levels.length;return n.levels=a?i:n.levels,0===n.levels.length&&(n.playlistParsingError=new Error("no levels found in manifest")),n}static parseMasterPlaylistMedia(e,t,n){let i;const r={},s=n.levels,a={AUDIO:s.map(e=>({id:e.attrs.AUDIO,audioCodec:e.audioCodec})),SUBTITLES:s.map(e=>({id:e.attrs.SUBTITLES,textCodec:e.textCodec})),"CLOSED-CAPTIONS":[]};let o=0;for(Tn.lastIndex=0;null!==(i=Tn.exec(e));){const e=new Jt(i[1],n),s=e.TYPE;if(s){const n=a[s],i=r[s]||[];r[s]=i;const l=e.LANGUAGE,c=e["ASSOC-LANGUAGE"],u=e.CHANNELS,h=e.CHARACTERISTICS,d=e["INSTREAM-ID"],f={attrs:e,bitrate:0,id:o++,groupId:e["GROUP-ID"]||"",name:e.NAME||l||"",type:s,default:e.bool("DEFAULT"),autoselect:e.bool("AUTOSELECT"),forced:e.bool("FORCED"),lang:l,url:e.URI?Rn.resolve(e.URI,t):""};if(c&&(f.assocLang=c),u&&(f.channels=u),h&&(f.characteristics=h),d&&(f.instreamId=d),null!=n&&n.length){const e=Rn.findGroup(n,f.groupId)||n[0];Dn(f,e,"audioCodec"),Dn(f,e,"textCodec")}i.push(f)}}return r}static parseLevelPlaylist(e,t,n,r,s,a){var o;const l={url:t},c=new tn(t),u=c.fragments,h=[];let d,f,p,m,g=null,y=0,b=0,x=0,_=0,S=0,E=null,T=new G(r,l),w=-1,M=!1,R=null;if(An.lastIndex=0,c.m3u8=e,c.hasVariableRefs=Wt(e),"#EXTM3U"!==(null==(o=An.exec(e))?void 0:o[0]))return c.playlistParsingError=new Error("Missing format identifier #EXTM3U"),c;for(;null!==(d=An.exec(e));){M&&(M=!1,T=new G(r,l),T.playlistOffset=x,T.setStart(x),T.sn=y,T.cc=_,S&&(T.bitrate=S),T.level=n,g&&(T.initSegment=g,g.rawProgramDateTime&&(T.rawProgramDateTime=g.rawProgramDateTime,g.rawProgramDateTime=null),R&&(T.setByteRange(R),R=null)));const e=d[1];if(e){T.duration=parseFloat(e);const t=(" "+d[2]).slice(1);T.title=t||null,T.tagList.push(t?["INF",e,t]:["INF",e])}else if(d[3]){if(i(T.duration)){T.playlistOffset=x,T.setStart(x),p&&Fn(T,p,c),T.sn=y,T.level=n,T.cc=_,u.push(T);const e=(" "+d[3]).slice(1);T.relurl=Yt(c,e),Nn(T,E,h),E=T,x+=T.duration,y++,b=0,M=!0}}else{if(d=d[0].match(Mn),!d){A.warn("No matches on slow regex match for level playlist!");continue}for(f=1;f<d.length&&void 0===d[f];f++);const e=(" "+d[f]).slice(1),s=(" "+d[f+1]).slice(1),o=d[f+2]?(" "+d[f+2]).slice(1):null;switch(e){case"BYTERANGE":E?T.setByteRange(s,E):T.setByteRange(s);break;case"PROGRAM-DATE-TIME":T.rawProgramDateTime=s,T.tagList.push(["PROGRAM-DATE-TIME",s]),-1===w&&(w=u.length);break;case"PLAYLIST-TYPE":c.type&&Un(c,e,d),c.type=s.toUpperCase();break;case"MEDIA-SEQUENCE":0!==c.startSN?Un(c,e,d):u.length>0&&Bn(c,e,d),y=c.startSN=parseInt(s);break;case"SKIP":{c.skippedSegments&&Un(c,e,d);const t=new Jt(s,c),n=t.decimalInteger("SKIPPED-SEGMENTS");if(i(n)){c.skippedSegments+=n;for(let e=n;e--;)u.push(null);y+=n}const r=t.enumeratedString("RECENTLY-REMOVED-DATERANGES");r&&(c.recentlyRemovedDateranges=(c.recentlyRemovedDateranges||[]).concat(r.split("\t")));break}case"TARGETDURATION":0!==c.targetduration&&Un(c,e,d),c.targetduration=Math.max(parseInt(s),1);break;case"VERSION":null!==c.version&&Un(c,e,d),c.version=parseInt(s);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":c.live||Un(c,e,d),c.live=!1;break;case"#":(s||o)&&T.tagList.push(o?[s,o]:[s]);break;case"DISCONTINUITY":_++,T.tagList.push(["DIS"]);break;case"GAP":T.gap=!0,T.tagList.push([e]);break;case"BITRATE":T.tagList.push([e,s]),S=1e3*parseInt(s),i(S)?T.bitrate=S:S=0;break;case"DATERANGE":{const e=new Jt(s,c),t=new en(e,c.dateRanges[e.ID],c.dateRangeTagCount);c.dateRangeTagCount++,t.isValid||c.skippedSegments?c.dateRanges[t.id]=t:A.warn('Ignoring invalid DATERANGE tag: "'.concat(s,'"')),T.tagList.push(["EXT-X-DATERANGE",s]);break}case"DEFINE":{const e=new Jt(s,c);"IMPORT"in e?qt(c,e,a):Xt(c,e,t)}break;case"DISCONTINUITY-SEQUENCE":0!==c.startCC?Un(c,e,d):u.length>0&&Bn(c,e,d),c.startCC=_=parseInt(s);break;case"KEY":{const e=In(s,t,c);if(e.isSupported()){if("NONE"===e.method){p=void 0;break}p||(p={});const t=p[e.keyFormat];null!=t&&t.matches(e)||(t&&(p=v({},p)),p[e.keyFormat]=e)}else A.warn('[Keys] Ignoring unsupported EXT-X-KEY tag: "'.concat(s,'"'));break}case"START":c.startTimeOffset=Pn(s);break;case"MAP":{const e=new Jt(s,c);if(T.duration){const t=new G(r,l);On(t,e,n,p),g=t,T.initSegment=g,g.rawProgramDateTime&&!T.rawProgramDateTime&&(T.rawProgramDateTime=g.rawProgramDateTime)}else{const t=T.byteRangeEndOffset;if(t){const e=T.byteRangeStartOffset;R="".concat(t-e,"@").concat(e)}else R=null;On(T,e,n,p),g=T,M=!0}g.cc=_;break}case"SERVER-CONTROL":m&&Un(c,e,d),m=new Jt(s),c.canBlockReload=m.bool("CAN-BLOCK-RELOAD"),c.canSkipUntil=m.optionalFloat("CAN-SKIP-UNTIL",0),c.canSkipDateRanges=c.canSkipUntil>0&&m.bool("CAN-SKIP-DATERANGES"),c.partHoldBack=m.optionalFloat("PART-HOLD-BACK",0),c.holdBack=m.optionalFloat("HOLD-BACK",0);break;case"PART-INF":{c.partTarget&&Un(c,e,d);const t=new Jt(s);c.partTarget=t.decimalFloatingPoint("PART-TARGET");break}case"PART":{let e=c.partList;e||(e=c.partList=[]);const t=b>0?e[e.length-1]:void 0,n=b++,i=new Jt(s,c),r=new V(i,T,l,n,t);e.push(r),T.duration+=r.duration;break}case"PRELOAD-HINT":{const e=new Jt(s,c);c.preloadHint=e;break}case"RENDITION-REPORT":{const e=new Jt(s,c);c.renditionReports=c.renditionReports||[],c.renditionReports.push(e);break}default:A.warn("line parsed but not handled: ".concat(d))}}}E&&!E.relurl?(u.pop(),x-=E.duration,c.partList&&(c.fragmentHint=E)):c.partList&&(Nn(T,E,h),T.cc=_,c.fragmentHint=T,p&&Fn(T,p,c)),c.targetduration||(c.playlistParsingError=new Error("Missing Target Duration"));const C=u.length,L=u[0],I=u[C-1];if(x+=c.skippedSegments*c.targetduration,x>0&&C&&I){c.averagetargetduration=x/C;const e=I.sn;c.endSN="initSegment"!==e?e:0,c.live||(I.endList=!0),w>0&&(!function(e,t){let n=e[t];for(let i=t;i--;){const t=e[i];if(!t)return;t.programDateTime=n.programDateTime-1e3*t.duration,n=t}}(u,w),L&&h.unshift(L))}return c.fragmentHint&&(x+=c.fragmentHint.duration),c.totalduration=x,h.length&&c.dateRangeTagCount&&L&&Cn(h,c),c.endCC=_,c}}function Cn(e,t){let n=e.length;if(!n){if(!t.hasProgramDateTime)return;{const i=t.fragments[t.fragments.length-1];e.push(i),n++}}const i=e[n-1],r=t.live?1/0:t.totalduration,s=Object.keys(t.dateRanges);for(let o=s.length;o--;){const l=t.dateRanges[s[o]],c=l.startDate.getTime();l.tagAnchor=i.ref;for(let i=n;i--;){var a;if((null==(a=e[i])?void 0:a.sn)<t.startSN)break;const n=Ln(t,c,e,i,r);if(-1!==n){l.tagAnchor=t.fragments[n].ref;break}}}}function Ln(e,t,n,i,r){const s=n[i];if(s){const o=s.programDateTime;if(t>=o||0===i){var a;if(t<=o+1e3*(((null==(a=n[i+1])?void 0:a.start)||r)-s.start)){const r=n[i].sn-e.startSN;if(r<0)return-1;const s=e.fragments;if(s.length>n.length){for(let a=(n[i+1]||s[s.length-1]).sn-e.startSN;a>r;a--){const e=s[a].programDateTime;if(t>=e&&t<e+1e3*s[a].duration)return a}}return r}}}return-1}function In(e,t,n){var i,r;const s=new Jt(e,n),a=null!=(i=s.METHOD)?i:"",o=s.URI,l=s.hexadecimalInteger("IV"),c=s.KEYFORMATVERSIONS,u=null!=(r=s.KEYFORMAT)?r:"identity";o&&s.IV&&!l&&A.error("Invalid IV: ".concat(s.IV));const h=o?Rn.resolve(o,t):"",d=(c||"1").split("/").map(Number).filter(Number.isFinite);return new _n(a,h,u,d,l,s.KEYID)}function Pn(e){const t=new Jt(e).decimalFloatingPoint("TIME-OFFSET");return i(t)?t:null}function kn(e,t){let n=(e||"").split(/[ ,]+/).filter(e=>e);["video","audio","text"].forEach(e=>{const i=n.filter(t=>be(t,e));i.length&&(t["".concat(e,"Codec")]=i.map(e=>e.split("/")[0]).join(","),n=n.filter(e=>-1===i.indexOf(e)))}),t.unknownCodecs=n}function Dn(e,t,n){const i=t[n];i&&(e[n]=i)}function Nn(e,t,n){e.rawProgramDateTime?n.push(e):null!=t&&t.programDateTime&&(e.programDateTime=t.endProgramDateTime)}function On(e,t,n,i){e.relurl=t.URI,t.BYTERANGE&&e.setByteRange(t.BYTERANGE),e.level=n,e.sn="initSegment",i&&(e.levelkeys=i),e.initSegment=null}function Fn(e,t,n){e.levelkeys=t;const{encryptedFragments:i}=n;i.length&&i[i.length-1].levelkeys===t||!Object.keys(t).some(e=>t[e].isCommonEncryption)||i.push(e)}function Un(e,t,n){e.playlistParsingError=new Error("#EXT-X-".concat(t," must not appear more than once (").concat(n[0],")"))}function Bn(e,t,n){e.playlistParsingError=new Error("#EXT-X-".concat(t," must appear before the first Media Segment (").concat(n[0],")"))}function zn(e,t){const n=t.startPTS;if(i(n)){let i,r=0;t.sn>e.sn?(r=n-e.start,i=e):(r=e.start-n,i=t),i.duration!==r&&i.setDuration(r)}else if(t.sn>e.sn){e.cc===t.cc&&e.minEndPTS?t.setStart(e.start+(e.minEndPTS-e.start)):t.setStart(e.start+e.duration)}else t.setStart(Math.max(e.start-t.duration,0))}function jn(e,t,n,r,s,a,o){r-n<=0&&(o.warn("Fragment should have a positive duration",t),r=n+t.duration,a=s+t.duration);let l=n,c=r;const u=t.startPTS,h=t.endPTS;if(i(u)){const d=Math.abs(u-n);e&&d>e.totalduration?o.warn("media timestamps and playlist times differ by ".concat(d,"s for level ").concat(t.level," ").concat(e.url)):i(t.deltaPTS)?t.deltaPTS=Math.max(d,t.deltaPTS):t.deltaPTS=d,l=Math.max(n,u),n=Math.min(n,u),s=void 0!==t.startDTS?Math.min(s,t.startDTS):s,c=Math.min(r,h),r=Math.max(r,h),a=void 0!==t.endDTS?Math.max(a,t.endDTS):a}const d=n-t.start;0!==t.start&&t.setStart(n),t.setDuration(r-t.start),t.startPTS=n,t.maxStartPTS=l,t.startDTS=s,t.endPTS=r,t.minEndPTS=c,t.endDTS=a;const f=t.sn;if(!e||f<e.startSN||f>e.endSN)return 0;let p;const m=f-e.startSN,g=e.fragments;for(g[m]=t,p=m;p>0;p--)zn(g[p],g[p-1]);for(p=m;p<g.length-1;p++)zn(g[p],g[p+1]);return e.fragmentHint&&zn(g[g.length-1],e.fragmentHint),e.PTSKnown=e.alignedSliding=!0,d}function Gn(e,t,n){if(e===t)return;let r=null;const s=e.fragments;for(let i=s.length-1;i>=0;i--){const e=s[i].initSegment;if(e){r=e;break}}let a;e.fragmentHint&&delete e.fragmentHint.endPTS,function(e,t,n){const i=t.skippedSegments,r=Math.max(e.startSN,t.startSN)-t.startSN,s=(e.fragmentHint?1:0)+(i?t.endSN:Math.min(e.endSN,t.endSN))-t.startSN,a=t.startSN-e.startSN,o=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,l=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments;for(let c=r;c<=s;c++){const r=l[a+c];let s=o[c];if(i&&!s&&r&&(s=t.fragments[c]=r),r&&s){n(r,s,c,o);const i=r.relurl,a=s.relurl;if(i&&Jn(i,a))return void(t.playlistParsingError=Vn("media sequence mismatch ".concat(s.sn,":"),e,t,r,s));if(r.cc!==s.cc)return void(t.playlistParsingError=Vn("discontinuity sequence mismatch (".concat(r.cc,"!=").concat(s.cc,")"),e,t,r,s))}}}(e,t,(e,n,s,o)=>{if((!t.startCC||t.skippedSegments)&&n.cc!==e.cc){const i=e.cc-n.cc;for(let e=s;e<o.length;e++)o[e].cc+=i;t.endCC=o[o.length-1].cc}i(e.startPTS)&&i(e.endPTS)&&(n.setStart(n.startPTS=e.startPTS),n.startDTS=e.startDTS,n.maxStartPTS=e.maxStartPTS,n.endPTS=e.endPTS,n.endDTS=e.endDTS,n.minEndPTS=e.minEndPTS,n.setDuration(e.endPTS-e.startPTS),n.duration&&(a=n),t.PTSKnown=t.alignedSliding=!0),e.hasStreams&&(n.elementaryStreams=e.elementaryStreams),n.loader=e.loader,e.hasStats&&(n.stats=e.stats),e.initSegment&&(n.initSegment=e.initSegment,r=e.initSegment)});const o=t.fragments,l=t.fragmentHint?o.concat(t.fragmentHint):o;if(r&&l.forEach(e=>{var t;!e||e.initSegment&&e.initSegment.relurl!==(null==(t=r)?void 0:t.relurl)||(e.initSegment=r)}),t.skippedSegments){if(t.deltaUpdateFailed=o.some(e=>!e),t.deltaUpdateFailed){n.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let e=t.skippedSegments;e--;)o.shift();t.startSN=o[0].sn}else{t.canSkipDateRanges&&(t.dateRanges=function(e,t,n){const{dateRanges:i,recentlyRemovedDateranges:r}=t,s=v({},e);r&&r.forEach(e=>{delete s[e]});const a=Object.keys(s).length;if(!a)return i;return Object.keys(i).forEach(e=>{const t=s[e],r=new en(i[e].attr,t);r.isValid?(s[e]=r,t||(r.tagOrder+=a)):n.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'.concat(qe(i[e].attr),'"'))}),s}(e.dateRanges,t,n));const i=e.fragments.filter(e=>e.rawProgramDateTime);if(e.hasProgramDateTime&&!t.hasProgramDateTime)for(let e=1;e<l.length;e++)null===l[e].programDateTime&&Nn(l[e],l[e-1],i);Cn(i,t)}t.endCC=o[o.length-1].cc}if(!t.startCC){var c;const n=Xn(e,t.startSN-1);t.startCC=null!=(c=null==n?void 0:n.cc)?c:o[0].cc}!function(e,t,n){if(e&&t){let i=0;for(let r=0,s=e.length;r<=s;r++){const s=e[r],a=t[r+i];s&&a&&s.index===a.index&&s.fragment.sn===a.fragment.sn?n(s,a):i--}}}(e.partList,t.partList,(e,t)=>{t.elementaryStreams=e.elementaryStreams,t.stats=e.stats}),a?jn(t,a,a.startPTS,a.endPTS,a.startDTS,a.endDTS,n):Hn(e,t),o.length&&(t.totalduration=t.edge-o[0].start),t.driftStartTime=e.driftStartTime,t.driftStart=e.driftStart;const u=t.advancedDateTime;if(t.advanced&&u){const e=t.edge;t.driftStart||(t.driftStartTime=u,t.driftStart=e),t.driftEndTime=u,t.driftEnd=e}else t.driftEndTime=e.driftEndTime,t.driftEnd=e.driftEnd,t.advancedDateTime=e.advancedDateTime;-1===t.requestScheduled&&(t.requestScheduled=e.requestScheduled)}function Vn(e,t,n,i,r){return new Error("".concat(e," ").concat(r.url,"\nPlaylist starting @").concat(t.startSN,"\n").concat(t.m3u8,"\n\nPlaylist starting @").concat(n.startSN,"\n").concat(n.m3u8))}function Hn(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const i=t.startSN+t.skippedSegments-e.startSN,r=e.fragments,s=i>=0;let a=0;if(s&&i<r.length)a=r[i].start;else if(s&&t.startSN===e.endSN+1)a=e.fragmentEnd;else if(s&&n)a=e.fragmentStart+i*t.levelTargetDuration;else{if(t.skippedSegments||0!==t.fragmentStart)return;a=e.fragmentStart}Wn(t,a)}function Wn(e,t){if(t){const n=e.fragments;for(let i=e.skippedSegments;i<n.length;i++)n[i].addStart(t);e.fragmentHint&&e.fragmentHint.addStart(t)}}function Yn(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,n=1e3*e.targetduration;if(e.updated){const i=e.fragments,r=4;if(i.length&&n*r>t){const e=1e3*i[i.length-1].duration;e<n&&(n=e)}}else n/=2;return Math.round(n)}function Xn(e,t,n){if(!e)return null;let i=e.fragments[t-e.startSN];return i||(i=e.fragmentHint,i&&i.sn===t?i:t<e.startSN&&n&&n.sn===t?n:null)}function qn(e,t,n){return e?Kn(e.partList,t,n):null}function Kn(e,t,n){if(e)for(let i=e.length;i--;){const r=e[i];if(r.index===n&&r.fragment.sn===t)return r}return null}function Zn(e){e.forEach((e,t)=>{var n;null==(n=e.details)||n.fragments.forEach(e=>{e.level=t,e.initSegment&&(e.initSegment.level=t)})})}function Jn(e,t){return!(e===t||!t)&&Qn(e)!==Qn(t)}function Qn(e){return e.replace(/\?[^?]*$/,"")}function $n(e,t){for(let i=0,r=e.length;i<r;i++){var n;if((null==(n=e[i])?void 0:n.cc)===t)return e[i]}return null}function ei(e,t){const n=e.start+t;e.startPTS=n,e.setStart(n),e.endPTS=n+e.duration}function ti(e,t){const n=t.fragments;for(let i=0,r=n.length;i<r;i++)ei(n[i],e);t.fragmentHint&&ei(t.fragmentHint,e),t.alignedSliding=!0}function ni(e,t){if(!function(e,t){return!!(e&&t.startCC<e.endCC&&t.endCC>e.startCC)}(t,e))return;const n=Math.min(t.endCC,e.endCC),i=$n(t.fragments,n),r=$n(e.fragments,n);if(!i||!r)return;A.log("Aligning playlist at start of dicontinuity sequence ".concat(n));ti(i.start-r.start,e)}function ii(e,t){if(!e.hasProgramDateTime||!t.hasProgramDateTime)return;const n=e.fragments,i=t.fragments;if(!n.length||!i.length)return;let r,s;const a=Math.min(t.endCC,e.endCC);t.startCC<a&&e.startCC<a&&(r=$n(i,a),s=$n(n,a)),r&&s||(r=i[Math.floor(i.length/2)],s=$n(n,r.cc)||n[Math.floor(n.length/2)]);const o=r.programDateTime,l=s.programDateTime;if(!o||!l)return;ti((l-o)/1e3-(s.start-r.start),e)}function ri(e,t,n){si(e,t,n),e.addEventListener(t,n)}function si(e,t,n){e.removeEventListener(t,n)}const ai=function(e){let t="";const n=e.length;for(let i=0;i<n;i++)t+="[".concat(e.start(i).toFixed(3),"-").concat(e.end(i).toFixed(3),"]");return t},oi="STOPPED",li="IDLE",ci="KEY_LOADING",ui="FRAG_LOADING",hi="FRAG_LOADING_WAITING_RETRY",di="WAITING_TRACK",fi="PARSING",pi="PARSED",mi="ENDED",gi="ERROR",vi="WAITING_INIT_PTS",yi="WAITING_LEVEL";class bi extends zt{constructor(e,t,n,r,s){super(r,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=oi,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:e,fragCurrent:t,media:n,mediaBuffer:r,state:s}=this,a=n?n.currentTime:0,o=Vt.bufferInfo(r||n,a,e.maxBufferHole),l=!o.len;if(this.log("Media seeking to ".concat(i(a)?a.toFixed(3):a,", state: ").concat(s,", ").concat(l?"out of":"in"," buffer")),this.state===mi)this.resetLoadingState();else if(t){const n=e.maxFragLookUpTolerance,i=t.start-n,r=t.start+t.duration+n;if(l||r<o.start||i>o.end){const e=a>r;(a<i||e)&&(e&&t.loader&&(this.log("Cancelling fragment load for seek (sn: ".concat(t.sn,")")),t.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(n){this.fragmentTracker.removeFragmentsInRange(a,1/0,this.playlistType,!0);if(a>this.lastCurrentTime&&(this.lastCurrentTime=a),!this.loadingParts){const e=Math.max(o.end,a),t=this.shouldLoadParts(this.getLevelDetails(),e);t&&(this.log("LL-Part loading ON after seeking to ".concat(a.toFixed(2)," with buffer @").concat(e.toFixed(2))),this.loadingParts=t)}}this.hls.hasEnoughToStart||(this.log("Setting ".concat(l?"startPosition":"nextLoadPosition"," to ").concat(a," for seek without enough to start")),this.nextLoadPosition=a,l&&(this.startPosition=a)),l&&this.state===li&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=s,this.hls=e,this.fragmentLoader=new Ot(e.config),this.keyLoader=n,this.fragmentTracker=t,this.config=e.config,this.decrypter=new Dt(e.config)}registerListeners(){const{hls:e}=this;e.on(l.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(l.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(l.MANIFEST_LOADING,this.onManifestLoading,this),e.on(l.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(l.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(l.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(l.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(l.MANIFEST_LOADING,this.onManifestLoading,this),e.off(l.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(l.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===oi)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;null!=e&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=oi}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return-1===t&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const n=e.end||0,i=this.config.timelineOffset||0;if(n<=i)return!1;const r=e.buffered;this.config.maxBufferHole&&r&&r.length>1&&(e=Vt.bufferedInfo(r,e.start,0));const s=e.nextStart;if(s&&s>i&&s<t.edge)return!1;if(this.media.currentTime<e.start)return!1;const a=t.partList;if(null!=a&&a.length){const e=a[a.length-1];return Vt.isBuffered(this.media,e.start+e.duration/2)}const o=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(o)}getLevelDetails(){if(this.levels&&null!==this.levelLastLoaded)return this.levelLastLoaded.details}get timelineOffset(){const e=this.config.timelineOffset;var t;return e?(null==(t=this.getLevelDetails())?void 0:t.appliedTimelineOffset)||e:0}onMediaAttached(e,t){const n=this.media=this.mediaBuffer=t.media;ri(n,"seeking",this.onMediaSeeking),ri(n,"ended",this.onMediaEnded);const i=this.config;this.levels&&i.autoStartLoad&&this.state===oi&&this.startLoad(i.startPosition)}onMediaDetaching(e,t){const n=!!t.transferMedia,i=this.media;if(null!==i){if(i.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),si(i,"seeking",this.onMediaSeeking),si(i,"ended",this.onMediaEnded),this.keyLoader&&!n&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,n)return this.resetLoadingState(),void this.resetTransmuxer();this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=oi,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,n){this.startFragRequested=!0,this._loadFragForPlayback(e,t,n)}_loadFragForPlayback(e,t,n){this._doFragLoad(e,t,n,e=>{const t=e.frag;if(this.fragContextChanged(t))return this.warn("".concat(t.type," sn: ").concat(t.sn).concat(e.part?" part: "+e.part.index:""," of ").concat(this.fragInfo(t,!1,e.part),") was dropped during download.")),void this.fragmentTracker.removeFragment(t);t.stats.chunkCount++,this._handleFragmentLoadProgress(e)}).then(e=>{if(!e)return;const t=this.state,n=e.frag;this.fragContextChanged(n)?(t===ui||!this.fragCurrent&&t===fi)&&(this.fragmentTracker.removeFragment(n),this.state=li):("payload"in e&&(this.log("Loaded ".concat(n.type," sn: ").concat(n.sn," of ").concat(this.playlistLabel()," ").concat(n.level)),this.hls.trigger(l.FRAG_LOADED,e)),this._handleFragmentLoadComplete(e))}).catch(t=>{this.state!==oi&&this.state!==gi&&(this.warn("Frag error: ".concat((null==t?void 0:t.message)||t)),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:n}=this;if(n.getState(e)===St){const t=e.type,i=this.getFwdBufferInfo(this.mediaBuffer,t),r=Math.max(e.duration,i?i.len:this.config.maxBufferLength),s=this.backtrackFragment;(1===(s?e.sn-s.sn:0)||this.reduceMaxBufferLength(r,e.duration))&&n.removeFragment(e)}else 0===(null==(t=this.mediaBuffer)?void 0:t.buffered.length)?n.removeAllFragments():n.hasParts(e.type)&&(n.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),n.getState(e)===Et&&n.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return(null==t?void 0:t.live)&&"EVENT"!==t.type&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t){if(!(e-t))return;const n={startOffset:e,endOffset:t,type:arguments.length>2&&void 0!==arguments[2]?arguments[2]:null};this.hls.trigger(l.BUFFER_FLUSHING,n)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(e=>{const t=null==e?void 0:e.frag;if(!t||this.fragContextChanged(t)||!this.levels)throw new Error("init load aborted");return e}).then(e=>{const{hls:t}=this,{frag:n,payload:i}=e,r=n.decryptdata;if(i&&i.byteLength>0&&null!=r&&r.key&&r.iv&&sn(r.method)){const s=self.performance.now();return this.decrypter.decrypt(new Uint8Array(i),r.key.buffer,r.iv.buffer,an(r.method)).catch(e=>{throw t.trigger(l.ERROR,{type:a.MEDIA_ERROR,details:o.FRAG_DECRYPT_ERROR,fatal:!1,error:e,reason:e.message,frag:n}),e}).then(i=>{const r=self.performance.now();return t.trigger(l.FRAG_DECRYPTED,{frag:n,payload:i,stats:{tstart:s,tdecrypt:r}}),e.payload=i,this.completeInitSegmentLoad(e)})}return this.completeInitSegmentLoad(e)}).catch(t=>{this.state!==oi&&this.state!==gi&&(this.warn(t),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const n=e.frag.stats;this.state!==oi&&(this.state=li),e.frag.data=new Uint8Array(e.payload),n.parsing.start=n.buffering.start=self.performance.now(),n.parsing.end=n.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,t){var n,i;const r=e.tracks;if(r&&!t.encrypted&&(null!=(n=r.audio)&&n.encrypted||null!=(i=r.video)&&i.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const e=this.media,n=new Error("Encrypted track with no key in ".concat(this.fragInfo(t)," (media ").concat(e?"attached mediaKeys: "+e.mediaKeys:"detached",")"));return this.warn(n.message),!e||e.mediaKeys?!1:(this.hls.trigger(l.ERROR,{type:a.KEY_SYSTEM_ERROR,details:o.KEY_SYSTEM_NO_KEYS,fatal:!1,error:n,frag:t}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const n=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log("Buffered ".concat(e.type," sn: ").concat(e.sn).concat(t?" part: "+t.index:""," of ").concat(this.fragInfo(e,!1,t)," > buffer:").concat(n?ai(Vt.getBuffered(n)):"(detached)",")")),j(e)){var i;if(e.type!==f.SUBTITLE){const t=e.elementaryStreams;if(!Object.keys(t).some(e=>!!t[e]))return void(this.state=li)}const t=null==(i=this.levels)?void 0:i[e.level];null!=t&&t.fragmentError&&(this.log("Resetting level fragment error count of ".concat(t.fragmentError," on frag buffered")),t.fragmentError=0)}this.state=li}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:n,part:i,partsLoaded:r}=e,s=!r||0===r.length||r.some(e=>!e),a=new jt(n.level,n.sn,n.stats.chunkCount+1,0,i?i.index:-1,!s);t.flush(a)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3?arguments[3]:void 0;var s;this.fragCurrent=e;const a=t.details;if(!this.levels||!a)throw new Error("frag load aborted, missing level".concat(a?"":" detail","s"));let o=null;if(!e.encrypted||null!=(s=e.decryptdata)&&s.key)e.encrypted||(o=this.keyLoader.loadClear(e,a.encryptedFragments,this.startFragRequested),o&&this.log("[eme] blocking frag load until media-keys acquired"));else if(this.log("Loading key for ".concat(e.sn," of [").concat(a.startSN,"-").concat(a.endSN,"], ").concat(this.playlistLabel()," ").concat(e.level)),this.state=ci,this.fragCurrent=e,o=this.keyLoader.load(e).then(e=>{if(!this.fragContextChanged(e.frag))return this.hls.trigger(l.KEY_LOADED,e),this.state===ci&&(this.state=li),e}),this.hls.trigger(l.KEY_LOADING,{frag:e}),null===this.fragCurrent)return this.log("context changed in KEY_LOADING"),Promise.resolve(null);const c=this.fragPrevious;if(j(e)&&(!c||e.sn!==c.sn)){const n=this.shouldLoadParts(t.details,e.end);n!==this.loadingParts&&(this.log("LL-Part loading ".concat(n?"ON":"OFF"," loading sn ").concat(null==c?void 0:c.sn,"->").concat(e.sn)),this.loadingParts=n)}if(n=Math.max(e.start,n||0),this.loadingParts&&j(e)){const i=a.partList;if(i&&r){n>a.fragmentEnd&&a.fragmentHint&&(e=a.fragmentHint);const s=this.getNextPart(i,e,n);if(s>-1){const c=i[s];let u;return e=this.fragCurrent=c.fragment,this.log("Loading ".concat(e.type," sn: ").concat(e.sn," part: ").concat(c.index," (").concat(s,"/").concat(i.length-1,") of ").concat(this.fragInfo(e,!1,c),") cc: ").concat(e.cc," [").concat(a.startSN,"-").concat(a.endSN,"], target: ").concat(parseFloat(n.toFixed(3)))),this.nextLoadPosition=c.start+c.duration,this.state=ui,u=o?o.then(n=>!n||this.fragContextChanged(n.frag)?null:this.doFragPartsLoad(e,c,t,r)).catch(e=>this.handleFragLoadError(e)):this.doFragPartsLoad(e,c,t,r).catch(e=>this.handleFragLoadError(e)),this.hls.trigger(l.FRAG_LOADING,{frag:e,part:c,targetBufferTime:n}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):u}if(!e.url||this.loadedEndOfParts(i,n))return Promise.resolve(null)}}var u;if(j(e)&&this.loadingParts)this.log("LL-Part loading OFF after next part miss @".concat(n.toFixed(2)," Check buffer at sn: ").concat(e.sn," loaded parts: ").concat(null==(u=a.partList)?void 0:u.filter(e=>e.loaded).map(e=>"[".concat(e.start,"-").concat(e.end,"]")))),this.loadingParts=!1;else if(!e.url)return Promise.resolve(null);this.log("Loading ".concat(e.type," sn: ").concat(e.sn," of ").concat(this.fragInfo(e,!1),") cc: ").concat(e.cc," ").concat("["+a.startSN+"-"+a.endSN+"]",", target: ").concat(parseFloat(n.toFixed(3)))),i(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=ui;const h=this.config.progressive&&e.type!==f.SUBTITLE;let d;return d=h&&o?o.then(t=>!t||this.fragContextChanged(t.frag)?null:this.fragmentLoader.load(e,r)).catch(e=>this.handleFragLoadError(e)):Promise.all([this.fragmentLoader.load(e,h?r:void 0),o]).then(e=>{let[t]=e;return!h&&r&&r(t),t}).catch(e=>this.handleFragLoadError(e)),this.hls.trigger(l.FRAG_LOADING,{frag:e,targetBufferTime:n}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):d}doFragPartsLoad(e,t,n,i){return new Promise((r,s)=>{var a;const o=[],c=null==(a=n.details)?void 0:a.partList,u=t=>{this.fragmentLoader.loadPart(e,t,i).then(i=>{o[t.index]=i;const s=i.part;this.hls.trigger(l.FRAG_LOADED,i);const a=qn(n.details,e.sn,t.index+1)||Kn(c,e.sn,t.index+1);if(!a)return r({frag:e,part:s,partsLoaded:o});u(a)}).catch(s)};u(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;t.frag&&t.details===o.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):t.frag&&t.type===a.KEY_SYSTEM_ERROR?(t.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(t.frag)):this.hls.trigger(l.ERROR,t)}else this.hls.trigger(l.ERROR,{type:a.OTHER_ERROR,details:o.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==fi)return void(this.fragCurrent||this.state===oi||this.state===gi||(this.state=li));const{frag:n,part:i,level:r}=t,s=self.performance.now();n.stats.parsing.end=s,i&&(i.stats.parsing.end=s);const a=this.getLevelDetails(),o=a&&n.sn>a.endSN||this.shouldLoadParts(a,n.end);o!==this.loadingParts&&(this.log("LL-Part loading ".concat(o?"ON":"OFF"," after parsing segment ending @").concat(n.end.toFixed(2))),this.loadingParts=o),this.updateLevelTiming(n,i,r,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var n;const r=e.partList[0];if(r.fragment.type===f.SUBTITLE)return!1;if(t>=r.end+((null==(n=e.fragmentHint)?void 0:n.duration)||0)){var i;if((this.hls.hasEnoughToStart?(null==(i=this.media)?void 0:i.currentTime)||this.lastCurrentTime:this.getLoadPosition())>r.start-r.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:n}=this,{level:i,sn:r,part:s}=e;if(null==t||!t[i])return this.warn("Levels object was unset while buffering fragment ".concat(r," of ").concat(this.playlistLabel()," ").concat(i,". The current chunk will not be buffered.")),null;const a=t[i],o=a.details,l=s>-1?qn(o,r,s):null,c=l?l.fragment:Xn(o,r,n);return c?(n&&n!==c&&(c.stats=n.stats),{frag:c,part:l,level:a}):null}bufferFragmentData(e,t,n,i,r){if(this.state!==fi)return;const{data1:s,data2:a}=e;let o=s;if(a&&(o=ce(s,a)),!o.length)return;const c=this.initPTS[t.cc],u=c?-c.baseTime/c.timescale:void 0,h={type:e.type,frag:t,part:n,chunkMeta:i,offset:u,parent:t.type,data:o};if(this.hls.trigger(l.BUFFER_APPENDING,h),e.dropped&&e.independent&&!n){if(r)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!Vt.isBuffered(t,t.currentTime))return void this.flushMainBuffer(0,e.start);const n=t.currentTime,i=Vt.bufferInfo(t,n,0),r=e.duration,s=Math.min(2*this.config.maxFragLookUpTolerance,.25*r),a=Math.max(Math.min(e.start-s,i.end-s),n+s);e.start-a>s&&this.flushMainBuffer(a,e.start)}getFwdBufferInfo(e,t){var n;const r=this.getLoadPosition();if(!i(r))return null;const s=this.lastCurrentTime>r||null!=(n=this.media)&&n.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,r,t,s)}getFwdBufferInfoAtPos(e,t,n,i){const r=Vt.bufferInfo(e,t,i);if(0===r.len&&void 0!==r.nextStart){const s=this.fragmentTracker.getBufferedFrag(t,n);if(s&&(r.nextStart<=s.end||s.gap)){const n=Math.max(Math.min(r.nextStart,s.end)-t,i);return Vt.bufferInfo(e,t,n)}}return r}getMaxBufferLength(e){const{config:t}=this;let n;return n=e?Math.max(8*t.maxBufferSize/e,t.maxBufferLength):t.maxBufferLength,Math.min(n,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const n=this.config,i=Math.max(Math.min(e-t,n.maxBufferLength),t),r=Math.max(e-3*t,n.maxMaxBufferLength/2,i);return r>=i&&(n.maxMaxBufferLength=r,this.warn("Reduce max buffer length to ".concat(r,"s")),!0)}getAppendedFrag(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:f.MAIN;const n=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,t):null;return n&&"fragment"in n?n.fragment:n}getNextFragment(e,t){const n=t.fragments,i=n.length;if(!i)return null;const{config:r}=this,s=n[0].start,a=r.lowLatencyMode&&!!t.partList;let o=null;if(t.live){const n=r.initialLiveManifestSize;if(i<n)return this.warn("Not enough fragments to start playback (have: ".concat(i,", need: ").concat(n,")")),null;if(!t.PTSKnown&&!this.startFragRequested&&-1===this.startPosition||e<s){var l;a&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),o=this.getInitialLiveFragment(t);const n=this.hls.startPosition,i=this.hls.liveSyncPosition,r=o?(-1!==n&&n>=s?n:i)||o.start:e;this.log("Setting startPosition to ".concat(r," to match start frag at live edge. mainStart: ").concat(n," liveSyncPosition: ").concat(i," frag.start: ").concat(null==(l=o)?void 0:l.start)),this.startPosition=this.nextLoadPosition=r}}else e<=s&&(o=n[0]);if(!o){const n=this.loadingParts?t.partEnd:t.fragmentEnd;o=this.getFragmentAtPosition(e,n,t)}let c=this.filterReplacedPrimary(o,t);if(!c&&o){const e=o.sn-t.startSN;c=this.filterReplacedPrimary(n[e+1]||null,t)}return this.mapToInitFragWhenRequired(c)}isLoopLoading(e,t){const n=this.fragmentTracker.getState(e);return(n===Tt||n===Et&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,n,i,r){let s=null;if(e.gap&&(s=this.getNextFragment(this.nextLoadPosition,t),s&&!s.gap&&n.nextStart)){const e=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,n.nextStart,i,0);if(null!==e&&n.len+e.len>=r){const e=s.sn;return this.loopSn!==e&&(this.log('buffer full after gaps in "'.concat(i,'" playlist starting at sn: ').concat(e)),this.loopSn=e),null}}return this.loopSn=void 0,s}get primaryPrefetch(){if(xi(this.config)){var e;if(null==(e=this.hls.interstitialsManager)||null==(e=e.playingItem)?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(xi(this.config)&&e.type!==f.SUBTITLE){const n=this.hls.interstitialsManager,i=null==n?void 0:n.bufferingItem;if(i){const n=i.event;if(n){if(n.appendInPlace||Math.abs(e.start-i.start)>1||0===i.start)return null}else{if(e.end<=i.start&&!1===(null==t?void 0:t.live))return null;if(e.start>i.end&&i.nextEvent&&(i.nextEvent.appendInPlace||e.start-i.end>1))return null}}const r=null==n?void 0:n.playerQueue;if(r)for(let t=r.length;t--;){const n=r[t].interstitial;if(n.appendInPlace&&e.start>=n.startTime&&e.end<=n.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return null==e||!e.initSegment||e.initSegment.data||this.bitrateTest?e:e.initSegment}getNextPart(e,t,n){let i=-1,r=!1,s=!0;for(let a=0,o=e.length;a<o;a++){const o=e[a];if(s=s&&!o.independent,i>-1&&n<o.start)break;const l=o.loaded;l?i=-1:(r||(o.independent||s)&&o.fragment===t)&&(o.fragment!==t&&this.warn("Need buffer at ".concat(n," but next unloaded part starts at ").concat(o.start)),i=a),r=l}return i}loadedEndOfParts(e,t){let n;for(let i=e.length;i--;){if(n=e[i],!n.loaded)return!1;if(t>n.start)return!0}return!1}getInitialLiveFragment(e){const t=e.fragments,n=this.fragPrevious;let r=null;if(n){if(e.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: ".concat(n.programDateTime)),r=function(e,t,n){if(null===t||!Array.isArray(e)||!e.length||!i(t))return null;if(t<(e[0].programDateTime||0))return null;if(t>=(e[e.length-1].endProgramDateTime||0))return null;for(let i=0;i<e.length;++i){const r=e[i];if(ot(t,n,r))return r}return null}(t,n.endProgramDateTime,this.config.maxFragLookUpTolerance)),!r){const i=n.sn+1;if(i>=e.startSN&&i<=e.endSN){const s=t[i-e.startSN];n.cc===s.cc&&(r=s,this.log("Live playlist, switching playlist, load frag with next SN: ".concat(r.sn)))}r||(r=lt(e,n.cc,n.end),r&&this.log("Live playlist, switching playlist, load frag with same CC: ".concat(r.sn)))}}else{const t=this.hls.liveSyncPosition;null!==t&&(r=this.getFragmentAtPosition(t,this.bitrateTest?e.fragmentEnd:e.edge,e))}return r}getFragmentAtPosition(e,t,n){const{config:i}=this;let{fragPrevious:r}=this,{fragments:s,endSN:a}=n;const{fragmentHint:o}=n,{maxFragLookUpTolerance:l}=i,c=n.partList,u=!!(this.loadingParts&&null!=c&&c.length&&o);let h;if(u&&!this.bitrateTest&&c[c.length-1].fragment.sn===o.sn&&(s=s.concat(o),a=o.sn),e<t){var d;h=st(r,s,e,e<this.lastCurrentTime||e>t-l||null!=(d=this.media)&&d.paused||!this.startFragRequested?0:l)}else h=s[s.length-1];if(h){const e=h.sn-n.startSN,t=this.fragmentTracker.getState(h);if((t===Tt||t===Et&&h.gap)&&(r=h),r&&h.sn===r.sn&&(!u||c[0].fragment.sn>h.sn||!n.live)){if(h.level===r.level){const t=s[e+1];h=h.sn<a&&this.fragmentTracker.getState(t)!==Tt?t:null}}}return h}alignPlaylists(e,t,n){const r=e.fragments.length;if(!r)return this.warn("No fragments in live playlist"),0;const s=e.fragmentStart,a=!t,o=e.alignedSliding&&i(s);if(a||!o&&!s){!function(e,t){e&&(ni(t,e),t.alignedSliding||ii(t,e),t.alignedSliding||t.skippedSegments||Hn(e,t,!1))}(n,e);const i=e.fragmentStart;return this.log("Live playlist sliding: ".concat(i.toFixed(2)," start-sn: ").concat(t?t.startSN:"na","->").concat(e.startSN," fragments: ").concat(r)),i}return s}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,3*e.partTarget)}setStartPosition(e,t){let n=this.startPosition;n<t&&(n=-1);const r=this.timelineOffset;if(-1===n){const s=null!==this.startTimeOffset,a=s?this.startTimeOffset:e.startTimeOffset;null!==a&&i(a)?(n=t+a,a<0&&(n+=e.edge),n=Math.min(Math.max(t,n),t+e.totalduration),this.log("Setting startPosition to ".concat(n," for start time offset ").concat(a," found in ").concat(s?"multivariant":"media"," playlist")),this.startPosition=n):e.live?(n=this.hls.liveSyncPosition||t,this.log("Setting startPosition to -1 to start at live edge ".concat(n)),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=n=0),this.lastCurrentTime=n+r}this.nextLoadPosition=n+r}getLoadPosition(){var e;const{media:t}=this;let n=0;return null!=(e=this.hls)&&e.hasEnoughToStart&&t?n=t.currentTime:this.nextLoadPosition>=0&&(n=this.nextLoadPosition),n}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&j(e)&&e.stats.aborted&&(this.log("Fragment ".concat(e.sn).concat(t?" part "+t.index:""," of ").concat(this.playlistLabel()," ").concat(e.level," was aborted")),this.resetFragmentLoading(e))}resetFragmentLoading(e){this.fragCurrent&&(this.fragContextChanged(e)||this.state===hi)||(this.state=li)}onFragmentOrKeyLoadError(e,t){var n;if(t.chunkMeta&&!t.frag){const e=this.getCurrentContext(t.chunkMeta);e&&(t.frag=e.frag)}const i=t.frag;if(!i||i.type!==e||!this.levels)return;var r;if(this.fragContextChanged(i))return void this.warn("Frag load error must match current frag to retry ".concat(i.url," > ").concat(null==(r=this.fragCurrent)?void 0:r.url));const s=t.details===o.FRAG_GAP;s&&this.fragmentTracker.fragBuffered(i,!0);const a=t.errorAction;if(!a)return void(this.state=gi);const{action:l,flags:c,retryCount:u=0,retryConfig:h}=a,d=!!h,f=d&&l===vt.RetryRequest,p=d&&!a.resolved&&c===yt.MoveAllAlternatesMatchingHost,m=null==(n=this.hls.latestLevelDetails)?void 0:n.live;if(!f&&p&&j(i)&&!i.endList&&m&&!ht(t))this.resetFragmentErrors(e),this.treatAsGap(i),a.resolved=!0;else if((f||p)&&u<h.maxNumRetry){var g;const n=gt(null==(g=t.response)?void 0:g.code),r=ft(h,u);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+r,this.state=hi,a.resolved=!0,n)return this.log("Waiting for connection (offline)"),this.retryDate=1/0,void(t.reason="offline");this.warn("Fragment ".concat(i.sn," of ").concat(e," ").concat(i.level," errored with ").concat(t.details,", retrying loading ").concat(u+1,"/").concat(h.maxNumRetry," in ").concat(r,"ms"))}else if(h){if(this.resetFragmentErrors(e),!(u<h.maxNumRetry))return void this.warn("".concat(t.details," reached or exceeded max retry (").concat(u,")"));s||l===vt.RemoveAlternatePermanently||(a.resolved=!0)}else l===vt.SendAlternateToPenaltyBox?this.state=yi:this.state=gi;this.tickImmediate()}checkRetryDate(){const e=self.performance.now(),t=this.retryDate,n=t===1/0;(!t||e>=t||n&&!gt(0))&&(n&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=li)}reduceLengthAndFlushBuffer(e){if(this.state===fi||this.state===pi){const t=e.frag,n=e.parent,i=this.getFwdBufferInfo(this.mediaBuffer,n),r=i&&i.len>.5;r&&this.reduceMaxBufferLength(i.len,(null==t?void 0:t.duration)||10);const s=!r;return s&&this.warn("Buffer full error while media.currentTime (".concat(this.getLoadPosition(),") is not buffered, flush ").concat(n," buffer")),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),s}return!1}resetFragmentErrors(e){e===f.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==oi&&(this.state=li)}afterBufferFlushed(e,t,n){if(!e)return;const i=Vt.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,i,n),this.state===mi&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==oi&&(this.state=li)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const e=this.levelLastLoaded,t=e?e.details:null;null!=t&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log("Loading context changed while buffering sn ".concat(e.sn," of ").concat(this.playlistLabel()," ").concat(-1===e.level?"<removed>":e.level,". This chunk will not be buffered.")),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,n,i){const r=n.details;if(!r)return void this.warn("level.details undefined");if(!Object.keys(e.elementaryStreams).reduce((t,s)=>{const a=e.elementaryStreams[s];if(a){const o=a.endPTS-a.startPTS;if(o<=0)return this.warn("Could not parse fragment ".concat(e.sn," ").concat(s," duration reliably (").concat(o,")")),t||!1;const c=i?0:jn(r,e,a.startPTS,a.endPTS,a.startDTS,a.endDTS,this);return this.hls.trigger(l.LEVEL_PTS_UPDATED,{details:r,level:n,drift:c,type:s,frag:e,start:a.startPTS,end:a.endPTS}),!0}return t},!1)){var s;const t=null===(null==(s=this.transmuxer)?void 0:s.error);if((0===n.fragmentError||t&&(n.fragmentError<2||e.endList))&&this.treatAsGap(e,n),t){const t=new Error("Found no media in fragment ".concat(e.sn," of ").concat(this.playlistLabel()," ").concat(e.level," resetting transmuxer to fallback to playlist timing"));if(this.warn(t.message),this.hls.trigger(l.ERROR,{type:a.MEDIA_ERROR,details:o.FRAG_PARSING_ERROR,fatal:!1,error:t,frag:e,reason:"Found no media in msn ".concat(e.sn," of ").concat(this.playlistLabel(),' "').concat(n.url,'"')}),!this.hls)return;this.resetTransmuxer()}}this.state=pi,this.log("Parsed ".concat(e.type," sn: ").concat(e.sn).concat(t?" part: "+t.index:""," of ").concat(this.fragInfo(e,!1,t),")")),this.hls.trigger(l.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===f.MAIN?"level":"track"}fragInfo(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0;var i,r;return"".concat(this.playlistLabel()," ").concat(e.level," (").concat(n?"part":"frag",":[").concat((null!=(i=t&&!n?e.startPTS:(n||e).start)?i:NaN).toFixed(3),"-").concat((null!=(r=t&&!n?e.endPTS:(n||e).end)?r:NaN).toFixed(3),"]").concat(n&&"main"===e.type?"INDEPENDENT="+(n.independent?"YES":"NO"):"")}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;null==(e=this.transmuxer)||e.reset()}recoverWorkerError(e){"demuxerWorker"===e.event&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log("".concat(t,"->").concat(e)))}get state(){return this._state}}function xi(e){return!!e.interstitialsController&&!1!==e.enableInterstitialPlayback}class _i{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let n;return e.length?(n=1===e.length?e[0]:function(e,t){const n=new Uint8Array(t);let i=0;for(let r=0;r<e.length;r++){const t=e[r];n.set(t,i),i+=t.length}return n}(e,t),this.reset(),n):new Uint8Array(0)}reset(){this.chunks.length=0,this.dataLength=0}}var Si,Ei={exports:{}};var Ti=(Si||(Si=1,function(e){var t=Object.prototype.hasOwnProperty,n="~";function i(){}function r(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function s(e,t,i,s,a){if("function"!==typeof i)throw new TypeError("The listener must be a function");var o=new r(i,s||e,a),l=n?n+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function a(e,t){0===--e._eventsCount?e._events=new i:delete e._events[t]}function o(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(n=!1)),o.prototype.eventNames=function(){var e,i,r=[];if(0===this._eventsCount)return r;for(i in e=this._events)t.call(e,i)&&r.push(n?i.slice(1):i);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},o.prototype.listeners=function(e){var t=n?n+e:e,i=this._events[t];if(!i)return[];if(i.fn)return[i.fn];for(var r=0,s=i.length,a=new Array(s);r<s;r++)a[r]=i[r].fn;return a},o.prototype.listenerCount=function(e){var t=n?n+e:e,i=this._events[t];return i?i.fn?1:i.length:0},o.prototype.emit=function(e,t,i,r,s,a){var o=n?n+e:e;if(!this._events[o])return!1;var l,c,u=this._events[o],h=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),h){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,i),!0;case 4:return u.fn.call(u.context,t,i,r),!0;case 5:return u.fn.call(u.context,t,i,r,s),!0;case 6:return u.fn.call(u.context,t,i,r,s,a),!0}for(c=1,l=new Array(h-1);c<h;c++)l[c-1]=arguments[c];u.fn.apply(u.context,l)}else{var d,f=u.length;for(c=0;c<f;c++)switch(u[c].once&&this.removeListener(e,u[c].fn,void 0,!0),h){case 1:u[c].fn.call(u[c].context);break;case 2:u[c].fn.call(u[c].context,t);break;case 3:u[c].fn.call(u[c].context,t,i);break;case 4:u[c].fn.call(u[c].context,t,i,r);break;default:if(!l)for(d=1,l=new Array(h-1);d<h;d++)l[d-1]=arguments[d];u[c].fn.apply(u[c].context,l)}}return!0},o.prototype.on=function(e,t,n){return s(this,e,t,n,!1)},o.prototype.once=function(e,t,n){return s(this,e,t,n,!0)},o.prototype.removeListener=function(e,t,i,r){var s=n?n+e:e;if(!this._events[s])return this;if(!t)return a(this,s),this;var o=this._events[s];if(o.fn)o.fn!==t||r&&!o.once||i&&o.context!==i||a(this,s);else{for(var l=0,c=[],u=o.length;l<u;l++)(o[l].fn!==t||r&&!o[l].once||i&&o[l].context!==i)&&c.push(o[l]);c.length?this._events[s]=1===c.length?c[0]:c:a(this,s)}return this},o.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&a(this,t)):(this._events=new i,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=n,o.EventEmitter=o,e.exports=o}(Ei)),Ei.exports),wi=P(Ti);const Ai="1.6.15",Mi={};function Ri(e,t){return t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128}function Ci(e,t){return t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128}function Li(e,t){let n=0;return n=(127&e[t])<<21,n|=(127&e[t+1])<<14,n|=(127&e[t+2])<<7,n|=127&e[t+3],n}function Ii(e,t){const n=t;let i=0;for(;Ci(e,t);){i+=10;i+=Li(e,t+6),Ri(e,t+10)&&(i+=10),t+=i}if(i>0)return e.subarray(n,n+i)}function Pi(e,t){return 255===e[t]&&240===(246&e[t+1])}function ki(e,t){return 1&e[t+1]?7:9}function Di(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function Ni(e,t){return t+1<e.length&&Pi(e,t)}function Oi(e,t){if(Ni(e,t)){const n=ki(e,t);if(t+n>=e.length)return!1;const i=Di(e,t);if(i<=n)return!1;const r=t+i;return r===e.length||Ni(e,r)}return!1}function Fi(e,t,n,i,r){if(!e.samplerate){const s=function(e,t,n,i){const r=t[n+2],s=r>>2&15;if(s>12){const t=new Error("invalid ADTS sampling index:".concat(s));return void e.emit(l.ERROR,l.ERROR,{type:a.MEDIA_ERROR,details:o.FRAG_PARSING_ERROR,fatal:!0,error:t,reason:t.message})}const c=1+(r>>6&3),u=t[n+3]>>6&3|(1&r)<<2,h="mp4a.40."+c,d=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350][s];let f=s;5!==c&&29!==c||(f-=3);const p=[c<<3|(14&f)>>1,(1&f)<<7|u<<3];return A.log("manifest codec:".concat(i,", parsed codec:").concat(h,", channels:").concat(u,", rate:").concat(d," (ADTS object type:").concat(c," sampling index:").concat(s,")")),{config:p,samplerate:d,channelCount:u,codec:h,parsedCodec:h,manifestCodec:i}}(t,n,i,r);if(!s)return;v(e,s)}}function Ui(e){return 9216e4/e}function Bi(e,t,n,i,r){const s=i+r*Ui(e.samplerate),a=function(e,t){const n=ki(e,t);if(t+n<=e.length){const i=Di(e,t)-n;if(i>0)return{headerLength:n,frameLength:i}}}(t,n);let o;if(a){const{frameLength:i,headerLength:r}=a,l=r+i,c=Math.max(0,n+l-t.length);c?(o=new Uint8Array(l-r),o.set(t.subarray(n+r,t.length),0)):o=t.subarray(n+r,n+l);const u={unit:o,pts:s};return c||e.samples.push(u),{sample:u,length:l,missing:c}}const l=t.length-n;o=new Uint8Array(l),o.set(t.subarray(n,t.length),0);return{sample:{unit:o,pts:s},length:l,missing:-1}}function zi(e,t){return Ci(e,t)&&Li(e,t+6)+10<=e.length-t}function ji(e){return function(e,t,n,i){const r=function(e){return e instanceof ArrayBuffer?e:e.buffer}(e);let s=1;"BYTES_PER_ELEMENT"in i&&(s=i.BYTES_PER_ELEMENT);const a=(h=e,h&&h.buffer instanceof ArrayBuffer&&void 0!==h.byteLength&&void 0!==h.byteOffset?e.byteOffset:0),o=(a+e.byteLength)/s,l=(a+t)/s,c=Math.floor(Math.max(0,Math.min(l,o))),u=Math.floor(Math.min(c+Math.max(n,0),o));var h;return new i(r,c,u-c)}(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0,Uint8Array)}function Gi(e){const t={key:e.type,description:"",data:"",mimeType:null,pictureType:null};if(e.size<2)return;if(3!==e.data[0])return void console.log("Ignore frame with unrecognized character encoding");const n=e.data.subarray(1).indexOf(0);if(-1===n)return;const i=C(ji(e.data,1,n)),r=e.data[2+n],s=e.data.subarray(3+n).indexOf(0);if(-1===s)return;const a=C(ji(e.data,3+n,s));let o;return o="--\x3e"===i?C(ji(e.data,4+n+s)):function(e){return e instanceof ArrayBuffer?e:0==e.byteOffset&&e.byteLength==e.buffer.byteLength?e.buffer:new Uint8Array(e).buffer}(e.data.subarray(4+n+s)),t.mimeType=i,t.pictureType=r,t.description=a,t.data=o,t}function Vi(e){return"PRIV"===e.type?function(e){if(e.size<2)return;const t=C(e.data,!0),n=new Uint8Array(e.data.subarray(t.length+1));return{key:e.type,info:t,data:n.buffer}}(e):"W"===e.type[0]?function(e){if("WXXX"===e.type){if(e.size<2)return;let t=1;const n=C(e.data.subarray(t),!0);t+=n.length+1;const i=C(e.data.subarray(t));return{key:e.type,info:n,data:i}}const t=C(e.data);return{key:e.type,info:"",data:t}}(e):"APIC"===e.type?Gi(e):function(e){if(e.size<2)return;if("TXXX"===e.type){let t=1;const n=C(e.data.subarray(t),!0);t+=n.length+1;const i=C(e.data.subarray(t));return{key:e.type,info:n,data:i}}const t=C(e.data.subarray(1));return{key:e.type,info:"",data:t}}(e)}function Hi(e){const t=String.fromCharCode(e[0],e[1],e[2],e[3]),n=Li(e,4);return{type:t,size:n,data:e.subarray(10,10+n)}}function Wi(e){let t=0;const n=[];for(;Ci(e,t);){const i=Li(e,t+6);e[t+5]>>6&1&&(t+=10),t+=10;const r=t+i;for(;t+10<r;){const i=Hi(e.subarray(t)),r=Vi(i);r&&n.push(r),t+=i.size+10}Ri(e,t)&&(t+=10)}return n}function Yi(e){return e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info}function Xi(e){if(8===e.data.byteLength){const t=new Uint8Array(e.data),n=1&t[3];let i=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return i/=45,n&&(i+=47721858.84),Math.round(i)}}function qi(e){const t=Wi(e);for(let n=0;n<t.length;n++){const e=t[n];if(Yi(e))return Xi(e)}}let Ki=function(e){return e.audioId3="org.id3",e.dateRange="com.apple.quicktime.HLS",e.emsg="https://aomedia.org/emsg/ID3",e.misbklv="urn:misb:KLV:bin:1910.1",e}({});function Zi(){return{type:arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",id:-1,pid:-1,inputTimeScale:arguments.length>1&&void 0!==arguments[1]?arguments[1]:9e4,sequenceNumber:-1,samples:[],dropped:0}}class Ji{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,n,i){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,n){}demux(e,t){this.cachedData&&(e=ce(this.cachedData,e),this.cachedData=null);let n,r=Ii(e,0),s=r?r.length:0;const a=this._audioTrack,o=this._id3Track,l=r?qi(r):void 0,c=e.length;for((null===this.basePTS||0===this.frameIndex&&i(l))&&(this.basePTS=Qi(l,t,this.initPTS),this.lastPTS=this.basePTS),null===this.lastPTS&&(this.lastPTS=this.basePTS),r&&r.length>0&&o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:Ki.audioId3,duration:Number.POSITIVE_INFINITY});s<c;){if(this.canParse(e,s)){const t=this.appendFrame(a,e,s);t?(this.frameIndex++,this.lastPTS=t.sample.pts,s+=t.length,n=s):s=c}else zi(e,s)?(r=Ii(e,s),o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:Ki.audioId3,duration:Number.POSITIVE_INFINITY}),s+=r.length,n=s):s++;if(s===c&&n!==c){const t=e.slice(n);this.cachedData?this.cachedData=ce(this.cachedData,t):this.cachedData=t}}return{audioTrack:a,videoTrack:Zi(),id3Track:o,textTrack:Zi()}}demuxSampleAes(e,t,n){return Promise.reject(new Error("[".concat(this,"] This demuxer does not support Sample-AES decryption")))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:Zi(),id3Track:this._id3Track,textTrack:Zi()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const Qi=(e,t,n)=>{if(i(e))return 90*e;return 9e4*t+(n?9e4*n.baseTime/n.timescale:0)};let $i=null;const er=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],tr=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],nr=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],ir=[0,1,1,4];function rr(e,t,n,i,r){if(n+24>t.length)return;const s=sr(t,n);if(s&&n+s.frameLength<=t.length){const a=i+r*(9e4*s.samplesPerFrame/s.sampleRate),o={unit:t.subarray(n,n+s.frameLength),pts:a,dts:a};return e.config=[],e.channelCount=s.channelCount,e.samplerate=s.sampleRate,e.samples.push(o),{sample:o,length:s.frameLength,missing:0}}}function sr(e,t){const n=e[t+1]>>3&3,i=e[t+1]>>1&3,r=e[t+2]>>4&15,s=e[t+2]>>2&3;if(1!==n&&0!==r&&15!==r&&3!==s){const a=e[t+2]>>1&1,o=e[t+3]>>6,l=1e3*er[14*(3===n?3-i:3===i?3:4)+r-1],c=tr[3*(3===n?0:2===n?1:2)+s],u=3===o?1:2,h=nr[n][i],d=ir[i],f=8*h*d,p=Math.floor(h*l/c+a)*d;if(null===$i){const e=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);$i=e?parseInt(e[1]):0}return!!$i&&$i<=87&&2===i&&l>=224e3&&0===o&&(e[t+3]=128|e[t+3]),{sampleRate:c,channelCount:u,frameLength:p,samplesPerFrame:f}}}function ar(e,t){return 255===e[t]&&224===(224&e[t+1])&&0!==(6&e[t+1])}function or(e,t){return t+1<e.length&&ar(e,t)}function lr(e,t){if(t+1<e.length&&ar(e,t)){const n=4,i=sr(e,t);let r=n;null!=i&&i.frameLength&&(r=i.frameLength);const s=t+r;return s===e.length||or(e,s)}return!1}const cr=(e,t)=>{let n=0,i=5;t+=i;const r=new Uint32Array(1),s=new Uint32Array(1),a=new Uint8Array(1);for(;i>0;){a[0]=e[t];const o=Math.min(i,8),l=8-o;s[0]=4278190080>>>24+l<<l,r[0]=(a[0]&s[0])>>l,n=n?n<<o|r[0]:r[0],t+=1,i-=o}return n};class ur extends Ji{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,n,i){super.resetInitSegment(e,t,n,i),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,n){const i=hr(e,t,n,this.basePTS,this.frameIndex);if(-1!==i){return{sample:e.samples[e.samples.length-1],length:i,missing:0}}}static probe(e){if(!e)return!1;const t=Ii(e,0);if(!t)return!1;const n=t.length;return 11===e[n]&&119===e[n+1]&&void 0!==qi(t)&&cr(e,n)<16}}function hr(e,t,n,i,r){if(n+8>t.length)return-1;if(11!==t[n]||119!==t[n+1])return-1;const s=t[n+4]>>6;if(s>=3)return-1;const a=[48e3,44100,32e3][s],o=63&t[n+4],l=2*[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][3*o+s];if(n+l>t.length)return-1;const c=t[n+6]>>5;let u=0;2===c?u+=2:(1&c&&1!==c&&(u+=2),4&c&&(u+=2));const h=(t[n+6]<<8|t[n+7])>>12-u&1,d=[2,1,2,3,3,4,4,5][c]+h,f=t[n+5]>>3,p=7&t[n+5],m=new Uint8Array([s<<6|f<<1|p>>2,(3&p)<<6|c<<3|h<<2|o>>4,o<<4&224]),g=i+r*(1536/a*9e4),v=t.subarray(n,n+l);return e.config=m,e.channelCount=d,e.samplerate=a,e.samples.push({unit:v,pts:g}),l}const dr=/\/emsg[-/]ID3/i;function fr(e,t){return i(e.presentationTime)?e.presentationTime/e.timeScale:t+e.presentationTimeDelta/e.timeScale}class pr{constructor(e,t,n){this.keyData=void 0,this.decrypter=void 0,this.keyData=n,this.decrypter=new Dt(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,Ct)}decryptAacSample(e,t,n){const i=e[t].unit;if(i.length<=16)return;const r=i.subarray(16,i.length-i.length%16),s=r.buffer.slice(r.byteOffset,r.byteOffset+r.length);this.decryptBuffer(s).then(r=>{const s=new Uint8Array(r);i.set(s,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,n)}).catch(n)}decryptAacSamples(e,t,n){for(;;t++){if(t>=e.length)return void n();if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,n),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=16*Math.floor((e.length-48)/160)+16,n=new Int8Array(t);let i=0;for(let r=32;r<e.length-16;r+=160,i+=16)n.set(e.subarray(r,r+16),i);return n}getAvcDecryptedUnit(e,t){const n=new Uint8Array(t);let i=0;for(let r=32;r<e.length-16;r+=160,i+=16)e.set(n.subarray(i,i+16),r);return e}decryptAvcSample(e,t,n,i,r){const s=pe(r.data),a=this.getAvcEncryptedData(s);this.decryptBuffer(a.buffer).then(a=>{r.data=this.getAvcDecryptedUnit(s,a),this.decrypter.isSync()||this.decryptAvcSamples(e,t,n+1,i)}).catch(i)}decryptAvcSamples(e,t,n,i){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,n=0){if(t>=e.length)return void i();const r=e[t].units;for(;!(n>=r.length);n++){const s=r[n];if(!(s.data.length<=48||1!==s.type&&5!==s.type)&&(this.decryptAvcSample(e,t,n,i,s),!this.decrypter.isSync()))return}}}}class mr{constructor(){this.VideoSample=null}createVideoSample(e,t,n){return{key:e,frame:!1,pts:t,dts:n,units:[],length:0}}getLastNalUnit(e){var t;let n,i=this.VideoSample;if(i&&0!==i.units.length||(i=e[e.length-1]),null!=(t=i)&&t.units){const e=i.units;n=e[e.length-1]}return n}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(void 0===e.pts){const n=t.samples,i=n.length;if(!i)return void t.dropped++;{const t=n[i-1];e.pts=t.pts,e.dts=t.dts}}t.samples.push(e)}}parseNALu(e,t,n){const i=t.byteLength;let r=e.naluState||0;const s=r,a=[];let o,l,c,u=0,h=-1,d=0;for(-1===r&&(h=0,d=this.getNALuType(t,0),r=0,u=1);u<i;)if(o=t[u++],r)if(1!==r)if(o)if(1===o){if(l=u-r-1,h>=0){const e={data:t.subarray(h,l),type:d};a.push(e)}else{const n=this.getLastNalUnit(e.samples);n&&(s&&u<=4-s&&n.state&&(n.data=n.data.subarray(0,n.data.byteLength-s)),l>0&&(n.data=ce(n.data,t.subarray(0,l)),n.state=0))}u<i?(c=this.getNALuType(t,u),h=u,d=c,r=0):r=-1}else r=0;else r=3;else r=o?0:2;else r=o?0:1;if(h>=0&&r>=0){const e={data:t.subarray(h,i),type:d,state:r};a.push(e)}if(0===a.length){const n=this.getLastNalUnit(e.samples);n&&(n.data=ce(n.data,t))}return e.naluState=r,a}}class gr{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,n=e.byteLength-t,i=new Uint8Array(4),r=Math.min(4,t);if(0===r)throw new Error("no bytes available");i.set(e.subarray(n,n+r)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=8*r,this.bytesAvailable-=r}skipBits(e){let t;e=Math.min(e,8*this.bytesAvailable+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(t=(e-=this.bitsAvailable)>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const n=this.word>>>32-t;if(e>32&&A.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else{if(!(this.bytesAvailable>0))throw new Error("no bits available");this.loadWord()}return t=e-t,t>0&&this.bitsAvailable?n<<t|this.readBits(t):n}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(0!==(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return 1===this.readBits(1)}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class vr extends mr{parsePES(e,t,n,i){const r=this.parseNALu(e,n.data,i);let s,a=this.VideoSample,o=!1;n.data=null,a&&r.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),r.forEach(i=>{var r,l;switch(i.type){case 1:{let t=!1;s=!0;const r=i.data;if(o&&r.length>4){const e=this.readSliceType(r);2!==e&&4!==e&&7!==e&&9!==e||(t=!0)}var c;if(t)null!=(c=a)&&c.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null);a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),a.frame=!0,a.key=t;break}case 5:s=!0,null!=(r=a)&&r.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),a.key=!0,a.frame=!0;break;case 6:s=!0,fe(i.data,1,n.pts,t.samples);break;case 7:{var u,h;s=!0,o=!0;const t=i.data,n=this.readSPS(t);if(!e.sps||e.width!==n.width||e.height!==n.height||(null==(u=e.pixelRatio)?void 0:u[0])!==n.pixelRatio[0]||(null==(h=e.pixelRatio)?void 0:h[1])!==n.pixelRatio[1]){e.width=n.width,e.height=n.height,e.pixelRatio=n.pixelRatio,e.sps=[t];const i=t.subarray(1,4);let r="avc1.";for(let e=0;e<3;e++){let t=i[e].toString(16);t.length<2&&(t="0"+t),r+=t}e.codec=r}break}case 8:s=!0,e.pps=[i.data];break;case 9:s=!0,e.audFound=!0,null!=(l=a)&&l.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts));break;case 12:s=!0;break;default:s=!1}if(a&&s){a.units.push(i)}}),i&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}getNALuType(e,t){return 31&e[t]}readSliceType(e){const t=new gr(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let n,i=8,r=8;for(let s=0;s<e;s++)0!==r&&(n=t.readEG(),r=(i+n+256)%256),i=0===r?i:r}readSPS(e){const t=new gr(e);let n,i,r,s=0,a=0,o=0,l=0;const c=t.readUByte.bind(t),u=t.readBits.bind(t),h=t.readUEG.bind(t),d=t.readBoolean.bind(t),f=t.skipBits.bind(t),p=t.skipEG.bind(t),m=t.skipUEG.bind(t),g=this.skipScalingList.bind(this);c();const v=c();if(u(5),f(3),c(),m(),100===v||110===v||122===v||244===v||44===v||83===v||86===v||118===v||128===v){const e=h();if(3===e&&f(1),m(),m(),f(1),d())for(i=3!==e?8:12,r=0;r<i;r++)d()&&g(r<6?16:64,t)}m();const y=h();if(0===y)h();else if(1===y)for(f(1),p(),p(),n=h(),r=0;r<n;r++)p();m(),f(1);const b=h(),x=h(),_=u(1);0===_&&f(1),f(1),d()&&(s=h(),a=h(),o=h(),l=h());let S=[1,1];if(d()&&d()){switch(c()){case 1:S=[1,1];break;case 2:S=[12,11];break;case 3:S=[10,11];break;case 4:S=[16,11];break;case 5:S=[40,33];break;case 6:S=[24,11];break;case 7:S=[20,11];break;case 8:S=[32,11];break;case 9:S=[80,33];break;case 10:S=[18,11];break;case 11:S=[15,11];break;case 12:S=[64,33];break;case 13:S=[160,99];break;case 14:S=[4,3];break;case 15:S=[3,2];break;case 16:S=[2,1];break;case 255:S=[c()<<8|c(),c()<<8|c()]}}return{width:Math.ceil(16*(b+1)-2*s-2*a),height:(2-_)*(x+1)*16-(_?2:4)*(o+l),pixelRatio:S}}}class yr extends mr{constructor(){super(...arguments),this.initVPS=null}parsePES(e,t,n,i){const r=this.parseNALu(e,n.data,i);let s,a=this.VideoSample,o=!1;n.data=null,a&&r.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),r.forEach(i=>{var r,l;switch(i.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:a||(a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),a.frame=!0,s=!0;break;case 16:case 17:case 18:case 21:var c;if(s=!0,o)null!=(c=a)&&c.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null);a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),a.key=!0,a.frame=!0;break;case 19:case 20:s=!0,null!=(r=a)&&r.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),a.key=!0,a.frame=!0;break;case 39:s=!0,fe(i.data,2,n.pts,t.samples);break;case 32:s=!0,e.vps||("object"!==typeof e.params&&(e.params={}),e.params=v(e.params,this.readVPS(i.data)),this.initVPS=i.data),e.vps=[i.data];break;case 33:if(s=!0,o=!0,void 0===e.vps||e.vps[0]===this.initVPS||void 0===e.sps||this.matchSPS(e.sps[0],i.data)||(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const t=this.readSPS(i.data);e.width=t.width,e.height=t.height,e.pixelRatio=t.pixelRatio,e.codec=t.codecString,e.sps=[],"object"!==typeof e.params&&(e.params={});for(const n in t.params)e.params[n]=t.params[n]}this.pushParameterSet(e.sps,i.data,e.vps),a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),a.key=!0;break;case 34:if(s=!0,"object"===typeof e.params){if(!e.pps){e.pps=[];const t=this.readPPS(i.data);for(const n in t)e.params[n]=t[n]}this.pushParameterSet(e.pps,i.data,e.vps)}break;case 35:s=!0,e.audFound=!0,null!=(l=a)&&l.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts));break;default:s=!1}if(a&&s){a.units.push(i)}}),i&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}pushParameterSet(e,t,n){(n&&n[0]===this.initVPS||!n&&!e.length)&&e.push(t)}getNALuType(e,t){return(126&e[t])>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let n=0;for(let i=0;i<e.byteLength;i++)i>=2&&3===e[i]&&0===e[i-1]&&0===e[i-2]||(t[n]=e[i],n++);return new Uint8Array(t.buffer,0,n)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new gr(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);return{numTemporalLayers:t.readBits(3)+1,temporalIdNested:t.readBoolean()}}readSPS(e){const t=new gr(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const n=t.readBits(3);t.readBoolean();const i=t.readBits(2),r=t.readBoolean(),s=t.readBits(5),a=t.readUByte(),o=t.readUByte(),l=t.readUByte(),c=t.readUByte(),u=t.readUByte(),h=t.readUByte(),d=t.readUByte(),f=t.readUByte(),p=t.readUByte(),m=t.readUByte(),g=t.readUByte(),v=[],y=[];for(let Y=0;Y<n;Y++)v.push(t.readBoolean()),y.push(t.readBoolean());if(n>0)for(let Y=n;Y<8;Y++)t.readBits(2);for(let Y=0;Y<n;Y++)v[Y]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),y[Y]&&t.readUByte();t.readUEG();const b=t.readUEG();3==b&&t.skipBits(1);const x=t.readUEG(),_=t.readUEG(),S=t.readBoolean();let E=0,T=0,w=0,A=0;S&&(E+=t.readUEG(),T+=t.readUEG(),w+=t.readUEG(),A+=t.readUEG());const M=t.readUEG(),R=t.readUEG(),C=t.readUEG();for(let Y=t.readBoolean()?0:n;Y<=n;Y++)t.skipUEG(),t.skipUEG(),t.skipUEG();t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.readBoolean()){if(t.readBoolean())for(let e=0;e<4;e++)for(let n=0;n<(3===e?2:6);n++){if(t.readBoolean()){const n=Math.min(64,1<<4+(e<<1));e>1&&t.readEG();for(let e=0;e<n;e++)t.readEG()}else t.readUEG()}}t.readBoolean(),t.readBoolean();t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const L=t.readUEG();let I=0;for(let Y=0;Y<L;Y++){let e=!1;if(0!==Y&&(e=t.readBoolean()),e){Y===L&&t.readUEG(),t.readBoolean(),t.readUEG();let e=0;for(let n=0;n<=I;n++){const n=t.readBoolean();let i=!1;n||(i=t.readBoolean()),(n||i)&&e++}I=e}else{const e=t.readUEG(),n=t.readUEG();I=e+n;for(let i=0;i<e;i++)t.readUEG(),t.readBoolean();for(let i=0;i<n;i++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const e=t.readUEG();for(let n=0;n<e;n++){for(let e=0;e<C+4;e++)t.readBits(1);t.readBits(1)}}let P=0,k=1,D=1,N=!0,O=1,F=0;t.readBoolean(),t.readBoolean();let U=!1;if(t.readBoolean()){if(t.readBoolean()){const e=t.readUByte();e>0&&e<16?(k=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][e-1],D=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][e-1]):255===e&&(k=t.readBits(16),D=t.readBits(16))}t.readBoolean()&&t.readBoolean();if(t.readBoolean()){t.readBits(3),t.readBoolean();t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())}t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),U=t.readBoolean(),U&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG());if(t.readBoolean()){O=t.readBits(32),F=t.readBits(32);t.readBoolean()&&t.readUEG();if(t.readBoolean()){const e=t.readBoolean(),i=t.readBoolean();let r=!1;(e||i)&&(r=t.readBoolean(),r&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),r&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let s=0;s<=n;s++){N=t.readBoolean();let n=!1;N||t.readBoolean()?t.readEG():n=t.readBoolean();const s=n?1:t.readUEG()+1;if(e)for(let e=0;e<s;e++)t.readUEG(),t.readUEG(),r&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(i)for(let e=0;e<s;e++)t.readUEG(),t.readUEG(),r&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),P=t.readUEG())}let B=x,z=_;if(S){let e=1,t=1;1===b?e=t=2:2==b&&(e=2),B=x-e*T-e*E,z=_-t*A-t*w}const j=i?["A","B","C"][i]:"",G=a<<24|o<<16|l<<8|c;let V=0;for(let Y=0;Y<32;Y++)V=(V|(G>>Y&1)<<31-Y)>>>0;let H=V.toString(16);1===s&&"2"===H&&(H="6");const W=r?"H":"L";return{codecString:"hvc1.".concat(j).concat(s,".").concat(H,".").concat(W).concat(g,".B0"),params:{general_tier_flag:r,general_profile_idc:s,general_profile_space:i,general_profile_compatibility_flags:[a,o,l,c],general_constraint_indicator_flags:[u,h,d,f,p,m],general_level_idc:g,bit_depth:M+8,bit_depth_luma_minus8:M,bit_depth_chroma_minus8:R,min_spatial_segmentation_idc:P,chroma_format_idc:b,frame_rate:{fixed:N,fps:F/O}},width:B,height:z,pixelRatio:[k,D]}}readPPS(e){const t=new gr(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2);t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const n=t.readBoolean(),i=t.readBoolean();let r=1;return i&&n?r=0:i?r=3:n&&(r=2),{parallelismType:r}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const br=188;class xr{constructor(e,t,n,i){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=n,this.logger=i,this.videoParser=null}static probe(e,t){const n=xr.syncOffset(e);return n>0&&t.warn("MPEG2-TS detected but first sync word found @ offset ".concat(n)),-1!==n}static syncOffset(e){const t=e.length;let n=Math.min(940,t-br)+1,i=0;for(;i<n;){let r=!1,s=-1,a=0;for(let o=i;o<t;o+=br){if(71!==e[o]||t-o!==br&&71!==e[o+br]){if(a)return-1;break}if(a++,-1===s&&(s=o,0!==s&&(n=Math.min(s+18612,e.length-br)+1)),r||(r=0===_r(e,o)),r&&a>1&&(0===s&&a>2||o+br>n))return s}i++}return-1}static createTrack(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:X[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===e?t:void 0}}resetInitSegment(e,t,n,i){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=xr.createTrack("video"),this._videoTrack.duration=i,this._audioTrack=xr.createTrack("audio",i),this._id3Track=xr.createTrack("id3"),this._txtTrack=xr.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=n}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:n}=this;e&&(e.pesData=null),t&&(t.pesData=null),n&&(n.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t){let n,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];i||(this.sampleAes=null);const s=this._videoTrack,a=this._audioTrack,o=this._id3Track,l=this._txtTrack;let c=s.pid,u=s.pesData,h=a.pid,d=o.pid,f=a.pesData,p=o.pesData,m=null,g=this.pmtParsed,v=this._pmtId,y=e.length;if(this.remainderData&&(y=(e=ce(this.remainderData,e)).length,this.remainderData=null),y<br&&!r)return this.remainderData=e,{audioTrack:a,videoTrack:s,id3Track:o,textTrack:l};const b=Math.max(0,xr.syncOffset(e));y-=(y-b)%br,y<e.byteLength&&!r&&(this.remainderData=new Uint8Array(e.buffer,y,e.buffer.byteLength-y));let x=0;for(let S=b;S<y;S+=br)if(71===e[S]){const t=!!(64&e[S+1]),r=_r(e,S);let y;if((48&e[S+3])>>4>1){if(y=S+5+e[S+4],y===S+br)continue}else y=S+4;switch(r){case c:t&&(u&&(n=Ar(u,this.logger))&&(this.readyVideoParser(s.segmentCodec),null!==this.videoParser&&this.videoParser.parsePES(s,l,n,!1)),u={data:[],size:0}),u&&(u.data.push(e.subarray(y,S+br)),u.size+=S+br-y);break;case h:if(t){if(f&&(n=Ar(f,this.logger)))switch(a.segmentCodec){case"aac":this.parseAACPES(a,n);break;case"mp3":this.parseMPEGPES(a,n);break;case"ac3":this.parseAC3PES(a,n)}f={data:[],size:0}}f&&(f.data.push(e.subarray(y,S+br)),f.size+=S+br-y);break;case d:t&&(p&&(n=Ar(p,this.logger))&&this.parseID3PES(o,n),p={data:[],size:0}),p&&(p.data.push(e.subarray(y,S+br)),p.size+=S+br-y);break;case 0:t&&(y+=e[y]+1),v=this._pmtId=Sr(e,y);break;case v:{t&&(y+=e[y]+1);const n=Er(e,y,this.typeSupported,i,this.observer,this.logger);c=n.videoPid,c>0&&(s.pid=c,s.segmentCodec=n.segmentVideoCodec),h=n.audioPid,h>0&&(a.pid=h,a.segmentCodec=n.segmentAudioCodec),d=n.id3Pid,d>0&&(o.pid=d),null===m||g||(this.logger.warn("MPEG-TS PMT found at ".concat(S," after unknown PID '").concat(m,"'. Backtracking to sync byte @").concat(b," to parse all TS packets.")),m=null,S=b-188),g=this.pmtParsed=!0;break}case 17:case 8191:break;default:m=r}}else x++;x>0&&Tr(this.observer,new Error("Found ".concat(x," TS packet/s that do not start with 0x47")),void 0,this.logger),s.pesData=u,a.pesData=f,o.pesData=p;const _={audioTrack:a,videoTrack:s,id3Track:o,textTrack:l};return r&&this.extractRemainingSamples(_),_}flush(){const{remainderData:e}=this;let t;return this.remainderData=null,t=e?this.demux(e,-1,!1,!0):{videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:n,id3Track:i,textTrack:r}=e,s=n.pesData,a=t.pesData,o=i.pesData;let l;if(s&&(l=Ar(s,this.logger))?(this.readyVideoParser(n.segmentCodec),null!==this.videoParser&&(this.videoParser.parsePES(n,r,l,!0),n.pesData=null)):n.pesData=s,a&&(l=Ar(a,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,l);break;case"mp3":this.parseMPEGPES(t,l);break;case"ac3":this.parseAC3PES(t,l)}t.pesData=null}else null!=a&&a.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=a;o&&(l=Ar(o,this.logger))?(this.parseID3PES(i,l),i.pesData=null):i.pesData=o}demuxSampleAes(e,t,n){const i=this.demux(e,n,!0,!this.config.progressive),r=this.sampleAes=new pr(this.observer,this.config,t);return this.decrypt(i,r)}readyVideoParser(e){null===this.videoParser&&("avc"===e?this.videoParser=new vr:"hevc"===e&&(this.videoParser=new yr))}decrypt(e,t){return new Promise(n=>{const{audioTrack:i,videoTrack:r}=e;i.samples&&"aac"===i.segmentCodec?t.decryptAacSamples(i.samples,0,()=>{r.samples?t.decryptAvcSamples(r.samples,0,0,()=>{n(e)}):n(e)}):r.samples&&t.decryptAvcSamples(r.samples,0,0,()=>{n(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let n=0;const i=this.aacOverFlow;let r,s,a,o=t.data;if(i){this.aacOverFlow=null;const t=i.missing,r=i.sample.unit.byteLength;if(-1===t)o=ce(i.sample.unit,o);else{const s=r-t;i.sample.unit.set(o.subarray(0,t),s),e.samples.push(i.sample),n=i.missing}}for(r=n,s=o.length;r<s-1&&!Ni(o,r);r++);if(r!==n){let e;const t=r<s-1;if(e=t?"AAC PES did not start with ADTS header,offset:".concat(r):"No ADTS header found in AAC PES",Tr(this.observer,new Error(e),t,this.logger),!t)return}if(Fi(e,this.observer,o,r,this.audioCodec),void 0!==t.pts)a=t.pts;else{if(!i)return void this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");{const t=Ui(e.samplerate);a=i.sample.pts+t}}let l,c=0;for(;r<s;){if(l=Bi(e,o,r,a,c),r+=l.length,l.missing){this.aacOverFlow=l;break}for(c++;r<s-1&&!Ni(o,r);r++);}}parseMPEGPES(e,t){const n=t.data,i=n.length;let r=0,s=0;const a=t.pts;if(void 0!==a)for(;s<i;)if(or(n,s)){const t=rr(e,n,s,a,r);if(!t)break;s+=t.length,r++}else s++;else this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS")}parseAC3PES(e,t){{const n=t.data,i=t.pts;if(void 0===i)return void this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");const r=n.length;let s,a=0,o=0;for(;o<r&&(s=hr(e,n,o,i,a++))>0;)o+=s}}parseID3PES(e,t){if(void 0===t.pts)return void this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");const n=v({},t,{type:this._videoTrack?Ki.emsg:Ki.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(n)}}function _r(e,t){return((31&e[t+1])<<8)+e[t+2]}function Sr(e,t){return(31&e[t+10])<<8|e[t+11]}function Er(e,t,n,i,r,s){const a={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},o=t+3+((15&e[t+1])<<8|e[t+2])-4;for(t+=12+((15&e[t+10])<<8|e[t+11]);t<o;){const o=_r(e,t),l=(15&e[t+3])<<8|e[t+4];switch(e[t]){case 207:if(!i){wr("ADTS AAC",s);break}case 15:-1===a.audioPid&&(a.audioPid=o);break;case 21:-1===a.id3Pid&&(a.id3Pid=o);break;case 219:if(!i){wr("H.264",s);break}case 27:-1===a.videoPid&&(a.videoPid=o);break;case 3:case 4:n.mpeg||n.mp3?-1===a.audioPid&&(a.audioPid=o,a.segmentAudioCodec="mp3"):s.log("MPEG audio found, not supported in this browser");break;case 193:if(!i){wr("AC-3",s);break}case 129:n.ac3?-1===a.audioPid&&(a.audioPid=o,a.segmentAudioCodec="ac3"):s.log("AC-3 audio found, not supported in this browser");break;case 6:if(-1===a.audioPid&&l>0){let i=t+5,r=l;for(;r>2;){if(106===e[i])!0!==n.ac3?s.log("AC-3 audio found, not supported in this browser for now"):(a.audioPid=o,a.segmentAudioCodec="ac3");const t=e[i+1]+2;i+=t,r-=t}}break;case 194:case 135:return Tr(r,new Error("Unsupported EC-3 in M2TS found"),void 0,s),a;case 36:-1===a.videoPid&&(a.videoPid=o,a.segmentVideoCodec="hevc",s.log("HEVC in M2TS found"))}t+=l+5}return a}function Tr(e,t,n,i){i.warn("parsing error: ".concat(t.message)),e.emit(l.ERROR,l.ERROR,{type:a.MEDIA_ERROR,details:o.FRAG_PARSING_ERROR,fatal:!1,levelRetry:n,error:t,reason:t.message})}function wr(e,t){t.log("".concat(e," with AES-128-CBC encryption found in unencrypted stream"))}function Ar(e,t){let n,i,r,s,a,o=0;const l=e.data;if(!e||0===e.size)return null;for(;l[0].length<19&&l.length>1;)l[0]=ce(l[0],l[1]),l.splice(1,1);n=l[0];if(1===(n[0]<<16)+(n[1]<<8)+n[2]){if(i=(n[4]<<8)+n[5],i&&i>e.size-6)return null;const c=n[7];192&c&&(s=536870912*(14&n[9])+4194304*(255&n[10])+16384*(254&n[11])+128*(255&n[12])+(254&n[13])/2,64&c?(a=536870912*(14&n[14])+4194304*(255&n[15])+16384*(254&n[16])+128*(255&n[17])+(254&n[18])/2,s-a>54e5&&(t.warn("".concat(Math.round((s-a)/9e4),"s delta between PTS and DTS, align them")),s=a)):a=s),r=n[8];let u=r+9;if(e.size<=u)return null;e.size-=u;const h=new Uint8Array(e.size);for(let e=0,t=l.length;e<t;e++){n=l[e];let t=n.byteLength;if(u){if(u>t){u-=t;continue}n=n.subarray(u),t-=u,u=0}h.set(n,o),o+=t}return i&&(i-=r+3),{data:h,pts:s,dts:a,len:i}}return null}class Mr{static getSilentFrame(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}}}const Rr=Math.pow(2,32)-1;class Cr{static init(){let e;for(e in Cr.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},Cr.types)Cr.types.hasOwnProperty(e)&&(Cr.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),n=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);Cr.HDLR_TYPES={video:t,audio:n};const i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),r=new Uint8Array([0,0,0,0,0,0,0,0]);Cr.STTS=Cr.STSC=Cr.STCO=r,Cr.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),Cr.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),Cr.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),Cr.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const s=new Uint8Array([105,115,111,109]),a=new Uint8Array([97,118,99,49]),o=new Uint8Array([0,0,0,1]);Cr.FTYP=Cr.box(Cr.types.ftyp,s,o,s,a),Cr.DINF=Cr.box(Cr.types.dinf,Cr.box(Cr.types.dref,i))}static box(e){let t=8;for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];let s=i.length;const a=s;for(;s--;)t+=i[s].byteLength;const o=new Uint8Array(t);for(o[0]=t>>24&255,o[1]=t>>16&255,o[2]=t>>8&255,o[3]=255&t,o.set(e,4),s=0,t=8;s<a;s++)o.set(i[s],t),t+=i[s].byteLength;return o}static hdlr(e){return Cr.box(Cr.types.hdlr,Cr.HDLR_TYPES[e])}static mdat(e){return Cr.box(Cr.types.mdat,e)}static mdhd(e,t){t*=e;const n=Math.floor(t/(Rr+1)),i=Math.floor(t%(Rr+1));return Cr.box(Cr.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,n>>24,n>>16&255,n>>8&255,255&n,i>>24,i>>16&255,i>>8&255,255&i,85,196,0,0]))}static mdia(e){return Cr.box(Cr.types.mdia,Cr.mdhd(e.timescale||0,e.duration||0),Cr.hdlr(e.type),Cr.minf(e))}static mfhd(e){return Cr.box(Cr.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e]))}static minf(e){return"audio"===e.type?Cr.box(Cr.types.minf,Cr.box(Cr.types.smhd,Cr.SMHD),Cr.DINF,Cr.stbl(e)):Cr.box(Cr.types.minf,Cr.box(Cr.types.vmhd,Cr.VMHD),Cr.DINF,Cr.stbl(e))}static moof(e,t,n){return Cr.box(Cr.types.moof,Cr.mfhd(e),Cr.traf(n,t))}static moov(e){let t=e.length;const n=[];for(;t--;)n[t]=Cr.trak(e[t]);return Cr.box.apply(null,[Cr.types.moov,Cr.mvhd(e[0].timescale||0,e[0].duration||0)].concat(n).concat(Cr.mvex(e)))}static mvex(e){let t=e.length;const n=[];for(;t--;)n[t]=Cr.trex(e[t]);return Cr.box.apply(null,[Cr.types.mvex,...n])}static mvhd(e,t){t*=e;const n=Math.floor(t/(Rr+1)),i=Math.floor(t%(Rr+1)),r=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,n>>24,n>>16&255,n>>8&255,255&n,i>>24,i>>16&255,i>>8&255,255&i,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return Cr.box(Cr.types.mvhd,r)}static sdtp(e){const t=e.samples||[],n=new Uint8Array(4+t.length);let i,r;for(i=0;i<t.length;i++)r=t[i].flags,n[i+4]=r.dependsOn<<4|r.isDependedOn<<2|r.hasRedundancy;return Cr.box(Cr.types.sdtp,n)}static stbl(e){return Cr.box(Cr.types.stbl,Cr.stsd(e),Cr.box(Cr.types.stts,Cr.STTS),Cr.box(Cr.types.stsc,Cr.STSC),Cr.box(Cr.types.stsz,Cr.STSZ),Cr.box(Cr.types.stco,Cr.STCO))}static avc1(e){let t,n,i,r=[],s=[];for(t=0;t<e.sps.length;t++)n=e.sps[t],i=n.byteLength,r.push(i>>>8&255),r.push(255&i),r=r.concat(Array.prototype.slice.call(n));for(t=0;t<e.pps.length;t++)n=e.pps[t],i=n.byteLength,s.push(i>>>8&255),s.push(255&i),s=s.concat(Array.prototype.slice.call(n));const a=Cr.box(Cr.types.avcC,new Uint8Array([1,r[3],r[4],r[5],255,224|e.sps.length].concat(r).concat([e.pps.length]).concat(s))),o=e.width,l=e.height,c=e.pixelRatio[0],u=e.pixelRatio[1];return Cr.box(Cr.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,o>>8&255,255&o,l>>8&255,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),a,Cr.box(Cr.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),Cr.box(Cr.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,255&c,u>>24,u>>16&255,u>>8&255,255&u])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,255&t,0,0])}static mp4a(e){return Cr.box(Cr.types.mp4a,Cr.audioStsd(e),Cr.box(Cr.types.esds,Cr.esds(e)))}static mp3(e){return Cr.box(Cr.types[".mp3"],Cr.audioStsd(e))}static ac3(e){return Cr.box(Cr.types["ac-3"],Cr.audioStsd(e),Cr.box(Cr.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if("audio"===e.type){if("aac"===t)return Cr.box(Cr.types.stsd,Cr.STSD,Cr.mp4a(e));if("ac3"===t&&e.config)return Cr.box(Cr.types.stsd,Cr.STSD,Cr.ac3(e));if("mp3"===t&&"mp3"===e.codec)return Cr.box(Cr.types.stsd,Cr.STSD,Cr.mp3(e))}else{if(!e.pps||!e.sps)throw new Error("video track missing pps or sps");if("avc"===t)return Cr.box(Cr.types.stsd,Cr.STSD,Cr.avc1(e));if("hevc"===t&&e.vps)return Cr.box(Cr.types.stsd,Cr.STSD,Cr.hvc1(e))}throw new Error("unsupported ".concat(e.type," segment codec (").concat(t,"/").concat(e.codec,")"))}static tkhd(e){const t=e.id,n=(e.duration||0)*(e.timescale||0),i=e.width||0,r=e.height||0,s=Math.floor(n/(Rr+1)),a=Math.floor(n%(Rr+1));return Cr.box(Cr.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,0,0,0,0,s>>24,s>>16&255,s>>8&255,255&s,a>>24,a>>16&255,a>>8&255,255&a,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>8&255,255&i,0,0,r>>8&255,255&r,0,0]))}static traf(e,t){const n=Cr.sdtp(e),i=e.id,r=Math.floor(t/(Rr+1)),s=Math.floor(t%(Rr+1));return Cr.box(Cr.types.traf,Cr.box(Cr.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i])),Cr.box(Cr.types.tfdt,new Uint8Array([1,0,0,0,r>>24,r>>16&255,r>>8&255,255&r,s>>24,s>>16&255,s>>8&255,255&s])),Cr.trun(e,n.length+16+20+8+16+8+8),n)}static trak(e){return e.duration=e.duration||4294967295,Cr.box(Cr.types.trak,Cr.tkhd(e),Cr.mdia(e))}static trex(e){const t=e.id;return Cr.box(Cr.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const n=e.samples||[],i=n.length,r=12+16*i,s=new Uint8Array(r);let a,o,l,c,u,h;for(t+=8+r,s.set(["video"===e.type?1:0,0,15,1,i>>>24&255,i>>>16&255,i>>>8&255,255&i,t>>>24&255,t>>>16&255,t>>>8&255,255&t],0),a=0;a<i;a++)o=n[a],l=o.duration,c=o.size,u=o.flags,h=o.cts,s.set([l>>>24&255,l>>>16&255,l>>>8&255,255&l,c>>>24&255,c>>>16&255,c>>>8&255,255&c,u.isLeading<<2|u.dependsOn,u.isDependedOn<<6|u.hasRedundancy<<4|u.paddingValue<<1|u.isNonSync,61440&u.degradPrio,15&u.degradPrio,h>>>24&255,h>>>16&255,h>>>8&255,255&h],12+16*a);return Cr.box(Cr.types.trun,s)}static initSegment(e){Cr.types||Cr.init();const t=Cr.moov(e);return ce(Cr.FTYP,t)}static hvc1(e){const t=e.params,n=[e.vps,e.sps,e.pps],i=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),3|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),n.length]);let r=i.length;for(let d=0;d<n.length;d+=1){r+=3;for(let e=0;e<n[d].length;e+=1)r+=2+n[d][e].length}const s=new Uint8Array(r);s.set(i,0),r=i.length;const a=n.length-1;for(let d=0;d<n.length;d+=1){s.set(new Uint8Array([32+d|(d===a?128:0),0,n[d].length]),r),r+=3;for(let e=0;e<n[d].length;e+=1)s.set(new Uint8Array([n[d][e].length>>8,255&n[d][e].length]),r),r+=2,s.set(n[d][e],r),r+=n[d][e].length}const o=Cr.box(Cr.types.hvcC,s),l=e.width,c=e.height,u=e.pixelRatio[0],h=e.pixelRatio[1];return Cr.box(Cr.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,255&l,c>>8&255,255&c,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,Cr.box(Cr.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),Cr.box(Cr.types.pasp,new Uint8Array([u>>24,u>>16&255,u>>8&255,255&u,h>>24,h>>16&255,h>>8&255,255&h])))}}Cr.types=void 0,Cr.HDLR_TYPES=void 0,Cr.STTS=void 0,Cr.STSC=void 0,Cr.STCO=void 0,Cr.STSZ=void 0,Cr.VMHD=void 0,Cr.SMHD=void 0,Cr.STSD=void 0,Cr.FTYP=void 0,Cr.DINF=void 0;function Lr(e,t){const n=e*t*(arguments.length>2&&void 0!==arguments[2]?arguments[2]:1);return arguments.length>3&&void 0!==arguments[3]&&arguments[3]?Math.round(n):n}function Ir(e){return Lr(e,1e3,1/9e4,arguments.length>1&&void 0!==arguments[1]&&arguments[1])}function Pr(e){const{baseTime:t,timescale:n,trackId:i}=e;return"".concat(t/n," (").concat(t,"/").concat(n,") trackId: ").concat(i)}let kr,Dr=null,Nr=null;function Or(e,t,n,i){return{duration:t,size:n,cts:i,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:e?2:1,isNonSync:e?0:1}}}class Fr extends x{constructor(e,t,n,i){if(super("mp4-remuxer",i),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=n,this.ISGenerated=!1,null===Dr){const e=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Dr=e?parseInt(e[1]):0}if(null===Nr){const e=navigator.userAgent.match(/Safari\/(\d+)/i);Nr=e?parseInt(e[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){const t=this._initPTS;t&&e&&e.trackId===t.trackId&&e.baseTime===t.baseTime&&e.timescale===t.timescale||this.log("Reset initPTS: ".concat(t?Pr(t):t," > ").concat(e?Pr(e):e)),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const n=e[0].pts,i=e.reduce((e,i)=>{let r=i.pts,s=r-e;return s<-4294967296&&(t=!0,r=Ur(r,n),s=r-e),s>0?e:r},n);return t&&this.debug("PTS rollover detected"),i}remux(e,t,n,i,r,s,a,o){let l,c,u,h,d,p,m=r,g=r;const v=e.pid>-1,y=t.pid>-1,b=t.samples.length,x=e.samples.length>0,_=a&&b>0||b>1;if((!v||x)&&(!y||_)||this.ISGenerated||a){if(this.ISGenerated){var S,E,T,w;const e=this.videoTrackConfig;(e&&(t.width!==e.width||t.height!==e.height||(null==(S=t.pixelRatio)?void 0:S[0])!==(null==(E=e.pixelRatio)?void 0:E[0])||(null==(T=t.pixelRatio)?void 0:T[1])!==(null==(w=e.pixelRatio)?void 0:w[1]))||!e&&_||null===this.nextAudioTs&&x)&&this.resetInitSegment()}this.ISGenerated||(u=this.generateIS(e,t,r,s));const n=this.isVideoContiguous;let i,a=-1;if(_&&(a=function(e){for(let t=0;t<e.length;t++)if(e[t].key)return t;return-1}(t.samples),!n&&this.config.forceKeyFrameOnDiscontinuity))if(p=!0,a>0){this.warn("Dropped ".concat(a," out of ").concat(b," video samples due to a missing keyframe"));const e=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(a),t.dropped+=a,g+=(t.samples[0].pts-e)/t.inputTimeScale,i=g}else-1===a&&(this.warn("No keyframe found out of ".concat(b," video samples")),p=!1);if(this.ISGenerated){if(x&&_){const n=this.getVideoStartPts(t.samples),i=(Ur(e.samples[0].pts,n)-n)/t.inputTimeScale;m+=Math.max(0,i),g+=Math.max(0,-i)}if(x){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),u=this.generateIS(e,t,r,s)),c=this.remuxAudio(e,m,this.isAudioContiguous,s,y||_||o===f.AUDIO?g:void 0),_){const i=c?c.endPTS-c.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),u=this.generateIS(e,t,r,s)),l=this.remuxVideo(t,g,n,i)}}else _&&(l=this.remuxVideo(t,g,n,0));l&&(l.firstKeyFrame=a,l.independent=-1!==a,l.firstKeyFramePTS=i)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(n.samples.length&&(d=Br(n,r,this._initPTS,this._initDTS)),i.samples.length&&(h=zr(i,r,this._initPTS))),{audio:c,video:l,initSegment:u,independent:p,text:h,id3:d}}computeInitPts(e,t,n,i){const r=Math.round(n*t);let s=Ur(e,r);if(s<r+t)for(this.log("Adjusting PTS for rollover in timeline near ".concat((r-s)/t," ").concat(i));s<r+t;)s+=8589934592;return s-r}generateIS(e,t,n,i){const r=e.samples,s=t.samples,a=this.typeSupported,o={},l=this._initPTS;let c,u,h,d=!l||i,f="audio/mp4",p=-1;if(d&&(c=u=1/0),e.config&&r.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":a.mpeg?(f="audio/mpeg",e.codec=""):a.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3"}o.audio={id:"audio",container:f,codec:e.codec,initSegment:"mp3"===e.segmentCodec&&a.mpeg?new Uint8Array(0):Cr.initSegment([e]),metadata:{channelCount:e.channelCount}},d&&(p=e.id,h=e.inputTimeScale,l&&h===l.timescale?d=!1:c=u=this.computeInitPts(r[0].pts,h,n,"audio"))}if(t.sps&&t.pps&&s.length){if(t.timescale=t.inputTimeScale,o.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:Cr.initSegment([t]),metadata:{width:t.width,height:t.height}},d)if(p=t.id,h=t.inputTimeScale,l&&h===l.timescale)d=!1;else{const e=this.getVideoStartPts(s),t=Ur(s[0].dts,e),i=this.computeInitPts(t,h,n,"video"),r=this.computeInitPts(e,h,n,"video");u=Math.min(u,i),c=Math.min(c,r)}this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(o).length)return this.ISGenerated=!0,d?(l&&this.warn("Timestamps at playlist time: ".concat(i?"":"~").concat(n," ").concat(c/h," != initPTS: ").concat(l.baseTime/l.timescale," (").concat(l.baseTime,"/").concat(l.timescale,") trackId: ").concat(l.trackId)),this.log("Found initPTS at playlist time: ".concat(n," offset: ").concat(c/h," (").concat(c,"/").concat(h,") trackId: ").concat(p)),this._initPTS={baseTime:c,timescale:h,trackId:p},this._initDTS={baseTime:u,timescale:h,trackId:p}):c=h=void 0,{tracks:o,initPTS:c,timescale:h,trackId:p}}remuxVideo(e,t,n,i){const r=e.inputTimeScale,s=e.samples,c=[],u=s.length,h=this._initPTS,d=h.baseTime*r/h.timescale;let f,p,m=this.nextVideoTs,g=8,y=this.videoSampleDuration,b=Number.POSITIVE_INFINITY,x=Number.NEGATIVE_INFINITY,_=!1;if(!n||null===m){const e=d+t*r,i=s[0].pts-Ur(s[0].dts,s[0].pts);Dr&&null!==m&&Math.abs(e-i-(m+d))<15e3?n=!0:m=e-i-d}const S=m+d;for(let a=0;a<u;a++){const e=s[a];e.pts=Ur(e.pts,S),e.dts=Ur(e.dts,S),e.dts<s[a>0?a-1:a].dts&&(_=!0)}_&&s.sort(function(e,t){const n=e.dts-t.dts,i=e.pts-t.pts;return n||i}),f=s[0].dts,p=s[s.length-1].dts;const E=p-f,T=E?Math.round(E/(u-1)):y||e.inputTimeScale/30;if(n){const n=f-S,i=n>T,r=n<-1;if((i||r)&&(i?this.warn("".concat((e.segmentCodec||"").toUpperCase(),": ").concat(Ir(n,!0)," ms (").concat(n,"dts) hole between fragments detected at ").concat(t.toFixed(3))):this.warn("".concat((e.segmentCodec||"").toUpperCase(),": ").concat(Ir(-n,!0)," ms (").concat(n,"dts) overlapping between fragments detected at ").concat(t.toFixed(3))),!r||S>=s[0].pts||Dr)){f=S;const e=s[0].pts-n;if(i)s[0].dts=f,s[0].pts=e;else{let t=!0;for(let i=0;i<s.length&&!(s[i].dts>e&&t);i++){const e=s[i].pts;if(s[i].dts-=n,s[i].pts-=n,i<s.length-1){const n=s[i+1].pts;t=n<=s[i].pts==n<=e}}}this.log("Video: Initial PTS/DTS adjusted: ".concat(Ir(e,!0),"/").concat(Ir(f,!0),", delta: ").concat(Ir(n,!0)," ms"))}}f=Math.max(0,f);let w=0,A=0,M=f;for(let a=0;a<u;a++){const e=s[a],t=e.units,n=t.length;let i=0;for(let r=0;r<n;r++)i+=t[r].data.length;A+=i,w+=n,e.length=i,e.dts<M?(e.dts=M,M+=T/4|0||1):M=e.dts,b=Math.min(e.pts,b),x=Math.max(e.pts,x)}p=s[u-1].dts;const R=A+4*w+8;let C;try{C=new Uint8Array(R)}catch(U){return void this.observer.emit(l.ERROR,l.ERROR,{type:a.MUX_ERROR,details:o.REMUX_ALLOC_ERROR,fatal:!1,error:U,bytes:R,reason:"fail allocating video mdat ".concat(R)})}const L=new DataView(C.buffer);L.setUint32(0,R),C.set(Cr.types.mdat,4);let I=!1,P=Number.POSITIVE_INFINITY,k=Number.POSITIVE_INFINITY,D=Number.NEGATIVE_INFINITY,N=Number.NEGATIVE_INFINITY;for(let a=0;a<u;a++){const e=s[a],t=e.units;let n,o=0;for(let i=0,r=t.length;i<r;i++){const e=t[i],n=e.data,r=e.data.byteLength;L.setUint32(g,r),g+=4,C.set(n,g),g+=r,o+=4+r}if(a<u-1)y=s[a+1].dts-e.dts,n=s[a+1].pts-e.pts;else{const t=this.config,o=a>0?e.dts-s[a-1].dts:T;if(n=a>0?e.pts-s[a-1].pts:T,t.stretchShortVideoTrack&&null!==this.nextAudioTs){const n=Math.floor(t.maxBufferHole*r),s=(i?b+i*r:this.nextAudioTs+d)-e.pts;s>n?(y=s-o,y<0?y=o:I=!0,this.log("It is approximately ".concat(s/90," ms to the next segment; using duration ").concat(y/90," ms for the last video frame."))):y=o}else y=o}const l=Math.round(e.pts-e.dts);P=Math.min(P,y),D=Math.max(D,y),k=Math.min(k,n),N=Math.max(N,n),c.push(Or(e.key,y,o,l))}if(c.length)if(Dr){if(Dr<70){const e=c[0].flags;e.dependsOn=2,e.isNonSync=0}}else if(Nr&&N-k<D-P&&T/D<.025&&0===c[0].cts){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let e=f;for(let t=0,n=c.length;t<n;t++){const i=e+c[t].duration,r=e+c[t].cts;if(t<n-1){const e=i+c[t+1].cts;c[t].duration=e-r}else c[t].duration=t?c[t-1].duration:T;c[t].cts=0,e=i}}y=I||!y?T:y;const O=p+y;this.nextVideoTs=m=O-d,this.videoSampleDuration=y,this.isVideoContiguous=!0;const F={data1:Cr.moof(e.sequenceNumber++,f,v(e,{samples:c})),data2:C,startPTS:(b-d)/r,endPTS:(x+y-d)/r,startDTS:(f-d)/r,endDTS:m/r,type:"video",hasAudio:!1,hasVideo:!0,nb:c.length,dropped:e.dropped};return e.samples=[],e.dropped=0,F}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return 1152;case"ac3":return 1536;default:return 1024}}remuxAudio(e,t,n,i,r){const s=e.inputTimeScale,c=s/(e.samplerate?e.samplerate:s),u=this.getSamplesPerFrame(e),h=u*c,d=this._initPTS,f="mp3"===e.segmentCodec&&this.typeSupported.mpeg,p=[],m=void 0!==r;let g=e.samples,y=f?0:8,b=this.nextAudioTs||-1;const x=d.baseTime*s/d.timescale,_=x+t*s;if(this.isAudioContiguous=n=n||g.length&&b>0&&(i&&Math.abs(_-(b+x))<9e3||Math.abs(Ur(g[0].pts,_)-(b+x))<20*h),g.forEach(function(e){e.pts=Ur(e.pts,_)}),!n||b<0){const e=g.length;if(g=g.filter(e=>e.pts>=0),e!==g.length&&this.warn("Removed ".concat(g.length-e," of ").concat(e," samples (initPTS ").concat(x," / ").concat(s,")")),!g.length)return;b=0===r?0:i&&!m?Math.max(0,_-x):g[0].pts-x}if("aac"===e.segmentCodec){const t=this.config.maxAudioFramesDrift;for(let n=0,i=b+x;n<g.length;n++){const r=g[n],a=r.pts,o=a-i,l=Math.abs(1e3*o/s);if(o<=-t*h&&m)0===n&&(this.warn("Audio frame @ ".concat((a/s).toFixed(3),"s overlaps marker by ").concat(Math.round(1e3*o/s)," ms.")),this.nextAudioTs=b=a-x,i=a);else if(o>=t*h&&l<1e4&&m){let t=Math.round(o/h);for(i=a-t*h;i<0&&t&&h;)t--,i+=h;0===n&&(this.nextAudioTs=b=i-x),this.warn("Injecting ".concat(t," audio frames @ ").concat(((i-x)/s).toFixed(3),"s due to ").concat(Math.round(1e3*o/s)," ms gap."));for(let s=0;s<t;s++){let t=Mr.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);t||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),t=r.unit.subarray()),g.splice(n,0,{unit:t,pts:i}),i+=h,n++}}r.pts=i,i+=h}}let S,E=null,T=null,w=0,A=g.length;for(;A--;)w+=g[A].unit.byteLength;for(let v=0,D=g.length;v<D;v++){const t=g[v],i=t.unit;let r=t.pts;if(null!==T){p[v-1].duration=Math.round((r-T)/c)}else{if(n&&"aac"===e.segmentCodec&&(r=b+x),E=r,!(w>0))return;w+=y;try{S=new Uint8Array(w)}catch(k){return void this.observer.emit(l.ERROR,l.ERROR,{type:a.MUX_ERROR,details:o.REMUX_ALLOC_ERROR,fatal:!1,error:k,bytes:w,reason:"fail allocating audio mdat ".concat(w)})}if(!f){new DataView(S.buffer).setUint32(0,w),S.set(Cr.types.mdat,4)}}S.set(i,y);const s=i.byteLength;y+=s,p.push(Or(!0,u,s,0)),T=r}const M=p.length;if(!M)return;const R=p[p.length-1];b=T-x,this.nextAudioTs=b+c*R.duration;const C=f?new Uint8Array(0):Cr.moof(e.sequenceNumber++,E/c,v({},e,{samples:p}));e.samples=[];const L=(E-x)/s,I=this.nextAudioTs/s,P={data1:C,data2:S,startPTS:L,endPTS:I,startDTS:L,endDTS:I,type:"audio",hasAudio:!0,hasVideo:!1,nb:M};return this.isAudioContiguous=!0,P}}function Ur(e,t){let n;if(null===t)return e;for(n=t<e?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=n;return e}function Br(e,t,n,i){const r=e.samples.length;if(!r)return;const s=e.inputTimeScale;for(let o=0;o<r;o++){const r=e.samples[o];r.pts=Ur(r.pts-n.baseTime*s/n.timescale,t*s)/s,r.dts=Ur(r.dts-i.baseTime*s/i.timescale,t*s)/s}const a=e.samples;return e.samples=[],{samples:a}}function zr(e,t,n){const i=e.samples.length;if(!i)return;const r=e.inputTimeScale;for(let a=0;a<i;a++){const i=e.samples[a];i.pts=Ur(i.pts-n.baseTime*r/n.timescale,t*r)/r}e.samples.sort((e,t)=>e.pts-t.pts);const s=e.samples;return e.samples=[],{samples:s}}function jr(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return void 0!==(null==e?void 0:e.start)?(e.start+(n?e.duration:0))/e.timescale:t}function Gr(e,t,n){const i=e.codec;if(i&&i.length>4)return i;if(t===F){if("ec-3"===i||"ac-3"===i||"alac"===i)return i;if("fLaC"===i||"Opus"===i){return Me(i,!1)}return n.warn('Unhandled audio codec "'.concat(i,'" in mp4 MAP')),i||"mp4a"}return n.warn('Unhandled video codec "'.concat(i,'" in mp4 MAP')),i||"avc1"}try{kr=self.performance.now.bind(self.performance)}catch(hl){kr=Date.now}const Vr=[{demux:class{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,n,i){const r=this.videoTrack=Zi("video",1),s=this.audioTrack=Zi("audio",1),a=this.txtTrack=Zi("text",1);if(this.id3Track=Zi("id3",1),this.timeOffset=0,null==e||!e.byteLength)return;const o=te(e);if(o.video){const{id:e,timescale:t,codec:n,supplemental:i}=o.video;r.id=e,r.timescale=a.timescale=t,r.codec=n,r.supplemental=i}if(o.audio){const{id:e,timescale:t,codec:n}=o.audio;s.id=e,s.timescale=t,s.codec=n}a.id=X.text,r.sampleDuration=0,r.duration=s.duration=i}resetContiguity(){this.remainderData=null}static probe(e){return function(e){const t=e.byteLength;for(let n=0;n<t;){const i=Z(e,n);if(i>8&&109===e[n+4]&&111===e[n+5]&&111===e[n+6]&&102===e[n+7])return!0;n=i>1?n+i:t}return!1}(e)}demux(e,t){this.timeOffset=t;let n=e;const i=this.videoTrack,r=this.txtTrack;if(this.config.progressive){this.remainderData&&(n=ce(this.remainderData,e));const t=function(e){const t={valid:null,remainder:null},n=$(e,["moof"]);if(n.length<2)return t.remainder=e,t;const i=n[n.length-1];return t.valid=e.slice(0,i.byteOffset-8),t.remainder=e.slice(i.byteOffset-8),t}(n);this.remainderData=t.remainder,i.samples=t.valid||new Uint8Array}else i.samples=n;const s=this.extractID3Track(i,t);return r.samples=ue(t,i),{videoTrack:i,audioTrack:this.audioTrack,id3Track:s,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,n=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const i=this.extractID3Track(t,this.timeOffset);return n.samples=ue(e,t),{videoTrack:t,audioTrack:Zi(),id3Track:i,textTrack:Zi()}}extractID3Track(e,t){const n=this.id3Track;if(e.samples.length){const i=$(e.samples,["emsg"]);i&&i.forEach(e=>{const i=function(e){const t=e[0];let n="",i="",s=0,a=0,o=0,l=0,c=0,u=0;if(0===t){for(;"\0"!==q(e.subarray(u,u+1));)n+=q(e.subarray(u,u+1)),u+=1;for(n+=q(e.subarray(u,u+1)),u+=1;"\0"!==q(e.subarray(u,u+1));)i+=q(e.subarray(u,u+1)),u+=1;i+=q(e.subarray(u,u+1)),u+=1,s=Z(e,12),a=Z(e,16),l=Z(e,20),c=Z(e,24),u=28}else if(1===t){u+=4,s=Z(e,u),u+=4;const t=Z(e,u);u+=4;const a=Z(e,u);for(u+=4,o=2**32*t+a,r(o)||(o=Number.MAX_SAFE_INTEGER,A.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),l=Z(e,u),u+=4,c=Z(e,u),u+=4;"\0"!==q(e.subarray(u,u+1));)n+=q(e.subarray(u,u+1)),u+=1;for(n+=q(e.subarray(u,u+1)),u+=1;"\0"!==q(e.subarray(u,u+1));)i+=q(e.subarray(u,u+1)),u+=1;i+=q(e.subarray(u,u+1)),u+=1}return{schemeIdUri:n,value:i,timeScale:s,presentationTime:o,presentationTimeDelta:a,eventDuration:l,id:c,payload:e.subarray(u,e.byteLength)}}(e);if(dr.test(i.schemeIdUri)){const e=fr(i,t);let r=4294967295===i.eventDuration?Number.POSITIVE_INFINITY:i.eventDuration/i.timeScale;r<=.001&&(r=Number.POSITIVE_INFINITY);const s=i.payload;n.samples.push({data:s,len:s.byteLength,dts:e,pts:e,type:Ki.emsg,duration:r})}else if(this.config.enableEmsgKLVMetadata&&i.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const e=fr(i,t);n.samples.push({data:i.payload,len:i.payload.byteLength,dts:e,pts:e,type:Ki.misbklv,duration:Number.POSITIVE_INFINITY})}})}return n}demuxSampleAes(e,t,n){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}},remux:class extends x{constructor(e,t,n,i){super("passthrough-remuxer",i),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,n,i){this.audioCodec=t,this.videoCodec=n,this.generateInitSegment(e,i),this.emitInitSegment=!0}generateInitSegment(e,t){let{audioCodec:n,videoCodec:i}=this;if(null==e||!e.byteLength)return this.initTracks=void 0,void(this.initData=void 0);const{audio:r,video:s}=this.initData=te(e);if(t)!function(e,t){if(!e||!t)return;const n=t.keyId;n&&t.isCommonEncryption&&oe(e,(e,t)=>{const i=e.subarray(8,24);i.some(e=>0!==e)||(A.log("[eme] Patching keyId in 'enc".concat(t?"a":"v",">sinf>>tenc' box: ").concat(L(i)," -> ").concat(L(n))),e.set(n,8))})}(e,t);else{const e=r||s;null!=e&&e.encrypted&&this.warn('Init segment with encrypted track with has no key ("'.concat(e.codec,'")!'))}r&&(n=Gr(r,F,this)),s&&(i=Gr(s,U,this));const a={};r&&s?a.audiovideo={container:"video/mp4",codec:n+","+i,supplemental:s.supplemental,encrypted:s.encrypted,initSegment:e,id:"main"}:r?a.audio={container:"audio/mp4",codec:n,encrypted:r.encrypted,initSegment:e,id:"audio"}:s?a.video={container:"video/mp4",codec:i,supplemental:s.supplemental,encrypted:s.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=a}remux(e,t,n,r,s,a){var o,l;let{initPTS:c,lastEndTime:u}=this;const h={audio:void 0,video:void 0,text:r,id3:n,initSegment:void 0};i(u)||(u=this.lastEndTime=s||0);const d=t.samples;if(!d.length)return h;const f={initPTS:void 0,timescale:void 0,trackId:void 0};let p=this.initData;if(null!=(o=p)&&o.length||(this.generateInitSegment(d),p=this.initData),null==(l=p)||!l.length)return this.warn("Failed to generate initSegment."),h;this.emitInitSegment&&(f.tracks=this.initTracks,this.emitInitSegment=!1);const m=function(e,t,n){const r={},s=$(e,["moof","traf"]);for(let a=0;a<s.length;a++){const e=s[a],o=$(e,["tfhd"])[0],l=Z(o,4),c=t[l];if(!c)continue;r[l]||(r[l]={start:NaN,duration:0,sampleCount:0,timescale:c.timescale,type:c.type});const u=r[l],h=$(e,["tfdt"])[0];if(h){const e=h[0];let t=Z(h,4);1===e&&(t===W?n.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(t*=W+1,t+=Z(h,8))),i(t)&&(!i(u.start)||t<u.start)&&(u.start=t)}const d=c.default,f=Z(o,0)|(null==d?void 0:d.flags);let p=(null==d?void 0:d.duration)||0;8&f&&(p=Z(o,2&f?12:8));const m=$(e,["trun"]);let g=u.start||0,v=0,y=p;for(let t=0;t<m.length;t++){const e=m[t],n=Z(e,4),i=u.sampleCount;u.sampleCount+=n;const r=1&e[3],s=4&e[3],a=1&e[2],o=2&e[2],l=4&e[2],c=8&e[2];let h=8,d=n;for(r&&(h+=4),s&&n&&(1&e[h+1]||void 0!==u.keyFrameIndex||(u.keyFrameIndex=i),h+=4,a?(y=Z(e,h),h+=4):y=p,o&&(h+=4),c&&(h+=4),g+=y,v+=y,d--);d--;)a?(y=Z(e,h),h+=4):y=p,o&&(h+=4),l&&(1&e[h+1]||void 0===u.keyFrameIndex&&(u.keyFrameIndex=u.sampleCount-(d+1),u.keyFrameStart=g),h+=4),c&&(h+=4),g+=y,v+=y;!v&&p&&(v+=p*n)}u.duration+=v}if(!Object.keys(r).some(e=>r[e].duration)){let t=1/0,n=0;const s=$(e,["sidx"]);for(let e=0;e<s.length;e++){const i=ee(s[e]);if(null!=i&&i.references){t=Math.min(t,i.earliestPresentationTime/i.timescale);const e=i.references.reduce((e,t)=>e+t.info.duration||0,0);n=Math.max(n,e+i.earliestPresentationTime/i.timescale)}}n&&i(n)&&Object.keys(r).forEach(e=>{r[e].duration||(r[e].duration=n*r[e].timescale-r[e].start)})}return r}(d,p,this),g=p.audio?m[p.audio.id]:null,v=p.video?m[p.video.id]:null,y=jr(v,1/0),b=jr(g,1/0),x=jr(v,0,!0),_=jr(g,0,!0);let S=s,E=0;const T=g&&(!v||!c&&b<y||c&&c.trackId===p.audio.id),w=T?g:v;if(w){const e=w.timescale,t=w.start-s*e,n=T?p.audio.id:p.video.id;S=w.start/e,E=T?_-b:x-y,!a&&c||!function(e,t,n,i){if(null===e)return!0;const r=Math.max(i,1),s=t-e.baseTime/e.timescale;return Math.abs(s-n)>r}(c,S,s,E)&&e===c.timescale||(c&&this.warn("Timestamps at playlist time: ".concat(a?"":"~").concat(s," ").concat(t/e," != initPTS: ").concat(c.baseTime/c.timescale," (").concat(c.baseTime,"/").concat(c.timescale,") trackId: ").concat(c.trackId)),this.log("Found initPTS at playlist time: ".concat(s," offset: ").concat(S-s," (").concat(t,"/").concat(e,") trackId: ").concat(n)),c=null,f.initPTS=t,f.timescale=e,f.trackId=n)}else this.warn("No audio or video samples found for initPTS at playlist time: ".concat(s));c?(f.initPTS=c.baseTime,f.timescale=c.timescale,f.trackId=c.trackId):(f.timescale&&void 0!==f.trackId&&void 0!==f.initPTS||(this.warn("Could not set initPTS"),f.initPTS=S,f.timescale=1,f.trackId=-1),this.initPTS=c={baseTime:f.initPTS,timescale:f.timescale,trackId:f.trackId});const A=S-c.baseTime/c.timescale,M=A+E;E>0?this.lastEndTime=M:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const R=!!p.audio,C=!!p.video;let L="";R&&(L+="audio"),C&&(L+="video");const I={data1:d,startPTS:A,startDTS:A,endPTS:M,endDTS:M,type:L,hasAudio:R,hasVideo:C,nb:1,dropped:0,encrypted:!!p.audio&&p.audio.encrypted||!!p.video&&p.video.encrypted};h.audio=R&&!C?I:void 0,h.video=C?I:void 0;const P=null==v?void 0:v.sampleCount;if(P){const e=v.keyFrameIndex,t=-1!==e;I.nb=P,I.dropped=0===e||this.isVideoContiguous?0:t?e:P,I.independent=t,I.firstKeyFrame=e,t&&v.keyFrameStart&&(I.firstKeyFramePTS=(v.keyFrameStart-c.baseTime)/c.timescale),this.isVideoContiguous||(h.independent=t),this.isVideoContiguous||(this.isVideoContiguous=t),I.dropped&&this.warn("fmp4 does not start with IDR: firstIDR ".concat(e,"/").concat(P," dropped: ").concat(I.dropped," start: ").concat(I.firstKeyFramePTS||"NA"))}return h.initSegment=f,h.id3=Br(n,s,c,c),r.samples.length&&(h.text=zr(r,s,c)),h}}},{demux:xr,remux:Fr},{demux:class extends Ji{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,n,i){super.resetInitSegment(e,t,n,i),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const n=Ii(e,0);let i=(null==n?void 0:n.length)||0;if(lr(e,i))return!1;for(let r=e.length;i<r;i++)if(Oi(e,i))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return function(e,t){return function(e,t){return t+5<e.length}(e,t)&&Pi(e,t)&&Di(e,t)<=e.length-t}(e,t)}appendFrame(e,t,n){Fi(e,this.observer,t,n,e.manifestCodec);const i=Bi(e,t,n,this.basePTS,this.frameIndex);if(i&&0===i.missing)return i}},remux:Fr},{demux:class extends Ji{resetInitSegment(e,t,n,i){super.resetInitSegment(e,t,n,i),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=Ii(e,0);let n=(null==t?void 0:t.length)||0;if(t&&11===e[n]&&119===e[n+1]&&void 0!==qi(t)&&cr(e,n)<=16)return!1;for(let i=e.length;n<i;n++)if(lr(e,n))return A.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return function(e,t){return ar(e,t)&&4<=e.length-t}(e,t)}appendFrame(e,t,n){if(null!==this.basePTS)return rr(e,t,n,this.basePTS,this.frameIndex)}},remux:Fr}];Vr.splice(2,0,{demux:ur,remux:Fr});class Hr{constructor(e,t,n,i,r,s){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=n,this.id=r,this.logger=s}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,n,i){const r=n.transmuxing;r.executeStart=kr();let s=new Uint8Array(e);const{currentTransmuxState:c,transmuxConfig:u}=this;i&&(this.currentTransmuxState=i);const{contiguous:h,discontinuity:d,trackSwitch:f,accurateTimeOffset:p,timeOffset:m,initSegmentChange:g}=i||c,{audioCodec:v,videoCodec:y,defaultInitPts:b,duration:x,initSegmentData:_}=u,S=function(e,t){let n=null;e.byteLength>0&&null!=(null==t?void 0:t.key)&&null!==t.iv&&null!=t.method&&(n=t);return n}(s,t);if(S&&sn(S.method)){const e=this.getDecrypter(),t=an(S.method);if(!e.isSync())return this.asyncResult=!0,this.decryptionPromise=e.webCryptoDecrypt(s,S.key.buffer,S.iv.buffer,t).then(e=>{const t=this.push(e,null,n);return this.decryptionPromise=null,t}),this.decryptionPromise;{let i=e.softwareDecrypt(s,S.key.buffer,S.iv.buffer,t);if(n.part>-1){const t=e.flush();i=t?t.buffer:t}if(!i)return r.executeEnd=kr(),Wr(n);s=new Uint8Array(i)}}const E=this.needsProbing(d,f);if(E){const e=this.configureTransmuxer(s);if(e)return this.logger.warn("[transmuxer] ".concat(e.message)),this.observer.emit(l.ERROR,l.ERROR,{type:a.MEDIA_ERROR,details:o.FRAG_PARSING_ERROR,fatal:!1,error:e,reason:e.message}),r.executeEnd=kr(),Wr(n)}(d||f||g||E)&&this.resetInitSegment(_,v,y,x,t),(d||g||E)&&this.resetInitialTimestamp(b),h||this.resetContiguity();const T=this.transmux(s,S,m,p,n);this.asyncResult=Yr(T);const w=this.currentTransmuxState;return w.contiguous=!0,w.discontinuity=!1,w.trackSwitch=!1,r.executeEnd=kr(),T}flush(e){const t=e.transmuxing;t.executeStart=kr();const{decrypter:n,currentTransmuxState:i,decryptionPromise:r}=this;if(r)return this.asyncResult=!0,r.then(()=>this.flush(e));const s=[],{timeOffset:a}=i;if(n){const t=n.flush();t&&s.push(this.push(t.buffer,null,e))}const{demuxer:o,remuxer:l}=this;if(!o||!l){t.executeEnd=kr();const n=[Wr(e)];return this.asyncResult?Promise.resolve(n):n}const c=o.flush(a);return Yr(c)?(this.asyncResult=!0,c.then(t=>(this.flushRemux(s,t,e),s))):(this.flushRemux(s,c,e),this.asyncResult?Promise.resolve(s):s)}flushRemux(e,t,n){const{audioTrack:i,videoTrack:r,id3Track:s,textTrack:a}=t,{accurateTimeOffset:o,timeOffset:l}=this.currentTransmuxState;this.logger.log("[transmuxer.ts]: Flushed ".concat(this.id," sn: ").concat(n.sn).concat(n.part>-1?" part: "+n.part:""," of ").concat(this.id===f.MAIN?"level":"track"," ").concat(n.level));const c=this.remuxer.remux(i,r,s,a,l,o,!0,this.id);e.push({remuxResult:c,chunkMeta:n}),n.transmuxing.executeEnd=kr()}resetInitialTimestamp(e){const{demuxer:t,remuxer:n}=this;t&&n&&(t.resetTimeStamp(e),n.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;e&&t&&(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,n,i,r){const{demuxer:s,remuxer:a}=this;s&&a&&(s.resetInitSegment(e,t,n,i),a.resetInitSegment(e,t,n,r))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,n,i,r){let s;return s=t&&"SAMPLE-AES"===t.method?this.transmuxSampleAes(e,t,n,i,r):this.transmuxUnencrypted(e,n,i,r),s}transmuxUnencrypted(e,t,n,i){const{audioTrack:r,videoTrack:s,id3Track:a,textTrack:o}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(r,s,a,o,t,n,!1,this.id),chunkMeta:i}}transmuxSampleAes(e,t,n,i,r){return this.demuxer.demuxSampleAes(e,t,n).then(e=>({remuxResult:this.remuxer.remux(e.audioTrack,e.videoTrack,e.id3Track,e.textTrack,n,i,!1,this.id),chunkMeta:r}))}configureTransmuxer(e){const{config:t,observer:n,typeSupported:i}=this;let r;for(let u=0,h=Vr.length;u<h;u++){var s;if(null!=(s=Vr[u].demux)&&s.probe(e,this.logger)){r=Vr[u];break}}if(!r)return new Error("Failed to find demuxer by probing fragment data");const a=this.demuxer,o=this.remuxer,l=r.remux,c=r.demux;o&&o instanceof l||(this.remuxer=new l(n,t,i,this.logger)),a&&a instanceof c||(this.demuxer=new c(n,t,i,this.logger),this.probe=c.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new Dt(this.config)),e}}const Wr=e=>({remuxResult:{},chunkMeta:e});function Yr(e){return"then"in e&&e.then instanceof Function}class Xr{constructor(e,t,n,i,r){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=n,this.duration=i,this.defaultInitPts=r||null}}class qr{constructor(e,t,n,i,r,s){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=n,this.trackSwitch=i,this.timeOffset=r,this.initSegmentChange=s}}let Kr=0;class Zr{constructor(e,t,n,i){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=Kr++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=e=>{const t=e.data,n=this.hls;if(n&&null!=t&&t.event&&t.instanceNo===this.instanceNo)switch(t.event){case"init":{var i;const e=null==(i=this.workerContext)?void 0:i.objectURL;e&&self.URL.revokeObjectURL(e);break}case"transmuxComplete":this.handleTransmuxComplete(t.data);break;case"flush":this.onFlush(t.data);break;case"workerLog":n.logger[t.data.logType]&&n.logger[t.data.logType](t.data.message);break;default:t.data=t.data||{},t.data.frag=this.frag,t.data.part=this.part,t.data.id=this.id,n.trigger(t.event,t.data)}},this.onWorkerError=e=>{if(!this.hls)return;const t=new Error("".concat(e.message,"  (").concat(e.filename,":").concat(e.lineno,")"));this.hls.config.enableWorker=!1,this.hls.logger.warn('Error in "'.concat(this.id,'" Web Worker, fallback to inline')),this.hls.trigger(l.ERROR,{type:a.OTHER_ERROR,details:o.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:t})};const r=e.config;this.hls=e,this.id=t,this.useWorker=!!r.enableWorker,this.onTransmuxComplete=n,this.onFlush=i;const s=(e,t)=>{(t=t||{}).frag=this.frag||void 0,e===l.ERROR&&(t.parent=this.id,t.part=this.part,this.error=t.error),this.hls.trigger(e,t)};this.observer=new wi,this.observer.on(l.FRAG_DECRYPTED,s),this.observer.on(l.ERROR,s);const c=Ie(r.preferManagedMediaSource);if(this.useWorker&&"undefined"!==typeof Worker){const n=this.hls.logger;if(r.workerPath||"function"===typeof __HLS_WORKER_BUNDLE__){try{r.workerPath?(n.log("loading Web Worker ".concat(r.workerPath,' for "').concat(t,'"')),this.workerContext=function(e){const t=Mi[e];if(t)return t.clientCount++,t;const n=new self.URL(e,self.location.href).href,i={worker:new self.Worker(n),scriptURL:n,clientCount:1};return Mi[e]=i,i}(r.workerPath)):(n.log('injecting Web Worker for "'.concat(t,'"')),this.workerContext=function(){const e=Mi[Ai];if(e)return e.clientCount++,e;const t=new self.Blob(["var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(".concat(__HLS_WORKER_BUNDLE__.toString(),")(true);")],{type:"text/javascript"}),n=self.URL.createObjectURL(t),i={worker:new self.Worker(n),objectURL:n,clientCount:1};return Mi[Ai]=i,i}());const{worker:e}=this.workerContext;e.addEventListener("message",this.onWorkerMessage),e.addEventListener("error",this.onWorkerError),e.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:c,id:t,config:qe(r)})}catch(hl){n.warn('Error setting up "'.concat(t,'" Web Worker, fallback to inline'),hl),this.terminateWorker(),this.error=null,this.transmuxer=new Hr(this.observer,c,r,"",t,e.logger)}return}}this.transmuxer=new Hr(this.observer,c,r,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=Kr++;const t=this.hls.config,n=Ie(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:n,id:this.id,config:qe(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),function(e){const t=Mi[e||Ai];if(t&&1===t.clientCount--){const{worker:n,objectURL:i}=t;delete Mi[e||Ai],i&&self.URL.revokeObjectURL(i),n.terminate()}}(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const e=this.transmuxer;e&&(e.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,n,i,r,s,a,o,l,c){var u,h;l.transmuxing.start=self.performance.now();const{instanceNo:d,transmuxer:p}=this,m=s?s.start:r.start,g=r.decryptdata,v=this.frag,y=!(v&&r.cc===v.cc),b=!(v&&l.level===v.level),x=v?l.sn-v.sn:-1,_=this.part?l.part-this.part.index:-1,S=0===x&&l.id>1&&l.id===(null==v?void 0:v.stats.chunkCount),E=!b&&(1===x||0===x&&(1===_||S&&_<=0)),T=self.performance.now();(b||x||0===r.stats.parsing.start)&&(r.stats.parsing.start=T),!s||!_&&E||(s.stats.parsing.start=T);const w=!(v&&(null==(u=r.initSegment)?void 0:u.url)===(null==(h=v.initSegment)?void 0:h.url)),A=new qr(y,E,o,b,m,w);if(!E||y||w){this.hls.logger.log("[transmuxer-interface]: Starting new transmux session for ".concat(r.type," sn: ").concat(l.sn).concat(l.part>-1?" part: "+l.part:""," ").concat(this.id===f.MAIN?"level":"track",": ").concat(l.level," id: ").concat(l.id,"\n        discontinuity: ").concat(y,"\n        trackSwitch: ").concat(b,"\n        contiguous: ").concat(E,"\n        accurateTimeOffset: ").concat(o,"\n        timeOffset: ").concat(m,"\n        initSegmentChange: ").concat(w));const e=new Xr(n,i,t,a,c);this.configureTransmuxer(e)}if(this.frag=r,this.part=s,this.workerContext)this.workerContext.worker.postMessage({instanceNo:d,cmd:"demux",data:e,decryptdata:g,chunkMeta:l,state:A},e instanceof ArrayBuffer?[e]:[]);else if(p){const t=p.push(e,g,l,A);Yr(t)?t.then(e=>{this.handleTransmuxComplete(e)}).catch(e=>{this.transmuxerError(e,l,"transmuxer-interface push error")}):this.handleTransmuxComplete(t)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:n}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(n){const t=n.flush(e);Yr(t)?t.then(t=>{this.handleFlushResult(t,e)}).catch(t=>{this.transmuxerError(t,e,"transmuxer-interface flush error")}):this.handleFlushResult(t,e)}}transmuxerError(e,t,n){this.hls&&(this.error=e,this.hls.trigger(l.ERROR,{type:a.MEDIA_ERROR,details:o.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:n}))}handleFlushResult(e,t){e.forEach(e=>{this.handleTransmuxComplete(e)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:n}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):n&&n.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}class Jr extends bi{constructor(e,t,n){super(e,t,n,"audio-stream-controller",f.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(l.LEVEL_LOADED,this.onLevelLoaded,this),e.on(l.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(l.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(l.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(l.BUFFER_RESET,this.onBufferReset,this),e.on(l.BUFFER_CREATED,this.onBufferCreated,this),e.on(l.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(l.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(l.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(l.FRAG_LOADING,this.onFragLoading,this),e.on(l.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(l.LEVEL_LOADED,this.onLevelLoaded,this),e.off(l.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(l.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(l.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(l.BUFFER_RESET,this.onBufferReset,this),e.off(l.BUFFER_CREATED,this.onBufferCreated,this),e.off(l.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(l.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(l.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(l.FRAG_LOADING,this.onFragLoading,this),e.off(l.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,t){let{frag:n,id:i,initPTS:r,timescale:s,trackId:a}=t;if(i===f.MAIN){const e=n.cc,t=this.fragCurrent;if(this.initPTS[e]={baseTime:r,timescale:s,trackId:a},this.log("InitPTS for cc: ".concat(e," found from main: ").concat(r/s," (").concat(r,"/").concat(s,") trackId: ").concat(a)),this.mainAnchor=n,this.state===vi){const t=this.waitingData;(!t&&!this.loadingParts||t&&t.frag.cc!==e)&&this.syncWithAnchor(n,null==t?void 0:t.frag)}else!this.hls.hasEnoughToStart&&t&&t.cc!==e?(t.abortRequests(),this.syncWithAnchor(n,t)):this.state===li&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var n;const i=(null==(n=this.mainFragLoading)?void 0:n.frag)||null;if(t&&(null==i?void 0:i.cc)===t.cc)return;const r=(i||e).cc,s=lt(this.getLevelDetails(),r,this.getLoadPosition());s&&(this.log("Syncing with main frag at ".concat(s.start," cc ").concat(s.cc)),this.startFragRequested=!1,this.nextLoadPosition=s.start,this.resetLoadingState(),this.state===li&&this.doTickIdle())}startLoad(e,t){if(!this.levels)return this.startPosition=e,void(this.state=oi);const n=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),n>0&&-1===e?(this.log("Override startPosition with lastCurrentTime @".concat(n.toFixed(3))),e=n,this.state=li):this.state=di,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case li:this.doTickIdle();break;case di:{const{levels:e,trackId:t}=this,n=null==e?void 0:e[t],i=null==n?void 0:n.details;if(i&&!this.waitForLive(n)){if(this.waitForCdnTuneIn(i))break;this.state=vi}break}case hi:this.checkRetryDate();break;case vi:{const e=this.waitingData;if(e){const{frag:t,part:n,cache:i,complete:r}=e,s=this.mainAnchor;if(void 0!==this.initPTS[t.cc]){this.waitingData=null,this.state=ui;const e={frag:t,part:n,payload:i.flush().buffer,networkDetails:null};this._handleFragmentLoadProgress(e),r&&super._handleFragmentLoadComplete(e)}else s&&s.cc!==e.frag.cc&&this.syncWithAnchor(s,e.frag)}else this.state=li}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;null!=e&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:n,media:i,trackId:r}=this,s=t.config;if(!this.buffering||!i&&!this.primaryPrefetch&&(this.startFragRequested||!s.startFragPrefetch)||null==n||!n[r])return;const a=n[r],o=a.details;if(!o||this.waitForLive(a)||this.waitForCdnTuneIn(o))return this.state=di,void(this.startFragRequested=!1);const c=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&c&&(this.bufferFlushed=!1,this.afterBufferFlushed(c,F,f.AUDIO));const u=this.getFwdBufferInfo(c,f.AUDIO);if(null===u)return;if(!this.switchingTrack&&this._streamEnded(u,o))return t.trigger(l.BUFFER_EOS,{type:"audio"}),void(this.state=mi);const h=u.len,d=t.maxBufferLength,p=o.fragments,m=p[0].start,g=this.getLoadPosition(),v=this.flushing?g:u.end;if(this.switchingTrack&&i){const e=g;o.PTSKnown&&e<m&&(u.end>m||u.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),i.currentTime=m+.05)}if(h>=d&&!this.switchingTrack&&v<p[p.length-1].start)return;let y=this.getNextFragment(v,o);if(y&&this.isLoopLoading(y,v)&&(y=this.getNextFragmentLoopLoading(y,o,u,f.MAIN,d)),!y)return void(this.bufferFlushed=!0);let b=(null==(e=this.mainFragLoading)?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&b&&j(y)&&!y.endList&&(!o.live||!this.loadingParts&&v<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(b)===Tt&&(this.mainFragLoading=b=null),b&&j(b))){if(y.start>b.end){const e=this.fragmentTracker.getFragAtPos(v,f.MAIN);e&&e.end>b.end&&(b=e,this.mainFragLoading={frag:e,targetBufferTime:null})}if(y.start>b.end)return}this.loadFragment(y,a,v)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,t){let{audioTracks:n}=t;this.resetTransmuxer(),this.levels=n.map(e=>new We(e))}onAudioTrackSwitching(e,t){const n=!!t.url;this.trackId=t.id;const{fragCurrent:i}=this;i&&(i.abortRequests(),this.removeUnbufferedFrags(i.start)),this.resetLoadingState(),n?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==oi&&(this.setInterval(100),this.state=li,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const n=this.cachedTrackLoadedData;n&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(l.AUDIO_TRACK_LOADED,n))}onAudioTrackLoaded(e,t){var n;const{levels:i}=this,{details:r,id:s,groupId:a,track:o}=t;if(!i)return void this.warn("Audio tracks reset while loading track ".concat(s,' "').concat(o.name,'" of "').concat(a,'"'));const c=this.mainDetails;if(!c||r.endCC>c.endCC||c.expired)return this.cachedTrackLoadedData=t,void(this.state!==oi&&(this.state=di));this.cachedTrackLoadedData=null,this.log("Audio track ".concat(s,' "').concat(o.name,'" of "').concat(a,'" loaded [').concat(r.startSN,",").concat(r.endSN,"]").concat(r.lastPartSn?"[part-".concat(r.lastPartSn,"-").concat(r.lastPartIndex,"]"):"",",duration:").concat(r.totalduration));const u=i[s];let h=0;if(r.live||null!=(n=u.details)&&n.live){if(this.checkLiveUpdate(r),r.deltaUpdateFailed)return;var d;if(u.details)h=this.alignPlaylists(r,u.details,null==(d=this.levelLastLoaded)?void 0:d.details);r.alignedSliding||(ni(r,c),r.alignedSliding||ii(r,c),h=r.fragmentStart)}u.details=r,this.levelLastLoaded=u,this.startFragRequested||this.setStartPosition(c,h),this.hls.trigger(l.AUDIO_TRACK_UPDATED,{details:r,id:s,groupId:t.groupId}),this.state!==di||this.waitForCdnTuneIn(r)||(this.state=li),this.tick()}_handleFragmentLoadProgress(e){var t;const n=e.frag,{part:i,payload:r}=e,{config:s,trackId:a,levels:o}=this;if(!o)return void this.warn("Audio tracks were reset while fragment load was in progress. Fragment ".concat(n.sn," of level ").concat(n.level," will not be buffered"));const l=o[a];if(!l)return void this.warn("Audio track is undefined on fragment load progress");const c=l.details;if(!c)return this.warn("Audio track details undefined on fragment load progress"),void this.removeUnbufferedFrags(n.start);const u=s.defaultAudioCodec||l.audioCodec||"mp4a.40.2";let h=this.transmuxer;h||(h=this.transmuxer=new Zr(this.hls,f.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const d=this.initPTS[n.cc],p=null==(t=n.initSegment)?void 0:t.data;if(void 0!==d){const e=!1,t=i?i.index:-1,s=-1!==t,a=new jt(n.level,n.sn,n.stats.chunkCount,r.byteLength,t,s);h.push(r,p,u,"",n,i,c.totalduration,e,a,d)}else{this.log("Unknown video PTS for cc ".concat(n.cc,", waiting for video PTS before demuxing audio frag ").concat(n.sn," of [").concat(c.startSN," ,").concat(c.endSN,"],track ").concat(a));const{cache:e}=this.waitingData=this.waitingData||{frag:n,part:i,cache:new _i,complete:!1};e.push(new Uint8Array(r)),this.state!==oi&&(this.state=vi)}}_handleFragmentLoadComplete(e){this.waitingData?this.waitingData.complete=!0:super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const n=t.tracks.audio;n&&(this.mediaBuffer=n.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===f.MAIN&&j(t.frag)&&(this.mainFragLoading=t,this.state===li&&this.tick())}onFragBuffered(e,t){const{frag:n,part:i}=t;if(n.type===f.AUDIO)if(this.fragContextChanged(n))this.warn("Fragment ".concat(n.sn).concat(i?" p: "+i.index:""," of level ").concat(n.level," finished buffering, but was aborted. state: ").concat(this.state,", audioSwitch: ").concat(this.switchingTrack?this.switchingTrack.name:"false"));else{if(j(n)){this.fragPrevious=n;const e=this.switchingTrack;e&&(this.bufferedTrack=e,this.switchingTrack=null,this.hls.trigger(l.AUDIO_TRACK_SWITCHED,b({},e)))}this.fragBufferedComplete(n,i),this.media&&this.tick()}else this.audioOnly||n.type!==f.MAIN||n.elementaryStreams.video||n.elementaryStreams.audiovideo||(this.audioOnly=!0,this.mainFragLoading=null)}onError(e,t){var n;if(t.fatal)this.state=gi;else switch(t.details){case o.FRAG_GAP:case o.FRAG_PARSING_ERROR:case o.FRAG_DECRYPT_ERROR:case o.FRAG_LOAD_ERROR:case o.FRAG_LOAD_TIMEOUT:case o.KEY_LOAD_ERROR:case o.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(f.AUDIO,t);break;case o.AUDIO_TRACK_LOAD_ERROR:case o.AUDIO_TRACK_LOAD_TIMEOUT:case o.LEVEL_PARSING_ERROR:t.levelRetry||this.state!==di||(null==(n=t.context)?void 0:n.type)!==h||(this.state=li);break;case o.BUFFER_ADD_CODEC_ERROR:case o.BUFFER_APPEND_ERROR:if("audio"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case o.BUFFER_FULL_ERROR:if("audio"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case o.INTERNAL_EXCEPTION:this.recoverWorkerError(t)}}onBufferFlushing(e,t){let{type:n}=t;n!==U&&(this.flushing=!0)}onBufferFlushed(e,t){let{type:n}=t;if(n!==U){this.flushing=!1,this.bufferFlushed=!0,this.state===mi&&(this.state=li);const e=this.mediaBuffer||this.media;e&&(this.afterBufferFlushed(e,n,f.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const n="audio",{hls:i}=this,{remuxResult:r,chunkMeta:s}=e,a=this.getCurrentContext(s);if(!a)return void this.resetWhenMissingContext(s);const{frag:o,part:c,level:u}=a,{details:h}=u,{audio:d,text:f,id3:p,initSegment:m}=r;if(!this.fragContextChanged(o)&&h){if(this.state=fi,this.switchingTrack&&d&&this.completeAudioSwitch(this.switchingTrack),null!=m&&m.tracks){const e=o.initSegment||o;if(this.unhandledEncryptionError(m,o))return;this._bufferInitSegment(u,m.tracks,e,s),i.trigger(l.FRAG_PARSING_INIT_SEGMENT,{frag:e,id:n,tracks:m.tracks})}if(d){const{startPTS:e,endPTS:t,startDTS:n,endDTS:i}=d;c&&(c.elementaryStreams[F]={startPTS:e,endPTS:t,startDTS:n,endDTS:i}),o.setElementaryStreamInfo(F,e,t,n,i),this.bufferFragmentData(d,o,c,s)}if(null!=p&&null!=(t=p.samples)&&t.length){const e=v({id:n,frag:o,details:h},p);i.trigger(l.FRAG_PARSING_METADATA,e)}if(f){const e=v({id:n,frag:o,details:h},f);i.trigger(l.FRAG_PARSING_USERDATA,e)}}else this.fragmentTracker.removeFragment(o)}_bufferInitSegment(e,t,n,i){if(this.state!==fi)return;if(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio)return;const r=t.audio;r.id=f.AUDIO;const s=e.audioCodec;this.log("Init audio buffer, container:".concat(r.container,", codecs[level/parsed]=[").concat(s,"/").concat(r.codec,"]")),s&&1===s.split(",").length&&(r.levelCodec=s),this.hls.trigger(l.BUFFER_CODECS,t);const a=r.initSegment;if(null!=a&&a.byteLength){const e={type:"audio",frag:n,part:null,chunkMeta:i,parent:n.type,data:a};this.hls.trigger(l.BUFFER_APPENDING,e)}this.tickImmediate()}loadFragment(e,t,n){const i=this.fragmentTracker.getState(e);var r;if(this.switchingTrack||i===_t||i===Et)if(j(e))if(null!=(r=t.details)&&r.live&&!this.initPTS[e.cc]){this.log("Waiting for video PTS in continuity counter ".concat(e.cc," of live stream before loading audio fragment ").concat(e.sn," of level ").concat(this.trackId)),this.state=vi;const n=this.mainDetails;n&&n.fragmentStart!==t.details.fragmentStart&&ii(t.details,n)}else super.loadFragment(e,t,n);else this._loadInitSegment(e,t);else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:n,assocLang:i,characteristics:r,audioCodec:s,channels:a}=this.bufferedTrack;$e({name:t,lang:n,assocLang:i,characteristics:r,audioCodec:s,channels:a},e,et)||(nt(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(l.AUDIO_TRACK_SWITCHED,b({},e))}}class Qr extends x{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){-1!==this.timer&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,n){const i=null==t?void 0:t.renditionReports;if(i){let s=-1;for(let n=0;n<i.length;n++){const a=i[n];let o;try{o=new self.URL(a.URI,t.url).href}catch(r){this.warn("Could not construct new URL for Rendition Report: ".concat(r)),o=a.URI||""}if(o===e){s=n;break}o===e.substring(0,o.length)&&(s=n)}if(-1!==s){const e=i[s],r=parseInt(e["LAST-MSN"])||t.lastPartSn;let a=parseInt(e["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){const e=Math.min(t.age-t.partTarget,t.targetduration);a>=0&&e>t.partTarget&&(a+=1)}const o=n&&Ve(n);return new He(r,a>=0?a:void 0,o)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(n){this.warn("Could not construct new URL with HLS Delivery Directives: ".concat(n))}return e}playlistLoaded(e,t,n){const{details:i,stats:r}=t,s=self.performance.now(),c=r.loading.first?Math.max(0,s-r.loading.first):0;i.advancedDateTime=Date.now()-c;const u=this.hls.config.timelineOffset;if(u!==i.appliedTimelineOffset){const e=Math.max(u||0,0);i.appliedTimelineOffset=e,i.fragments.forEach(t=>{t.setStart(t.playlistOffset+e)})}if(i.live||null!=n&&n.live){const u="levelInfo"in t?t.levelInfo:t.track;if(i.reloaded(n),n&&i.fragments.length>0){Gn(n,i,this);const e=i.playlistParsingError;if(e){this.warn(e);const n=this.hls;if(!n.config.ignorePlaylistParsingErrors){var h;const{networkDetails:s}=t;return void n.trigger(l.ERROR,{type:a.NETWORK_ERROR,details:o.LEVEL_PARSING_ERROR,fatal:!1,url:i.url,error:e,reason:e.message,level:t.level||void 0,parent:null==(h=i.fragments[0])?void 0:h.type,networkDetails:s,stats:r})}i.playlistParsingError=null}}-1===i.requestScheduled&&(i.requestScheduled=r.loading.start);const d=this.hls.mainForwardBufferInfo,f=d?d.end-d.len:0,p=Yn(i,1e3*(i.edge-f));if(i.requestScheduled+p<s?i.requestScheduled=s:i.requestScheduled+=p,this.log("live playlist ".concat(e," ").concat(i.advanced?"REFRESHED "+i.lastPartSn+"-"+i.lastPartIndex:i.updated?"UPDATED":"MISSED")),!this.canLoad||!i.live)return;let m,g,v;if(i.canBlockReload&&i.endSN&&i.advanced){const e=this.hls.config.lowLatencyMode,r=i.lastPartSn,a=i.endSN,o=i.lastPartIndex,l=r===a;-1!==o?l?(g=a+1,v=e?0:o):(g=r,v=e?o+1:i.maxPartIndex):g=a+1;const c=i.age,h=c+i.ageHeader;let d=Math.min(h-i.partTarget,1.5*i.targetduration);if(d>0){if(h>3*i.targetduration)this.log("Playlist last advanced ".concat(c.toFixed(2),"s ago. Omitting segment and part directives.")),g=void 0,v=void 0;else if(null!=n&&n.tuneInGoal&&h-i.partTarget>n.tuneInGoal)this.warn("CDN Tune-in goal increased from: ".concat(n.tuneInGoal," to: ").concat(d," with playlist age: ").concat(i.age)),d=0;else{const e=Math.floor(d/i.targetduration);if(g+=e,void 0!==v){v+=Math.round(d%i.targetduration/i.partTarget)}this.log("CDN Tune-in age: ".concat(i.ageHeader,"s last advanced ").concat(c.toFixed(2),"s goal: ").concat(d," skip sn ").concat(e," to part ").concat(v))}i.tuneInGoal=d}if(m=this.getDeliveryDirectives(i,t.deliveryDirectives,g,v),e||!l)return i.requestScheduled=s,void this.loadingPlaylist(u,m)}else(i.canBlockReload||i.canSkipUntil)&&(m=this.getDeliveryDirectives(i,t.deliveryDirectives,g,v));m&&void 0!==g&&i.canBlockReload&&(i.requestScheduled=r.loading.first+Math.max(p-2*c,p/2)),this.scheduleLoading(u,m,i)}else this.clearTimer()}scheduleLoading(e,t,n){const i=n||e.details;if(!i)return void this.loadingPlaylist(e,t);const r=self.performance.now(),s=i.requestScheduled;if(r>=s)return void this.loadingPlaylist(e,t);const a=s-r;this.log("reload live playlist ".concat(e.name||e.bitrate+"bps"," in ").concat(Math.round(a)," ms")),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),a)}getDeliveryDirectives(e,t,n,i){let r=Ve(e);return null!=t&&t.skip&&e.deltaUpdateFailed&&(n=t.msn,i=t.part,r=Ge.No),new He(n,i,r)}checkRetry(e){const t=e.details,n=ct(e),i=e.errorAction,{action:r,retryCount:s=0,retryConfig:a}=i||{},o=!!i&&!!a&&(r===vt.RetryRequest||!i.resolved&&r===vt.SendAlternateToPenaltyBox);if(o){var l;if(s>=a.maxNumRetry)return!1;if(n&&null!=(l=e.context)&&l.deliveryDirectives)this.warn("Retrying playlist loading ".concat(s+1,"/").concat(a.maxNumRetry,' after "').concat(t,'" without delivery-directives')),this.loadPlaylist();else{const e=ft(a,s);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),e),this.warn("Retrying playlist loading ".concat(s+1,"/").concat(a.maxNumRetry,' after "').concat(t,'" in ').concat(e,"ms"))}e.levelRetry=!0,i.resolved=!0}return o}}function $r(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!es(e[n].attrs,t[n].attrs))return!1;return!0}function es(e,t,n){const i=e["STABLE-RENDITION-ID"];return i&&!n?i===t["STABLE-RENDITION-ID"]:!(n||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(n=>e[n]!==t[n])}function ts(e,t){return t.label.toLowerCase()===e.name.toLowerCase()&&(!t.language||t.language.toLowerCase()===(e.lang||"").toLowerCase())}class ns extends Qr{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(l.MANIFEST_LOADING,this.onManifestLoading,this),e.on(l.MANIFEST_PARSED,this.onManifestParsed,this),e.on(l.LEVEL_LOADING,this.onLevelLoading,this),e.on(l.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(l.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(l.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(l.MANIFEST_LOADING,this.onManifestLoading,this),e.off(l.MANIFEST_PARSED,this.onManifestParsed,this),e.off(l.LEVEL_LOADING,this.onLevelLoading,this),e.off(l.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(l.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(l.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:n,groupId:i,details:r}=t,s=this.tracksInGroup[n];if(!s||s.groupId!==i)return void this.warn("Audio track with id:".concat(n," and group:").concat(i," not found in active group ").concat(null==s?void 0:s.groupId));const a=s.details;s.details=t.details,this.log("Audio track ".concat(n,' "').concat(s.name,'" lang:').concat(s.lang," group:").concat(i," loaded [").concat(r.startSN,"-").concat(r.endSN,"]")),n===this.trackId&&this.playlistLoaded(n,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const n=t.audioGroups||null,i=this.groupIds;let r=this.currentTrack;if(!n||(null==i?void 0:i.length)!==(null==n?void 0:n.length)||null!=n&&n.some(e=>-1===(null==i?void 0:i.indexOf(e)))){this.groupIds=n,this.trackId=-1,this.currentTrack=null;const e=this.tracks.filter(e=>!n||-1!==n.indexOf(e.groupId));if(e.length)this.selectDefaultTrack&&!e.some(e=>e.default)&&(this.selectDefaultTrack=!1),e.forEach((e,t)=>{e.id=t});else if(!r&&!this.tracksInGroup.length)return;this.tracksInGroup=e;const t=this.hls.config.audioPreference;if(!r&&t){const n=Qe(t,e,et);if(n>-1)r=e[n];else{const e=Qe(t,this.tracks);r=this.tracks[e]}}let i=this.findTrackId(r);-1===i&&r&&(i=this.findTrackId(null));const c={audioTracks:e};this.log("Updating audio tracks, ".concat(e.length," track(s) found in group(s): ").concat(null==n?void 0:n.join(","))),this.hls.trigger(l.AUDIO_TRACKS_UPDATED,c);const u=this.trackId;if(-1!==i&&-1===u)this.setAudioTrack(i);else if(e.length&&-1===u){var s;const t=new Error("No audio track selected for current audio group-ID(s): ".concat(null==(s=this.groupIds)?void 0:s.join(",")," track count: ").concat(e.length));this.warn(t.message),this.hls.trigger(l.ERROR,{type:a.MEDIA_ERROR,details:o.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:t})}}}onError(e,t){!t.fatal&&t.context&&(t.context.type!==h||t.context.id!==this.trackId||this.groupIds&&-1===this.groupIds.indexOf(t.context.groupId)||this.checkRetry(t))}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const n=this.allAudioTracks;if(this.selectDefaultTrack=!1,n.length){const i=this.currentTrack;if(i&&$e(e,i,et))return i;const r=Qe(e,this.tracksInGroup,et);if(r>-1){const e=this.tracksInGroup[r];return this.setAudioTrack(r),e}if(i){let i=t.loadLevel;-1===i&&(i=t.firstAutoLevel);const r=function(e,t,n,i,r){const s=t[i],a=t.reduce((e,t,n)=>{const i=t.uri;return(e[i]||(e[i]=[])).push(n),e},{})[s.uri];a.length>1&&(i=Math.max.apply(Math,a));const o=s.videoRange,l=s.frameRate,c=s.codecSet.substring(0,4),u=tt(t,i,t=>{if(t.videoRange!==o||t.frameRate!==l||t.codecSet.substring(0,4)!==c)return!1;const i=t.audioGroups,s=n.filter(e=>!i||-1!==i.indexOf(e.groupId));return Qe(e,s,r)>-1});return u>-1?u:tt(t,i,t=>{const i=t.audioGroups,s=n.filter(e=>!i||-1!==i.indexOf(e.groupId));return Qe(e,s,r)>-1})}(e,t.levels,n,i,et);if(-1===r)return null;t.nextLoadLevel=r}if(e.channels||e.audioCodec){const t=Qe(e,n);if(t>-1)return n[t]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length)return void this.warn("Invalid audio track id: ".concat(e));this.selectDefaultTrack=!1;const n=this.currentTrack,i=t[e],r=i.details&&!i.details.live;if(e===this.trackId&&i===n&&r)return;if(this.log("Switching to audio-track ".concat(e,' "').concat(i.name,'" lang:').concat(i.lang," group:").concat(i.groupId," channels:").concat(i.channels)),this.trackId=e,this.currentTrack=i,this.hls.trigger(l.AUDIO_TRACK_SWITCHING,b({},i)),r)return;const s=this.switchParams(i.url,null==n?void 0:n.details,i.details);this.loadPlaylist(s)}findTrackId(e){const t=this.tracksInGroup;for(let n=0;n<t.length;n++){const i=t[n];if((!this.selectDefaultTrack||i.default)&&(!e||$e(e,i,et)))return n}if(e){const{name:n,lang:i,assocLang:r,characteristics:s,audioCodec:a,channels:o}=e;for(let e=0;e<t.length;e++){if($e({name:n,lang:i,assocLang:r,characteristics:s,audioCodec:a,channels:o},t[e],et))return e}for(let l=0;l<t.length;l++){const n=t[l];if(es(e.attrs,n.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return l}for(let l=0;l<t.length;l++){const n=t[l];if(es(e.attrs,n.attrs,["LANGUAGE"]))return l}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&nt(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=e.id,i=e.groupId,r=this.getUrlWithDirectives(e.url,t),s=e.details,a=null==s?void 0:s.age;this.log("Loading audio-track ".concat(n,' "').concat(e.name,'" lang:').concat(e.lang," group:").concat(i).concat(void 0!==(null==t?void 0:t.msn)?" at sn "+t.msn+" part "+t.part:"").concat(a&&s.live?" age "+a.toFixed(1)+(s.type?" "+s.type||0:""):""," ").concat(r)),this.hls.trigger(l.AUDIO_TRACK_LOADING,{url:r,id:n,groupId:i,deliveryDirectives:t||null,track:e})}}class is{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,n){if(null===this.queues||null===this.tracks)return;const i=this.queues[t];i.push(e),1!==i.length||n||this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const n={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(n,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const n={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(n)}})}removeBlockers(){null!==this.queues&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const n=null==(t=e[0])?void 0:t.label;"async-blocker"!==n&&"async-blocker-prepend"!==n||(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(null===this.queues)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(null===this.queues||null===this.tracks)return;const t=this.queues[e];if(t.length){const r=t[0];try{r.execute()}catch(i){var n;if(r.onError(i),null===this.queues||null===this.tracks)return;const t=null==(n=this.tracks[e])?void 0:n.buffer;null!=t&&t.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){null!==this.queues&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return(null==(t=this.queues)?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return null===e||null===t?"<destroyed>":"\n".concat(this.list("video"),"\n").concat(this.list("audio"),"\n").concat(this.list("audiovideo"),"}")}list(e){var t,n;return null!=(t=this.queues)&&t[e]||null!=(n=this.tracks)&&n[e]?"".concat(e,": (").concat(this.listSbInfo(e),") ").concat(this.listOps(e)):""}listSbInfo(e){var t;const n=null==(t=this.tracks)?void 0:t[e],i=null==n?void 0:n.buffer;return i?"SourceBuffer".concat(i.updating?" updating":"").concat(n.ended?" ended":"").concat(n.ending?" ending":""):"none"}listOps(e){var t;return(null==(t=this.queues)?void 0:t[e].map(e=>e.label).join(", "))||""}}const rs=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,ss="HlsJsTrackRemovedError";class as extends Error{constructor(e){super(e),this.name=ss}}class os extends x{constructor(e,t){var n;super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=e=>{var t;this.hls&&"open"===(null==(t=this.mediaSource)?void 0:t.readyState)&&this.hls.pauseBuffering()},this._onStartStreaming=e=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=e=>{const{media:t,mediaSource:n}=this;e&&this.log("Media source opened"),t&&n&&(n.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(l.MEDIA_ATTACHED,{media:t,mediaSource:n}),null!==this.mediaSource&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:e,_objectUrl:t}=this;e!==t&&this.error("Media element src was set while attaching MediaSource (".concat(t," > ").concat(e,")"))},this.hls=e,this.fragmentTracker=t,this.appendSource=(n=M(e.config.preferManagedMediaSource),"undefined"!==typeof self&&n===self.ManagedMediaSource),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(l.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(l.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(l.MANIFEST_LOADING,this.onManifestLoading,this),e.on(l.MANIFEST_PARSED,this.onManifestParsed,this),e.on(l.BUFFER_RESET,this.onBufferReset,this),e.on(l.BUFFER_APPENDING,this.onBufferAppending,this),e.on(l.BUFFER_CODECS,this.onBufferCodecs,this),e.on(l.BUFFER_EOS,this.onBufferEos,this),e.on(l.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(l.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(l.FRAG_PARSED,this.onFragParsed,this),e.on(l.FRAG_CHANGED,this.onFragChanged,this),e.on(l.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(l.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(l.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(l.MANIFEST_LOADING,this.onManifestLoading,this),e.off(l.MANIFEST_PARSED,this.onManifestParsed,this),e.off(l.BUFFER_RESET,this.onBufferReset,this),e.off(l.BUFFER_APPENDING,this.onBufferAppending,this),e.off(l.BUFFER_CODECS,this.onBufferCodecs,this),e.off(l.BUFFER_EOS,this.onBufferEos,this),e.off(l.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(l.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(l.FRAG_PARSED,this.onFragParsed,this),e.off(l.FRAG_CHANGED,this.onFragChanged,this),e.off(l.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const n={};if(this.operationQueue){const e=this.isUpdating();e||this.operationQueue.removeBlockers();const t=this.isQueued();(e||t)&&this.warn("Transfering MediaSource with".concat(t?" operations in queue":"").concat(e?" updating SourceBuffer(s)":""," ").concat(this.operationQueue)),this.operationQueue.destroy()}const i=this.transferData;return!this.sourceBufferCount&&i&&i.mediaSource===t?v(n,i.tracks):this.sourceBuffers.forEach(e=>{const[t]=e;t&&(n[t]=v({},this.tracks[t]),this.removeBuffer(t)),e[0]=e[1]=null}),{media:e,mediaSource:t,tracks:n}}initTracks(){this.sourceBuffers=[[null,null],[null,null]],this.tracks={},this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var n;let i=2;(t.audio&&!t.video||!t.altAudio)&&(i=1),this.bufferCodecEventsTotal=i,this.log("".concat(i," bufferCodec event(s) expected.")),null!=(n=this.transferData)&&n.mediaSource&&this.sourceBufferCount&&i&&this.bufferCreated()}onMediaAttaching(e,t){const n=this.media=t.media;this.transferData=this.overrides=void 0;const i=M(this.appendSource);if(i){const e=!!t.mediaSource;(e||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const s=this.mediaSource=t.mediaSource||new i;if(this.assignMediaSource(s),e)this._objectUrl=n.src,this.attachTransferred();else{const e=this._objectUrl=self.URL.createObjectURL(s);if(this.appendSource)try{n.removeAttribute("src");const t=self.ManagedMediaSource;n.disableRemotePlayback=n.disableRemotePlayback||t&&s instanceof t,ls(n),function(e,t){const n=self.document.createElement("source");n.type="video/mp4",n.src=t,e.appendChild(n)}(n,e),n.load()}catch(r){n.src=e}else n.src=e}n.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,n;this.log("".concat((null==(t=this.transferData)?void 0:t.mediaSource)===e?"transferred":"created"," media source: ").concat(null==(n=e.constructor)?void 0:n.name)),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const n=this.tracks,i=t.tracks,r=i?Object.keys(i):null,s=r?r.length:0,a=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(i&&r&&s){if(!this.tracksReady)return this.hls.config.startFragPrefetch=!0,void this.log("attachTransferred: waiting for SourceBuffer track info");if(this.log("attachTransferred: (bufferCodecEventsTotal ".concat(this.bufferCodecEventsTotal,")\nrequired tracks: ").concat(qe(n,(e,t)=>"initSegment"===e?void 0:t),";\ntransfer tracks: ").concat(qe(i,(e,t)=>"initSegment"===e?void 0:t),"}")),!R(i,n)){t.mediaSource=null,t.tracks=void 0;const r=e.currentTime,s=this.details,a=Math.max(r,(null==s?void 0:s.fragments[0].start)||0);return a-r>1?void this.log("attachTransferred: waiting for playback to reach new tracks start time ".concat(r," -> ").concat(a)):(this.warn('attachTransferred: resetting MediaSource for incompatible tracks ("'.concat(Object.keys(i),'"->"').concat(Object.keys(n),'") start time: ').concat(a," currentTime: ").concat(r)),this.onMediaDetaching(l.MEDIA_DETACHING,{}),this.onMediaAttaching(l.MEDIA_ATTACHING,t),void(e.currentTime=a))}this.transferData=void 0,r.forEach(e=>{const t=e,n=i[t];if(n){const e=n.buffer;if(e){const i=this.fragmentTracker,r=n.id;if(i.hasFragments(r)||i.hasParts(r)){const n=Vt.getBuffered(e);i.detectEvictedFragments(t,n,r,null,!0)}const s=cs(t),a=[t,e];this.sourceBuffers[s]=a,e.updating&&this.operationQueue&&this.operationQueue.prependBlocker(t),this.trackSourceBuffer(t,n)}}}),a(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),a()}get mediaSourceOpenOrEnded(){var e;const t=null==(e=this.mediaSource)?void 0:e.readyState;return"open"===t||"ended"===t}onMediaDetaching(e,t){const n=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:i,mediaSource:r,_objectUrl:s}=this;if(r){if(this.log("media source ".concat(n?"transferring":"detaching")),n)this.sourceBuffers.forEach(e=>{let[t]=e;t&&this.removeBuffer(t)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const e="open"===r.readyState;try{const t=r.sourceBuffers;for(let n=t.length;n--;)e&&t[n].abort(),r.removeSourceBuffer(t[n]);e&&r.endOfStream()}catch(hl){this.warn("onMediaDetaching: ".concat(hl.message," while calling endOfStream"))}}this.sourceBufferCount&&this.onBufferReset()}r.removeEventListener("sourceopen",this._onMediaSourceOpen),r.removeEventListener("sourceended",this._onMediaSourceEnded),r.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(r.removeEventListener("startstreaming",this._onStartStreaming),r.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}i&&(i.removeEventListener("emptied",this._onMediaEmptied),n||(s&&self.URL.revokeObjectURL(s),this.mediaSrc===s?(i.removeAttribute("src"),this.appendSource&&ls(i),i.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(l.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(e=>{let[t]=e;t&&this.resetBuffer(t)}),this.initTracks()}resetBuffer(e){var t;const n=null==(t=this.tracks[e])?void 0:t.buffer;if(this.removeBuffer(e),n)try{var i;null!=(i=this.mediaSource)&&i.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(n)}catch(hl){this.warn("onBufferReset ".concat(e),hl)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[cs(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new is(this.tracks)}onBufferCodecs(e,t){var n;const i=this.tracks,r=Object.keys(t);this.log('BUFFER_CODECS: "'.concat(r,'" (current SB count ').concat(this.sourceBufferCount,")"));const s="audiovideo"in t&&(i.audio||i.video)||i.audiovideo&&("audio"in t||"video"in t),a=!s&&this.sourceBufferCount&&this.media&&r.some(e=>!i[e]);s||a?this.warn('Unsupported transition between "'.concat(Object.keys(i),'" and "').concat(r,'" SourceBuffers')):(r.forEach(e=>{var n,r;const s=t[e],{id:a,codec:o,levelCodec:l,container:c,metadata:u,supplemental:h}=s;let d=i[e];const f=null==(n=this.transferData)||null==(n=n.tracks)?void 0:n[e],p=null!=f&&f.buffer?f:d,m=(null==p?void 0:p.pendingCodec)||(null==p?void 0:p.codec),g=null==p?void 0:p.levelCodec;d||(d=i[e]={buffer:void 0,listeners:[],codec:o,supplemental:h,container:c,levelCodec:l,metadata:u,id:a});const v=Re(m,g),y=null==v?void 0:v.replace(rs,"$1");let b=Re(o,l);const x=null==(r=b)?void 0:r.replace(rs,"$1");b&&v&&y!==x&&("audio"===e.slice(0,5)&&(b=Me(b,this.appendSource)),this.log("switching codec ".concat(m," to ").concat(b)),b!==(d.pendingCodec||d.codec)&&(d.pendingCodec=b),d.container=c,this.appendChangeType(e,c,b))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),this.sourceBufferCount||(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!t.video&&"main"===(null==(n=t.audio)?void 0:n.id)&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks()))}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const n=this.tracks[t];return e[t]={id:n.id,container:n.container,codec:n.codec,levelCodec:n.levelCodec},e},{})}appendChangeType(e,t,n){const i="".concat(t,";codecs=").concat(n),r={label:"change-type=".concat(i),execute:()=>{const r=this.tracks[e];if(r){const s=r.buffer;null!=s&&s.changeType&&(this.log("changing ".concat(e," sourceBuffer type to ").concat(i)),s.changeType(i),r.codec=n,r.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:t=>{this.warn("Failed to change ".concat(e," SourceBuffer type"),t)}};this.append(r,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const n=e.start,i=n+.05*e.duration;if(!0===(null==(t=this.fragmentTracker.getAppendedFrag(n,f.MAIN))?void 0:t.gap))return;const r={label:"block-audio",execute:()=>{var e;const t=this.tracks.video;(this.lastVideoAppendEnd>i||null!=t&&t.buffer&&Vt.isBuffered(t.buffer,i)||!0===(null==(e=this.fragmentTracker.getAppendedFrag(i,f.MAIN))?void 0:e.gap))&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:e=>{this.warn("Error executing block-audio operation",e)}};this.blockedAudioAppend={op:r,frag:e},this.append(r,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:n}=this,{data:r,type:s,parent:c,frag:u,part:h,chunkMeta:d,offset:p}=t,m=d.buffering[s],{sn:g,cc:v}=u,y=self.performance.now();m.start=y;const b=u.stats.buffering,x=h?h.stats.buffering:null;0===b.start&&(b.start=y),x&&0===x.start&&(x.start=y);const _=n.audio;let S=!1;"audio"===s&&"audio/mpeg"===(null==_?void 0:_.container)&&(S=!this.lastMpegAudioChunk||1===d.id||this.lastMpegAudioChunk.sn!==d.sn,this.lastMpegAudioChunk=d);const E=n.video,T=null==E?void 0:E.buffer;if(T&&"initSegment"!==g){const e=h||u,t=this.blockedAudioAppend;if("audio"!==s||"main"===c||this.blockedAudioAppend||E.ending||E.ended){if("video"===s){const n=e.end;if(t){const e=t.frag.start;(n>e||n<this.lastVideoAppendEnd||Vt.isBuffered(T,e))&&this.unblockAudio()}this.lastVideoAppendEnd=n}}else{const t=e.start+.05*e.duration,n=T.buffered,i=this.currentOp("video");n.length||i?!i&&!Vt.isBuffered(T,t)&&this.lastVideoAppendEnd<t&&this.blockAudio(e):this.blockAudio(e)}}const w=(h||u).start,A={label:"append-".concat(s),execute:()=>{var e;m.executeStart=self.performance.now();const t=null==(e=this.tracks[s])?void 0:e.buffer;t&&(S?this.updateTimestampOffset(t,w,.1,s,g,v):void 0!==p&&i(p)&&this.updateTimestampOffset(t,p,1e-6,s,g,v)),this.appendExecutor(r,s)},onStart:()=>{},onComplete:()=>{const e=self.performance.now();m.executeEnd=m.end=e,0===b.first&&(b.first=e),x&&0===x.first&&(x.first=e);const t={};this.sourceBuffers.forEach(e=>{let[n,i]=e;n&&(t[n]=Vt.getBuffered(i))}),this.appendErrors[s]=0,"audio"===s||"video"===s?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(l.BUFFER_APPENDED,{type:s,frag:u,part:h,chunkMeta:d,parent:u.type,timeRanges:t})},onError:e=>{var t;const n={type:a.MEDIA_ERROR,parent:u.type,details:o.BUFFER_APPEND_ERROR,sourceBufferName:s,frag:u,part:h,chunkMeta:d,error:e,err:e,fatal:!1},i=null==(t=this.media)?void 0:t.error;if(e.code===DOMException.QUOTA_EXCEEDED_ERR||"QuotaExceededError"==e.name||"quota"in e)n.details=o.BUFFER_FULL_ERROR;else if(e.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!i)n.errorAction=xt(!0);else if(e.name===ss&&0===this.sourceBufferCount)n.errorAction=xt(!0);else{const e=++this.appendErrors[s];this.warn("Failed ".concat(e,"/").concat(this.hls.config.appendErrorMaxRetry,' times to append segment in "').concat(s,'" sourceBuffer (').concat(i||"no media error",")")),(e>=this.hls.config.appendErrorMaxRetry||i)&&(n.fatal=!0)}this.hls.trigger(l.ERROR,n)}};this.log('queuing "'.concat(s,'" append sn: ').concat(g).concat(h?" p: "+h.index:""," of ").concat(u.type===f.MAIN?"level":"track"," ").concat(u.level," cc: ").concat(v)),this.append(A,s,this.isPending(this.tracks[s]))}getFlushOp(e,t,n){return this.log('queuing "'.concat(e,'" remove ').concat(t,"-").concat(n)),{label:"remove",execute:()=>{this.removeExecutor(e,t,n)},onStart:()=>{},onComplete:()=>{this.hls.trigger(l.BUFFER_FLUSHED,{type:e})},onError:i=>{this.warn("Failed to remove ".concat(t,"-").concat(n,' from "').concat(e,'" SourceBuffer'),i)}}}onBufferFlushing(e,t){const{type:n,startOffset:i,endOffset:r}=t;n?this.append(this.getFlushOp(n,i,r),n):this.sourceBuffers.forEach(e=>{let[t]=e;t&&this.append(this.getFlushOp(t,i,r),t)})}onFragParsed(e,t){const{frag:n,part:i}=t,r=[],s=i?i.elementaryStreams:n.elementaryStreams;s[B]?r.push("audiovideo"):(s[F]&&r.push("audio"),s[U]&&r.push("video"));0===r.length&&this.warn("Fragments must have at least one ElementaryStreamType set. type: ".concat(n.type," level: ").concat(n.level," sn: ").concat(n.sn)),this.blockBuffers(()=>{const e=self.performance.now();n.stats.buffering.end=e,i&&(i.stats.buffering.end=e);const t=i?i.stats:n.stats;this.hls.trigger(l.FRAG_BUFFERED,{frag:n,part:i,stats:t,id:n.type})},r).catch(e=>{this.warn("Fragment buffered callback ".concat(e)),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(e=>{let[t]=e;if(t){const e=this.tracks[t];if(e)return!e.ended||e.ending}return!1})}onBufferEos(e,t){var n;this.sourceBuffers.forEach(e=>{let[n]=e;if(n){const e=this.tracks[n];t.type&&t.type!==n||(e.ending=!0,e.ended||(e.ended=!0,this.log("".concat(n," buffer reached EOS"))))}});const i=!1!==(null==(n=this.overrides)?void 0:n.endOfStream);this.sourceBufferCount>0&&!this.sourceBuffers.some(e=>{let[t]=e;var n;return t&&!(null!=(n=this.tracks[t])&&n.ended)})?i?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:e}=this;e&&"open"===e.readyState?(this.log("Calling mediaSource.endOfStream()"),e.endOfStream(),this.hls.trigger(l.BUFFERED_TO_END,void 0)):e&&this.log("Could not call mediaSource.endOfStream(). mediaSource.readyState: ".concat(e.readyState))})):(this.tracksEnded(),this.hls.trigger(l.BUFFERED_TO_END,void 0)):"video"===t.type&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(e=>{let[t]=e;if(null!==t){const e=this.tracks[t];e&&(e.ending=!1)}})}onLevelUpdated(e,t){let{details:n}=t;n.fragments.length&&(this.details=n,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===o.BUFFER_APPEND_ERROR&&t.frag){var n;const e=null==(n=t.errorAction)?void 0:n.nextAutoLevel;i(e)&&e!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:n}=this;if(!n||null===t)return;if(!this.sourceBufferCount)return;const r=e.config,s=n.currentTime,a=t.levelTargetDuration,o=t.live&&null!==r.liveBackBufferLength?r.liveBackBufferLength:r.backBufferLength;if(i(o)&&o>=0){const e=Math.max(o,a),t=Math.floor(s/a)*a-e;this.flushBackBuffer(s,a,t)}const l=r.frontBufferFlushThreshold;if(i(l)&&l>0){const e=Math.max(r.maxBufferLength,l),t=Math.max(e,a),n=Math.floor(s/a)*a+t;this.flushFrontBuffer(s,a,n)}}flushBackBuffer(e,t,n){this.sourceBuffers.forEach(e=>{let[t,i]=e;if(i){const e=Vt.getBuffered(i);if(e.length>0&&n>e.start(0)){var r;this.hls.trigger(l.BACK_BUFFER_REACHED,{bufferEnd:n});const e=this.tracks[t];if(null!=(r=this.details)&&r.live)this.hls.trigger(l.LIVE_BACK_BUFFER_REACHED,{bufferEnd:n});else if(null!=e&&e.ended)return void this.log("Cannot flush ".concat(t," back buffer while SourceBuffer is in ended state"));this.hls.trigger(l.BUFFER_FLUSHING,{startOffset:0,endOffset:n,type:t})}}})}flushFrontBuffer(e,t,n){this.sourceBuffers.forEach(t=>{let[i,r]=t;if(r){const t=Vt.getBuffered(r),s=t.length;if(s<2)return;const a=t.start(s-1),o=t.end(s-1);if(n>a||e>=a&&e<=o)return;this.hls.trigger(l.BUFFER_FLUSHING,{startOffset:a,endOffset:1/0,type:i})}})}getDurationAndRange(){var e;const{details:t,mediaSource:n}=this;if(!t||!this.media||"open"!==(null==n?void 0:n.readyState))return null;const r=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&n.setLiveSeekableRange){const e=Math.max(0,t.fragmentStart);return{duration:1/0,start:e,end:Math.max(e,r)}}return{duration:1/0}}const s=null==(e=this.overrides)?void 0:e.duration;if(s)return i(s)?{duration:s}:null;const a=this.media.duration;return r>(i(n.duration)?n.duration:0)&&r>a||!i(a)?{duration:r}:null}updateMediaSource(e){let{duration:t,start:n,end:r}=e;const s=this.mediaSource;this.media&&s&&"open"===s.readyState&&(s.duration!==t&&(i(t)&&this.log("Updating MediaSource duration to ".concat(t.toFixed(3))),s.duration=t),void 0!==n&&void 0!==r&&(this.log("MediaSource duration is set to ".concat(s.duration,". Setting seekable range to ").concat(n,"-").concat(r,".")),s.setLiveSeekableRange(n,r)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:n}=this;if(this.log("checkPendingTracks (pending: ".concat(t," codec events expected: ").concat(e,") ").concat(qe(n))),this.tracksReady){var i;const e=null==(i=this.transferData)?void 0:i.tracks;e&&Object.keys(e).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(t=>{let[n,i]=t;if(n){const t=this.tracks[n];e[n]={buffer:i,container:t.container,codec:t.codec,supplemental:t.supplemental,levelCodec:t.levelCodec,id:t.id,metadata:t.metadata}}}),this.hls.trigger(l.BUFFER_CREATED,{tracks:e}),this.log("SourceBuffers created. Running queue: ".concat(this.operationQueue)),this.sourceBuffers.forEach(e=>{let[t]=e;this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(l.ERROR,{type:a.MEDIA_ERROR,details:o.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:n}=this;if(!n)throw new Error("createSourceBuffers called when mediaSource was null");for(const s in e){const c=s,u=e[c];if(this.isPending(u)){const e=this.getTrackCodec(u,c),s="".concat(u.container,";codecs=").concat(e);u.codec=e,this.log("creating sourceBuffer(".concat(s,")").concat(this.currentOp(c)?" Queued":""," ").concat(qe(u)));try{const e=n.addSourceBuffer(s),i=cs(c),r=[c,e];t[i]=r,u.buffer=e}catch(r){var i;return this.error("error while trying to add sourceBuffer: ".concat(r.message)),this.shiftAndExecuteNext(c),null==(i=this.operationQueue)||i.removeBlockers(),delete this.tracks[c],void this.hls.trigger(l.ERROR,{type:a.MEDIA_ERROR,details:o.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:r,sourceBufferName:c,mimeType:s,parent:u.id})}this.trackSourceBuffer(c,u)}}this.bufferCreated()}getTrackCodec(e,t){const n=e.supplemental;let i=e.codec;n&&("video"===t||"audiovideo"===t)&&xe(n,"video")&&(i=function(e,t){const n=[];if(e){const t=e.split(",");for(let e=0;e<t.length;e++)be(t[e],"video")||n.push(t[e])}return t&&n.push(t),n.join(",")}(i,n));const r=Re(i,e.levelCodec);return r?"audio"===t.slice(0,5)?Me(r,this.appendSource):r:""}trackSourceBuffer(e,t){const n=t.buffer;if(!n)return;const i=this.getTrackCodec(t,e);this.tracks[e]={buffer:n,codec:i,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(e,t)=>{const n=t.removedRanges;null!=n&&n.length&&this.hls.trigger(l.BUFFER_FLUSHED,{type:e})})}get mediaSrc(){var e,t;const n=(null==(e=this.media)||null==(t=e.querySelector)?void 0:t.call(e,"source"))||this.media;return null==n?void 0:n.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if("closed"===(null==(t=this.mediaSource)?void 0:t.readyState))return void this.resetBuffer(e);const n=this.currentOp(e);n&&(n.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var n;const i=new Error("".concat(e," SourceBuffer error. MediaSource readyState: ").concat(null==(n=this.mediaSource)?void 0:n.readyState));this.error("".concat(i),t),this.hls.trigger(l.ERROR,{type:a.MEDIA_ERROR,details:o.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:i,fatal:!1});const r=this.currentOp(e);r&&r.onError(i)}updateTimestampOffset(e,t,n,i,r,s){const a=t-e.timestampOffset;Math.abs(a)>=n&&(this.log("Updating ".concat(i," SourceBuffer timestampOffset to ").concat(t," (sn: ").concat(r," cc: ").concat(s,")")),e.timestampOffset=t)}removeExecutor(e,t,n){const{media:r,mediaSource:s}=this,a=this.tracks[e],o=null==a?void 0:a.buffer;if(!r||!s||!o)return this.warn("Attempting to remove from the ".concat(e," SourceBuffer, but it does not exist")),void this.shiftAndExecuteNext(e);const l=i(r.duration)?r.duration:1/0,c=i(s.duration)?s.duration:1/0,u=Math.max(0,t),h=Math.min(n,l,c);h>u&&(!a.ending||a.ended)?(a.ended=!1,this.log("Removing [".concat(u,",").concat(h,"] from the ").concat(e," SourceBuffer")),o.remove(u,h)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const n=this.tracks[t],i=null==n?void 0:n.buffer;if(!i)throw new as("Attempting to append to the ".concat(t," SourceBuffer, but it does not exist"));n.ending=!1,n.ended=!1,i.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(e=>{this.warn("SourceBuffer blocked callback ".concat(e)),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn("Callback run without blocking ".concat(this.operationQueue," ").concat(t))}}isUpdating(){return this.sourceBuffers.some(e=>{let[t,n]=e;return t&&n.updating})}isQueued(){return this.sourceBuffers.some(e=>{let[t]=e;return t&&!!this.currentOp(t)})}isPending(e){return!!e&&!e.buffer}blockBuffers(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sourceBufferTypes;if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:n}=this,i=t.map(e=>this.appendBlocker(e));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(i).then(t=>{n===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(e=>{var t;const n=null==(t=this.tracks[e])?void 0:t.buffer;n&&!n.updating&&this.shiftAndExecuteNext(e)})}append(e,t,n){this.operationQueue&&this.operationQueue.append(e,t,n)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,t)=>{let[n]=t;return e+(n?1:0)},0)}get sourceBufferTypes(){return this.sourceBuffers.map(e=>{let[t]=e;return t}).filter(e=>!!e)}addBufferListener(e,t,n){const i=this.tracks[e];if(!i)return;const r=i.buffer;if(!r)return;const s=n.bind(this,e);i.listeners.push({event:t,listener:s}),r.addEventListener(t,s)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const n=t.buffer;n&&(t.listeners.forEach(e=>{n.removeEventListener(e.event,e.listener)}),t.listeners.length=0)}}function ls(e){const t=e.querySelectorAll("source");[].slice.call(t).forEach(t=>{e.removeChild(t)})}function cs(e){return"audio"===e?1:0}class us{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(l.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(l.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(l.MANIFEST_PARSED,this.onManifestParsed,this),e.on(l.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(l.BUFFER_CODECS,this.onBufferCodecs,this),e.on(l.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(l.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(l.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(l.MANIFEST_PARSED,this.onManifestParsed,this),e.off(l.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(l.BUFFER_CODECS,this.onBufferCodecs,this),e.off(l.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const n=this.hls.levels[t.droppedLevel];this.isLevelAllowed(n)&&this.restrictedLevels.push({bitrate:n.bitrate,height:n.height,width:n.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const n=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,n.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&i(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0)return void(this.clientRect=null);const e=this.hls.levels;if(e.length){const t=this.hls,n=this.getMaxLevel(e.length-1);n!==this.autoLevelCapping&&t.logger.log("Setting autoLevelCapping to ".concat(n,": ").concat(e[n].height,"p@").concat(e[n].bitrate," for media ").concat(this.mediaWidth,"x").concat(this.mediaHeight)),t.autoLevelCapping=n,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const n=t.filter((t,n)=>this.isLevelAllowed(t)&&n<=e);return this.clientRect=null,us.getMaxLevelByMediaSize(n,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const n=e.getBoundingClientRect();t.width=n.width,t.height=n.height,t.width||t.height||(t.width=n.right-n.left||e.width||0,t.height=n.bottom-n.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch(t){}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(t=>e.bitrate===t.bitrate&&e.width===t.width&&e.height===t.height)}static getMaxLevelByMediaSize(e,t,n){if(null==e||!e.length)return-1;const i=(e,t)=>!t||(e.width!==t.width||e.height!==t.height);let r=e.length-1;const s=Math.max(t,n);for(let a=0;a<e.length;a+=1){const t=e[a];if((t.width>=s||t.height>=s)&&i(t,e[a+1])){r=a;break}}return r}}const hs={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},ds={HLS:"h"};class fs{constructor(e,t){Array.isArray(e)&&(e=e.map(e=>e instanceof fs?e:new fs(e))),this.value=e,this.params=t}}function ps(e,t,n,i){return new Error("failed to ".concat(e,' "').concat((r=t,Array.isArray(r)?JSON.stringify(r):r instanceof Map?"Map{}":r instanceof Set?"Set{}":"object"===typeof r?JSON.stringify(r):String(r)),'" as ').concat(n),{cause:i});var r}function ms(e,t,n){return ps("serialize",e,t,n)}class gs{constructor(e){this.description=e}}const vs="Bare Item";function ys(e){if(!1===ArrayBuffer.isView(e))throw ms(e,"Byte Sequence");return":".concat((t=e,btoa(String.fromCharCode(...t))),":");var t}function bs(e){if(function(e){return e<-999999999999999||999999999999999<e}(e))throw ms(e,"Integer");return e.toString()}function xs(e,t){if(e<0)return-xs(-e,t);const n=Math.pow(10,t);if(Math.abs(e*n%1-.5)<Number.EPSILON){const t=Math.floor(e*n);return(t%2===0?t:t+1)/n}return Math.round(e*n)/n}function _s(e){const t=xs(e,3);if(Math.floor(Math.abs(t)).toString().length>12)throw ms(e,"Decimal");const n=t.toString();return n.includes(".")?n:"".concat(n,".0")}const Ss=/[\x00-\x1f\x7f]+/;function Es(e){const t=(n=e).description||n.toString().slice(7,-1);var n;if(!1===/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(t))throw ms(t,"Token");return t}function Ts(e){switch(typeof e){case"number":if(!i(e))throw ms(e,vs);return Number.isInteger(e)?bs(e):_s(e);case"string":return function(e){if(Ss.test(e))throw ms(e,"String");return'"'.concat(e.replace(/\\/g,"\\\\").replace(/"/g,'\\"'),'"')}(e);case"symbol":return Es(e);case"boolean":return function(e){if("boolean"!==typeof e)throw ms(e,"Boolean");return e?"?1":"?0"}(e);case"object":if(e instanceof Date)return function(e){return"@".concat(bs(e.getTime()/1e3))}(e);if(e instanceof Uint8Array)return ys(e);if(e instanceof gs)return Es(e);default:throw ms(e,vs)}}function ws(e){if(!1===/^[a-z*][a-z0-9\-_.*]*$/.test(e))throw ms(e,"Key");return e}function As(e){return null==e?"":Object.entries(e).map(e=>{let[t,n]=e;return!0===n?";".concat(ws(t)):";".concat(ws(t),"=").concat(Ts(n))}).join("")}function Ms(e){return e instanceof fs?"".concat(Ts(e.value)).concat(As(e.params)):Ts(e)}function Rs(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{whitespace:!0};if("object"!==typeof e||null==e)throw ms(e,"Dict");const n=e instanceof Map?e.entries():Object.entries(e),i=(null===t||void 0===t?void 0:t.whitespace)?" ":"";return Array.from(n).map(e=>{let[t,n]=e;n instanceof fs===!1&&(n=new fs(n));let i=ws(t);var r;return!0===n.value?i+=As(n.params):(i+="=",Array.isArray(n.value)?i+="(".concat((r=n).value.map(Ms).join(" "),")").concat(As(r.params)):i+=Ms(n)),i}).join(",".concat(i))}function Cs(e,t){return Rs(e,t)}const Ls="CMCD-Object",Is="CMCD-Request",Ps="CMCD-Session",ks="CMCD-Status",Ds={br:Ls,ab:Ls,d:Ls,ot:Ls,tb:Ls,tpb:Ls,lb:Ls,tab:Ls,lab:Ls,url:Ls,pb:Is,bl:Is,tbl:Is,dl:Is,ltc:Is,mtp:Is,nor:Is,nrr:Is,rc:Is,sn:Is,sta:Is,su:Is,ttfb:Is,ttfbb:Is,ttlb:Is,cmsdd:Is,cmsds:Is,smrt:Is,df:Is,cs:Is,ts:Is,cid:Ps,pr:Ps,sf:Ps,sid:Ps,st:Ps,v:Ps,msd:Ps,bs:ks,bsd:ks,cdn:ks,rtp:ks,bg:ks,pt:ks,ec:ks,e:ks},Ns=Is;function Os(e,t){const n={};if(!e)return n;const i=Object.keys(e),r=t?(s=t,Object.keys(s).reduce((e,t)=>{var n;return null===(n=s[t])||void 0===n||n.forEach(n=>e[n]=t),e},{})):{};var s;return i.reduce((t,n)=>{var i;const s=Ds[n]||r[n]||Ns;return(null!==(i=t[s])&&void 0!==i?i:t[s]={})[n]=e[n],t},n)}const Fs="event";const Us=e=>Math.round(e),Bs=(e,t)=>Array.isArray(e)?e.map(e=>Bs(e,t)):e instanceof fs&&"string"===typeof e.value?new fs(Bs(e.value,t),e.params):(t.baseUrl&&(e=function(e,t){const n=new URL(e),i=new URL(t);if(n.origin!==i.origin)return e;const r=n.pathname.split("/").slice(1),s=i.pathname.split("/").slice(1,-1);for(;r[0]===s[0];)r.shift(),s.shift();for(;s.length;)s.shift(),r.unshift("..");return r.join("/")+n.search+n.hash}(e,t.baseUrl)),1===t.version?encodeURIComponent(e):e),zs=e=>100*Us(e/100),js={br:Us,d:Us,bl:zs,dl:zs,mtp:zs,nor:(e,t)=>{let n=e;return t.version>=2&&(e instanceof fs&&"string"===typeof e.value?n=new fs([e]):"string"===typeof e&&(n=[e])),Bs(n,t)},rtp:zs,tb:Us},Gs="request",Vs="response",Hs=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],Ws=["e"],Ys=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function Xs(e){return Ys.test(e)}const qs=["d","dl","nor","ot","rtp","su"];const Ks=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];const Zs=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function Js(e){return Zs.includes(e)||Xs(e)}const Qs={[Vs]:function(e){return Hs.includes(e)||qs.includes(e)||Ks.includes(e)||Xs(e)},[Fs]:function(e){return Hs.includes(e)||Ws.includes(e)||Xs(e)},[Gs]:function(e){return Hs.includes(e)||qs.includes(e)||Xs(e)}};function $s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n={};if(null==e||"object"!==typeof e)return n;const r=t.version||e.v||1,s=t.reportingMode||Gs,a=1===r?Js:Qs[s];let o=Object.keys(e).filter(a);const l=t.filter;"function"===typeof l&&(o=o.filter(l));const c=s===Vs||s===Fs;c&&!o.includes("ts")&&o.push("ts"),r>1&&!o.includes("v")&&o.push("v");const u=v({},js,t.formatters),h={version:r,reportingMode:s,baseUrl:t.baseUrl};return o.sort().forEach(t=>{let s=e[t];const a=u[t];if("function"===typeof a&&(s=a(s,h)),"v"===t){if(1===r)return;s=r}"pr"==t&&1===s||(c&&"ts"===t&&!i(s)&&(s=Date.now()),function(e){return"number"===typeof e?i(e):null!=e&&""!==e&&!1!==e}(s)&&(function(e){return["ot","sf","st","e","sta"].includes(e)}(t)&&"string"===typeof s&&(s=new gs(s)),n[t]=s))}),n}function ea(e,t,n){return v(e,function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n={};if(!e)return n;const i=Os($s(e,t),null===t||void 0===t?void 0:t.customHeaderMap);return Object.entries(i).reduce((e,t)=>{let[n,i]=t;const r=Cs(i,{whitespace:!1});return r&&(e[n]=r),e},n)}(t,n))}function ta(e){if(!e)return"";const t=function(e){return e?Cs($s(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),{whitespace:!1}):""}(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{});return encodeURIComponent(t)}const na=/CMCD=[^&#]+/;function ia(e,t,n){const i=function(e){if(!e)return"";const t=ta(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{});return"".concat("CMCD","=").concat(t)}(t,n);if(!i)return e;if(na.test(e))return e.replace(na,i);const r=e.includes("?")?"&":"?";return"".concat(e).concat(r).concat(i)}class ra{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=e=>{try{this.apply(e,{ot:hs.MANIFEST,su:!this.initialized})}catch(t){this.hls.logger.warn("Could not generate manifest CMCD data.",t)}},this.applyFragmentData=e=>{try{const{frag:t,part:n}=e,i=this.hls.levels[t.level],r=this.getObjectType(t),s={d:1e3*(n||t).duration,ot:r};r!==hs.VIDEO&&r!==hs.AUDIO&&r!=hs.MUXED||(s.br=i.bitrate/1e3,s.tb=this.getTopBandwidth(r)/1e3,s.bl=this.getBufferLength(r));const a=n?this.getNextPart(n):this.getNextFrag(t);null!=a&&a.url&&a.url!==t.url&&(s.nor=a.url),this.apply(e,s)}catch(t){this.hls.logger.warn("Could not generate segment CMCD data.",t)}},this.hls=e;const t=this.config=e.config,{cmcd:n}=t;null!=n&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=n.sessionId||e.sessionId,this.cid=n.contentId,this.useHeaders=!0===n.useHeaders,this.includeKeys=n.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(l.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(l.MEDIA_DETACHED,this.onMediaDetached,this),e.on(l.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(l.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(l.MEDIA_DETACHED,this.onMediaDetached,this),e.off(l.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var n,i;this.audioBuffer=null==(n=t.tracks.audio)?void 0:n.buffer,this.videoBuffer=null==(i=t.tracks.video)?void 0:i.buffer}createData(){var e;return{v:1,sf:ds.HLS,sid:this.sid,cid:this.cid,pr:null==(e=this.media)?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};v(t,this.createData());const n=t.ot===hs.INIT||t.ot===hs.VIDEO||t.ot===hs.MUXED;this.starved&&n&&(t.bs=!0,t.su=!0,this.starved=!1),null==t.su&&(t.su=this.buffering);const{includeKeys:i}=this;i&&(t=Object.keys(t).reduce((e,n)=>(i.includes(n)&&(e[n]=t[n]),e),{}));const r={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),ea(e.headers,t,r)):e.url=ia(e.url,t,r)}getNextFrag(e){var t;const n=null==(t=this.hls.levels[e.level])?void 0:t.details;if(n){const t=e.sn-n.startSN;return n.fragments[t+1]}}getNextPart(e){var t;const{index:n,fragment:i}=e,r=null==(t=this.hls.levels[i.level])||null==(t=t.details)?void 0:t.partList;if(r){const{sn:e}=i;for(let t=r.length-1;t>=0;t--){const i=r[t];if(i.index===n&&i.fragment.sn===e)return r[t+1]}}}getObjectType(e){const{type:t}=e;return"subtitle"===t?hs.TIMED_TEXT:"initSegment"===e.sn?hs.INIT:"audio"===t?hs.AUDIO:"main"===t?this.hls.audioTracks.length?hs.VIDEO:hs.MUXED:void 0}getTopBandwidth(e){let t,n=0;const i=this.hls;if(e===hs.AUDIO)t=i.audioTracks;else{const e=i.maxAutoLevel,n=e>-1?e+1:i.levels.length;t=i.levels.slice(0,n)}return t.forEach(e=>{e.bitrate>n&&(n=e.bitrate)}),n>0?n:NaN}getBufferLength(e){const t=this.media,n=e===hs.AUDIO?this.audioBuffer:this.videoBuffer;if(!n||!t)return NaN;return 1e3*Vt.bufferInfo(n,t.currentTime,this.config.maxBufferHole).len}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,n=e||this.config.loader;return class{constructor(e){this.loader=void 0,this.loader=new n(e)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(e,n,i){t(e),this.loader.load(e,n,i)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,n=e||this.config.loader;return class{constructor(e){this.loader=void 0,this.loader=new n(e)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(e,n,i){t(e),this.loader.load(e,n,i)}}}}class sa extends x{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(l.MANIFEST_LOADING,this.onManifestLoading,this),e.on(l.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(l.MANIFEST_PARSED,this.onManifestParsed,this),e.on(l.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(l.MANIFEST_LOADING,this.onManifestLoading,this),e.off(l.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(l.MANIFEST_PARSED,this.onManifestParsed,this),e.off(l.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(-1===e.indexOf(t.pathwayId)&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=1e3*this.timeToLoad-(performance.now()-this.updated);if(e>0)return void this.scheduleRefresh(this.uri,e)}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){-1!==this.reloadTimer&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(t=>t!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:n}=t;null!==n&&(this.pathwayId=n.pathwayId,this.uri=n.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:n}=t;if((null==n?void 0:n.action)===vt.SendAlternateToPenaltyBox&&n.flags===yt.MoveAllAlternatesMatchingHost){const e=this.levels;let i=this._pathwayPriority,r=this.pathwayId;if(t.context){const{groupId:n,pathwayId:i,type:s}=t.context;n&&e?r=this.getPathwayForGroupId(n,s,r):i&&(r=i)}r in this.penalizedPathways||(this.penalizedPathways[r]=performance.now()),!i&&e&&(i=this.pathways()),i&&i.length>1&&(this.updatePathwayPriority(i),n.resolved=this.pathwayId!==r),t.details!==o.BUFFER_APPEND_ERROR||t.fatal?n.resolved||this.warn("Could not resolve ".concat(t.details,' ("').concat(t.error.message,'") with content-steering for Pathway: ').concat(r," levels: ").concat(e?e.length:e," priorities: ").concat(qe(i)," penalized: ").concat(qe(this.penalizedPathways))):n.resolved=!0}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(0===t.length){const n=e[0].pathwayId;this.log("No levels found in Pathway ".concat(this.pathwayId,'. Setting initial Pathway to "').concat(n,'"')),t=this.getLevelsForPathway(n),this.pathwayId=n}return t.length!==e.length&&this.log("Found ".concat(t.length,"/").concat(e.length,' levels in Pathway "').concat(this.pathwayId,'"')),t}getLevelsForPathway(e){return null===this.levels?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){let t;this._pathwayPriority=e;const n=this.penalizedPathways,i=performance.now();Object.keys(n).forEach(e=>{i-n[e]>3e5&&delete n[e]});for(let r=0;r<e.length;r++){const i=e[r];if(i in n)continue;if(i===this.pathwayId)return;const s=this.hls.nextLoadLevel,a=this.hls.levels[s];if(t=this.getLevelsForPathway(i),t.length>0){this.log('Setting Pathway to "'.concat(i,'"')),this.pathwayId=i,Zn(t),this.hls.trigger(l.LEVELS_UPDATED,{levels:t});const e=this.hls.levels[s];a&&e&&this.levels&&(e.attrs["STABLE-VARIANT-ID"]!==a.attrs["STABLE-VARIANT-ID"]&&e.bitrate!==a.bitrate&&this.log("Unstable Pathways change from bitrate ".concat(a.bitrate," to ").concat(e.bitrate)),this.hls.nextLoadLevel=s);break}}}getPathwayForGroupId(e,t,n){const i=this.getLevelsForPathway(n).concat(this.levels||[]);for(let r=0;r<i.length;r++)if(t===h&&i[r].hasAudioGroup(e)||t===d&&i[r].hasSubtitleGroup(e))return i[r].pathwayId;return n}clonePathways(e){const t=this.levels;if(!t)return;const n={},i={};e.forEach(e=>{const{ID:r,"BASE-ID":s,"URI-REPLACEMENT":a}=e;if(t.some(e=>e.pathwayId===r))return;const o=this.getLevelsForPathway(s).map(e=>{const t=new Jt(e.attrs);t["PATHWAY-ID"]=r;const s=t.AUDIO&&"".concat(t.AUDIO,"_clone_").concat(r),o=t.SUBTITLES&&"".concat(t.SUBTITLES,"_clone_").concat(r);s&&(n[t.AUDIO]=s,t.AUDIO=s),o&&(i[t.SUBTITLES]=o,t.SUBTITLES=o);const l=oa(e.uri,t["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",a),c=new We({attrs:t,audioCodec:e.audioCodec,bitrate:e.bitrate,height:e.height,name:e.name,url:l,videoCodec:e.videoCodec,width:e.width});if(e.audioGroups)for(let n=1;n<e.audioGroups.length;n++)c.addGroupId("audio","".concat(e.audioGroups[n],"_clone_").concat(r));if(e.subtitleGroups)for(let n=1;n<e.subtitleGroups.length;n++)c.addGroupId("text","".concat(e.subtitleGroups[n],"_clone_").concat(r));return c});t.push(...o),aa(this.audioTracks,n,a,r),aa(this.subtitleTracks,i,a,r)})}loadSteeringManifest(e){const t=this.hls.config,n=t.loader;let i;this.loader&&this.loader.destroy(),this.loader=new n(t);try{i=new self.URL(e)}catch(u){return this.enabled=!1,void this.log("Failed to parse Steering Manifest URI: ".concat(e))}if("data:"!==i.protocol){const e=0|(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate);i.searchParams.set("_HLS_pathway",this.pathwayId),i.searchParams.set("_HLS_throughput",""+e)}const r={responseType:"json",url:i.href},s=t.steeringManifestLoadPolicy.default,a=s.errorRetry||s.timeoutRetry||{},o={loadPolicy:s,timeout:s.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},c={onSuccess:(e,t,n,r)=>{this.log('Loaded steering manifest: "'.concat(i,'"'));const s=e.data;if(1!==(null==s?void 0:s.VERSION))return void this.log("Steering VERSION ".concat(s.VERSION," not supported!"));this.updated=performance.now(),this.timeToLoad=s.TTL;const{"RELOAD-URI":a,"PATHWAY-CLONES":o,"PATHWAY-PRIORITY":c}=s;if(a)try{this.uri=new self.URL(a,i).href}catch(u){return this.enabled=!1,void this.log("Failed to parse Steering Manifest RELOAD-URI: ".concat(a))}this.scheduleRefresh(this.uri||n.url),o&&this.clonePathways(o);const h={steeringManifest:s,url:i.toString()};this.hls.trigger(l.STEERING_MANIFEST_LOADED,h),c&&this.updatePathwayPriority(c)},onError:(e,t,n,i)=>{if(this.log("Error loading steering manifest: ".concat(e.code," ").concat(e.text," (").concat(t.url,")")),this.stopLoad(),410===e.code)return this.enabled=!1,void this.log("Steering manifest ".concat(t.url," no longer available"));let r=1e3*this.timeToLoad;if(429===e.code){const e=this.loader;if("function"===typeof(null==e?void 0:e.getResponseHeader)){const t=e.getResponseHeader("Retry-After");t&&(r=1e3*parseFloat(t))}return void this.log("Steering manifest ".concat(t.url," rate limited"))}this.scheduleRefresh(this.uri||t.url,r)},onTimeout:(e,t,n)=>{this.log("Timeout loading steering manifest (".concat(t.url,")")),this.scheduleRefresh(this.uri||t.url)}};this.log("Requesting steering manifest: ".concat(i)),this.loader.load(r,o,c)}scheduleRefresh(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3*this.timeToLoad;this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var t;const n=null==(t=this.hls)?void 0:t.media;!n||n.ended?this.scheduleRefresh(e,1e3*this.timeToLoad):this.loadSteeringManifest(e)},t)}}function aa(e,t,n,i){e&&Object.keys(t).forEach(r=>{const s=e.filter(e=>e.groupId===r).map(e=>{const s=v({},e);return s.details=void 0,s.attrs=new Jt(s.attrs),s.url=s.attrs.URI=oa(e.url,e.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",n),s.groupId=s.attrs["GROUP-ID"]=t[r],s.attrs["PATHWAY-ID"]=i,s});e.push(...s)})}function oa(e,t,n,i){const{HOST:r,PARAMS:s,[n]:a}=i;let o;t&&(o=null==a?void 0:a[t],o&&(e=o));const l=new self.URL(e);return r&&!o&&(l.host=r),s&&Object.keys(s).sort().forEach(e=>{e&&l.searchParams.set(e,s[e])}),l.href}class la extends x{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.mediaResolved=void 0,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=la.CDMCleanupPromise?[la.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=e=>{const{initDataType:t,initData:n}=e,i='"'.concat(e.type,'" event: init data type: "').concat(t,'"');if(this.debug(i),null!==n){if(!this.keyFormatPromise){let e=Object.keys(this.keySystemAccessPromises);e.length||(e=gn(this.config));const t=e.map(mn).filter(e=>!!e);this.keyFormatPromise=this.getKeyFormatPromise(t)}this.keyFormatPromise.then(r=>{const s=pn(r);if("sinf"!==t||s!==dn.FAIRPLAY)return void this.log('Ignoring "'.concat(e.type,'" event with init data type: "').concat(t,'" for selected key-system ').concat(s));let a;try{const e=q(new Uint8Array(n)),t=le(on(JSON.parse(e).sinf));if(!t)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");a=new Uint8Array(t.subarray(8,24))}catch(h){return void this.warn("".concat(i," Failed to parse sinf: ").concat(h))}const o=L(a),{keyIdToKeySessionPromise:l,mediaKeySessions:c}=this;let u=l[o];for(let e=0;e<c.length;e++){const i=c[e],r=i.decryptdata;if(!r.keyId)continue;const s=L(r.keyId);if(nn(a,r.keyId)||-1!==r.uri.replace(/-/g,"").indexOf(o)){if(u=l[s],!u)continue;if(r.pssh)break;delete l[s],r.pssh=new Uint8Array(n),r.keyId=a,u=l[o]=u.then(()=>this.generateRequestWithPreferredKeySession(i,t,n,"encrypted-event-key-match")),u.catch(e=>this.handleError(e));break}}u||this.handleError(new Error("Key ID ".concat(o," not encountered in playlist. Key-system sessions ").concat(c.length,".")))}).catch(e=>this.handleError(e))}},this.onWaitingForKey=e=>{this.log('"'.concat(e.type,'" event'))},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(l.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(l.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(l.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(l.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(l.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(l.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(l.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(l.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(l.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(l.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:n}=this.config,i=null==t?void 0:t[e];return i?i.licenseUrl:e===dn.WIDEVINE&&n?n:void 0}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(void 0===t)throw new Error('no license server URL configured for key-system "'.concat(e,'"'));return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,n=null==t?void 0:t[e];if(n)return n.serverCertificateUrl;this.log('No Server Certificate in config.drmSystems["'.concat(e,'"]'))}attemptKeySystemAccess(e){const t=this.hls.levels,n=(e,t,n)=>!!e&&n.indexOf(e)===t,i=t.map(e=>e.audioCodec).filter(n),r=t.map(e=>e.videoCodec).filter(n);return i.length+r.length===0&&r.push("avc1.42e01e"),new Promise((t,n)=>{const s=e=>{const l=e.shift();this.getMediaKeysPromise(l,i,r).then(e=>t({keySystem:l,mediaKeys:e})).catch(t=>{e.length?s(e):n(t instanceof ha?t:new ha({type:a.KEY_SYSTEM_ERROR,details:o.KEY_SYSTEM_NO_ACCESS,error:t,fatal:!0},t.message))})};s(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:n}=this.config;if("function"!==typeof n){let e="Configured requestMediaKeySystemAccess is not a function ".concat(n);return null===vn&&"http:"===self.location.protocol&&(e="navigator.requestMediaKeySystemAccess is not available over insecure protocol ".concat(location.protocol)),Promise.reject(new Error(e))}return n(e,t)}getMediaKeysPromise(e,t,n){var i;const r=function(e,t,n,i){let r;switch(e){case dn.FAIRPLAY:r=["cenc","sinf"];break;case dn.WIDEVINE:case dn.PLAYREADY:r=["cenc"];break;case dn.CLEARKEY:r=["cenc","keyids"];break;default:throw new Error("Unknown key-system: ".concat(e))}return function(e,t,n,i){return[{initDataTypes:e,persistentState:i.persistentState||"optional",distinctiveIdentifier:i.distinctiveIdentifier||"optional",sessionTypes:i.sessionTypes||[i.sessionType||"temporary"],audioCapabilities:t.map(e=>({contentType:"audio/mp4; codecs=".concat(e),robustness:i.audioRobustness||"",encryptionScheme:i.audioEncryptionScheme||null})),videoCapabilities:n.map(e=>({contentType:"video/mp4; codecs=".concat(e),robustness:i.videoRobustness||"",encryptionScheme:i.videoEncryptionScheme||null}))}]}(r,t,n,i)}(e,t,n,this.config.drmSystemOptions||{});let s=this.keySystemAccessPromises[e],a=null==(i=s)?void 0:i.keySystemAccess;if(!a){this.log('Requesting encrypted media "'.concat(e,'" key-system access with config: ').concat(qe(r))),a=this.requestMediaKeySystemAccess(e,r);const t=s=this.keySystemAccessPromises[e]={keySystemAccess:a};return a.catch(t=>{this.log('Failed to obtain access to key-system "'.concat(e,'": ').concat(t))}),a.then(n=>{this.log('Access for key-system "'.concat(n.keySystem,'" obtained'));const i=this.fetchServerCertificate(e);this.log('Create media-keys for "'.concat(e,'"'));const r=t.mediaKeys=n.createMediaKeys().then(n=>(this.log('Media-keys created for "'.concat(e,'"')),t.hasMediaKeys=!0,i.then(t=>t?this.setMediaKeysServerCertificate(n,e,t):n)));return r.catch(t=>{this.error('Failed to create media-keys for "'.concat(e,'"}: ').concat(t))}),r})}return a.then(()=>s.mediaKeys)}createMediaKeySessionContext(e){let{decryptdata:t,keySystem:n,mediaKeys:i}=e;this.log('Creating key-system session "'.concat(n,'" keyId: ').concat(L(t.keyId||[])," keyUri: ").concat(t.uri));const r=i.createSession(),s={decryptdata:t,keySystem:n,mediaKeys:i,mediaKeysSession:r,keyStatus:"status-pending"};return this.mediaKeySessions.push(s),s}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const n=this.createMediaKeySessionContext(e),i=ca(t),r="cenc";this.keyIdToKeySessionPromise[i]=this.generateRequestWithPreferredKeySession(n,r,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}updateKeySession(e,t){const n=e.mediaKeysSession;return this.log('Updating key-session "'.concat(n.sessionId,'" for keyId ').concat(L(e.decryptdata.keyId||[]),"\n      } (data length: ").concat(t.byteLength,")")),n.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(e=>{let{hasMediaKeys:t}=e;return!!t}).map(e=>{let{keySystem:t}=e;return mn(t)}).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(e=>{let{keySystem:t,mediaKeys:n}=e;return this.attemptSetMediaKeys(t,n)})}selectKeySystem(e){return new Promise((t,n)=>{this.getKeySystemSelectionPromise(e).then(e=>{let{keySystem:i}=e;const r=mn(i);r?t(r):n(new Error('Unable to find format for key-system "'.concat(i,'"')))}).catch(n)})}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log("Selecting key-system from fragment (sn: ".concat(e.sn," ").concat(e.type,": ").concat(e.level,") key formats ").concat(t.join(", "))),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=gn(this.config),n=e.map(pn).filter(e=>!!e&&-1!==t.indexOf(e));return this.selectKeySystem(n)}getKeyStatus(e){const{mediaKeySessions:t}=this;for(let n=0;n<t.length;n++){const i=ua(e,t[n]);if(i)return i}}loadKey(e){const t=e.keyInfo.decryptdata,n=ca(t),i=this.bannedKeyIds[n];if(i||"internal-error"===this.getKeyStatus(t)){const n=da(i||"internal-error",t);return this.handleError(n,e.frag),Promise.reject(n)}const r="(keyId: ".concat(n,' format: "').concat(t.keyFormat,'" method: ').concat(t.method," uri: ").concat(t.uri,")");this.log("Starting session for key ".concat(r));const s=this.keyIdToKeySessionPromise[n];if(!s){const i=this.getKeySystemForKeyPromise(t).then(n=>{let{keySystem:i,mediaKeys:s}=n;return this.throwIfDestroyed(),this.log("Handle encrypted media sn: ".concat(e.frag.sn," ").concat(e.frag.type,": ").concat(e.frag.level," using key ").concat(r)),this.attemptSetMediaKeys(i,s).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:i,mediaKeys:s,decryptdata:t})))}).then(e=>{const n=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(e,"cenc",n,"playlist-key")});return i.catch(t=>this.handleError(t,e.frag)),this.keyIdToKeySessionPromise[n]=i,i}return s.catch(n=>{if(n instanceof ha){const i=b({},n.data);"internal-error"===this.getKeyStatus(t)&&(i.decryptdata=t);const r=new ha(i,n.message);this.handleError(r,e.frag)}}),s}throwIfDestroyed(){if(!this.hls)throw new Error("invalid state")}handleError(e,t){if(this.hls)if(e instanceof ha){t&&(e.data.frag=t);const n=e.data.decryptdata;this.error("".concat(e.message).concat(n?" (".concat(L(n.keyId||[]),")"):"")),this.hls.trigger(l.ERROR,e.data)}else this.error(e.message),this.hls.trigger(l.ERROR,{type:a.KEY_SYSTEM_ERROR,details:o.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0})}getKeySystemForKeyPromise(e){const t=ca(e),n=this.keyIdToKeySessionPromise[t];if(!n){const t=pn(e.keyFormat),n=t?[t]:gn(this.config);return this.attemptKeySystemAccess(n)}return n}getKeySystemSelectionPromise(e){if(e.length||(e=gn(this.config)),0===e.length)throw new ha({type:a.KEY_SYSTEM_ERROR,details:o.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},"Missing key-system license configuration options ".concat(qe({drmSystems:this.config.drmSystems})));return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaResolved=void 0,this.mediaKeys===t)return Promise.resolve();const n=this.setMediaKeysQueue.slice();this.log('Setting media-keys for "'.concat(e,'"'));const i=Promise.all(n).then(()=>this.media?this.media.setMediaKeys(t):new Promise((e,n)=>{this.mediaResolved=()=>{if(this.mediaResolved=void 0,!this.media)return n(new Error("Attempted to set mediaKeys without media element attached"));this.mediaKeys=t,this.media.setMediaKeys(t).then(e).catch(n)}}));return this.mediaKeys=t,this.setMediaKeysQueue.push(i),i.then(()=>{this.log('Media-keys set for "'.concat(e,'"')),n.push(i),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(e=>-1===n.indexOf(e))})}generateRequestWithPreferredKeySession(e,t,n,i){var r;const s=null==(r=this.config.drmSystems)||null==(r=r[e.keySystem])?void 0:r.generateRequest;if(s)try{const i=s.call(this.hls,t,n,e);if(!i)throw new Error("Invalid response from configured generateRequest filter");t=i.initDataType,n=i.initData?i.initData:null,e.decryptdata.pssh=n?new Uint8Array(n):null}catch(m){if(this.warn(m.message),this.hls&&this.hls.config.debug)throw m}if(null===n)return this.log('Skipping key-session request for "'.concat(i,'" (no initData)')),Promise.resolve(e);const l=ca(e.decryptdata),c=e.decryptdata.uri;this.log('Generating key-session request for "'.concat(i,'" keyId: ').concat(l," URI: ").concat(c," (init data type: ").concat(t," length: ").concat(n.byteLength,")"));const u=new wi,h=e._onmessage=t=>{const n=e.mediaKeysSession;if(!n)return void u.emit("error",new Error("invalid state"));const{messageType:i,message:r}=t;this.log('"'.concat(i,'" message event for session "').concat(n.sessionId,'" message size: ').concat(r.byteLength)),"license-request"===i||"license-renewal"===i?this.renewLicense(e,r).catch(e=>{u.eventNames().length?u.emit("error",e):this.handleError(e)}):"license-release"===i?e.keySystem===dn.FAIRPLAY&&this.updateKeySession(e,ln("acknowledged")).then(()=>this.removeSession(e)).catch(e=>this.handleError(e)):this.warn('unhandled media key message type "'.concat(i,'"'))},d=(e,t)=>{let n;t.keyStatus=e,e.startsWith("usable")?u.emit("resolved"):"internal-error"===e||"output-restricted"===e||"output-downscaled"===e?n=da(e,t.decryptdata):"expired"===e?n=new Error("key expired (keyId: ".concat(l,")")):"released"===e?n=new Error("key released"):"status-pending"===e||this.warn('unhandled key status change "'.concat(e,'" (keyId: ').concat(l,")")),n&&(u.eventNames().length?u.emit("error",n):this.handleError(n))},f=e._onkeystatuseschange=t=>{if(!e.mediaKeysSession)return void u.emit("error",new Error("invalid state"));const n=this.getKeyStatuses(e);if(!Object.keys(n).some(e=>"status-pending"!==n[e]))return;if("expired"===n[l])return this.log("Expired key ".concat(qe(n),' in key-session "').concat(e.mediaKeysSession.sessionId,'"')),void this.renewKeySession(e);let i=n[l];if(i)d(i,e);else{var r;const t=1e3;e.keyStatusTimeouts||(e.keyStatusTimeouts={}),(r=e.keyStatusTimeouts)[l]||(r[l]=self.setTimeout(()=>{if(!e.mediaKeysSession||!this.mediaKeys)return;const n=this.getKeyStatus(e.decryptdata);if(n&&"status-pending"!==n)return this.log("No status for keyId ".concat(l,' in key-session "').concat(e.mediaKeysSession.sessionId,'". Using session key-status ').concat(n," from other session.")),d(n,e);this.log("key status for ".concat(l,' in key-session "').concat(e.mediaKeysSession.sessionId,'" timed out after ').concat(t,"ms")),i="internal-error",d(i,e)},t)),this.log("No status for keyId ".concat(l," (").concat(qe(n),")."))}};ri(e.mediaKeysSession,"message",h),ri(e.mediaKeysSession,"keystatuseschange",f);const p=new Promise((e,t)=>{u.on("error",t),u.on("resolved",e)});return e.mediaKeysSession.generateRequest(t,n).then(()=>{this.log('Request generated for key-session "'.concat(e.mediaKeysSession.sessionId,'" keyId: ').concat(l," URI: ").concat(c))}).catch(t=>{throw new ha({type:a.KEY_SYSTEM_ERROR,details:o.KEY_SYSTEM_NO_SESSION,error:t,decryptdata:e.decryptdata,fatal:!1},"Error generating key-session request: ".concat(t))}).then(()=>p).catch(t=>(u.removeAllListeners(),this.removeSession(e).then(()=>{throw t}))).then(()=>(u.removeAllListeners(),e))}getKeyStatuses(e){const t={};return e.mediaKeysSession.keyStatuses.forEach((n,i)=>{if("string"===typeof i&&"object"===typeof n){const e=i;i=n,n=e}const r="buffer"in i?new Uint8Array(i.buffer,i.byteOffset,i.byteLength):new Uint8Array(i);if(e.keySystem===dn.PLAYREADY&&16===r.length){const e=L(r);t[e]=n,cn(r)}const s=L(r);"internal-error"===n&&(this.bannedKeyIds[s]=n),this.log('key status change "'.concat(n,'" for keyStatuses keyId: ').concat(s,' key-session "').concat(e.mediaKeysSession.sessionId,'"')),t[s]=n}),t}fetchServerCertificate(e){const t=this.config,n=new(0,t.loader)(t),i=this.getServerCertificateUrl(e);return i?(this.log('Fetching server certificate for "'.concat(e,'"')),new Promise((r,s)=>{const l={responseType:"arraybuffer",url:i},c=t.certLoadPolicy.default,u={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},h={onSuccess:(e,t,n,i)=>{r(e.data)},onError:(t,n,r,c)=>{s(new ha({type:a.KEY_SYSTEM_ERROR,details:o.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:r,response:b({url:l.url,data:void 0},t)},'"'.concat(e,'" certificate request failed (').concat(i,"). Status: ").concat(t.code," (").concat(t.text,")")))},onTimeout:(t,n,r)=>{s(new ha({type:a.KEY_SYSTEM_ERROR,details:o.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:r,response:{url:l.url,data:void 0}},'"'.concat(e,'" certificate request timed out (').concat(i,")")))},onAbort:(e,t,n)=>{s(new Error("aborted"))}};n.load(l,u,h)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,n){return new Promise((i,r)=>{e.setServerCertificate(n).then(r=>{this.log("setServerCertificate ".concat(r?"success":"not supported by CDM"," (").concat(n.byteLength,') on "').concat(t,'"')),i(e)}).catch(e=>{r(new ha({type:a.KEY_SYSTEM_ERROR,details:o.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:e,fatal:!0},e.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(t=>this.updateKeySession(e,new Uint8Array(t)).catch(t=>{throw new ha({type:a.KEY_SYSTEM_ERROR,details:o.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:t,fatal:!1},t.message)}))}unpackPlayReadyKeyMessage(e,t){const n=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!n.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const i=(new DOMParser).parseFromString(n,"application/xml"),r=i.querySelectorAll("HttpHeader");if(r.length>0){let t;for(let n=0,i=r.length;n<i;n++){var s,a;t=r[n];const i=null==(s=t.querySelector("name"))?void 0:s.textContent,o=null==(a=t.querySelector("value"))?void 0:a.textContent;i&&o&&e.setRequestHeader(i,o)}}const o=i.querySelector("Challenge"),l=null==o?void 0:o.textContent;if(!l)throw new Error("Cannot find <Challenge> in key message");return ln(atob(l))}setupLicenseXHR(e,t,n,i){const r=this.config.licenseXhrSetup;return r?Promise.resolve().then(()=>{if(!n.decryptdata)throw new Error("Key removed");return r.call(this.hls,e,t,n,i)}).catch(s=>{if(!n.decryptdata)throw s;return e.open("POST",t,!0),r.call(this.hls,e,t,n,i)}).then(n=>{e.readyState||e.open("POST",t,!0);return{xhr:e,licenseChallenge:n||i}}):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:i}))}requestLicense(e,t){const n=this.config.keyLoadPolicy.default;return new Promise((i,r)=>{const s=this.getLicenseServerUrlOrThrow(e.keySystem);this.log("Sending license request to URL: ".concat(s));const l=new XMLHttpRequest;l.responseType="arraybuffer",l.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return r(new Error("invalid state"));if(4===l.readyState)if(200===l.status){this._requestLicenseFailureCount=0;let t=l.response;this.log("License received ".concat(t instanceof ArrayBuffer?t.byteLength:t));const n=this.config.licenseResponseCallback;if(n)try{t=n.call(this.hls,l,s,e)}catch(c){this.error(c)}i(t)}else{const c=n.errorRetry,u=c?c.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>u||l.status>=400&&l.status<500)r(new ha({type:a.KEY_SYSTEM_ERROR,details:o.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:l,response:{url:s,data:void 0,code:l.status,text:l.statusText}},"License Request XHR failed (".concat(s,"). Status: ").concat(l.status," (").concat(l.statusText,")")));else{const n=u-this._requestLicenseFailureCount+1;this.warn("Retrying license request, ".concat(n," attempts left")),this.requestLicense(e,t).then(i,r)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=l,this.setupLicenseXHR(l,s,e,t).then(t=>{let{xhr:n,licenseChallenge:i}=t;e.keySystem==dn.PLAYREADY&&(i=this.unpackPlayReadyKeyMessage(n,i)),n.send(i)}).catch(r)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const n=t.media;this.media=n,ri(n,"encrypted",this.onMediaEncrypted),ri(n,"waitingforkey",this.onWaitingForKey);const i=this.mediaResolved;i?i():this.mediaKeys=n.mediaKeys}onMediaDetached(){const e=this.media;e&&(si(e,"encrypted",this.onMediaEncrypted),si(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={};const t=this.mediaResolved;if(t&&t(),!this.mediaKeys&&!this.mediaKeySessions.length)return;const n=this.media,i=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,_n.clearKeyUriToKeyIdMap();const r=i.length;la.CDMCleanupPromise=Promise.all(i.map(e=>this.removeSession(e)).concat((null==n||null==(e=n.setMediaKeys(null))?void 0:e.catch(e=>{this.log("Could not clear media keys: ".concat(e)),this.hls&&this.hls.trigger(l.ERROR,{type:a.OTHER_ERROR,details:o.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error("Could not clear media keys: ".concat(e))})}))||Promise.resolve())).catch(e=>{this.log("Could not close sessions and clear media keys: ".concat(e)),this.hls&&this.hls.trigger(l.ERROR,{type:a.OTHER_ERROR,details:o.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error("Could not close sessions and clear media keys: ".concat(e))})}).then(()=>{r&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this._clear()}onManifestLoaded(e,t){let{sessionKeys:n}=t;if(n&&this.config.emeEnabled&&!this.keyFormatPromise){const e=n.reduce((e,t)=>(-1===e.indexOf(t.keyFormat)&&e.push(t.keyFormat),e),[]);this.log("Selecting key-system from session-keys ".concat(e.join(", "))),this.keyFormatPromise=this.getKeyFormatPromise(e)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:n,decryptdata:i}=e;if(t){this.log('Remove licenses and keys and close session "'.concat(t.sessionId,'" keyId: ').concat(L((null==i?void 0:i.keyId)||[]))),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),n&&n.readyState!==XMLHttpRequest.DONE&&n.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const r=this.mediaKeySessions.indexOf(e);r>-1&&this.mediaKeySessions.splice(r,1);const{keyStatusTimeouts:s}=e;s&&Object.keys(s).forEach(e=>self.clearTimeout(s[e]));const{drmSystemOptions:c}=this.config,u=function(e){var t;return!!e&&("persistent-license"===e.sessionType||!(null==(t=e.sessionTypes)||!t.some(e=>"persistent-license"===e)))}(c)?new Promise((e,n)=>{self.setTimeout(()=>n(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(e).catch(n)}):Promise.resolve();return u.catch(e=>{this.log("Could not remove session: ".concat(e)),this.hls&&this.hls.trigger(l.ERROR,{type:a.OTHER_ERROR,details:o.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error("Could not remove session: ".concat(e))})}).then(()=>t.close()).catch(e=>{this.log("Could not close session: ".concat(e)),this.hls&&this.hls.trigger(l.ERROR,{type:a.OTHER_ERROR,details:o.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error("Could not close session: ".concat(e))})})}return Promise.resolve()}}function ca(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(null===e.keyId)throw new Error("keyId is null");return L(e.keyId)}function ua(e,t){return e.keyId&&t.mediaKeysSession.keyStatuses.has(e.keyId)?t.mediaKeysSession.keyStatuses.get(e.keyId):e.matches(t.decryptdata)?t.keyStatus:void 0}la.CDMCleanupPromise=void 0;class ha extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}function da(e,t){const n="output-restricted"===e,i=n?o.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:o.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new ha({type:a.KEY_SYSTEM_ERROR,details:i,fatal:!1,decryptdata:t},n?"HDCP level output restricted":'key status changed to "'.concat(e,'"'))}class fa{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(l.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(l.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(l.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(l.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const n=this.hls.config;if(n.capLevelOnFPSDrop){const e=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=e,e&&"function"===typeof e.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),n.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,n){const i=performance.now();if(t){if(this.lastTime){const e=i-this.lastTime,r=n-this.lastDroppedFrames,s=t-this.lastDecodedFrames,a=1e3*r/e,o=this.hls;if(o.trigger(l.FPS_DROP,{currentDropped:r,currentDecoded:s,totalDroppedFrames:n}),a>0&&r>o.config.fpsDroppedMonitoringThreshold*s){let e=o.currentLevel;o.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+e),e>0&&(-1===o.autoLevelCapping||o.autoLevelCapping>=e)&&(e-=1,o.trigger(l.FPS_DROP_LEVEL_CAPPING,{level:e,droppedLevel:o.currentLevel}),o.autoLevelCapping=e,this.streamController.nextLevelSwitch())}}this.lastTime=i,this.lastDroppedFrames=n,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function pa(e,t){let n;try{n=new Event("addtrack")}catch(hl){n=document.createEvent("Event"),n.initEvent("addtrack",!1,!1)}n.track=e,t.dispatchEvent(n)}function ma(e,t){const n=e.mode;if("disabled"===n&&(e.mode="hidden"),e.cues&&!e.cues.getCueById(t.id))try{if(e.addCue(t),!e.cues.getCueById(t.id))throw new Error("addCue is failed for: ".concat(t))}catch(hl){A.debug("[texttrack-utils]: ".concat(hl));try{const n=new self.TextTrackCue(t.startTime,t.endTime,t.text);n.id=t.id,e.addCue(n)}catch(i){A.debug("[texttrack-utils]: Legacy TextTrackCue fallback failed: ".concat(i))}}"disabled"===n&&(e.mode=n)}function ga(e,t){const n=e.mode;if("disabled"===n&&(e.mode="hidden"),e.cues)for(let i=e.cues.length;i--;)t&&e.cues[i].removeEventListener("enter",t),e.removeCue(e.cues[i]);"disabled"===n&&(e.mode=n)}function va(e,t,n,i){const r=e.mode;if("disabled"===r&&(e.mode="hidden"),e.cues&&e.cues.length>0){const r=function(e,t,n){const i=[],r=function(e,t){if(t<=e[0].startTime)return 0;const n=e.length-1;if(t>e[n].endTime)return-1;let i,r=0,s=n;for(;r<=s;)if(i=Math.floor((s+r)/2),t<e[i].startTime)s=i-1;else{if(!(t>e[i].startTime&&r<n))return i;r=i+1}return e[r].startTime-t<t-e[s].startTime?r:s}(e,t);if(r>-1)for(let s=r,a=e.length;s<a;s++){const r=e[s];if(r.startTime>=t&&r.endTime<=n)i.push(r);else if(r.startTime>n)return i}return i}(e.cues,t,n);for(let t=0;t<r.length;t++)i&&!i(r[t])||e.removeCue(r[t])}"disabled"===r&&(e.mode=r)}function ya(e){const t=[];for(let n=0;n<e.length;n++){const i=e[n];"subtitles"!==i.kind&&"captions"!==i.kind||!i.label||t.push(e[n])}return t}class ba extends Qr{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let e=null;const t=ya(this.media.textTracks);for(let i=0;i<t.length;i++)if("hidden"===t[i].mode)e=t[i];else if("showing"===t[i].mode){e=t[i];break}const n=this.findTrackForTextTrack(e);this.subtitleTrack!==n&&this.setSubtitleTrack(n)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(l.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(l.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(l.MANIFEST_LOADING,this.onManifestLoading,this),e.on(l.MANIFEST_PARSED,this.onManifestParsed,this),e.on(l.LEVEL_LOADING,this.onLevelLoading,this),e.on(l.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(l.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(l.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(l.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(l.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(l.MANIFEST_LOADING,this.onManifestLoading,this),e.off(l.MANIFEST_PARSED,this.onManifestParsed,this),e.off(l.LEVEL_LOADING,this.onLevelLoading,this),e.off(l.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(l.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(l.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const n=this.media;if(!n)return;const i=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||n.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,i)return;ya(n.textTracks).forEach(e=>{ga(e)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:n,groupId:i,details:r}=t,s=this.tracksInGroup[n];if(!s||s.groupId!==i)return void this.warn("Subtitle track with id:".concat(n," and group:").concat(i," not found in active group ").concat(null==s?void 0:s.groupId));const a=s.details;s.details=t.details,this.log("Subtitle track ".concat(n,' "').concat(s.name,'" lang:').concat(s.lang," group:").concat(i," loaded [").concat(r.startSN,"-").concat(r.endSN,"]")),n===this.trackId&&this.playlistLoaded(n,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const n=t.subtitleGroups||null,i=this.groupIds;let r=this.currentTrack;if(!n||(null==i?void 0:i.length)!==(null==n?void 0:n.length)||null!=n&&n.some(e=>-1===(null==i?void 0:i.indexOf(e)))){this.groupIds=n,this.trackId=-1,this.currentTrack=null;const e=this.tracks.filter(e=>!n||-1!==n.indexOf(e.groupId));if(e.length)this.selectDefaultTrack&&!e.some(e=>e.default)&&(this.selectDefaultTrack=!1),e.forEach((e,t)=>{e.id=t});else if(!r&&!this.tracksInGroup.length)return;this.tracksInGroup=e;const t=this.hls.config.subtitlePreference;if(!r&&t){this.selectDefaultTrack=!1;const n=Qe(t,e);if(n>-1)r=e[n];else{const e=Qe(t,this.tracks);r=this.tracks[e]}}let i=this.findTrackId(r);-1===i&&r&&(i=this.findTrackId(null));const s={subtitleTracks:e};this.log("Updating subtitle tracks, ".concat(e.length,' track(s) found in "').concat(null==n?void 0:n.join(","),'" group-id')),this.hls.trigger(l.SUBTITLE_TRACKS_UPDATED,s),-1!==i&&-1===this.trackId&&this.setSubtitleTrack(i)}}findTrackId(e){const t=this.tracksInGroup,n=this.selectDefaultTrack;for(let i=0;i<t.length;i++){const r=t[i];if((!n||r.default)&&(n||e)&&(!e||$e(r,e)))return i}if(e){for(let n=0;n<t.length;n++){const i=t[n];if(es(e.attrs,i.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return n}for(let n=0;n<t.length;n++){const i=t[n];if(es(e.attrs,i.attrs,["LANGUAGE"]))return n}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let n=0;n<t.length;n++){if(ts(t[n],e))return n}}return-1}onError(e,t){!t.fatal&&t.context&&(t.context.type!==d||t.context.id!==this.trackId||this.groupIds&&-1===this.groupIds.indexOf(t.context.groupId)||this.checkRetry(t))}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(-1===e.id)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const n=this.currentTrack;if(n&&$e(e,n))return n;const i=Qe(e,this.tracksInGroup);if(i>-1){const e=this.tracksInGroup[i];return this.setSubtitleTrack(i),e}if(n)return null;{const n=Qe(e,t);if(n>-1)return t[n]}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=e.id,i=e.groupId,r=this.getUrlWithDirectives(e.url,t),s=e.details,a=null==s?void 0:s.age;this.log("Loading subtitle ".concat(n,' "').concat(e.name,'" lang:').concat(e.lang," group:").concat(i).concat(void 0!==(null==t?void 0:t.msn)?" at sn "+t.msn+" part "+t.part:"").concat(a&&s.live?" age "+a.toFixed(1)+(s.type?" "+s.type||0:""):""," ").concat(r)),this.hls.trigger(l.SUBTITLE_TRACK_LOADING,{url:r,id:n,groupId:i,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=ya(e.textTracks),n=this.currentTrack;let i;if(n&&(i=t.filter(e=>ts(n,e))[0],i||this.warn('Unable to find subtitle TextTrack with name "'.concat(n.name,'" and language "').concat(n.lang,'"'))),[].slice.call(t).forEach(e=>{"disabled"!==e.mode&&e!==i&&(e.mode="disabled")}),i){const e=this.subtitleDisplay?"showing":"hidden";i.mode!==e&&(i.mode=e)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media)return void(this.queuedDefaultTrack=e);if(e<-1||e>=t.length||!i(e))return void this.warn("Invalid subtitle track id: ".concat(e));this.selectDefaultTrack=!1;const n=this.currentTrack,r=t[e]||null;if(this.trackId=e,this.currentTrack=r,this.toggleTrackModes(),!r)return void this.hls.trigger(l.SUBTITLE_TRACK_SWITCH,{id:e});const s=!!r.details&&!r.details.live;if(e===this.trackId&&r===n&&s)return;this.log("Switching to subtitle-track ".concat(e)+(r?' "'.concat(r.name,'" lang:').concat(r.lang," group:").concat(r.groupId):""));const{id:a,groupId:o="",name:c,type:u,url:h}=r;this.hls.trigger(l.SUBTITLE_TRACK_SWITCH,{id:a,groupId:o,name:c,type:u,url:h});const d=this.switchParams(r.url,null==n?void 0:n.details,r.details);this.loadPlaylist(d)}}function xa(e){let t=5381,n=e.length;for(;n;)t=33*t^e.charCodeAt(--n);return(t>>>0).toString()}const _a=.025;let Sa=function(e){return e[e.Point=0]="Point",e[e.Range=1]="Range",e}({});function Ea(e,t,n){return"".concat(e.identifier,"-").concat(n+1,"-").concat(xa(t))}class Ta{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,null==(e=this.assetListLoader)||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const n=this.playoutLimit;if(e<=0||isNaN(n))return!1;if(0===n)return!0;return((null==(t=this.assetList[e])?void 0:t.startOffset)||0)>n}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return wa(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(0===this.startTime||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime;return t-wa(t,e)<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=i(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return wa(e,t)}return e}get appendInPlace(){return!!this.appendInPlaceStarted||!this.appendInPlaceDisabled&&!(this.cue.once||this.cue.pre||!this.startIsAligned||!(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<_a))}set appendInPlace(e){this.appendInPlaceStarted?this.resetOnResume=!e:this.appendInPlaceDisabled=!e}get timelineStart(){return null!==this._timelineStart?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return t=null!==this._duration?this._duration:this.dateRange.duration?this.dateRange.duration:this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return"RANGE"===this.dateRange.attr["X-TIMELINE-OCCUPIES"]?Sa.Range:Sa.Point}get supplementsPrimary(){return"PRIMARY"===this.dateRange.attr["X-TIMELINE-STYLE"]}get contentMayVary(){return"NO"!==this.dateRange.attr["X-CONTENT-MAY-VARY"]}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||null!==this.assetListResponse}toString(){return'["'.concat((e=this).identifier,'" ').concat(e.cue.pre?"<pre>":e.cue.post?"<post>":"").concat(e.timelineStart.toFixed(2),"-").concat(e.resumeTime.toFixed(2),"]");var e}}function wa(e,t){return e-t.start<t.duration/2&&!(Math.abs(e-(t.start+t.duration))<_a)?t.start:t.start+t.duration}function Aa(e,t,n){const i=new self.URL(e,n);return"data:"!==i.protocol&&i.searchParams.set("_HLS_primary_id",t),i}function Ma(e,t){for(;null!=(n=e.assetList[++t])&&n.error;)var n;return t}function Ra(e){const t=e.timelineStart,n=e.duration||0;return'["'.concat(e.identifier,'" ').concat(t.toFixed(2),"-").concat((t+n).toFixed(2),"]")}class Ca{constructor(e,t,n,i){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(l.PLAYOUT_LIMIT_REACHED,{})};const r=this.hls=new e(t);this.interstitial=n,this.assetItem=i;const s=()=>{this.hasDetails=!0};r.once(l.LEVEL_LOADED,s),r.once(l.AUDIO_TRACK_LOADED,s),r.once(l.SUBTITLE_TRACK_LOADED,s),r.on(l.MEDIA_ATTACHING,(e,t)=>{let{media:n}=t;this.removeMediaListeners(),this.mediaAttached=n;this.interstitial.playoutLimit&&(n.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&r.on(l.BUFFER_APPENDED,()=>{const e=this.bufferedEnd;this.reachedPlayout(e)&&(this._bufferedEosTime=e,r.trigger(l.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let n=this.assetItem.uri;try{n=Aa(n,e.config.primarySessionId||"").href}catch(t){}e.loadSource(n)}}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if(null!=(t=this.hls)&&t.bufferedToEnd)return!0;if(!e)return!1;const n=Math.min(this._bufferedEosTime||1/0,this.duration),i=this.timelineOffset,r=Vt.bufferInfo(e,i,0);return this.getAssetTime(r.end)>=n-.02}reachedPlayout(e){const t=this.interstitial.playoutLimit;return this.startOffset+e>=t}get destroyed(){var e;return!(null!=(e=this.hls)&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return(null==(e=this.hls)?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=Vt.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;if(!e)return 0;const t=this.interstitial.playoutLimit;if(t){const n=t-this.startOffset;if(n>0&&n<e)return n}return e}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return(null==(e=this.hls)?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const n=e-t;if(Math.abs(n)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,n=this.duration;return Math.min(Math.max(0,e-t),n)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){var e;this.mediaAttached&&(null!=(e=this.hls)&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd))}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var t;this.loadSource(),null==(t=this.hls)||t.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,null==(e=this.hls)||e.detachMedia()}resumeBuffering(){var e;null==(e=this.hls)||e.resumeBuffering()}pauseBuffering(){var e;null==(e=this.hls)||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),(null==(e=this.hls)?void 0:e.transferMedia())||null}resetDetails(){const e=this.hls;if(e&&this.hasDetails){e.stopLoad();const t=e=>delete e.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,n){var i;null==(i=this.hls)||i.on(e,t)}once(e,t,n){var i;null==(i=this.hls)||i.once(e,t)}off(e,t,n){var i;null==(i=this.hls)||i.off(e,t)}toString(){var e;return"HlsAssetPlayer: ".concat(Ra(this.assetItem)," ").concat(null==(e=this.hls)?void 0:e.sessionId," ").concat(this.appendInPlace?"append-in-place":"")}}class La extends x{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((n,i)=>e<=i.startOffset&&t>i.startOffset?(delete i.error,n+1):n,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let n=-1;e.nextEvent?n=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(n=this.findEventIndex(e.previousEvent.identifier)+1);const i=this.items;if(i)for(i[n]||(void 0===t&&(t=e.start),n=this.findItemIndexAtTime(t));n>=0&&null!=(r=i[n])&&r.event;){var r;n--}return n}findItemIndexAtTime(e,t){const n=this.items;if(n)for(let i=0;i<n.length;i++){let r=n[i];if(t&&"primary"!==t&&(r=r[t]),e===r.start||e>r.start&&e<r.end)return i}return-1}findJumpRestrictedIndex(e,t){const n=this.items;if(n)for(let i=e;i<=t&&n[i];i++){const e=n[i].event;if(null!=e&&e.restrictions.jump&&!e.appendInPlace)return i}return-1}findEventIndex(e){const t=this.items;if(t)for(let i=t.length;i--;){var n;if((null==(n=t[i].event)?void 0:n.identifier)===e)return i}return-1}findAssetIndex(e,t){const n=e.assetList,i=n.length;if(i>1)for(let r=0;r<i;r++){const e=n[r];if(!e.error){const n=e.timelineStart;if(t===n||t>n&&(t<n+(e.duration||0)||r===i-1))return r}}return 0}get assetIdAtEnd(){var e;const t=null==(e=this.items)||null==(e=e[this.length-1])?void 0:e.event;if(t){const e=t.assetList,n=e[e.length-1];if(n)return n.identifier}return null}parseInterstitialDateRanges(e,t){const n=e.main.details,{dateRanges:i}=n,r=this.events,s=this.parseDateRanges(i,{url:n.url},t),a=Object.keys(i),o=r?r.filter(e=>!a.includes(e.identifier)):[];s.length&&s.sort((e,t)=>{const n=e.cue.pre,i=e.cue.post,r=t.cue.pre,s=t.cue.post;if(n&&!r)return-1;if(r&&!n)return 1;if(i&&!s)return 1;if(s&&!i)return-1;if(!n&&!r&&!i&&!s){const n=e.startTime,i=t.startTime;if(n!==i)return n-i}return e.dateRange.tagOrder-t.dateRange.tagOrder}),this.events=s,o.forEach(e=>{this.removeEvent(e)}),this.updateSchedule(e,o)}updateSchedule(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=this.events||[];if(i.length||t.length||this.length<2){const r=this.items,s=this.parseSchedule(i,e);(n||t.length||(null==r?void 0:r.length)!==s.length||s.some((e,t)=>Math.abs(e.playout.start-r[t].playout.start)>.005||Math.abs(e.playout.end-r[t].playout.end)>.005))&&(this.items=s,this.onScheduleUpdate(t,r))}}parseDateRanges(e,t,n){const i=[],r=Object.keys(e);for(let s=0;s<r.length;s++){const a=r[s],o=e[a];if(o.isInterstitial){let e=this.eventMap[a];e?e.setDateRange(o):(e=new Ta(o,t),this.eventMap[a]=e,!1===n&&(e.appendInPlace=n)),i.push(e)}}return i}parseSchedule(e,t){const n=[],i=t.main.details,r=i.live?1/0:i.edge;let s=0;if((e=e.filter(e=>!e.error&&!(e.cue.once&&e.hasPlayed))).length){this.resolveOffsets(e,t);let i=0,o=0;if(e.forEach((t,a)=>{const l=t.cue.pre,c=t.cue.post,u=e[a-1]||null,h=t.appendInPlace,d=c?r:t.startOffset,f=t.duration,p=t.timelineOccupancy===Sa.Range?f:0,m=t.resumptionOffset,g=(null==u?void 0:u.startTime)===d,v=d+t.cumulativeDuration;let y=h?v+f:d+m;if(l||!c&&d<=0){const e=o;o+=p,t.timelineStart=v;const i=s;s+=f,n.push({event:t,start:v,end:y,playout:{start:i,end:s},integrated:{start:e,end:o}})}else{if(!(d<=r))return;{if(!g){const r=d-i;if(r>.033){const l=i,c=o;o+=r;const u=s;s+=r;const h={previousEvent:e[a-1]||null,nextEvent:t,start:l,end:l+r,playout:{start:u,end:s},integrated:{start:c,end:o}};n.push(h)}else r>0&&u&&(u.cumulativeDuration+=r,n[n.length-1].end=d)}c&&(y=v),t.timelineStart=v;const r=o;o+=p;const l=s;s+=f,n.push({event:t,start:v,end:y,playout:{start:l,end:s},integrated:{start:r,end:o}})}}const b=t.resumeTime;i=c||b>r?r:b}),i<r){var a;const e=i,t=o,l=r-i;o+=l;const c=s;s+=l,n.push({previousEvent:(null==(a=n[n.length-1])?void 0:a.event)||null,nextEvent:null,start:i,end:e+l,playout:{start:c,end:s},integrated:{start:t,end:o}})}this.setDurations(r,s,o)}else{const e=0;n.push({previousEvent:null,nextEvent:null,start:e,end:r,playout:{start:e,end:r},integrated:{start:e,end:r}}),this.setDurations(r,r,r)}return n}setDurations(e,t,n){this.durations={primary:e,playout:t,integrated:n}}resolveOffsets(e,t){const n=t.main.details,r=n.live?1/0:n.edge;let s=0,a=-1;e.forEach((o,l)=>{const c=o.cue.pre,u=o.cue.post,h=c?0:u?r:o.startTime;this.updateAssetDurations(o);if(a===h?o.cumulativeDuration=s:(s=0,a=h),!u&&o.snapOptions.in&&(o.resumeAnchor=st(null,n.fragments,o.startOffset+o.resumptionOffset,0,0)||void 0),o.appendInPlace&&!o.appendInPlaceStarted){this.primaryCanResumeInPlaceAt(o,t)||(o.appendInPlace=!1)}if(!o.appendInPlace&&l+1<e.length){e[l+1].startTime-e[l].resumeTime<.033&&(e[l+1].appendInPlace=!1,e[l+1].appendInPlace&&this.warn("Could not change append strategy for abutting event ".concat(o)))}const d=i(o.resumeOffset)?o.resumeOffset:o.duration;s+=d})}primaryCanResumeInPlaceAt(e,t){const n=e.resumeTime,i=e.startTime+e.resumptionOffset;if(Math.abs(n-i)>_a)return this.log('"'.concat(e.identifier,'" resumption ').concat(n," not aligned with estimated timeline end ").concat(i)),!1;return!Object.keys(t).some(i=>{const r=t[i].details,s=r.edge;if(n>=s)return this.log('"'.concat(e.identifier,'" resumption ').concat(n," past ").concat(i," playlist end ").concat(s)),!1;const a=st(null,r.fragments,n);if(!a)return this.log('"'.concat(e.identifier,'" resumption ').concat(n," does not align with any fragments in ").concat(i," playlist (").concat(r.fragStart,"-").concat(r.fragmentEnd,")")),!0;const o="audio"===i?.175:0;return!(Math.abs(a.start-n)<_a+o||Math.abs(a.end-n)<_a+o)&&(this.log('"'.concat(e.identifier,'" resumption ').concat(n," not aligned with ").concat(i," fragment bounds (").concat(a.start,"-").concat(a.end," sn: ").concat(a.sn," cc: ").concat(a.cc,")")),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let n=0,i=!1,r=!1;for(let s=0;s<e.assetList.length;s++){const a=e.assetList[s],o=t+n;a.startOffset=n,a.timelineStart=o,i||(i=null===a.duration),r||(r=!!a.error);n+=a.error?0:a.duration||0}e.duration=i&&!r?Math.max(n,e.duration):n}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function Ia(e){return"[".concat(e.event?'"'+e.event.identifier+'"':"primary",": ").concat(e.start.toFixed(2),"-").concat(e.end.toFixed(2),"]")}class Pa{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const n=e.assetListUrl;let i;try{i=Aa(n,this.hls.sessionId,e.baseUrl)}catch(d){const t=this.assignAssetListError(e,o.ASSET_LIST_LOAD_ERROR,d,n);return void this.hls.trigger(l.ERROR,t)}t&&"data:"!==i.protocol&&i.searchParams.set("_HLS_start_offset",""+t);const r=this.hls.config,s=new(0,r.loader)(r),a={responseType:"json",url:i.href},c=r.interstitialAssetListLoadPolicy.default,u={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},h={onSuccess:(t,n,i,r)=>{const s=t.data,a=null==s?void 0:s.ASSETS;if(!Array.isArray(a)){const t=this.assignAssetListError(e,o.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),i.url,n,r);return void this.hls.trigger(l.ERROR,t)}e.assetListResponse=s,this.hls.trigger(l.ASSET_LIST_LOADED,{event:e,assetListResponse:s,networkDetails:r})},onError:(t,n,i,r)=>{const s=this.assignAssetListError(e,o.ASSET_LIST_LOAD_ERROR,new Error("Error loading X-ASSET-LIST: HTTP status ".concat(t.code," ").concat(t.text," (").concat(n.url,")")),n.url,r,i);this.hls.trigger(l.ERROR,s)},onTimeout:(t,n,i)=>{const r=this.assignAssetListError(e,o.ASSET_LIST_LOAD_TIMEOUT,new Error("Timeout loading X-ASSET-LIST (".concat(n.url,")")),n.url,t,i);this.hls.trigger(l.ERROR,r)}};return s.load(a,u,h),this.hls.trigger(l.ASSET_LIST_LOADING,{event:e}),s}assignAssetListError(e,t,n,i,r,s){return e.error=n,{type:a.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:i,error:n,networkDetails:s,stats:r}}}function ka(e){var t;null==e||null==(t=e.play())||t.catch(()=>{})}function Da(e,t){return"[".concat(e,"] Advancing timeline position to ").concat(t)}class Na extends bi{constructor(e,t,n){super(e,t,n,"subtitle-stream-controller",f.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(l.LEVEL_LOADED,this.onLevelLoaded,this),e.on(l.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(l.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(l.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(l.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(l.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(l.LEVEL_LOADED,this.onLevelLoaded,this),e.off(l.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(l.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(l.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(l.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(l.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=li,this.setInterval(500),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:n,success:i}=t;if(this.fragContextChanged(n)||(j(n)&&(this.fragPrevious=n),this.state=li),!i)return;const r=this.tracksBuffered[this.currentTrackId];if(!r)return;let s;const a=n.start;for(let l=0;l<r.length;l++)if(a>=r[l].start&&a<=r[l].end){s=r[l];break}const o=n.start+n.duration;s?s.end=o:(s={start:a,end:o},r.push(s)),this.fragmentTracker.fragBuffered(n),this.fragBufferedComplete(n,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:n,endOffset:i}=t;if(0===n&&i!==Number.POSITIVE_INFINITY){const e=i-1;if(e<=0)return;t.endOffsetSubtitles=Math.max(0,e),this.tracksBuffered.forEach(t=>{for(let n=0;n<t.length;)if(t[n].end<=e)t.shift();else{if(!(t[n].start<e))break;t[n].start=e,n++}}),this.fragmentTracker.removeFragmentsInRange(n,e,f.SUBTITLE)}}onError(e,t){const n=t.frag;(null==n?void 0:n.type)===f.SUBTITLE&&(t.details===o.FRAG_GAP&&this.fragmentTracker.fragBuffered(n,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==oi&&(this.state=li))}onSubtitleTracksUpdated(e,t){let{subtitleTracks:n}=t;this.levels&&$r(this.levels,n)?this.levels=n.map(e=>new We(e)):(this.tracksBuffered=[],this.levels=n.map(e=>{const t=new We(e);return this.tracksBuffered[t.id]=[],t}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,f.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null)}onSubtitleTrackSwitch(e,t){var n;if(this.currentTrackId=t.id,null==(n=this.levels)||!n.length||-1===this.currentTrackId)return void this.clearInterval();const i=this.levels[this.currentTrackId];null!=i&&i.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,i&&this.state!==oi&&this.setInterval(500)}onSubtitleTrackLoaded(e,t){var n;const{currentTrackId:i,levels:r}=this,{details:s,id:a}=t;if(!r)return void this.warn("Subtitle tracks were reset while loading level ".concat(a));const o=r[a];if(a>=r.length||!o)return;this.log("Subtitle track ".concat(a," loaded [").concat(s.startSN,",").concat(s.endSN,"]").concat(s.lastPartSn?"[part-".concat(s.lastPartSn,"-").concat(s.lastPartIndex,"]"):"",",duration:").concat(s.totalduration)),this.mediaBuffer=this.mediaBufferTimeRanges;let c=0;if(s.live||null!=(n=o.details)&&n.live){if(s.deltaUpdateFailed)return;const e=this.mainDetails;if(!e)return void(this.startFragRequested=!1);const t=e.fragments[0];var u;if(o.details)c=this.alignPlaylists(s,o.details,null==(u=this.levelLastLoaded)?void 0:u.details),0===c&&t&&(c=t.start,Wn(s,c));else s.hasProgramDateTime&&e.hasProgramDateTime?(ii(s,e),c=s.fragmentStart):t&&(c=t.start,Wn(s,c));e&&!this.startFragRequested&&this.setStartPosition(e,c)}if(o.details=s,this.levelLastLoaded=o,a===i&&(this.hls.trigger(l.SUBTITLE_TRACK_UPDATED,{details:s,id:a,groupId:t.groupId}),this.tick(),s.live&&!this.fragCurrent&&this.media&&this.state===li)){st(null,s.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),o.details=void 0)}}_handleFragmentLoadComplete(e){const{frag:t,payload:n}=e,i=t.decryptdata,r=this.hls;if(!this.fragContextChanged(t)&&n&&n.byteLength>0&&null!=i&&i.key&&i.iv&&sn(i.method)){const e=performance.now();this.decrypter.decrypt(new Uint8Array(n),i.key.buffer,i.iv.buffer,an(i.method)).catch(e=>{throw r.trigger(l.ERROR,{type:a.MEDIA_ERROR,details:o.FRAG_DECRYPT_ERROR,fatal:!1,error:e,reason:e.message,frag:t}),e}).then(n=>{const i=performance.now();r.trigger(l.FRAG_DECRYPTED,{frag:t,payload:n,stats:{tstart:e,tdecrypt:i}})}).catch(e=>{this.warn("".concat(e.name,": ").concat(e.message)),this.state=li})}}doTick(){if(this.media){if(this.state===li){const{currentTrackId:e,levels:t}=this,n=null==t?void 0:t[e];if(!n||!t.length||!n.details)return;if(this.waitForLive(n))return;const{config:i}=this,r=this.getLoadPosition(),s=Vt.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],r,i.maxBufferHole),{end:a,len:o}=s,l=n.details;if(o>this.hls.maxBufferLength+l.levelTargetDuration)return;const c=l.fragments,u=c.length,h=l.edge;let d=null;const f=this.fragPrevious;if(a<h){const e=i.maxFragLookUpTolerance,t=a>h-e?0:e;d=st(f,c,Math.max(c[0].start,a),t),!d&&f&&f.start<c[0].start&&(d=c[0])}else d=c[u-1];if(d=this.filterReplacedPrimary(d,n.details),!d)return;const p=c[d.sn-l.startSN-1];if(p&&p.cc===d.cc&&this.fragmentTracker.getState(p)===_t&&(d=p),this.fragmentTracker.getState(d)===_t){const e=this.mapToInitFragWhenRequired(d);e&&this.loadFragment(e,n,a)}}}else this.state=li}loadFragment(e,t,n){j(e)?super.loadFragment(e,t,n):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new Oa(this.tracksBuffered[this.currentTrackId]||[])}}class Oa{constructor(e){this.buffered=void 0;const t=(t,n,i)=>{if((n>>>=0)>i-1)throw new DOMException("Failed to execute '".concat(t,"' on 'TimeRanges': The index provided (").concat(n,") is greater than the maximum bound (").concat(i,")"));return e[n][t]};this.buffered={get length(){return e.length},end:n=>t("end",n,e.length),start:n=>t("start",n,e.length)}}}const Fa={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},Ua=e=>String.fromCharCode(Fa[e]||e),Ba=15,za=100,ja={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},Ga={17:2,18:4,21:6,22:8,23:10,19:13,20:15},Va={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},Ha={25:2,26:4,29:6,30:8,31:10,27:13,28:15},Wa=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class Ya{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const n="function"===typeof t?t():t;A.log("".concat(this.time," [").concat(e,"] ").concat(n))}}}const Xa=function(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n].toString(16));return t};class qa{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let n=0;n<t.length;n++){const i=t[n];e.hasOwnProperty(i)&&(this[i]=e[i])}}isDefault(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class Ka{constructor(){this.uchar=" ",this.penState=new qa}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return" "===this.uchar&&this.penState.isDefault()}}class Za{constructor(e){this.chars=[],this.pos=0,this.currPenState=new qa,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<za;t++)this.chars.push(new Ka);this.logger=e}equals(e){for(let t=0;t<za;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<za;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<za;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>za&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=za)}moveCursor(e){const t=this.pos+e;if(e>1)for(let n=this.pos+1;n<t+1;n++)this.chars[n].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=Ua(e);this.pos>=za?this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1))}clearFromPos(e){let t;for(t=e;t<za;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let n=0;n<za;n++){const i=this.chars[n].uchar;" "!==i&&(t=!1),e.push(i)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e);this.chars[this.pos].setPenState(this.currPenState)}}class Ja{constructor(e){this.rows=[],this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<Ba;t++)this.rows.push(new Za(e));this.logger=e}reset(){for(let e=0;e<Ba;e++)this.rows[e].clear();this.currRow=14}equals(e){let t=!0;for(let n=0;n<Ba;n++)if(!this.rows[n].equals(e.rows[n])){t=!1;break}return t}copy(e){for(let t=0;t<Ba;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<Ba;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e);this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+qe(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let t=0;t<Ba;t++)this.rows[t].clear();const e=this.currRow+1-this.nrRollUpRows,n=this.lastOutputScreen;if(n){const i=n.rows[e].cueStartTime,r=this.logger.time;if(null!==i&&null!==r&&i<r)for(let s=0;s<this.nrRollUpRows;s++)this.rows[t-this.nrRollUpRows+s+1].copy(n.rows[e+s])}}this.currRow=t;const n=this.rows[this.currRow];if(null!==e.indent){const t=e.indent,i=Math.max(t-1,0);n.setCursor(e.indent),e.color=n.chars[i].penState.foreground}const i={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(i)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+qe(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(null===this.nrRollUpRows)return void this.logger.log(3,"roll_up but nrRollUpRows not set yet");this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let n="",i=-1;for(let r=0;r<Ba;r++){const n=this.rows[r].getTextString();n&&(i=r+1,e?t.push("Row "+i+": '"+n+"'"):t.push(n.trim()))}return t.length>0&&(n=e?"["+t.join(" | ")+"]":t.join("\n")),n}getTextAndFormat(){return this.rows}}class Qa{constructor(e,t,n){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new Ja(n),this.nonDisplayedMemory=new Ja(n),this.lastOutputScreen=new Ja(n),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=n}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let n=0;n<e.length;n++)this.writeScreen.insertChar(e[n]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const n=Math.floor(e/2)-16,i=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=i[n]}this.logger.log(2,"MIDROW: "+qe(t)),this.writeScreen.setPen(t)}outputDataUpdate(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=this.logger.time;null!==t&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class $a{constructor(e,t,n){this.channels=void 0,this.currentChannel=0,this.cmdHistory={a:null,b:null},this.logger=void 0;const i=this.logger=new Ya;this.channels=[null,new Qa(e,t,i),new Qa(e+1,n,i)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let n=0;n<t.length;n+=2){const e=127&t[n],i=127&t[n+1];let r=!1,s=null;if(0===e&&0===i)continue;this.logger.log(3,()=>"["+Xa([t[n],t[n+1]])+"] -> ("+Xa([e,i])+")");const a=this.cmdHistory;if(e>=16&&e<=31){if(to(e,i,a)){eo(null,null,a),this.logger.log(3,()=>"Repeated command ("+Xa([e,i])+") is dropped");continue}eo(e,i,this.cmdHistory),r=this.parseCmd(e,i),r||(r=this.parseMidrow(e,i)),r||(r=this.parsePAC(e,i)),r||(r=this.parseBackgroundAttributes(e,i))}else eo(null,null,a);if(!r&&(s=this.parseChars(e,i),s)){const e=this.currentChannel;if(e&&e>0){this.channels[e].insertChars(s)}else this.logger.log(2,"No channel found yet. TEXT-MODE?")}r||s||this.logger.log(2,()=>"Couldn't parse cleaned data "+Xa([e,i])+" orig: "+Xa([t[n],t[n+1]]))}}parseCmd(e,t){if(!((20===e||28===e||21===e||29===e)&&t>=32&&t<=47)&&!((23===e||31===e)&&t>=33&&t<=35))return!1;const n=20===e||21===e||23===e?1:2,i=this.channels[n];return 20===e||21===e||28===e||29===e?32===t?i.ccRCL():33===t?i.ccBS():34===t?i.ccAOF():35===t?i.ccAON():36===t?i.ccDER():37===t?i.ccRU(2):38===t?i.ccRU(3):39===t?i.ccRU(4):40===t?i.ccFON():41===t?i.ccRDC():42===t?i.ccTR():43===t?i.ccRTD():44===t?i.ccEDM():45===t?i.ccCR():46===t?i.ccENM():47===t&&i.ccEOC():i.ccTO(t-32),this.currentChannel=n,!0}parseMidrow(e,t){let n=0;if((17===e||25===e)&&t>=32&&t<=47){if(n=17===e?1:2,n!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const i=this.channels[n];return!!i&&(i.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+Xa([e,t])+")"),!0)}return!1}parsePAC(e,t){let n;if(!((e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127)&&!((16===e||24===e)&&t>=64&&t<=95))return!1;const i=e<=23?1:2;n=t>=64&&t<=95?1===i?ja[e]:Va[e]:1===i?Ga[e]:Ha[e];const r=this.channels[i];return!!r&&(r.setPAC(this.interpretPAC(n,t)),this.currentChannel=i,!0)}interpretPAC(e,t){let n;const i={color:null,italics:!1,indent:null,underline:!1,row:e};return n=t>95?t-96:t-64,i.underline=1===(1&n),n<=13?i.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(i.italics=!0,i.color="white"):i.indent=4*Math.floor((n-16)/2),i}parseChars(e,t){let n,i=null,r=null;if(e>=25?(n=2,r=e-8):(n=1,r=e),r>=17&&r<=19){let e;e=17===r?t+80:18===r?t+112:t+144,this.logger.log(2,()=>"Special char '"+Ua(e)+"' in channel "+n),i=[e]}else e>=32&&e<=127&&(i=0===t?[e]:[e,t]);return i&&this.logger.log(3,()=>"Char codes =  "+Xa(i).join(",")),i}parseBackgroundAttributes(e,t){if(!((16===e||24===e)&&t>=32&&t<=47)&&!((23===e||31===e)&&t>=45&&t<=47))return!1;let n;const i={};16===e||24===e?(n=Math.floor((t-32)/2),i.background=Wa[n],t%2===1&&(i.background=i.background+"_semi")):45===t?i.background="transparent":(i.foreground="black",47===t&&(i.underline=!0));const r=e<=23?1:2;return this.channels[r].setBkgData(i),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}eo(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const n=this.channels[t];n&&n.cueSplitAtTime(e)}}}function eo(e,t,n){n.a=e,n.b=t}function to(e,t,n){return n.a===e&&n.b===t}var no=function(){if(null!=hn&&hn.VTTCue)return self.VTTCue;const e=["","lr","rl"],t=["start","middle","end","left","right"];function n(e,t){if("string"!==typeof t)return!1;if(!Array.isArray(e))return!1;const n=t.toLowerCase();return!!~e.indexOf(n)&&n}function i(e){return n(t,e)}function r(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];let r=1;for(;r<arguments.length;r++){const t=arguments[r];for(const n in t)e[n]=t[n]}return e}function s(t,s,a){const o=this,l={enumerable:!0};o.hasBeenReset=!1;let c="",u=!1,h=t,d=s,f=a,p=null,m="",g=!0,v="auto",y="start",b=50,x="middle",_=50,S="middle";Object.defineProperty(o,"id",r({},l,{get:function(){return c},set:function(e){c=""+e}})),Object.defineProperty(o,"pauseOnExit",r({},l,{get:function(){return u},set:function(e){u=!!e}})),Object.defineProperty(o,"startTime",r({},l,{get:function(){return h},set:function(e){if("number"!==typeof e)throw new TypeError("Start time must be set to a number.");h=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"endTime",r({},l,{get:function(){return d},set:function(e){if("number"!==typeof e)throw new TypeError("End time must be set to a number.");d=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"text",r({},l,{get:function(){return f},set:function(e){f=""+e,this.hasBeenReset=!0}})),Object.defineProperty(o,"region",r({},l,{get:function(){return p},set:function(e){p=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"vertical",r({},l,{get:function(){return m},set:function(t){const i=function(t){return n(e,t)}(t);if(!1===i)throw new SyntaxError("An invalid or illegal string was specified.");m=i,this.hasBeenReset=!0}})),Object.defineProperty(o,"snapToLines",r({},l,{get:function(){return g},set:function(e){g=!!e,this.hasBeenReset=!0}})),Object.defineProperty(o,"line",r({},l,{get:function(){return v},set:function(e){if("number"!==typeof e&&"auto"!==e)throw new SyntaxError("An invalid number or illegal string was specified.");v=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"lineAlign",r({},l,{get:function(){return y},set:function(e){const t=i(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");y=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"position",r({},l,{get:function(){return b},set:function(e){if(e<0||e>100)throw new Error("Position must be between 0 and 100.");b=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"positionAlign",r({},l,{get:function(){return x},set:function(e){const t=i(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");x=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"size",r({},l,{get:function(){return _},set:function(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100.");_=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"align",r({},l,{get:function(){return S},set:function(e){const t=i(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");S=t,this.hasBeenReset=!0}})),o.displayState=void 0}return s.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},s}();class io{decode(e,t){if(!e)return"";if("string"!==typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function ro(e){function t(e,t,n,i){return 3600*(0|e)+60*(0|t)+(0|n)+parseFloat(i||0)}const n=e.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return n?parseFloat(n[2])>59?t(n[2],n[3],0,n[4]):t(n[1],n[2],n[3],n[4]):null}class so{constructor(){this.values=Object.create(null)}set(e,t){this.get(e)||""===t||(this.values[e]=t)}get(e,t,n){return n?this.has(e)?this.values[e]:t[n]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,n){for(let i=0;i<n.length;++i)if(t===n[i]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const n=parseFloat(t);if(n>=0&&n<=100)return this.set(e,n),!0}return!1}}function ao(e,t,n,i){const r=i?e.split(i):[e];for(const s in r){if("string"!==typeof r[s])continue;const e=r[s].split(n);if(2!==e.length)continue;t(e[0],e[1])}}const oo=new no(0,0,""),lo="middle"===oo.align?"middle":"center";function co(e,t,n){const i=e;function r(){const t=ro(e);if(null===t)throw new Error("Malformed timestamp: "+i);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function s(){e=e.replace(/^\s+/,"")}if(s(),t.startTime=r(),s(),"--\x3e"!==e.slice(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+i);e=e.slice(3),s(),t.endTime=r(),s(),function(e,t){const i=new so;ao(e,function(e,t){let r;switch(e){case"region":for(let r=n.length-1;r>=0;r--)if(n[r].id===t){i.set(e,n[r].region);break}break;case"vertical":i.alt(e,t,["rl","lr"]);break;case"line":r=t.split(","),i.integer(e,r[0]),i.percent(e,r[0])&&i.set("snapToLines",!1),i.alt(e,r[0],["auto"]),2===r.length&&i.alt("lineAlign",r[1],["start",lo,"end"]);break;case"position":r=t.split(","),i.percent(e,r[0]),2===r.length&&i.alt("positionAlign",r[1],["start",lo,"end","line-left","line-right","auto"]);break;case"size":i.percent(e,t);break;case"align":i.alt(e,t,["start",lo,"end","left","right"])}},/:/,/\s/),t.region=i.get("region",null),t.vertical=i.get("vertical","");let r=i.get("line","auto");"auto"===r&&-1===oo.line&&(r=-1),t.line=r,t.lineAlign=i.get("lineAlign","start"),t.snapToLines=i.get("snapToLines",!0),t.size=i.get("size",100),t.align=i.get("align",lo);let s=i.get("position","auto");"auto"===s&&50===oo.position&&(s="start"===t.align||"left"===t.align?0:"end"===t.align||"right"===t.align?100:50),t.position=s}(e,t)}function uo(e){return e.replace(/<br(?: \/)?>/gi,"\n")}class ho{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new io,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;function n(){let e=t.buffer,n=0;for(e=uo(e);n<e.length&&"\r"!==e[n]&&"\n"!==e[n];)++n;const i=e.slice(0,n);return"\r"===e[n]&&++n,"\n"===e[n]&&++n,t.buffer=e.slice(n),i}function i(e){ao(e,function(e,t){},/:/)}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{let e="";if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;e=n();const i=e.match(/^(\xef\xbb\xbf)?WEBVTT([ \t].*)?$/);if(null==i||!i[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let s=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(s?s=!1:e=n(),t.state){case"HEADER":/:/.test(e)?i(e):e||(t.state="ID");continue;case"NOTE":e||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(e)){t.state="NOTE";break}if(!e)continue;if(t.cue=new no(0,0,""),t.state="CUE",-1===e.indexOf("--\x3e")){t.cue.id=e;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{co(e,t.cue,t.regionList)}catch(r){t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const n=-1!==e.indexOf("--\x3e");if(!e||n&&(s=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(null===t.cue)continue;t.cue.text&&(t.cue.text+="\n"),t.cue.text+=e}continue;case"BADCUE":e||(t.state="ID")}}}catch(r){"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||"HEADER"===e.state)&&(e.buffer+="\n\n",e.parse()),"INITIAL"===e.state||"BADWEBVTT"===e.state)throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const fo=/\r\n|\n\r|\n|\r/g,po=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return e.slice(n,n+t.length)===t};function mo(e,t,n){return xa(e.toString())+xa(t.toString())+xa(n)}function go(e,t,n,r,s,a,o){const l=new ho,c=C(new Uint8Array(e)).trim().replace(fo,"\n").split("\n"),u=[],h=t?function(e){return Lr(e,9e4,1/(arguments.length>1&&void 0!==arguments[1]?arguments[1]:1))}(t.baseTime,t.timescale):0;let d,f="00:00.000",p=0,m=0,g=!0;l.oncue=function(e){const i=n[r];let a=n.ccOffset;const o=(p-h)/9e4;if(null!=i&&i.new&&(void 0!==m?a=n.ccOffset=i.start:function(e,t,n){let i=e[t],r=e[i.prevCC];if(!r||!r.new&&i.new)return e.ccOffset=e.presentationOffset=i.start,void(i.new=!1);for(;null!=(s=r)&&s.new;){var s;e.ccOffset+=i.start-r.start,i.new=!1,i=r,r=e[i.prevCC]}e.presentationOffset=n}(n,r,o)),o){if(!t)return void(d=new Error("Missing initPTS for VTT MPEGTS"));a=o-n.presentationOffset}const l=e.endTime-e.startTime,c=Ur(9e4*(e.startTime+a-m),9e4*s)/9e4;e.startTime=Math.max(c,0),e.endTime=Math.max(c+l,0);const f=e.text.trim();e.text=decodeURIComponent(encodeURIComponent(f)),e.id||(e.id=mo(e.startTime,e.endTime,f)),e.endTime>0&&u.push(e)},l.onparsingerror=function(e){d=e},l.onflush=function(){d?o(d):a(u)},c.forEach(e=>{if(g){if(po(e,"X-TIMESTAMP-MAP=")){g=!1,e.slice(16).split(",").forEach(e=>{po(e,"LOCAL:")?f=e.slice(6):po(e,"MPEGTS:")&&(p=parseInt(e.slice(7)))});try{m=function(e){let t=parseInt(e.slice(-3));const n=parseInt(e.slice(-6,-4)),r=parseInt(e.slice(-9,-7)),s=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!i(t)||!i(n)||!i(r)||!i(s))throw Error("Malformed X-TIMESTAMP-MAP: Local:".concat(e));return t+=1e3*n,t+=6e4*r,t+=36e5*s,t}(f)/1e3}catch(t){d=t}return}""===e&&(g=!1)}l.parse(e+"\n")}),l.flush()}const vo="stpp.ttml.im1t",yo=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,bo=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,xo={left:"start",center:"center",right:"end",start:"start",end:"end"};function _o(e,t,n,i){const r=$(new Uint8Array(e),["mdat"]);if(0===r.length)return void i(new Error("Could not parse IMSC1 mdat"));const s=r.map(e=>C(e)),a=function(e,t){return Lr(e,t,1/(arguments.length>2&&void 0!==arguments[2]?arguments[2]:1),arguments.length>3&&void 0!==arguments[3]&&arguments[3])}(t.baseTime,1,t.timescale);try{s.forEach(e=>n(function(e,t){const n=(new DOMParser).parseFromString(e,"text/xml"),i=n.getElementsByTagName("tt")[0];if(!i)throw new Error("Invalid ttml");const r={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},s=Object.keys(r).reduce((e,t)=>(e[t]=i.getAttribute("ttp:".concat(t))||r[t],e),{}),a="preserve"!==i.getAttribute("xml:space"),o=Eo(So(i,"styling","style")),l=Eo(So(i,"layout","region")),c=So(i,"body","[begin]");return[].map.call(c,e=>{const n=To(e,a);if(!n||!e.hasAttribute("begin"))return null;const i=Mo(e.getAttribute("begin"),s),r=Mo(e.getAttribute("dur"),s);let c=Mo(e.getAttribute("end"),s);if(null===i)throw Ao(e);if(null===c){if(null===r)throw Ao(e);c=i+r}const u=new no(i-t,c-t,n);u.id=mo(u.startTime,u.endTime,u.text);const h=function(e,t,n){const i="http://www.w3.org/ns/ttml#styling";let r=null;const s=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],a=null!=e&&e.hasAttribute("style")?e.getAttribute("style"):null;a&&n.hasOwnProperty(a)&&(r=n[a]);return s.reduce((n,s)=>{const a=wo(t,i,s)||wo(e,i,s)||wo(r,i,s);return a&&(n[s]=a),n},{})}(l[e.getAttribute("region")],o[e.getAttribute("style")],o),{textAlign:d}=h;if(d){const e=xo[d];e&&(u.lineAlign=e),u.align=d}return v(u,h),u}).filter(e=>null!==e)}(e,a)))}catch(o){i(o)}}function So(e,t,n){const i=e.getElementsByTagName(t)[0];return i?[].slice.call(i.querySelectorAll(n)):[]}function Eo(e){return e.reduce((e,t)=>{const n=t.getAttribute("xml:id");return n&&(e[n]=t),e},{})}function To(e,t){return[].slice.call(e.childNodes).reduce((e,n,i)=>{var r;return"br"===n.nodeName&&i?e+"\n":null!=(r=n.childNodes)&&r.length?To(n,t):t?e+n.textContent.trim().replace(/\s+/g," "):e+n.textContent},"")}function wo(e,t,n){return e&&e.hasAttributeNS(t,n)?e.getAttributeNS(t,n):null}function Ao(e){return new Error("Could not parse ttml timestamp ".concat(e))}function Mo(e,t){if(!e)return null;let n=ro(e);return null===n&&(yo.test(e)?n=function(e,t){const n=yo.exec(e),i=(0|n[4])+(0|n[5])/t.subFrameRate;return 3600*(0|n[1])+60*(0|n[2])+(0|n[3])+i/t.frameRate}(e,t):bo.test(e)&&(n=function(e,t){const n=bo.exec(e),i=Number(n[1]);switch(n[2]){case"h":return 3600*i;case"m":return 60*i;case"ms":return 1e3*i;case"f":return i/t.frameRate;case"t":return i/t.tickRate}return i}(e,t))),n}class Ro{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,n){(null===this.startTime||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=n,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class Co{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(l.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(l.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(l.MANIFEST_LOADING,this.onManifestLoading,this),e.on(l.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(l.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(l.FRAG_LOADING,this.onFragLoading,this),e.on(l.FRAG_LOADED,this.onFragLoaded,this),e.on(l.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(l.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(l.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(l.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(l.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(l.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(l.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(l.MANIFEST_LOADING,this.onManifestLoading,this),e.off(l.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(l.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(l.FRAG_LOADING,this.onFragLoading,this),e.off(l.FRAG_LOADED,this.onFragLoaded,this),e.off(l.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(l.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(l.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(l.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(l.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new Ro(this,"textTrack1"),t=new Ro(this,"textTrack2"),n=new Ro(this,"textTrack3"),i=new Ro(this,"textTrack4");this.cea608Parser1=new $a(1,e,t),this.cea608Parser2=new $a(3,n,i)}addCues(e,t,n,i,r){let s=!1;for(let a=r.length;a--;){const e=r[a],i=Po(e[0],e[1],t,n);if(i>=0&&(e[0]=Math.min(e[0],t),e[1]=Math.max(e[1],n),s=!0,i/(n-t)>.5))return}if(s||r.push([t,n]),this.config.renderTextTracksNatively){const r=this.captionsTracks[e];this.Cues.newCue(r,t,n,i)}else{const r=this.Cues.newCue(null,t,n,i);this.hls.trigger(l.CUES_PARSED,{type:"captions",cues:r,track:e})}}onInitPtsFound(e,t){let{frag:n,id:i,initPTS:r,timescale:s,trackId:a}=t;const{unparsedVttFrags:o}=this;i===f.MAIN&&(this.initPTS[n.cc]={baseTime:r,timescale:s,trackId:a}),o.length&&(this.unparsedVttFrags=[],o.forEach(e=>{this.initPTS[e.frag.cc]?this.onFragLoaded(l.FRAG_LOADED,e):this.hls.trigger(l.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){const{media:n}=this;if(n)for(let i=0;i<n.textTracks.length;i++){const r=n.textTracks[i];if(Io(r,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return r}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:n,media:i}=this,{label:r,languageCode:s}=t[e],a=this.getExistingTrack(r,s);if(a)n[e]=a,ga(n[e]),pa(n[e],i);else{const t=this.createTextTrack("captions",r,s);t&&(t[e]=!0,n[e]=t)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const n={_id:e,label:t.label,kind:"captions",default:!!t.media&&!!t.media.default,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=n,this.hls.trigger(l.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[n]})}createTextTrack(e,t,n){const i=this.media;if(i)return i.addTextTrack(e,t,n)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const n=!!t.transferMedia;if(this.media=null,n)return;const{captionsTracks:i}=this;Object.keys(i).forEach(e=>{ga(i[e]),delete i[e]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let n=0;n<t.length;n++)ga(t[n])}onSubtitleTracksUpdated(e,t){const n=t.subtitleTracks||[],i=n.some(e=>e.textCodec===vo);if(this.config.enableWebVTT||i&&this.config.enableIMSC1){if($r(this.tracks,n))return void(this.tracks=n);if(this.textTracks=[],this.tracks=n,this.config.renderTextTracksNatively){const e=this.media,t=e?ya(e.textTracks):null;if(this.tracks.forEach((e,n)=>{let i;if(t){let n=null;for(let i=0;i<t.length;i++)if(t[i]&&Io(t[i],e)){n=t[i],t[i]=null;break}n&&(i=n)}if(i)ga(i);else{const t=Lo(e);i=this.createTextTrack(t,e.name,e.lang),i&&(i.mode="disabled")}i&&this.textTracks.push(i)}),null!=t&&t.length){const e=t.filter(e=>null!==e).map(e=>e.label);e.length&&this.hls.logger.warn("Media element contains unused subtitle tracks: ".concat(e.join(", "),". Replace media element for each source to clear TextTracks and captions menu."))}}else if(this.tracks.length){const e=this.tracks.map(e=>({label:e.name,kind:e.type.toLowerCase(),default:e.default,subtitleTrack:e}));this.hls.trigger(l.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:e})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(e=>{const t=/(?:CC|SERVICE)([1-4])/.exec(e.instreamId);if(!t)return;const n="textTrack".concat(t[1]),i=this.captionsProperties[n];i&&(i.label=e.name,e.lang&&(i.languageCode=e.lang),i.media=e)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return null==t?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===f.MAIN){var n,i;const{cea608Parser1:e,cea608Parser2:r,lastSn:s}=this,{cc:a,sn:o}=t.frag,l=null!=(n=null==(i=t.part)?void 0:i.index)?n:-1;e&&r&&(o!==s+1||o===s&&l!==this.lastPartIndex+1||a!==this.lastCc)&&(e.reset(),r.reset()),this.lastCc=a,this.lastSn=o,this.lastPartIndex=l}}onFragLoaded(e,t){const{frag:n,payload:i}=t;if(n.type===f.SUBTITLE)if(i.byteLength){const e=n.decryptdata,r="stats"in t;if(null==e||!e.encrypted||r){const e=this.tracks[n.level],r=this.vttCCs;r[n.cc]||(r[n.cc]={start:n.start,prevCC:this.prevCC,new:!0},this.prevCC=n.cc),e&&e.textCodec===vo?this._parseIMSC1(n,i):this._parseVTTs(t)}}else this.hls.trigger(l.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const n=this.hls;_o(t,this.initPTS[e.cc],t=>{this._appendCues(t,e.level),n.trigger(l.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},t=>{n.logger.log("Failed to parse IMSC1: ".concat(t)),n.trigger(l.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:t})})}_parseVTTs(e){var t;const{frag:n,payload:i}=e,{initPTS:r,unparsedVttFrags:s}=this,a=r.length-1;if(!r[n.cc]&&-1===a)return void s.push(e);const o=this.hls;go(null!=(t=n.initSegment)&&t.data?ce(n.initSegment.data,new Uint8Array(i)).buffer:i,this.initPTS[n.cc],this.vttCCs,n.cc,n.start,e=>{this._appendCues(e,n.level),o.trigger(l.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:n})},t=>{const r="Missing initPTS for VTT MPEGTS"===t.message;r?s.push(e):this._fallbackToIMSC1(n,i),o.logger.log("Failed to parse VTT cue: ".concat(t)),r&&a>n.cc||o.trigger(l.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:t})})}_fallbackToIMSC1(e,t){const n=this.tracks[e.level];n.textCodec||_o(t,this.initPTS[e.cc],()=>{n.textCodec=vo,this._parseIMSC1(e,t)},()=>{n.textCodec="wvtt"})}_appendCues(e,t){const n=this.hls;if(this.config.renderTextTracksNatively){const n=this.textTracks[t];if(!n||"disabled"===n.mode)return;e.forEach(e=>ma(n,e))}else{const i=this.tracks[t];if(!i)return;const r=i.default?"default":"subtitles"+t;n.trigger(l.CUES_PARSED,{type:"subtitles",cues:e,track:r})}}onFragDecrypted(e,t){const{frag:n}=t;n.type===f.SUBTITLE&&this.onFragLoaded(l.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:n,samples:i}=t;if(n.type!==f.MAIN||"NONE"!==this.closedCaptionsForLevel(n))for(let r=0;r<i.length;r++){const e=i[r].bytes;if(e){this.cea608Parser1||this.initCea608Parsers();const t=this.extractCea608Data(e);this.cea608Parser1.addData(i[r].pts,t[0]),this.cea608Parser2.addData(i[r].pts,t[1])}}}onBufferFlushing(e,t){let{startOffset:n,endOffset:i,endOffsetSubtitles:r,type:s}=t;const{media:a}=this;if(a&&!(a.currentTime<i)){if(!s||"video"===s){const{captionsTracks:e}=this;Object.keys(e).forEach(t=>va(e[t],n,i))}if(this.config.renderTextTracksNatively&&0===n&&void 0!==r){const{textTracks:e}=this;Object.keys(e).forEach(t=>va(e[t],n,r))}}}extractCea608Data(e){const t=[[],[]],n=31&e[0];let i=2;for(let r=0;r<n;r++){const n=e[i++],r=127&e[i++],s=127&e[i++];if(0===r&&0===s)continue;if(0!==(4&n)){const e=3&n;0!==e&&1!==e||(t[e].push(r),t[e].push(s))}}return t}}function Lo(e){return e.characteristics&&/transcribes-spoken-dialog/gi.test(e.characteristics)&&/describes-music-and-sound/gi.test(e.characteristics)?"captions":"subtitles"}function Io(e,t){return!!e&&e.kind===Lo(t)&&ts(t,e)}function Po(e,t,n,i){return Math.min(t,i)-Math.max(e,n)}const ko=/\s/,Do={newCue(e,t,n,i){const r=[];let s,a,o,l,c;const u=self.VTTCue||self.TextTrackCue;for(let d=0;d<i.rows.length;d++)if(s=i.rows[d],o=!0,l=0,c="",!s.isEmpty()){var h;for(let e=0;e<s.chars.length;e++)ko.test(s.chars[e].uchar)&&o?l++:(c+=s.chars[e].uchar,o=!1);s.cueStartTime=t,t===n&&(n+=1e-4),l>=16?l--:l++;const i=uo(c.trim()),f=mo(t,n,i);null!=e&&null!=(h=e.cues)&&h.getCueById(f)||(a=new u(t,n,i),a.id=f,a.line=d+1,a.align="left",a.position=10+Math.min(80,10*Math.floor(8*l/32)),r.push(a))}return e&&r.length&&(r.sort((e,t)=>"auto"===e.line||"auto"===t.line?0:e.line>8&&t.line>8?t.line-e.line:e.line-t.line),r.forEach(t=>ma(e,t))),r}};function No(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(e){}return!1}const Oo=/(\d+)-(\d+)\/(\d+)/;class Fo{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||Uo,this.controller=new self.AbortController,this.stats=new O}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,n){const r=this.stats;if(r.loading.start)throw new Error("Loader can only be used once.");r.loading.start=self.performance.now();const s=function(e,t){const n={method:"GET",mode:"cors",credentials:"same-origin",signal:t,headers:new self.Headers(v({},e.headers))};e.rangeEnd&&n.headers.set("Range","bytes="+e.rangeStart+"-"+String(e.rangeEnd-1));return n}(e,this.controller.signal),a="arraybuffer"===e.responseType,o=a?"byteLength":"length",{maxTimeToFirstByteMs:l,maxLoadTimeMs:c}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=n,this.request=this.fetchSetup(e,s),self.clearTimeout(this.requestTimeout),t.timeout=l&&i(l)?l:c,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(r,e,this.response))},t.timeout);(Yr(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(n=>{var s;this.response=this.loader=n;const o=Math.max(self.performance.now(),r.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=c,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(r,e,this.response))},c-(o-r.loading.start)),!n.ok){const{status:e,statusText:t}=n;throw new Bo(t||"fetch, bad network response",e,n)}r.loading.first=o,r.total=function(e){const t=e.get("Content-Range");if(t){const e=function(e){const t=Oo.exec(e);if(t)return parseInt(t[2])-parseInt(t[1])+1}(t);if(i(e))return e}const n=e.get("Content-Length");if(n)return parseInt(n)}(n.headers)||r.total;const l=null==(s=this.callbacks)?void 0:s.onProgress;return l&&i(t.highWaterMark)?this.loadProgressively(n,r,e,t.highWaterMark,l):a?n.arrayBuffer():"json"===e.responseType?n.json():n.text()}).then(n=>{var s,a;const l=this.response;if(!l)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),r.loading.end=Math.max(self.performance.now(),r.loading.first);const c=n[o];c&&(r.loaded=r.total=c);const u={url:l.url,data:n,code:l.status},h=null==(s=this.callbacks)?void 0:s.onProgress;h&&!i(t.highWaterMark)&&h(r,e,n,l),null==(a=this.callbacks)||a.onSuccess(u,r,e,l)}).catch(t=>{var n;if(self.clearTimeout(this.requestTimeout),r.aborted)return;const i=t&&t.code||0,s=t?t.message:null;null==(n=this.callbacks)||n.onError({code:i,text:s},e,t?t.details:null,r)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4?arguments[4]:void 0;const s=new _i,a=e.body.getReader(),o=()=>a.read().then(a=>{if(a.done)return s.dataLength&&r(t,n,s.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const l=a.value,c=l.length;return t.loaded+=c,c<i||s.dataLength?(s.push(l),s.dataLength>=i&&r(t,n,s.flush().buffer,e)):r(t,n,l.buffer,e),o()}).catch(()=>Promise.reject());return o()}}function Uo(e,t){return new self.Request(e.url,t)}class Bo extends Error{constructor(e,t,n){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=n}}const zo=/^age:\s*[\d.]+\s*$/im;class jo{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new O,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,4!==e.readyState&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,n){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=n,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const n=this.loader=new self.XMLHttpRequest,i=this.stats;i.loading.first=0,i.loaded=0,i.aborted=!1;const r=this.xhrSetup;r?Promise.resolve().then(()=>{if(this.loader===n&&!this.stats.aborted)return r(n,t.url)}).catch(e=>{if(this.loader===n&&!this.stats.aborted)return n.open("GET",t.url,!0),r(n,t.url)}).then(()=>{this.loader!==n||this.stats.aborted||this.openAndSendXhr(n,t,e)}).catch(e=>{var r;null==(r=this.callbacks)||r.onError({code:n.status,text:e.message},t,n,i)}):this.openAndSendXhr(n,t,e)}openAndSendXhr(e,t,n){e.readyState||e.open("GET",t.url,!0);const r=t.headers,{maxTimeToFirstByteMs:s,maxLoadTimeMs:a}=n.loadPolicy;if(r)for(const i in r)e.setRequestHeader(i,r[i]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),n.timeout=s&&i(s)?s:a,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),n.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:n}=this;if(!e||!t)return;const i=t.readyState,r=this.config;if(!n.aborted&&i>=2&&(0===n.loading.first&&(n.loading.first=Math.max(self.performance.now(),n.loading.start),r.timeout!==r.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),r.timeout=r.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.loadPolicy.maxLoadTimeMs-(n.loading.first-n.loading.start)))),4===i)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const i=t.status,l="text"===t.responseType?t.responseText:null;if(i>=200&&i<300){const r=null!=l?l:t.response;if(null!=r){var s,a;n.loading.end=Math.max(self.performance.now(),n.loading.first);const o="arraybuffer"===t.responseType?r.byteLength:r.length;n.loaded=n.total=o,n.bwEstimate=8e3*n.total/(n.loading.end-n.loading.first);const l=null==(s=this.callbacks)?void 0:s.onProgress;l&&l(n,e,r,t);const c={url:t.responseURL,data:r,code:i};return void(null==(a=this.callbacks)||a.onSuccess(c,n,e,t))}}const c=r.loadPolicy.errorRetry;var o;if(mt(c,n.retry,!1,{url:e.url,data:void 0,code:i}))this.retry(c);else A.error("".concat(i," while loading ").concat(e.url)),null==(o=this.callbacks)||o.onError({code:i,text:t.statusText},e,t,n)}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry;if(mt(e,this.stats.retry,!0))this.retry(e);else{var t;A.warn("timeout while loading ".concat(null==(t=this.context)?void 0:t.url));const e=this.callbacks;e&&(this.abortInternal(),e.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:n}=this;this.retryDelay=ft(e,n.retry),n.retry++,A.warn("".concat(status?"HTTP Status "+status:"Timeout"," while loading ").concat(null==t?void 0:t.url,", retrying ").concat(n.retry,"/").concat(e.maxNumRetry," in ").concat(this.retryDelay,"ms")),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&zo.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp("^".concat(e,":\\s*[\\d.]+\\s*$"),"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const Go=b(b({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:6e7,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:jo,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:it,bufferController:os,capLevelController:us,errorController:bt,fpsController:fa,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:vn,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null}},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},{cueHandler:Do,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:Na,subtitleTrackController:ba,timelineController:Co,audioStreamController:Jr,audioTrackController:ns,emeController:la,cmcdController:ra,contentSteeringController:sa,interstitialsController:class extends x{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const e=this.currentTime;if(void 0===e||this.playbackDisabled||!this.schedule)return;const t=e-this.timelinePos;if(Math.abs(t)<1/7056e5)return;const n=t<=-.01;this.timelinePos=e,this.bufferedPos=e;const i=this.playingItem;if(!i)return void this.checkBuffer();if(n){this.schedule.resetErrorsInRange(e,e-t)&&this.updateSchedule(!0)}if(this.checkBuffer(),n&&e<i.start||e>=i.end){var r;const t=this.findItemIndex(i);let s=this.schedule.findItemIndexAtTime(e);if(-1===s&&(s=t+(n?-1:1),this.log("seeked ".concat(n?"back ":"","to position not covered by schedule ").concat(e," (resolving from ").concat(t," to ").concat(s,")"))),!this.isInterstitial(i)&&null!=(r=this.media)&&r.paused&&(this.shouldPlay=!1),!n&&s>t){const e=this.schedule.findJumpRestrictedIndex(t+1,s);if(e>t)return void this.setSchedulePosition(e)}return void this.setSchedulePosition(s)}const s=this.playingAsset;if(!s){if(this.playingLastItem&&this.isInterstitial(i)){const t=i.event.assetList[0];t&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(e,t))}return}const a=s.timelineStart,o=s.duration||0;var l;(n&&e<a||e>=a+o)&&(null!=(l=i.event)&&l.appendInPlace&&(this.clearAssetPlayers(i.event,i),this.flushFrontBuffer(e)),this.setScheduleToAssetAtTime(e,s))},this.onTimeupdate=()=>{const e=this.currentTime;if(void 0===e||this.playbackDisabled)return;if(!(e>this.timelinePos))return;this.timelinePos=e,e>this.bufferedPos&&this.checkBuffer();const t=this.playingItem;if(!t||this.playingLastItem)return;if(e>=t.end){this.timelinePos=t.end;const e=this.findItemIndex(t);this.setSchedulePosition(e+1)}const n=this.playingAsset;if(!n)return;e>=n.timelineStart+(n.duration||0)&&this.setScheduleToAssetAtTime(e,n)},this.onScheduleUpdate=(e,t)=>{const n=this.schedule;if(!n)return;const i=this.playingItem,r=n.events||[],s=n.items||[],a=n.durations,o=e.map(e=>e.identifier),c=!(!r.length&&!o.length);(c||t)&&this.log("INTERSTITIALS_UPDATED (".concat(r.length,"): ").concat(r,"\nSchedule: ").concat(s.map(e=>Ia(e))," pos: ").concat(this.timelinePos)),o.length&&this.log("Removed events ".concat(o));let u=null,h=null;i&&(u=this.updateItem(i,this.timelinePos),this.itemsMatch(i,u)?this.playingItem=u:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const d=this.bufferingItem;if(d&&(h=this.updateItem(d,this.bufferedPos),this.itemsMatch(d,h)?this.bufferingItem=h:d.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(d.event,null))),e.forEach(e=>{e.assetList.forEach(e=>{this.clearAssetPlayer(e.identifier,null)})}),this.playerQueue.forEach(e=>{if(e.interstitial.appendInPlace){const n=e.assetItem.timelineStart,i=e.timelineOffset-n;if(i)try{e.timelineOffset=n}catch(t){Math.abs(i)>_a&&this.warn("".concat(t,' ("').concat(e.assetId,'" ').concat(e.timelineOffset,"->").concat(n,")"))}}}),c||t){if(this.hls.trigger(l.INTERSTITIALS_UPDATED,{events:r.slice(0),schedule:s.slice(0),durations:a,removedIds:o}),this.isInterstitial(i)&&o.includes(i.event.identifier))return this.warn('Interstitial "'.concat(i.event.identifier,'" removed while playing')),void this.primaryFallback(i.event);i&&this.trimInPlace(u,i),d&&h!==u&&this.trimInPlace(h,d),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new Pa(e),this.schedule=new La(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e&&(e.on(l.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(l.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(l.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(l.MANIFEST_LOADING,this.onManifestLoading,this),e.on(l.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(l.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(l.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(l.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(l.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(l.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(l.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(l.BUFFER_APPENDED,this.onBufferAppended,this),e.on(l.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(l.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(l.MEDIA_ENDED,this.onMediaEnded,this),e.on(l.ERROR,this.onError,this),e.on(l.DESTROYING,this.onDestroying,this))}unregisterListeners(){const e=this.hls;e&&(e.off(l.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(l.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(l.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(l.MANIFEST_LOADING,this.onManifestLoading,this),e.off(l.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(l.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(l.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(l.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(l.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(l.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(l.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(l.BUFFER_CODECS,this.onBufferCodecs,this),e.off(l.BUFFER_APPENDED,this.onBufferAppended,this),e.off(l.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(l.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(l.MEDIA_ENDED,this.onMediaEnded,this),e.off(l.ERROR,this.onError,this),e.off(l.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;null==(e=this.getBufferingPlayer())||e.resumeBuffering()}pauseBuffering(){var e;null==(e=this.getBufferingPlayer())||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){si(e,"play",this.onPlay),si(e,"pause",this.onPause),si(e,"seeking",this.onSeeking),si(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const n=this.media=t.media;ri(n,"seeking",this.onSeeking),ri(n,"timeupdate",this.onTimeupdate),ri(n,"play",this.onPlay),ri(n,"pause",this.onPause)}onMediaAttached(e,t){const n=this.effectivePlayingItem,i=this.detachedData;if(this.detachedData=null,null===n)this.checkStart();else if(!i){this.clearScheduleState();const e=this.findItemIndex(n);this.setSchedulePosition(e)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const n=!!t.transferMedia,i=this.media;if(this.media=null,!n&&(i&&this.removeMediaListeners(i),this.detachedData)){const e=this.getBufferingPlayer();e&&(this.log("Removing schedule state for detachedData and ".concat(e)),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,e.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const e=this,t=()=>e.bufferingItem||e.waitingItem,n=t=>t?e.getAssetPlayer(t.identifier):t,i=(t,i,s,a,o)=>{if(t){let l=t[i].start;const c=t.event;if(c){if("playout"===i||c.timelineOccupancy!==Sa.Point){const e=n(s);(null==e?void 0:e.interstitial)===c&&(l+=e.assetItem.startOffset+e[o])}}else{l+=("bufferedPos"===a?r():e[a])-t.start}return l}return 0},r=()=>{const t=e.bufferedPos;return t===Number.MAX_VALUE?s("primary"):Math.max(t,0)},s=t=>{var n,i;return null!=(n=e.primaryDetails)&&n.live?e.primaryDetails.edge:(null==(i=e.schedule)?void 0:i.durations[t])||0},a=(t,r)=>{var s,a;const o=e.effectivePlayingItem;if(null!=o&&null!=(s=o.event)&&s.restrictions.skip||!e.schedule)return;e.log("seek to ".concat(t,' "').concat(r,'"'));const l=e.effectivePlayingItem,c=e.schedule.findItemIndexAtTime(t,r),u=null==(a=e.schedule.items)?void 0:a[c],h=e.getBufferingPlayer(),d=null==h?void 0:h.interstitial,f=null==d?void 0:d.appendInPlace,p=l&&e.itemsMatch(l,u);if(l&&(f||p)){const s=n(e.playingAsset),a=(null==s?void 0:s.media)||e.primaryMedia;if(a){const n="primary"===r?a.currentTime:i(l,r,e.playingAsset,"timelinePos","currentTime"),o=t-n,c=(f?n:a.currentTime)+o;if(c>=0&&(!s||f||c<=s.duration))return void(a.currentTime=c)}}if(u){let n=t;if("primary"!==r){const e=t-u[r].start;n=u.start+e}const i=!e.isInterstitial(u);if(e.isInterstitial(l)&&!l.event.appendInPlace||!i&&!u.event.appendInPlace){if(l){const s=e.findItemIndex(l);if(c>s){const t=e.schedule.findJumpRestrictedIndex(s+1,c);if(t>s)return void e.setSchedulePosition(t)}let a=0;if(i)e.timelinePos=n,e.checkBuffer();else{const e=u.event.assetList,n=t-(u[r]||u).start;for(let t=e.length;t--;){const i=e[t];if(i.duration&&n>=i.startOffset&&n<i.startOffset+i.duration){a=t;break}}}e.setSchedulePosition(c,a)}}else{const t=e.media||(f?null==h?void 0:h.media:null);t&&(t.currentTime=n)}}},o=()=>{const n=e.effectivePlayingItem;if(e.isInterstitial(n))return n;const i=t();return e.isInterstitial(i)?i:null},l={get bufferedEnd(){const n=t(),r=e.bufferingItem;var s;return r&&r===n&&(i(r,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-r.playout.start||(null==(s=e.bufferingAsset)?void 0:s.startOffset))||0},get currentTime(){const t=o(),n=e.effectivePlayingItem;return n&&n===t?i(n,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-n.playout.start:0},set currentTime(t){const n=o(),i=e.effectivePlayingItem;i&&i===n&&a(t+i.playout.start,"playout")},get duration(){const e=o();return e?e.playout.end-e.playout.start:0},get assetPlayers(){var t;const n=null==(t=o())?void 0:t.event.assetList;return n?n.map(t=>e.getAssetPlayer(t.identifier)):[]},get playingIndex(){var t;const n=null==(t=o())?void 0:t.event;return n&&e.effectivePlayingAsset?n.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return o()}};return this.manager={get events(){var t;return(null==(t=e.schedule)||null==(t=t.events)?void 0:t.slice(0))||[]},get schedule(){var t;return(null==(t=e.schedule)||null==(t=t.items)?void 0:t.slice(0))||[]},get interstitialPlayer(){return o()?l:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const n=t();return e.findItemIndex(n)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const t=e.effectivePlayingItem;return e.findItemIndex(t)},primary:{get bufferedEnd(){return r()},get currentTime(){const t=e.timelinePos;return t>0?t:0},set currentTime(e){a(e,"primary")},get duration(){return s("primary")},get seekableStart(){var t;return(null==(t=e.primaryDetails)?void 0:t.fragmentStart)||0}},integrated:{get bufferedEnd(){return i(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return i(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(e){a(e,"integrated")},get duration(){return s("integrated")},get seekableStart(){var t;return((t,n)=>{var i;if(0!==t&&"primary"!==n&&null!=(i=e.schedule)&&i.length){var r;const i=e.schedule.findItemIndexAtTime(t),s=null==(r=e.schedule.items)?void 0:r[i];if(s)return t+(s[n].start-s.start)}return t})((null==(t=e.primaryDetails)?void 0:t.fragmentStart)||0,"integrated")}},skip:()=>{const t=e.effectivePlayingItem,n=null==t?void 0:t.event;if(n&&!n.restrictions.skip){const i=e.findItemIndex(t);if(n.appendInPlace){const e=t.playout.start+t.event.duration;a(e+.001,"playout")}else e.advanceAfterAssetEnded(n,i,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,n=null==(e=this.schedule)?void 0:e.items;return!!(this.playbackStarted&&t&&n)&&this.findItemIndex(t)===n.length-1}get playbackStarted(){return null!==this.effectivePlayingItem}get currentTime(){var e,t;if(null===this.mediaSelection)return;const n=this.waitingItem||this.playingItem;if(this.isInterstitial(n)&&!n.event.appendInPlace)return;let r=this.media;!r&&null!=(e=this.bufferingItem)&&null!=(e=e.event)&&e.appendInPlace&&(r=this.primaryMedia);const s=null==(t=r)?void 0:t.currentTime;return void 0!==s&&i(s)?s:void 0}get primaryMedia(){var e;return this.media||(null==(e=this.detachedData)?void 0:e.media)||null}isInterstitial(e){return!(null==e||!e.event)}retreiveMediaSource(e,t){const n=this.getAssetPlayer(e);n&&this.transferMediaFromPlayer(n,t)}transferMediaFromPlayer(e,t){const n=e.interstitial.appendInPlace,i=e.media;if(n&&i===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&i)return void(this.detachedData={media:i});const n=e.transferMedia();this.log("transfer MediaSource from ".concat(e," ").concat(qe(n))),this.detachedData=n}else t&&i&&(this.shouldPlay||(this.shouldPlay=!i.paused))}transferMediaTo(e,t){var n,i;if(e.media===t)return;let r=null;const s=this.hls,a=e!==s,o=a&&e.interstitial.appendInPlace,l=null==(n=this.detachedData)?void 0:n.mediaSource;let c;if(s.media)o&&(r=s.transferMedia(),this.detachedData=r),c="Primary";else if(l){const e=this.getBufferingPlayer();e?(r=e.transferMedia(),c="".concat(e)):c="detached MediaSource"}else c="detached media";if(!r)if(l)r=this.detachedData,this.log("using detachedData: MediaSource ".concat(qe(r)));else if(!this.detachedData||s.media===t){const e=this.playerQueue;e.length>1&&e.forEach(e=>{if(a&&e.interstitial.appendInPlace!==o){const t=e.interstitial;this.clearInterstitial(e.interstitial,null),t.appendInPlace=!1,t.appendInPlace&&this.warn("Could not change append strategy for queued assets ".concat(t))}}),this.hls.detachMedia(),this.detachedData={media:t}}const u=r&&"mediaSource"in r&&"closed"!==(null==(i=r.mediaSource)?void 0:i.readyState),h=u&&r?r:t;this.log("".concat(u?"transfering MediaSource":"attaching media"," to ").concat(a?e:"Primary"," from ").concat(c," (media.currentTime: ").concat(t.currentTime,")"));const d=this.schedule;if(h===r&&d){const t=a&&e.assetId===d.assetIdAtEnd;h.overrides={duration:d.duration,endOfStream:!a||t,cueRemoval:!a}}e.attachMedia(h)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=null==e?void 0:e.events;if(!t||this.playbackDisabled||!this.media)return;-1===this.bufferedPos&&(this.bufferedPos=0);const n=this.timelinePos,i=this.effectivePlayingItem;if(-1===n){const n=this.hls.startPosition;if(this.log(Da("checkStart",n)),this.timelinePos=n,t.length&&t[0].cue.pre){const n=e.findEventIndex(t[0].identifier);this.setSchedulePosition(n)}else if(n>=0||!this.primaryLive){const t=this.timelinePos=n>0?n:0,i=e.findItemIndexAtTime(t);this.setSchedulePosition(i)}}else if(i&&!this.playingItem){const t=e.findItemIndex(i);this.setSchedulePosition(t)}}advanceAssetBuffering(e,t){const n=e.event,i=n.findAssetIndex(t),r=Ma(n,i);if(n.isAssetPastPlayoutLimit(r)){if(this.schedule){var s;const t=null==(s=this.schedule.items)?void 0:s[this.findItemIndex(e)+1];t&&this.bufferedToItem(t)}}else this.bufferedToEvent(e,r)}advanceAfterAssetEnded(e,t,n){const i=Ma(e,n);if(e.isAssetPastPlayoutLimit(i)){if(this.schedule){const n=this.schedule.items;if(n){const i=t+1;if(i>=n.length)return void this.setSchedulePosition(-1);const r=e.resumeTime;this.timelinePos<r&&(this.log(Da("advanceAfterAssetEnded",r)),this.timelinePos=r,e.appendInPlace&&this.advanceInPlace(r),this.checkBuffer(this.bufferedPos<r)),this.setSchedulePosition(i)}}}else{if(e.appendInPlace){const t=e.assetList[i];t&&this.advanceInPlace(t.timelineStart)}this.setSchedulePosition(t,i)}}setScheduleToAssetAtTime(e,t){const n=this.schedule;if(!n)return;const i=t.parentIdentifier,r=n.getEvent(i);if(r){const t=n.findEventIndex(i),s=n.findAssetIndex(r,e);this.advanceAfterAssetEnded(r,t,s-1)}}setSchedulePosition(e,t){var n;const i=null==(n=this.schedule)?void 0:n.items;if(!i||this.playbackDisabled)return;const r=e>=0?i[e]:null;this.log("setSchedulePosition ".concat(e,", ").concat(t," (").concat(r?Ia(r):r,") pos: ").concat(this.timelinePos));const s=this.waitingItem||this.playingItem,a=this.playingLastItem;if(this.isInterstitial(s)){const n=s.event,u=this.playingAsset,h=null==u?void 0:u.identifier,d=h?this.getAssetPlayer(h):null;if(d&&h&&(!this.eventItemsMatch(s,r)||void 0!==t&&h!==n.assetList[t].identifier)){var o;const t=n.findAssetIndex(u);if(this.log("INTERSTITIAL_ASSET_ENDED ".concat(t+1,"/").concat(n.assetList.length," ").concat(Ra(u))),this.endedAsset=u,this.playingAsset=null,this.hls.trigger(l.INTERSTITIAL_ASSET_ENDED,{asset:u,assetListIndex:t,event:n,schedule:i.slice(0),scheduleIndex:e,player:d}),s!==this.playingItem)return void(this.itemsMatch(s,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(n,this.findItemIndex(this.playingItem),t));this.retreiveMediaSource(h,r),!d.media||null!=(o=this.detachedData)&&o.mediaSource||d.detachMedia()}if(!this.eventItemsMatch(s,r)&&(this.endedItem=s,this.playingItem=null,this.log("INTERSTITIAL_ENDED ".concat(n," ").concat(Ia(s))),n.hasPlayed=!0,this.hls.trigger(l.INTERSTITIAL_ENDED,{event:n,schedule:i.slice(0),scheduleIndex:e}),n.cue.once)){var c;this.updateSchedule();const e=null==(c=this.schedule)?void 0:c.items;if(r&&e){const n=this.findItemIndex(r);this.advanceSchedule(n,e,t,s,a)}return}}this.advanceSchedule(e,i,t,s,a)}advanceSchedule(e,t,n,i,r){const s=this.schedule;if(!s)return;const a=t[e]||null,o=this.primaryMedia,c=this.playerQueue;if(c.length&&c.forEach(t=>{const n=t.interstitial,i=s.findEventIndex(n.identifier);(i<e||i>e+1)&&this.clearInterstitial(n,a)}),this.isInterstitial(a)){this.timelinePos=Math.min(Math.max(this.timelinePos,a.start),a.end);const r=a.event;if(void 0===n){const t=Ma(r,(n=s.findAssetIndex(r,this.timelinePos))-1);if(r.isAssetPastPlayoutLimit(t)||r.appendInPlace&&this.timelinePos===a.end)return void this.advanceAfterAssetEnded(r,e,n);n=t}const c=this.waitingItem;this.assetsBuffered(a,o)||this.setBufferingItem(a);let u=this.preloadAssets(r,n);if(this.eventItemsMatch(a,c||i)||(this.waitingItem=a,this.log("INTERSTITIAL_STARTED ".concat(Ia(a)," ").concat(r.appendInPlace?"append in place":"")),this.hls.trigger(l.INTERSTITIAL_STARTED,{event:r,schedule:t.slice(0),scheduleIndex:e})),!r.assetListLoaded)return void this.log("Waiting for ASSET-LIST to complete loading ".concat(r));if(r.assetListLoader&&(r.assetListLoader.destroy(),r.assetListLoader=void 0),!o)return void this.log("Waiting for attachMedia to start Interstitial ".concat(r));this.waitingItem=this.endedItem=null,this.playingItem=a;const h=r.assetList[n];if(!h)return void this.advanceAfterAssetEnded(r,e,n||0);if(u||(u=this.getAssetPlayer(h.identifier)),null===u||u.destroyed){const e=r.assetList.length;this.warn("asset ".concat(n+1,"/").concat(e," player destroyed ").concat(r)),u=this.createAssetPlayer(r,h,n),u.loadSource()}if(!this.eventItemsMatch(a,this.bufferingItem)&&r.appendInPlace&&this.isAssetBuffered(h))return;this.startAssetPlayer(u,n,t,e,o),this.shouldPlay&&ka(u.media)}else a?(this.resumePrimary(a,e,i),this.shouldPlay&&ka(this.hls.media)):r&&this.isInterstitial(i)&&(this.endedItem=null,this.playingItem=i,i.event.appendInPlace||this.attachPrimary(s.durations.primary,null))}get playbackDisabled(){return!1===this.hls.config.enableInterstitialPlayback}get primaryDetails(){var e;return null==(e=this.mediaSelection)?void 0:e.main.details}get primaryLive(){var e;return!(null==(e=this.primaryDetails)||!e.live)}resumePrimary(e,t,n){var i,r;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log("resuming ".concat(Ia(e))),null==(i=this.detachedData)||!i.mediaSource){let n=this.timelinePos;(n<e.start||n>=e.end)&&(n=this.getPrimaryResumption(e,t),this.log(Da("resumePrimary",n)),this.timelinePos=n),this.attachPrimary(n,e)}if(!n)return;const s=null==(r=this.schedule)?void 0:r.items;s&&(this.log("INTERSTITIALS_PRIMARY_RESUMED ".concat(Ia(e))),this.hls.trigger(l.INTERSTITIALS_PRIMARY_RESUMED,{schedule:s.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const n=e.start;if(this.primaryLive){const e=this.primaryDetails;if(0===t)return this.hls.startPosition;if(e&&(n<e.fragmentStart||n>e.edge))return this.hls.liveSyncPosition||-1}return n}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);if(null!=t&&t.hls)return t.hls.bufferedToEnd;return Vt.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,n){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const i=this.primaryMedia;if(!i)return;const r=this.hls;r.media?this.checkBuffer():(this.transferMediaTo(r,i),n&&this.startLoadingPrimaryAt(e,n)),n||(this.log(Da("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,n))}startLoadingPrimaryAt(e,t){var n;const i=this.hls;!i.loadingEnabled||!i.media||Math.abs(((null==(n=i.mainForwardBufferInfo)?void 0:n.start)||i.media.currentTime)-e)>.5?i.startLoad(e,t):i.bufferingEnabled||i.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),null==(e=this.schedule)||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(l.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(l.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(-1===t.level||!this.schedule)return;const n=this.hls.levels[t.level];if(!n.details)return;const i=b(b({},this.mediaSelection||this.altSelection),{},{main:n});this.mediaSelection=i,this.schedule.parseInterstitialDateRanges(i,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const n=this.hls.audioTracks[t.id],i=this.mediaSelection;if(!i)return void(this.altSelection=b(b({},this.altSelection),{},{audio:n}));const r=b(b({},i),{},{audio:n});this.mediaSelection=r}onSubtitleTrackUpdated(e,t){const n=this.hls.subtitleTracks[t.id],i=this.mediaSelection;if(!i)return void(this.altSelection=b(b({},this.altSelection),{},{subtitles:n}));const r=b(b({},i),{},{subtitles:n});this.mediaSelection=r}onAudioTrackSwitching(e,t){const n=Je(t);this.playerQueue.forEach(e=>{let{hls:i}=e;return i&&(i.setAudioOption(t)||i.setAudioOption(n))})}onSubtitleTrackSwitch(e,t){const n=Je(t);this.playerQueue.forEach(e=>{let{hls:i}=e;return i&&(i.setSubtitleOption(t)||-1!==t.id&&i.setSubtitleOption(n))})}onBufferCodecs(e,t){const n=t.tracks;n&&(this.requiredTracks=n)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const n=this.playingItem;if(n&&!this.itemsMatch(n,this.bufferingItem)&&!this.isInterstitial(n)){const e=this.timelinePos;this.bufferedPos=e,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let e=0;e<t.length;e++){const i=t[e];if(i.cue.post){var n;const e=this.schedule.findEventIndex(i.identifier),t=null==(n=this.schedule.items)?void 0:n[e];this.isInterstitial(t)&&this.eventItemsMatch(t,this.bufferingItem)&&this.bufferedToItem(t,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const e=this.findItemIndex(t);this.setSchedulePosition(e+1)}else this.shouldPlay=!1}updateItem(e,t){var n;const i=null==(n=this.schedule)?void 0:n.items;if(e&&i){return i[this.findItemIndex(e,t)]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((t,n)=>{e.event.isAssetPastPlayoutLimit(n)&&this.clearAssetPlayer(t.identifier,null)});const n=e.end+.25,i=Vt.bufferInfo(this.primaryMedia,n,0);if(i.end>n||(i.nextStart||0)>n){this.log("trim buffered interstitial ".concat(Ia(e)," (was ").concat(Ia(t),")"));const i=!0;this.attachPrimary(n,null,i),this.flushFrontBuffer(n)}}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var n;return!!t&&(e===t||e.event.identifier===(null==(n=t.event)?void 0:n.identifier))}findItemIndex(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1}updateSchedule(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];var t;const n=this.mediaSelection;n&&(null==(t=this.schedule)||t.updateSchedule(n,[],e))}checkBuffer(e){var t;const n=null==(t=this.schedule)?void 0:t.items;if(!n)return;const i=Vt.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=i.len<1),this.updateBufferedPos(i.end,n,e)}updateBufferedPos(e,t,n){const i=this.schedule,r=this.bufferingItem;if(this.bufferedPos>e||!i)return;if(1===t.length&&this.itemsMatch(t[0],r))return void(this.bufferedPos=e);const s=this.playingItem,a=this.findItemIndex(s);let o=i.findItemIndexAtTime(e);if(this.bufferedPos<e){var l;const n=this.findItemIndex(r),i=Math.min(n+1,t.length-1),s=t[i];if((-1===o&&r&&e>=r.end||null!=(l=s.event)&&l.appendInPlace&&e+.01>=s.start)&&(o=i),this.isInterstitial(r)){const e=r.event;if(i-a>1&&!1===e.appendInPlace)return;if(0===e.assetList.length&&e.assetListLoader)return}if(this.bufferedPos=e,o>n&&o>a)this.bufferedToItem(s);else{const t=this.primaryDetails;this.primaryLive&&t&&e>t.edge-t.targetduration&&s.start<t.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(s)&&this.preloadAssets(s.event,0)}}else n&&s&&!this.itemsMatch(s,r)&&(o===a?this.bufferedToItem(s):o===a+1&&this.bufferedToItem(t[o]))}assetsBuffered(e,t){return 0!==e.event.assetList.length&&!e.event.assetList.some(e=>{const n=this.getAssetPlayer(e.identifier);return!(null!=n&&n.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,n=this.schedule;if(!this.itemsMatch(e,t)&&n){const{items:i,events:r}=n;if(!i||!r)return t;const s=this.isInterstitial(e),a=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const o=a?a.remaining:t?t.end-this.timelinePos:0;if(this.log("INTERSTITIALS_BUFFERED_TO_BOUNDARY ".concat(Ia(e))+(t?" (".concat(o.toFixed(2)," remaining)"):"")),!this.playbackDisabled)if(s){const t=n.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((e,n)=>{const i=this.getAssetPlayer(e.identifier);i&&(n===t&&i.loadSource(),i.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(e=>e.pauseBuffering());this.hls.trigger(l.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:r.slice(0),schedule:i.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return t}bufferedToItem(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.setBufferingItem(e);if(!this.playbackDisabled)if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(null!==n){this.bufferingAsset=null;const t=this.detachedData;if(t)if(t.mediaSource){const t=!0;this.attachPrimary(e.start,e,t)}else this.preloadPrimary(e);else this.preloadPrimary(e)}}preloadPrimary(e){const t=this.findItemIndex(e),n=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(n)}bufferedToEvent(e,t){const n=e.event,i=0===n.assetList.length&&!n.assetListLoader,r=n.cue.once;if(i||!r){const e=this.preloadAssets(n,t);if(null!=e&&e.interstitial.appendInPlace){const t=this.primaryMedia;t&&this.bufferAssetPlayer(e,t)}}}preloadAssets(e,t){const n=e.assetUrl,i=e.assetList.length,r=0===i&&!e.assetListLoader,s=e.cue.once;if(r){const r=e.timelineStart;if(e.appendInPlace){var a;const t=this.playingItem;this.isInterstitial(t)||(null==t||null==(a=t.nextEvent)?void 0:a.identifier)!==e.identifier||this.flushFrontBuffer(r+.25)}let s,o=0;if(!this.playingItem&&this.primaryLive&&(o=this.hls.startPosition,-1===o&&(o=this.hls.liveSyncPosition||0)),o&&!e.cue.pre&&!e.cue.post){const e=o-r;e>0&&(s=Math.round(1e3*e)/1e3)}if(this.log("Load interstitial asset ".concat(t+1,"/").concat(n?1:i," ").concat(e).concat(s?" live-start: ".concat(o," start-offset: ").concat(s):"")),n)return this.createAsset(e,0,0,r,e.duration,n);const l=this.assetListLoader.loadAssetList(e,s);l&&(e.assetListLoader=l)}else if(!s&&i){for(let r=t;r<i;r++){const t=e.assetList[r],n=this.getAssetPlayerQueueIndex(t.identifier);-1!==n&&!this.playerQueue[n].destroyed||t.error||this.createAssetPlayer(e,t,r)}const n=e.assetList[t];if(n){const e=this.getAssetPlayer(n.identifier);return e&&e.loadSource(),e}}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log("Removing front buffer starting at ".concat(e));Object.keys(t).forEach(t=>{this.hls.trigger(l.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:t})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let n=0;n<t.length;n++)if(e===t[n].assetId)return n;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t)for(let n=0;n<e.length;n++)if(e[n].media===t)return e[n];return null}createAsset(e,t,n,i,r,s){const a={parentIdentifier:e.identifier,identifier:Ea(e,s,t),duration:r,startOffset:n,timelineStart:i,uri:s};return this.createAssetPlayer(e,a,t)}createAssetPlayer(e,t,n){const i=this.hls,r=i.userConfig;let s=r.videoPreference;const c=i.loadLevelObj||i.levels[i.currentLevel];(s||c)&&(s=v({},s),c.videoCodec&&(s.videoCodec=c.videoCodec),c.videoRange&&(s.allowedVideoRanges=[c.videoRange]));const u=i.audioTracks[i.audioTrack],h=i.subtitleTracks[i.subtitleTrack];let d=0;if(this.primaryLive||e.appendInPlace){const e=this.timelinePos-t.timelineStart;if(e>1){const n=t.duration;n&&e<n&&(d=e)}}const f=t.identifier,p=b(b({},r),{},{maxMaxBufferLength:Math.min(180,i.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:i.sessionId,assetPlayerId:f,abrEwmaDefaultEstimate:i.bandwidthEstimate,interstitialsController:void 0,startPosition:d,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:s,audioPreference:u||r.audioPreference,subtitlePreference:h||r.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(p.timelineOffset=t.timelineStart));const m=p.cmcd;null!=m&&m.sessionId&&m.contentId&&(p.cmcd=v({},m,{contentId:xa(t.uri)})),this.getAssetPlayer(f)&&this.warn("Duplicate date range identifier ".concat(e," and asset ").concat(f));const g=new Ca(this.HlsPlayerClass,p,e,t);this.playerQueue.push(g),e.assetList[n]=t;let y=!0;const x=i=>{if(i.live){var r;const t=new Error("Interstitials MUST be VOD assets ".concat(e)),i={fatal:!0,type:a.OTHER_ERROR,details:o.INTERSTITIAL_ASSET_ITEM_ERROR,error:t},s=(null==(r=this.schedule)?void 0:r.findEventIndex(e.identifier))||-1;return void this.handleAssetItemError(i,e,s,n,t.message)}const s=i.edge-i.fragmentStart,l=t.duration;(y||null===l||s>l)&&(y=!1,this.log('Interstitial asset "'.concat(f,'" duration change ').concat(l," > ").concat(s)),t.duration=s,this.updateSchedule())};g.on(l.LEVEL_UPDATED,(e,t)=>{let{details:n}=t;return x(n)}),g.on(l.LEVEL_PTS_UPDATED,(e,t)=>{let{details:n}=t;return x(n)}),g.on(l.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const _=(e,t)=>{const n=this.getAssetPlayer(f);if(n&&t.tracks){n.off(l.BUFFER_CODECS,_),n.tracks=t.tracks;const e=this.primaryMedia;this.bufferingAsset===n.assetItem&&e&&!n.media&&this.bufferAssetPlayer(n,e)}};g.on(l.BUFFER_CODECS,_);g.on(l.BUFFERED_TO_END,()=>{var n;const i=this.getAssetPlayer(f);if(this.log("buffered to end of asset ".concat(i)),!i||!this.schedule)return;const r=this.schedule.findEventIndex(e.identifier),s=null==(n=this.schedule.items)?void 0:n[r];this.isInterstitial(s)&&this.advanceAssetBuffering(s,t)});const S=t=>()=>{if(!this.getAssetPlayer(f)||!this.schedule)return;this.shouldPlay=!0;const n=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,n,t)};return g.once(l.MEDIA_ENDED,S(n)),g.once(l.PLAYOUT_LIMIT_REACHED,S(1/0)),g.on(l.ERROR,(t,i)=>{if(!this.schedule)return;const r=this.getAssetPlayer(f);if(i.details===o.BUFFER_STALLED_ERROR)return null!=r&&r.appendInPlace?void this.handleInPlaceStall(e):(this.onTimeupdate(),void this.checkBuffer(!0));this.handleAssetItemError(i,e,this.schedule.findEventIndex(e.identifier),n,"Asset player error ".concat(i.error," ").concat(e))}),g.on(l.DESTROYING,()=>{if(!this.getAssetPlayer(f)||!this.schedule)return;const t=new Error("Asset player destroyed unexpectedly ".concat(f)),i={fatal:!0,type:a.OTHER_ERROR,details:o.INTERSTITIAL_ASSET_ITEM_ERROR,error:t};this.handleAssetItemError(i,e,this.schedule.findEventIndex(e.identifier),n,t.message)}),this.log("INTERSTITIAL_ASSET_PLAYER_CREATED ".concat(Ra(t))),this.hls.trigger(l.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:n,event:e,player:g}),g}clearInterstitial(e,t){this.clearAssetPlayers(e,t),e.reset()}clearAssetPlayers(e,t){e.assetList.forEach(e=>{this.clearAssetPlayer(e.identifier,t)})}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(-1!==t){this.log('reset asset player "'.concat(e,'" after error'));const n=this.playerQueue[t];this.transferMediaFromPlayer(n,null),n.resetDetails()}}clearAssetPlayer(e,t){const n=this.getAssetPlayerQueueIndex(e);if(-1!==n){const e=this.playerQueue[n];this.log("clear ".concat(e," toSegment: ").concat(t?Ia(t):t)),this.transferMediaFromPlayer(e,t),this.playerQueue.splice(n,1),e.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,n,i,r){const{interstitial:s,assetItem:a,assetId:o}=e,c=s.assetList.length,u=this.playingAsset;this.endedAsset=null,this.playingAsset=a,u&&u.identifier===o||(u&&(this.clearAssetPlayer(u.identifier,n[i]),delete u.error),this.log("INTERSTITIAL_ASSET_STARTED ".concat(t+1,"/").concat(c," ").concat(Ra(a))),this.hls.trigger(l.INTERSTITIAL_ASSET_STARTED,{asset:a,assetListIndex:t,event:s,schedule:n.slice(0),scheduleIndex:i,player:e})),this.bufferAssetPlayer(e,r)}bufferAssetPlayer(e,t){var n,i;if(!this.schedule)return;const{interstitial:r,assetItem:s}=e,l=this.schedule.findEventIndex(r.identifier),c=null==(n=this.schedule.items)?void 0:n[l];if(!c)return;e.loadSource(),this.setBufferingItem(c),this.bufferingAsset=s;const u=this.getBufferingPlayer();if(u===e)return;const h=r.appendInPlace;if(h&&!1===(null==u?void 0:u.interstitial.appendInPlace))return;const d=(null==u?void 0:u.tracks)||(null==(i=this.detachedData)?void 0:i.tracks)||this.requiredTracks;if(h&&s!==this.playingAsset){if(!e.tracks)return void this.log("Waiting for track info before buffering ".concat(e));if(d&&!R(d,e.tracks)){const t=new Error("Asset ".concat(Ra(s)," SourceBuffer tracks ('").concat(Object.keys(e.tracks),"') are not compatible with primary content tracks ('").concat(Object.keys(d),"')")),n={fatal:!0,type:a.OTHER_ERROR,details:o.INTERSTITIAL_ASSET_ITEM_ERROR,error:t},i=r.findAssetIndex(s);return void this.handleAssetItemError(n,r,l,i,t.message)}}this.transferMediaTo(e,t)}handleInPlaceStall(e){const t=this.schedule,n=this.primaryMedia;if(!t||!n)return;const i=n.currentTime,r=t.findAssetIndex(e,i),s=e.assetList[r];if(s){const a=this.getAssetPlayer(s.identifier);if(a){const o=a.currentTime||i-s.timelineStart,l=a.duration-o;if(this.warn("Stalled at ".concat(o," of ").concat(o+l," in ").concat(a," ").concat(e," (media.currentTime: ").concat(i,")")),o&&(l/n.playbackRate<.5||a.bufferedInPlaceToEnd(n))&&a.hls){const n=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,n,r)}}}}advanceInPlace(e){const t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)}handleAssetItemError(e,t,n,i,r){if(e.details===o.BUFFER_STALLED_ERROR)return;const s=t.assetList[i]||null;if(this.warn("INTERSTITIAL_ASSET_ERROR ".concat(s?Ra(s):s," ").concat(e.error)),!this.schedule)return;const a=(null==s?void 0:s.identifier)||"",c=this.getAssetPlayerQueueIndex(a),u=this.playerQueue[c]||null,h=this.schedule.items,d=v({},e,{fatal:!1,errorAction:xt(!0),asset:s,assetListIndex:i,event:t,schedule:h,scheduleIndex:n,player:u});if(this.hls.trigger(l.INTERSTITIAL_ASSET_ERROR,d),!e.fatal)return;const f=this.playingAsset,p=this.bufferingAsset,m=new Error(r);if(s&&(this.clearAssetPlayer(a,null),s.error=m),t.assetList.some(e=>!e.error))for(let o=i;o<t.assetList.length;o++)this.resetAssetPlayer(t.assetList[o].identifier);else t.error=m;this.updateSchedule(!0),t.error?this.primaryFallback(t):f&&f.identifier===a?this.advanceAfterAssetEnded(t,n,i):p&&p.identifier===a&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,p)}primaryFallback(e){const t=e.timelineStart,n=this.effectivePlayingItem;let i=this.timelinePos;if(n){this.log('Fallback to primary from event "'.concat(e.identifier,'" start: ').concat(t," pos: ").concat(i," playing: ").concat(Ia(n)," error: ").concat(e.error)),-1===i&&(i=this.hls.startPosition);const r=this.updateItem(n,i);this.itemsMatch(n,r)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t))}else if(-1===i)return void this.checkStart();if(!this.schedule)return;const r=this.schedule.findItemIndexAtTime(i);this.setSchedulePosition(r)}onAssetListLoaded(e,t){var n,i;const r=t.event,s=r.identifier,a=t.assetListResponse.ASSETS;if(null==(n=this.schedule)||!n.hasEvent(s))return;const o=r.timelineStart,l=r.duration;let c=0;a.forEach((e,t)=>{const n=parseFloat(e.DURATION);this.createAsset(r,t,c,o+c,n,e.URI),c+=n}),r.duration=c,this.log("Loaded asset-list with duration: ".concat(c," (was: ").concat(l,") ").concat(r));const u=this.waitingItem,h=(null==u?void 0:u.event.identifier)===s;this.updateSchedule();const d=null==(i=this.bufferingItem)?void 0:i.event;if(h){var f;const e=this.schedule.findEventIndex(s),t=null==(f=this.schedule.items)?void 0:f[e];if(t){if(!this.playingItem&&this.timelinePos>t.end){if(this.schedule.findItemIndexAtTime(this.timelinePos)!==e)return r.error=new Error("Interstitial ".concat(a.length?"no longer within playback range":"asset-list is empty"," ").concat(this.timelinePos," ").concat(r)),this.log(r.error.message),this.updateSchedule(!0),void this.primaryFallback(r)}this.setBufferingItem(t)}this.setSchedulePosition(e)}else if((null==d?void 0:d.identifier)===s){const e=r.assetList[0];if(e){const t=this.getAssetPlayer(e.identifier);if(d.appendInPlace){const e=this.primaryMedia;t&&e&&this.bufferAssetPlayer(t,e)}else t&&t.loadSource()}}}onError(e,t){if(this.schedule)switch(t.details){case o.ASSET_LIST_PARSING_ERROR:case o.ASSET_LIST_LOAD_ERROR:case o.ASSET_LIST_LOAD_TIMEOUT:{const e=t.interstitial;e&&(this.updateSchedule(!0),this.primaryFallback(e));break}case o.BUFFER_STALLED_ERROR:{const e=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(e)&&e.event.appendInPlace)return void this.handleInPlaceStall(e.event);this.log("Primary player stall @".concat(this.timelinePos," bufferedPos: ").concat(this.bufferedPos)),this.onTimeupdate(),this.checkBuffer(!0);break}}}}});function Vo(e){return e&&"object"===typeof e?Array.isArray(e)?e.map(Vo):Object.keys(e).reduce((t,n)=>(t[n]=Vo(e[n]),t),{}):e}class Ho extends zt{constructor(e,t){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var e;null!=(e=this.media)&&e.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{var e;this.hls&&(this.ended=(null==(e=this.media)?void 0:e.currentTime)||1,this.hls.trigger(l.MEDIA_ENDED,{stalled:!1}))},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(l.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(l.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(l.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(l.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(l.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(l.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(100),this.mediaSource=t.mediaSource;const n=this.media=t.media;ri(n,"playing",this.onMediaPlaying),ri(n,"waiting",this.onMediaWaiting),ri(n,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:n}=this;n&&(si(n,"playing",this.onMediaPlaying),si(n,"waiting",this.onMediaWaiting),si(n,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(null==(e=this.media)||!e.readyState||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var n,i;const r=null==(n=this.hls)?void 0:n.config;if(!r)return;const s=this.media;if(!s)return;const{seeking:a}=s,o=this.seeking&&!a,c=!this.seeking&&a,u=s.paused&&!a||s.ended||0===s.playbackRate;if(this.seeking=a,e!==t)return t&&(this.ended=0),this.moved=!0,a||(this.nudgeRetry=0,r.nudgeOnVideoHole&&!u&&e>t&&this.nudgeOnVideoHole(e,t)),void(0===this.waiting&&this.stallResolved(e));if(c||o)return void(o&&this.stallResolved(e));if(u)return this.nudgeRetry=0,this.stallResolved(e),void(!this.ended&&s.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(l.MEDIA_ENDED,{stalled:!1})));if(!Vt.getBuffered(s).length)return void(this.nudgeRetry=0);const h=Vt.bufferInfo(s,e,0),d=h.nextStart||0,f=this.fragmentTracker;if(a&&f&&this.hls){const t=Wo(this.hls.inFlightFragments,e),n=h.len>2,i=!d||t||d-e>2&&!f.getPartialFragment(e);if(n||i)return;this.moved=!1}const p=null==(i=this.hls)?void 0:i.latestLevelDetails;if(!this.moved&&null!==this.stalled&&f){if(!(h.len>0)&&!d)return;const t=Math.max(d,h.start||0)-e,n=!(null==p||!p.live)?2*p.targetduration:2,i=Xo(e,f);if(t>0&&(t<=n||i))return void(s.paused||this._trySkipBufferHole(i))}const m=r.detectStallWithCurrentTimeMs,g=self.performance.now(),v=this.waiting;let y=this.stalled;if(null===y){if(!(v>0&&g-v<m))return void(this.stalled=g);y=this.stalled=v}const b=g-y;if(!a&&(b>=m||v)&&this.hls){var x;if("ended"===(null==(x=this.mediaSource)?void 0:x.readyState)&&(null==p||!p.live)&&Math.abs(e-((null==p?void 0:p.edge)||0))<1){if(this.ended)return;return this.ended=e||1,void this.hls.trigger(l.MEDIA_ENDED,{stalled:!0})}if(this._reportStall(h),!this.media||!this.hls)return}const _=Vt.bufferInfo(s,e,r.maxBufferHole);this._tryFixBufferStall(_,b,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const n=self.performance.now()-t;this.log("playback not stuck anymore @".concat(e,", after ").concat(Math.round(n),"ms")),this.stallReported=!1,this.waiting=0,this.hls.trigger(l.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var n;const i=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&null!=(n=this.buffered.audio)&&n.length&&i&&i.length>1&&e>i.end(0)){const n=Vt.bufferedInfo(Vt.timeRangesToArray(this.buffered.audio),e,0);if(n.len>1&&t>=n.start){const n=Vt.timeRangesToArray(i),r=Vt.bufferedInfo(n,t,0).bufferedIndex;if(r>-1&&r<n.length-1){const t=Vt.bufferedInfo(n,e,0).bufferedIndex,i=n[r].end,s=n[r+1].start;if((-1===t||t>r)&&s-i<1&&e-i<2){const n=new Error("nudging playhead to flush pipeline after video hole. currentTime: ".concat(e," hole: ").concat(i," -> ").concat(s," buffered index: ").concat(t));this.warn(n.message),this.media.currentTime+=1e-6;let r=Xo(e,this.fragmentTracker);r&&"fragment"in r?r=r.fragment:r||(r=void 0);const c=Vt.bufferInfo(this.media,e,0);this.hls.trigger(l.ERROR,{type:a.MEDIA_ERROR,details:o.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:n,reason:n.message,frag:r,buffer:c.len,bufferInfo:c})}}}}}_tryFixBufferStall(e,t,n){var i,r;const{fragmentTracker:s,media:a}=this,o=null==(i=this.hls)?void 0:i.config;if(!a||!s||!o)return;const l=null==(r=this.hls)?void 0:r.latestLevelDetails,c=Xo(n,s);if(c||null!=l&&l.live&&n<l.fragmentStart){if(this._trySkipBufferHole(c)||!this.media)return}const u=e.buffered,h=this.adjacentTraversal(e,n);(u&&u.length>1&&e.len>o.maxBufferHole||e.nextStart&&(e.nextStart-n<o.maxBufferHole||h))&&(t>1e3*o.highBufferWatchdogPeriod||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const n=this.fragmentTracker,i=e.nextStart;if(n&&i){const e=n.getFragAtPos(t,f.MAIN),r=n.getFragAtPos(i,f.MAIN);if(e&&r)return r.sn-e.sn<2}return!1}_reportStall(e){const{hls:t,media:n,stallReported:i,stalled:r}=this;if(!i&&null!==r&&n&&t){this.stallReported=!0;const i=new Error("Playback stalling at @".concat(n.currentTime," due to low buffer (").concat(qe(e),")"));this.warn(i.message),t.trigger(l.ERROR,{type:a.MEDIA_ERROR,details:o.BUFFER_STALLED_ERROR,fatal:!1,error:i,buffer:e.len,bufferInfo:e,stalled:{start:r}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:n,media:i}=this,r=null==(t=this.hls)?void 0:t.config;if(!i||!n||!r)return 0;const s=i.currentTime,c=Vt.bufferInfo(i,s,0),u=s<c.start?c.start:c.nextStart;if(u&&this.hls){const t=c.len<=r.maxBufferHole,d=c.len>0&&c.len<1&&i.readyState<3,p=u-s;if(p>0&&(t||d)){if(p>r.maxBufferHole){let t=!1;if(0===s){const e=n.getAppendedFrag(0,f.MAIN);e&&u<e.end&&(t=!0)}if(!t&&e){var h;if(null==(h=this.hls.loadLevelObj)||!h.details)return 0;if(Wo(this.hls.inFlightFragments,u))return 0;let t=!1,i=e.end;for(;i<u;){const e=Xo(i,n);if(!e){t=!0;break}i+=e.duration}if(t)return 0}}const t=Math.max(u+.05,s+.1);if(this.warn("skipping hole, adjusting currentTime from ".concat(s," to ").concat(t)),this.moved=!0,i.currentTime=t,null==e||!e.gap){const n=new Error("fragment loaded with buffer holes, seeking from ".concat(s," to ").concat(t)),i={type:a.MEDIA_ERROR,details:o.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:n,reason:n.message,buffer:c.len,bufferInfo:c};e&&("fragment"in e?i.part=e:i.frag=e),this.hls.trigger(l.ERROR,i)}return t}}return 0}_tryNudgeBuffer(e){const{hls:t,media:n,nudgeRetry:i}=this,r=null==t?void 0:t.config;if(!n||!r)return 0;const s=n.currentTime;if(this.nudgeRetry++,i<r.nudgeMaxRetry){const c=s+(i+1)*r.nudgeOffset,u=new Error("Nudging 'currentTime' from ".concat(s," to ").concat(c));this.warn(u.message),n.currentTime=c,t.trigger(l.ERROR,{type:a.MEDIA_ERROR,details:o.BUFFER_NUDGE_ON_STALL,error:u,fatal:!1,buffer:e.len,bufferInfo:e})}else{const n=new Error("Playhead still not moving while enough data buffered @".concat(s," after ").concat(r.nudgeMaxRetry," nudges"));this.error(n.message),t.trigger(l.ERROR,{type:a.MEDIA_ERROR,details:o.BUFFER_STALLED_ERROR,error:n,fatal:!0,buffer:e.len,bufferInfo:e})}}}function Wo(e,t){const n=Yo(e.main);if(n&&n.start<=t)return n;const i=Yo(e.audio);return i&&i.start<=t?i:null}function Yo(e){if(!e)return null;switch(e.state){case li:case oi:case mi:case gi:return null}return e.frag}function Xo(e,t){return t.getAppendedFrag(e,f.MAIN)||t.getPartialFragment(e)}function qo(){if("undefined"!==typeof self)return self.VTTCue||self.TextTrackCue}function Ko(e,t,n,i,r){let s=new e(t,n,"");try{s.value=i,r&&(s.type=r)}catch(a){s=new e(t,n,qe(r?b({type:r},i):i))}return s}const Zo=(()=>{const e=qo();try{e&&new e(0,Number.POSITIVE_INFINITY,"")}catch(t){return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class Jo{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(l.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e&&(e.on(l.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(l.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(l.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(l.MANIFEST_LOADING,this.onManifestLoading,this),e.on(l.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(l.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(l.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(l.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(l.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(l.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(l.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(l.MANIFEST_LOADING,this.onManifestLoading,this),e.off(l.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(l.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(l.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(l.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,t){var n;this.media=t.media,!1===(null==(n=t.overrides)?void 0:n.cueRemoval)&&(this.removeCues=!1)}onMediaAttached(){var e;const t=null==(e=this.hls)?void 0:e.latestLevelDetails;t&&this.updateDateRangeCues(t)}onMediaDetaching(e,t){this.media=null;!!t.transferMedia||(this.id3Track&&(this.removeCues&&ga(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const n=e[t];if("metadata"===n.kind&&"id3"===n.label)return pa(n,this.media),n}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:n,enableID3MetadataCues:i}=this.hls.config;if(!n&&!i)return;const{samples:r}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const s=qo();if(s)for(let a=0;a<r.length;a++){const e=r[a].type;if(e===Ki.emsg&&!n||!i)continue;const t=Wi(r[a].data),o=r[a].pts;let l=o+r[a].duration;l>Zo&&(l=Zo);l-o<=0&&(l=o+.25);for(let n=0;n<t.length;n++){const i=t[n];if(!Yi(i)){this.updateId3CueEnds(o,e);const t=Ko(s,o,l,i,e);t&&this.id3Track.addCue(t)}}}}updateId3CueEnds(e,t){var n;const i=null==(n=this.id3Track)?void 0:n.cues;if(i)for(let r=i.length;r--;){const n=i[r];n.type===t&&n.startTime<e&&n.endTime===Zo&&(n.endTime=e)}}onBufferFlushing(e,t){let{startOffset:n,endOffset:i,type:r}=t;const{id3Track:s,hls:a}=this;if(!a)return;const{config:{enableEmsgMetadataCues:o,enableID3MetadataCues:l}}=a;if(s&&(o||l)){let e;e="audio"===r?e=>e.type===Ki.audioId3&&l:"video"===r?e=>e.type===Ki.emsg&&o:e=>e.type===Ki.audioId3&&l||e.type===Ki.emsg&&o,va(s,n,i,e)}}onLevelUpdated(e,t){let{details:n}=t;this.updateDateRangeCues(n,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.hls||!this.media)return;const{assetPlayerId:n,timelineOffset:r,enableDateRangeMetadataCues:s,interstitialsController:a}=this.hls.config;if(!s)return;const o=qo();if(n&&r&&!a){const{fragmentStart:t,fragmentEnd:i}=e;let r=this.assetCue;r?(r.startTime=t,r.endTime=i):o&&(r=this.assetCue=Ko(o,t,i,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),r&&(r.id=n,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(r),r.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;const{id3Track:l}=this,{dateRanges:c}=e,u=Object.keys(c);let h=this.dateRangeCuesAppended;var d;if(l&&t)if(null!=(d=l.cues)&&d.length){const e=Object.keys(h).filter(e=>!u.includes(e));for(let t=e.length;t--;){var f;const n=e[t],i=null==(f=h[n])?void 0:f.cues;delete h[n],i&&Object.keys(i).forEach(e=>{const t=i[e];if(t){t.removeEventListener("enter",this.onEventCueEnter);try{l.removeCue(t)}catch(n){}}})}}else h=this.dateRangeCuesAppended={};const p=e.fragments[e.fragments.length-1];if(0!==u.length&&i(null==p?void 0:p.programDateTime)){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let e=0;e<u.length;e++){const t=u[e],n=c[t],i=n.startTime,r=h[t],s=(null==r?void 0:r.cues)||{};let l=(null==r?void 0:r.durationKnown)||!1,d=Zo;const{duration:f,endDate:p}=n;if(p&&null!==f)d=i+f,l=!0;else if(n.endOnNext&&!l){const e=u.reduce((e,t)=>{if(t!==n.id){const i=c[t];if(i.class===n.class&&i.startDate>n.startDate&&(!e||n.startDate<e.startDate))return i}return e},null);e&&(d=e.startTime,l=!0)}const m=Object.keys(n.attr);for(let e=0;e<m.length;e++){const c=m[e];if(!Qt(c))continue;const u=s[c];if(u)!l||null!=r&&r.durationKnown?Math.abs(u.startTime-i)>.01&&(u.startTime=i,u.endTime=d):u.endTime=d;else if(o){let e=n.attr[c];$t(c)&&(e=I(e));const r=Ko(o,i,d,{key:c,data:e},Ki.dateRange);r&&(r.id=t,this.id3Track.addCue(r),s[c]=r,a&&("X-ASSET-LIST"!==c&&"X-ASSET-URL"!==c||r.addEventListener("enter",this.onEventCueEnter)))}}h[t]={cues:s,dateRange:n,durationKnown:l}}}}}class Qo{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:e}=this,t=this.levelDetails;if(!e||!t)return;this.currentTime=e.currentTime;const n=this.computeLatency();if(null===n)return;this._latency=n;const{lowLatencyMode:i,maxLiveSyncPlaybackRate:r}=this.config;if(!i||1===r||!t.live)return;const s=this.targetLatency;if(null===s)return;const a=n-s;if(a<Math.min(this.maxLatency,s+t.targetduration)&&a>.05&&this.forwardBufferLength>1){const t=Math.min(2,Math.max(1,r)),n=Math.round(2/(1+Math.exp(-.75*a-this.edgeStalled))*20)/20,i=Math.min(t,Math.max(1,n));this.changeMediaPlaybackRate(e,i)}else 1!==e.playbackRate&&0!==e.playbackRate&&this.changeMediaPlaybackRate(e,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return(null==(e=this.hls)?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(void 0!==e.liveMaxLatencyDuration)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(null===e||null===this.hls)return null;const{holdBack:t,partHoldBack:n,targetduration:i}=e,{liveSyncDuration:r,liveSyncDurationCount:s,lowLatencyMode:a}=this.config,o=this.hls.userConfig;let l=a&&n||t;(this._targetLatencyUpdated||o.liveSyncDuration||o.liveSyncDurationCount||0===l)&&(l=void 0!==r?r:s*i);const c=i;return l+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,c)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(null===e||null===t)return null;const n=this.levelDetails;if(null===n)return null;const i=n.edge,r=e-t-this.edgeStalled,s=i-n.totalduration,a=i-(this.config.lowLatencyMode&&n.partTarget||n.targetduration);return Math.min(Math.max(s,r),a)}get drift(){const e=this.levelDetails;return null===e?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(null===e)return 0;const t=3*(this.config.lowLatencyMode&&e.partTarget||e.targetduration);return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const n=e.buffered.length;return(n?e.buffered.end(n-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(l.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(l.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(l.MANIFEST_LOADING,this.onManifestLoading,this),e.on(l.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(l.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(l.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(l.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(l.MANIFEST_LOADING,this.onManifestLoading,this),e.off(l.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(l.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,t){let{details:n}=t;n.advanced&&this.onTimeupdate(),!n.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var n;t.details===o.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&null!=(n=this.levelDetails)&&n.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var n,i;e.playbackRate!==t&&(null==(n=this.hls)||n.logger.debug("[latency-controller]: latency=".concat(this.latency.toFixed(3),", targetLatency=").concat(null==(i=this.targetLatency)?void 0:i.toFixed(3),", forwardBufferLength=").concat(this.forwardBufferLength.toFixed(3),": adjusting playback rate from ").concat(e.playbackRate," to ").concat(t)),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return null===e?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return null===e?null:e-this.currentTime}}class $o extends Qr{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(l.MANIFEST_LOADING,this.onManifestLoading,this),e.on(l.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(l.LEVEL_LOADED,this.onLevelLoaded,this),e.on(l.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(l.FRAG_BUFFERED,this.onFragBuffered,this),e.on(l.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(l.MANIFEST_LOADING,this.onManifestLoading,this),e.off(l.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(l.LEVEL_LOADED,this.onLevelLoaded,this),e.off(l.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(l.FRAG_BUFFERED,this.onFragBuffered,this),e.off(l.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(e=>{e.loadError=0,e.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const n=this.hls.config.preferManagedMediaSource,i=[],r={},s={};let a=!1,o=!1,l=!1;t.levels.forEach(e=>{const t=e.attrs;let{audioCodec:c,videoCodec:u}=e;c&&(e.audioCodec=c=Me(c,n)||void 0),u&&(u=e.videoCodec=function(e){const t=e.split(",");for(let n=0;n<t.length;n++){const e=t[n].split(".");e.length>2&&"avc1"===e[0]&&(t[n]="avc1.".concat(parseInt(e[1]).toString(16)).concat(("000"+parseInt(e[2]).toString(16)).slice(-4)))}return t.join(",")}(u));const{width:h,height:d,unknownCodecs:f}=e,p=(null==f?void 0:f.length)||0;if(a||(a=!(!h||!d)),o||(o=!!u),l||(l=!!c),p||c&&!this.isAudioSupported(c)||u&&!this.isVideoSupported(u))return void this.log('Some or all CODECS not supported "'.concat(t.CODECS,'"'));const{CODECS:m,"FRAME-RATE":g,"HDCP-LEVEL":v,"PATHWAY-ID":y,RESOLUTION:b,"VIDEO-RANGE":x}=t,_="".concat(y||".","-"),S="".concat(_).concat(e.bitrate,"-").concat(b,"-").concat(g,"-").concat(m,"-").concat(x,"-").concat(v);if(r[S])if(r[S].uri===e.url||e.attrs["PATHWAY-ID"])r[S].addGroupId("audio",t.AUDIO),r[S].addGroupId("text",t.SUBTITLES);else{const t=s[S]+=1;e.attrs["PATHWAY-ID"]=new Array(t+1).join(".");const n=this.createLevel(e);r[S]=n,i.push(n)}else{const t=this.createLevel(e);r[S]=t,s[S]=1,i.push(t)}}),this.filterAndSortMediaOptions(i,t,a,o,l)}createLevel(e){const t=new We(e),n=e.supplemental;if(null!=n&&n.videoCodec&&!this.isVideoSupported(n.videoCodec)){const e=new Error('SUPPLEMENTAL-CODECS not supported "'.concat(n.videoCodec,'"'));this.log(e.message),t.supportedResult=Ne(e,[])}return t}isAudioSupported(e){return xe(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return xe(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,n,i,r){var s;let c=[],u=[],h=e;const d=(null==(s=t.stats)?void 0:s.parsing)||{};if((n||i)&&r&&(h=h.filter(e=>{let{videoCodec:t,videoRange:n,width:i,height:r}=e;return(!!t||!(!i||!r))&&(!!(s=n)&&je.indexOf(s)>-1);var s})),0===h.length)return Promise.resolve().then(()=>{if(this.hls){let e="no level with compatible codecs found in manifest",n=e;t.levels.length&&(n="one or more CODECS in variant not supported: ".concat(qe(t.levels.map(e=>e.attrs.CODECS).filter((e,t,n)=>n.indexOf(e)===t))),this.warn(n),e+=" (".concat(n,")"));const i=new Error(e);this.hls.trigger(l.ERROR,{type:a.MEDIA_ERROR,details:o.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:i,reason:n})}}),void(d.end=performance.now());t.audioTracks&&(c=t.audioTracks.filter(e=>!e.audioCodec||this.isAudioSupported(e.audioCodec)),el(c)),t.subtitles&&(u=t.subtitles,el(u));const f=h.slice(0);h.sort((e,t)=>{if(e.attrs["HDCP-LEVEL"]!==t.attrs["HDCP-LEVEL"])return(e.attrs["HDCP-LEVEL"]||"")>(t.attrs["HDCP-LEVEL"]||"")?1:-1;if(n&&e.height!==t.height)return e.height-t.height;if(e.frameRate!==t.frameRate)return e.frameRate-t.frameRate;if(e.videoRange!==t.videoRange)return je.indexOf(e.videoRange)-je.indexOf(t.videoRange);if(e.videoCodec!==t.videoCodec){const n=Ee(e.videoCodec),i=Ee(t.videoCodec);if(n!==i)return i-n}if(e.uri===t.uri&&e.codecSet!==t.codecSet){const n=Te(e.codecSet),i=Te(t.codecSet);if(n!==i)return i-n}return e.averageBitrate!==t.averageBitrate?e.averageBitrate-t.averageBitrate:0});let p=f[0];if(this.steering&&(h=this.steering.filterParsedLevels(h),h.length!==f.length))for(let a=0;a<f.length;a++)if(f[a].pathwayId===h[0].pathwayId){p=f[a];break}this._levels=h;for(let a=0;a<h.length;a++)if(h[a]===p){var m;this._firstLevel=a;const e=p.bitrate,t=this.hls.bandwidthEstimate;if(this.log("manifest loaded, ".concat(h.length," level(s) found, first bitrate: ").concat(e)),void 0===(null==(m=this.hls.userConfig)?void 0:m.abrEwmaDefaultEstimate)){const n=Math.min(e,this.hls.config.abrEwmaDefaultEstimateMax);n>t&&t===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=n)}break}const g=r&&!i,v=this.hls.config,y=!(!v.audioStreamController||!v.audioTrackController),b={levels:h,audioTracks:c,subtitleTracks:u,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:r,video:i,altAudio:y&&!g&&c.some(e=>!!e.url)};d.end=performance.now(),this.hls.trigger(l.MANIFEST_PARSED,b)}get levels(){return 0===this._levels.length?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(0===t.length)return;if(e<0||e>=t.length){const n=new Error("invalid level idx"),i=e<0;if(this.hls.trigger(l.ERROR,{type:a.OTHER_ERROR,details:o.LEVEL_SWITCH_ERROR,level:e,fatal:i,error:n,reason:n.message}),i)return;e=Math.min(e,t.length-1)}const n=this.currentLevelIndex,i=this.currentLevel,r=i?i.attrs["PATHWAY-ID"]:void 0,s=t[e],c=s.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=s,n===e&&i&&r===c)return;this.log("Switching to level ".concat(e," (").concat(s.height?s.height+"p ":"").concat(s.videoRange?s.videoRange+" ":"").concat(s.codecSet?s.codecSet+" ":"","@").concat(s.bitrate,")").concat(c?" with Pathway "+c:""," from level ").concat(n).concat(r?" with Pathway "+r:""));const u={level:e,attrs:s.attrs,details:s.details,bitrate:s.bitrate,averageBitrate:s.averageBitrate,maxBitrate:s.maxBitrate,realBitrate:s.realBitrate,width:s.width,height:s.height,codecSet:s.codecSet,audioCodec:s.audioCodec,videoCodec:s.videoCodec,audioGroups:s.audioGroups,subtitleGroups:s.subtitleGroups,loaded:s.loaded,loadError:s.loadError,fragmentError:s.fragmentError,name:s.name,id:s.id,uri:s.uri,url:s.url,urlId:0,audioGroupIds:s.audioGroupIds,textGroupIds:s.textGroupIds};this.hls.trigger(l.LEVEL_SWITCHING,u);const h=s.details;if(!h||h.live){const e=this.switchParams(s.uri,null==i?void 0:i.details,h);this.loadPlaylist(e)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(void 0===this._startLevel){const e=this.hls.config.startLevel;return void 0!==e?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),n=e.filter(e=>-1!==t.indexOf(e));if(e.length<1)return void this.warn("pathwayPriority ".concat(e," should contain at least one pathway from list: ").concat(t));this.steering.pathwayPriority=n}}onError(e,t){!t.fatal&&t.context&&t.context.type===u&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,t){let{frag:n}=t;if(void 0!==n&&n.type===f.MAIN){const e=n.elementaryStreams;if(!Object.keys(e).some(t=>!!e[t]))return;const t=this._levels[n.level];null!=t&&t.loadError&&(this.log("Resetting level error count of ".concat(t.loadError," on frag buffered")),t.loadError=0)}}onLevelLoaded(e,t){var n;const{level:i,details:r}=t,s=t.levelInfo;var a;if(!s)return this.warn("Invalid level index ".concat(i)),void(null!=(a=t.deliveryDirectives)&&a.skip&&(r.deltaUpdateFailed=!0));if(s===this.currentLevel||t.withoutMultiVariant){0===s.fragmentError&&(s.loadError=0);let e=s.details;e===t.details&&e.advanced&&(e=void 0),this.playlistLoaded(i,t,e)}else null!=(n=t.deliveryDirectives)&&n.skip&&(r.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=this.getUrlWithDirectives(e.uri,t),i=this.currentLevelIndex,r=e.attrs["PATHWAY-ID"],s=e.details,a=null==s?void 0:s.age;this.log("Loading level index ".concat(i).concat(void 0!==(null==t?void 0:t.msn)?" at sn "+t.msn+" part "+t.part:"").concat(r?" Pathway "+r:"").concat(a&&s.live?" age "+a.toFixed(1)+(s.type?" "+s.type||0:""):""," ").concat(n)),this.hls.trigger(l.LEVEL_LOADING,{url:n,level:i,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(1===this._levels.length)return;const n=this._levels.filter((t,n)=>n!==e||(this.steering&&this.steering.removeLevel(t),t===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,t.details&&t.details.fragments.forEach(e=>e.level=-1)),!1));Zn(n),this._levels=n,this.currentLevelIndex>-1&&null!=(t=this.currentLevel)&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const i=n.length-1;this._firstLevel=Math.min(this._firstLevel,i),this._startLevel&&(this._startLevel=Math.min(this._startLevel,i)),this.hls.trigger(l.LEVELS_UPDATED,{levels:n})}onLevelsUpdated(e,t){let{levels:n}=t;this._levels=n}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:n}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(l.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:n}))}}function el(e){const t={};e.forEach(e=>{const n=e.groupId||"";e.id=t[n]=t[n]||0,t[n]++})}function tl(){return self.SourceBuffer||self.WebKitSourceBuffer}function nl(){if(!M())return!1;const e=tl();return!e||e.prototype&&"function"===typeof e.prototype.appendBuffer&&"function"===typeof e.prototype.remove}function il(){if(!nl())return!1;const e=M();return"function"===typeof(null==e?void 0:e.isTypeSupported)&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(t=>e.isTypeSupported(Se(t,"video")))||["mp4a.40.2","fLaC"].some(t=>e.isTypeSupported(Se(t,"audio"))))}class rl extends bi{constructor(e,t,n){super(e,t,n,"stream-controller",f.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const e=this.media,t=e?e.currentTime:null;if(null===t||!i(t))return;if(this.log("Media seeked to ".concat(t.toFixed(3))),!this.getBufferedFrag(t))return;const n=this.getFwdBufferInfoAtPos(e,t,f.MAIN,0);null!==n&&0!==n.len?this.tick():this.warn("Main forward buffer length at ".concat(t,' on "seeked" event ').concat(n?n.len:"empty",")"))},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(l.MANIFEST_PARSED,this.onManifestParsed,this),e.on(l.LEVEL_LOADING,this.onLevelLoading,this),e.on(l.LEVEL_LOADED,this.onLevelLoaded,this),e.on(l.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(l.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(l.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(l.BUFFER_CREATED,this.onBufferCreated,this),e.on(l.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(l.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(l.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(l.MANIFEST_PARSED,this.onManifestParsed,this),e.off(l.LEVEL_LOADED,this.onLevelLoaded,this),e.off(l.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(l.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(l.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(l.BUFFER_CREATED,this.onBufferCreated,this),e.off(l.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(l.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(l.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:n,hls:i}=this;if(this.stopLoad(),this.setInterval(100),this.level=-1,!this.startFragRequested){let e=i.startLevel;-1===e&&(i.config.testBandwidth&&this.levels.length>1?(e=0,this.bitrateTest=!0):e=i.firstAutoLevel),i.nextLoadLevel=e,this.level=i.loadLevel,this._hasEnoughToStart=!!t}n>0&&-1===e&&!t&&(this.log("Override startPosition with lastCurrentTime @".concat(n.toFixed(3))),e=n),this.state=li,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=oi}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case yi:{const{levels:e,level:t}=this,n=null==e?void 0:e[t],i=null==n?void 0:n.details;if(i&&(!i.live||this.levelLastLoaded===n&&!this.waitForLive(n))){if(this.waitForCdnTuneIn(i))break;this.state=li;break}if(this.hls.nextLoadLevel!==this.level){this.state=li;break}break}case hi:this.checkRetryDate()}this.state===li&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),null!=(e=this.media)&&e.readyState&&!1===this.media.seeking&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:n,media:i}=this;if(null===t||!i&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch))return;if(this.altAudio&&this.audioOnly)return;const r=this.buffering?e.nextLoadLevel:e.loadLevel;if(null==n||!n[r])return;const s=n[r],a=this.getMainFwdBufferInfo();if(null===a)return;const o=this.getLevelDetails();if(o&&this._streamEnded(a,o)){const e={};return 2===this.altAudio&&(e.type="video"),this.hls.trigger(l.BUFFER_EOS,e),void(this.state=mi)}if(!this.buffering)return;e.loadLevel!==r&&-1===e.manualLevel&&this.log("Adapting to level ".concat(r," from level ").concat(this.level)),this.level=e.nextLoadLevel=r;const c=s.details;if(!c||this.state===yi||this.waitForLive(s))return this.level=r,this.state=yi,void(this.startFragRequested=!1);const u=a.len,h=this.getMaxBufferLength(s.maxBitrate);if(u>=h)return;this.backtrackFragment&&this.backtrackFragment.start>a.end&&(this.backtrackFragment=null);const d=this.backtrackFragment?this.backtrackFragment.start:a.end;let p=this.getNextFragment(d,c);if(this.couldBacktrack&&!this.fragPrevious&&p&&j(p)&&this.fragmentTracker.getState(p)!==Tt){var m;const e=(null!=(m=this.backtrackFragment)?m:p).sn-c.startSN,t=c.fragments[e-1];t&&p.cc===t.cc&&(p=t,this.fragmentTracker.removeFragment(t))}else this.backtrackFragment&&a.len&&(this.backtrackFragment=null);if(p&&this.isLoopLoading(p,d)){if(!p.gap){const e=this.audioOnly&&!this.altAudio?F:U,t=(e===U?this.videoBuffer:this.mediaBuffer)||this.media;t&&this.afterBufferFlushed(t,e,f.MAIN)}p=this.getNextFragmentLoopLoading(p,c,a,f.MAIN,h)}p&&(!p.initSegment||p.initSegment.data||this.bitrateTest||(p=p.initSegment),this.loadFragment(p,s,d))}loadFragment(e,t,n){const i=this.fragmentTracker.getState(e);i===_t||i===Et?j(e)?this.bitrateTest?(this.log("Fragment ".concat(e.sn," of level ").concat(e.level," is being downloaded to test bitrate and will not be buffered")),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,n):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,f.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(null!=t&&t.readyState){let n;const i=this.getAppendedFrag(t.currentTime);i&&i.start>1&&this.flushMainBuffer(0,i.start-1);const r=this.getLevelDetails();if(null!=r&&r.live){const e=this.getMainFwdBufferInfo();if(!e||e.len<2*r.targetduration)return}if(!t.paused&&e){const t=e[this.hls.nextLoadLevel],i=this.fragLastKbps;n=i&&this.fragCurrent?this.fragCurrent.duration*t.maxBitrate/(1e3*i)+1:0}else n=0;const s=this.getBufferedFrag(t.currentTime+n);if(s){const e=this.followingBufferedFrag(s);if(e){this.abortCurrentFrag();const t=e.maxStartPTS?e.maxStartPTS:e.start,n=e.duration,i=Math.max(s.end,t+Math.min(Math.max(n-this.config.maxFragLookUpTolerance,n*(this.couldBacktrack?.5:.125)),n*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(i,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case ci:case ui:case hi:case fi:case pi:this.state=li}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,2===this.altAudio?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const n=t.media;ri(n,"playing",this.onMediaPlaying),ri(n,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:n}=this;n&&(si(n,"playing",this.onMediaPlaying),si(n,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t);!!t.transferMedia||(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(l.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let n=!1,i=!1;for(let r=0;r<t.levels.length;r++){const e=t.levels[r].audioCodec;e&&(n=n||-1!==e.indexOf("mp4a.40.2"),i=i||-1!==e.indexOf("mp4a.40.5"))}this.audioCodecSwitch=n&&i&&!function(){var e;const t=tl();return"function"===typeof(null==t||null==(e=t.prototype)?void 0:e.changeType)}(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:n}=this;if(!n||this.state!==li)return;const i=t.levelInfo;(!i.details||i.details.live&&(this.levelLastLoaded!==i||i.details.expired)||this.waitForCdnTuneIn(i.details))&&(this.state=yi)}onLevelLoaded(e,t){var n;const{levels:i,startFragRequested:r}=this,s=t.level,a=t.details,o=a.totalduration;if(!i)return void this.warn("Levels were reset while loading level ".concat(s));this.log("Level ".concat(s," loaded [").concat(a.startSN,",").concat(a.endSN,"]").concat(a.lastPartSn?"[part-".concat(a.lastPartSn,"-").concat(a.lastPartIndex,"]"):"",", cc [").concat(a.startCC,", ").concat(a.endCC,"] duration:").concat(o));const c=t.levelInfo,u=this.fragCurrent;!u||this.state!==ui&&this.state!==hi||u.level!==t.level&&u.loader&&this.abortCurrentFrag();let h=0;if(a.live||null!=(n=c.details)&&n.live){var d;if(this.checkLiveUpdate(a),a.deltaUpdateFailed)return;h=this.alignPlaylists(a,c.details,null==(d=this.levelLastLoaded)?void 0:d.details)}if(c.details=a,this.levelLastLoaded=c,r||this.setStartPosition(a,h),this.hls.trigger(l.LEVEL_UPDATED,{details:a,level:s}),this.state===yi){if(this.waitForCdnTuneIn(a))return;this.state=li}r&&a.live&&this.synchronizeToLiveEdge(a),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:n}=this;if(!n)return;const i=this.hls.liveSyncPosition,r=this.getLoadPosition(),s=e.fragmentStart,a=e.edge,o=r>=s-t.maxFragLookUpTolerance&&r<=a;if(null!==i&&n.duration>i&&(r<i||!o)){const s=void 0!==t.liveMaxLatencyDuration?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!o&&n.readyState<4||r<a-s)&&(this._hasEnoughToStart||(this.nextLoadPosition=i),n.readyState))if(this.warn("Playback: ".concat(r.toFixed(3)," is located too far from the end of live sliding playlist: ").concat(a,", reset currentTime to : ").concat(i.toFixed(3))),"buffered"===this.config.liveSyncMode){var l;const e=Vt.bufferInfo(n,i,0);if(null==(l=e.buffered)||!l.length)return void(n.currentTime=i);if(e.start<=r)return void(n.currentTime=i);const{nextStart:t}=Vt.bufferedInfo(e.buffered,r,0);t&&(n.currentTime=t)}else n.currentTime=i}}_handleFragmentLoadProgress(e){var t;const n=e.frag,{part:i,payload:r}=e,{levels:s}=this;if(!s)return void this.warn("Levels were reset while fragment load was in progress. Fragment ".concat(n.sn," of level ").concat(n.level," will not be buffered"));const a=s[n.level];if(!a)return void this.warn("Level ".concat(n.level," not found on progress"));const o=a.details;if(!o)return this.warn("Dropping fragment ".concat(n.sn," of level ").concat(n.level," after level details were reset")),void this.fragmentTracker.removeFragment(n);const l=a.videoCodec,c=o.PTSKnown||!o.live,u=null==(t=n.initSegment)?void 0:t.data,h=this._getAudioCodec(a),d=this.transmuxer=this.transmuxer||new Zr(this.hls,f.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),p=i?i.index:-1,m=-1!==p,g=new jt(n.level,n.sn,n.stats.chunkCount,r.byteLength,p,m),v=this.initPTS[n.cc];d.push(r,u,h,l,n,i,o.totalduration,c,g,v)}onAudioTrackSwitching(e,t){const n=this.hls,i=0!==this.altAudio;if(nt(t.url,n))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const e=this.fragCurrent;e&&(this.log("Switching to main audio track, cancel main fragment load"),e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(i)return this.altAudio=0,this.fragmentTracker.removeAllFragments(),n.once(l.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(l.AUDIO_TRACK_SWITCHED,t)}),void n.trigger(l.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});n.trigger(l.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const n=nt(t.url,this.hls);if(n){const e=this.videoBuffer;e&&this.mediaBuffer!==e&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=e)}this.altAudio=n?2:0,this.tick()}onBufferCreated(e,t){const n=t.tracks;let i,r,s=!1;for(const a in n){const e=n[a];if("main"===e.id){if(r=a,i=e,"video"===a){const e=n[a];e&&(this.videoBuffer=e.buffer)}}else s=!0}s&&i?(this.log("Alternate track found, use ".concat(r,".buffered to schedule main fragment loading")),this.mediaBuffer=i.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:n,part:i}=t,r=n.type===f.MAIN;if(r){if(this.fragContextChanged(n))return this.warn("Fragment ".concat(n.sn).concat(i?" p: "+i.index:""," of level ").concat(n.level," finished buffering, but was aborted. state: ").concat(this.state)),void(this.state===pi&&(this.state=li));const e=i?i.stats:n.stats;this.fragLastKbps=Math.round(8*e.total/(e.buffering.end-e.loading.first)),j(n)&&(this.fragPrevious=n),this.fragBufferedComplete(n,i)}const s=this.media;s&&(!this._hasEnoughToStart&&Vt.getBuffered(s).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),r&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var n;if(t.fatal)this.state=gi;else switch(t.details){case o.FRAG_GAP:case o.FRAG_PARSING_ERROR:case o.FRAG_DECRYPT_ERROR:case o.FRAG_LOAD_ERROR:case o.FRAG_LOAD_TIMEOUT:case o.KEY_LOAD_ERROR:case o.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(f.MAIN,t);break;case o.LEVEL_LOAD_ERROR:case o.LEVEL_LOAD_TIMEOUT:case o.LEVEL_PARSING_ERROR:t.levelRetry||this.state!==yi||(null==(n=t.context)?void 0:n.type)!==u||(this.state=li);break;case o.BUFFER_ADD_CODEC_ERROR:case o.BUFFER_APPEND_ERROR:if("main"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case o.BUFFER_FULL_ERROR:if("main"!==t.parent)return;if(this.reduceLengthAndFlushBuffer(t)){!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}break;case o.INTERNAL_EXCEPTION:this.recoverWorkerError(t)}}onFragLoadEmergencyAborted(){this.state=li,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,t){let{type:n}=t;if(n!==F||!this.altAudio){const e=(n===U?this.videoBuffer:this.mediaBuffer)||this.media;e&&(this.afterBufferFlushed(e,n,f.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,-1===this.level&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let n=this.startPosition;if(n>=0&&t<n){if(e.seeking)return void this.log("could not seek to ".concat(n,", already seeking at ").concat(t));const i=this.timelineOffset;i&&n&&(n+=i);const r=this.getLevelDetails(),s=Vt.getBuffered(e),a=s.length?s.start(0):0,o=a-n,l=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||o>0&&(o<l||this.loadingParts&&o<2*((null==r?void 0:r.partTarget)||0)))&&(this.log("adjusting start position by ".concat(o," to match buffer start")),n+=o,this.startPosition=n),t<n&&(this.log("seek to target start position ".concat(n," from current time ").concat(t," buffer start ").concat(a)),e.currentTime=n)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(e=>{const{hls:n}=this,i=null==e?void 0:e.frag;if(!i||this.fragContextChanged(i))return;t.fragmentError=0,this.state=li,this.startFragRequested=!1,this.bitrateTest=!1;const r=i.stats;r.parsing.start=r.parsing.end=r.buffering.start=r.buffering.end=self.performance.now(),n.trigger(l.FRAG_LOADED,e),i.bitrateTest=!1}).catch(t=>{this.state!==oi&&this.state!==gi&&(this.warn(t),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){const t=this.playlistType,{hls:n}=this,{remuxResult:r,chunkMeta:s}=e,a=this.getCurrentContext(s);if(!a)return void this.resetWhenMissingContext(s);const{frag:o,part:c,level:u}=a,{video:h,text:d,id3:f,initSegment:p}=r,{details:m}=u,g=this.altAudio?void 0:r.audio;if(this.fragContextChanged(o))this.fragmentTracker.removeFragment(o);else{if(this.state=fi,p){const e=p.tracks;if(e){const i=o.initSegment||o;if(this.unhandledEncryptionError(p,o))return;this._bufferInitSegment(u,e,i,s),n.trigger(l.FRAG_PARSING_INIT_SEGMENT,{frag:i,id:t,tracks:e})}const r=p.initPTS,a=p.timescale,c=this.initPTS[o.cc];if(i(r)&&(!c||c.baseTime!==r||c.timescale!==a)){const e=p.trackId;this.initPTS[o.cc]={baseTime:r,timescale:a,trackId:e},n.trigger(l.INIT_PTS_FOUND,{frag:o,id:t,initPTS:r,timescale:a,trackId:e})}}if(h&&m){g&&"audiovideo"===h.type&&this.logMuxedErr(o);const e=m.fragments[o.sn-1-m.startSN],t=o.sn===m.startSN,n=!e||o.cc>e.cc;if(!1!==r.independent){const{startPTS:e,endPTS:i,startDTS:r,endDTS:a}=h;if(c)c.elementaryStreams[h.type]={startPTS:e,endPTS:i,startDTS:r,endDTS:a};else if(h.firstKeyFrame&&h.independent&&1===s.id&&!n&&(this.couldBacktrack=!0),h.dropped&&h.independent){const r=this.getMainFwdBufferInfo(),s=(r?r.end:this.getLoadPosition())+this.config.maxBufferHole,l=h.firstKeyFramePTS?h.firstKeyFramePTS:e;if(!t&&s<l-this.config.maxBufferHole&&!n)return void this.backtrack(o);n&&(o.gap=!0),o.setElementaryStreamInfo(h.type,o.start,i,o.start,a,!0)}else t&&e-(m.appliedTimelineOffset||0)>2&&(o.gap=!0);o.setElementaryStreamInfo(h.type,e,i,r,a),this.backtrackFragment&&(this.backtrackFragment=o),this.bufferFragmentData(h,o,c,s,t||n)}else{if(!t&&!n)return void this.backtrack(o);o.gap=!0}}if(g){const{startPTS:e,endPTS:t,startDTS:n,endDTS:i}=g;c&&(c.elementaryStreams[F]={startPTS:e,endPTS:t,startDTS:n,endDTS:i}),o.setElementaryStreamInfo(F,e,t,n,i),this.bufferFragmentData(g,o,c,s)}if(m&&null!=f&&f.samples.length){const e={id:t,frag:o,details:m,samples:f.samples};n.trigger(l.FRAG_PARSING_METADATA,e)}if(m&&d){const e={id:t,frag:o,details:m,samples:d.samples};n.trigger(l.FRAG_PARSING_USERDATA,e)}}}logMuxedErr(e){this.warn("".concat(j(e)?"Media":"Init"," segment with muxed audiovideo where only video expected: ").concat(e.url))}_bufferInitSegment(e,t,n,i){if(this.state!==fi)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(n));const{audio:r,video:s,audiovideo:a}=t;if(r){const n=e.audioCodec;let i=Re(r.codec,n);"mp4a"===i&&(i="mp4a.40.5");const s=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){i&&(i=-1!==i.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5");const e=r.metadata;e&&"channelCount"in e&&1!==(e.channelCount||1)&&-1===s.indexOf("firefox")&&(i="mp4a.40.5")}i&&-1!==i.indexOf("mp4a.40.5")&&-1!==s.indexOf("android")&&"audio/mpeg"!==r.container&&(i="mp4a.40.2",this.log("Android: force audio codec to ".concat(i))),n&&n!==i&&this.log('Swapping manifest audio codec "'.concat(n,'" for "').concat(i,'"')),r.levelCodec=i,r.id=f.MAIN,this.log("Init audio buffer, container:".concat(r.container,", codecs[selected/level/parsed]=[").concat(i||"","/").concat(n||"","/").concat(r.codec,"]")),delete t.audiovideo}if(s){s.levelCodec=e.videoCodec,s.id=f.MAIN;const n=s.codec;if(4===(null==n?void 0:n.length))switch(n){case"hvc1":case"hev1":s.codec="hvc1.1.6.L120.90";break;case"av01":s.codec="av01.0.04M.08";break;case"avc1":s.codec="avc1.42e01e"}this.log("Init video buffer, container:".concat(s.container,", codecs[level/parsed]=[").concat(e.videoCodec||"","/").concat(n,"]").concat(s.codec!==n?" parsed-corrected="+s.codec:"").concat(s.supplemental?" supplemental="+s.supplemental:"")),delete t.audiovideo}a&&(this.log("Init audiovideo buffer, container:".concat(a.container,", codecs[level/parsed]=[").concat(e.codecs,"/").concat(a.codec,"]")),delete t.video,delete t.audio);const o=Object.keys(t);if(o.length){if(this.hls.trigger(l.BUFFER_CODECS,t),!this.hls)return;o.forEach(e=>{const r=t[e].initSegment;null!=r&&r.byteLength&&this.hls.trigger(l.BUFFER_APPENDING,{type:e,data:r,frag:n,part:null,chunkMeta:i,parent:n.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&2===this.altAudio?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,f.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,n=null==e?void 0:e[t];return n?this.getMaxBufferLength(n.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=li}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&!1===e.seeking){const n=e.currentTime;if(Vt.isBuffered(e,n)?t=this.getAppendedFrag(n):Vt.isBuffered(e,n+.1)&&(t=this.getAppendedFrag(n+.1)),t){this.backtrackFragment=null;const e=this.fragPlaying,n=t.level;e&&t.sn===e.sn&&e.level===n||(this.fragPlaying=t,this.hls.trigger(l.FRAG_CHANGED,{frag:t}),e&&e.level===n||this.hls.trigger(l.LEVEL_SWITCHED,{level:n}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=(null==(e=this.media)?void 0:e.currentTime)||this.lastCurrentTime;return i(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=(null==(e=this.media)?void 0:e.currentTime)||this.lastCurrentTime;if(i(t)){const e=this.getLevelDetails(),n=this.currentFrag||(e?st(null,e.fragments,t):null);if(n){const e=n.programDateTime;if(null!==e){const i=e+1e3*(t-n.start);return new Date(i)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class sl extends x{constructor(e,t){super("key-loader",t),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const n in this.keyIdToKeyInfo){const i=this.keyIdToKeyInfo[n].loader;if(i){var t;if(e&&e!==(null==(t=i.context)?void 0:t.frag.type))return;i.abort()}}}detach(){for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e].loader;t&&t.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.KEY_LOAD_ERROR,n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0;return new Bt({type:a.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:r,error:n,networkDetails:i})}loadClear(e,t,n){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let i=0,r=t.length;i<r;i++){const s=t[i];if(e.cc<=s.cc&&(!j(e)||!j(s)||e.sn<s.sn)||!n&&i==r-1)return this.emeController.selectKeySystemFormat(s).then(e=>{if(!this.emeController)return;s.setKeyFormat(e);const t=pn(e);return t?this.emeController.getKeySystemAccess([t]):void 0})}if(this.config.requireKeySystemAccessOnStart){const e=gn(this.config);if(e.length)return this.emeController.getKeySystemAccess(e)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var n,i;t&&e.setKeyFormat(t);const r=e.decryptdata;if(!r){const n=new Error(t?"Expected frag.decryptdata to be defined after setting format ".concat(t):"Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ".concat(this.emeController&&this.config.emeEnabled,")"));return Promise.reject(this.createKeyLoadError(e,o.KEY_LOAD_ERROR,n))}const s=r.uri;if(!s)return Promise.reject(this.createKeyLoadError(e,o.KEY_LOAD_ERROR,new Error('Invalid key URI: "'.concat(s,'"'))));const a=al(r);let l=this.keyIdToKeyInfo[a];if(null!=(n=l)&&n.decryptdata.key)return r.key=l.decryptdata.key,Promise.resolve({frag:e,keyInfo:l});if(this.emeController&&null!=(i=l)&&i.keyLoadPromise){switch(this.emeController.getKeyStatus(l.decryptdata)){case"usable":case"usable-in-future":return l.keyLoadPromise.then(t=>{const{keyInfo:n}=t;return r.key=n.decryptdata.key,{frag:e,keyInfo:n}})}}switch(this.log("".concat(this.keyIdToKeyInfo[a]?"Rel":"L","oading").concat(r.keyId?" keyId: "+L(r.keyId):""," URI: ").concat(r.uri," from ").concat(e.type," ").concat(e.level)),l=this.keyIdToKeyInfo[a]={decryptdata:r,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},r.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return"identity"===r.keyFormat?this.loadKeyHTTP(l,e):this.loadKeyEME(l,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(l,e);default:return Promise.reject(this.createKeyLoadError(e,o.KEY_LOAD_ERROR,new Error('Key supplied with unsupported METHOD: "'.concat(r.method,'"'))))}}loadKeyEME(e,t){const n={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var i;if(!e.decryptdata.keyId&&null!=(i=t.initSegment)&&i.data){const n=function(e){const t=[];return oe(e,e=>t.push(e.subarray(8,24))),t}(t.initSegment.data);if(n.length){let t=n[0];t.some(e=>0!==e)?(this.log("Using keyId found in init segment ".concat(L(t))),_n.setKeyIdForUri(e.decryptdata.uri,t)):(t=_n.addKeyIdForUri(e.decryptdata.uri),this.log("Generating keyId to patch media ".concat(L(t)))),e.decryptdata.keyId=t}}if(!e.decryptdata.keyId&&!j(t))return Promise.resolve(n);const r=this.emeController.loadKey(n);return(e.keyLoadPromise=r.then(t=>(e.mediaKeySessionContext=t,n))).catch(n=>{throw e.keyLoadPromise=null,"data"in n&&(n.data.frag=t),n})}return Promise.resolve(n)}loadKeyHTTP(e,t){const n=this.config,i=new(0,n.loader)(n);return t.keyLoader=e.loader=i,e.keyLoadPromise=new Promise((r,s)=>{const a={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},l=n.keyLoadPolicy.default,c={loadPolicy:l,timeout:l.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},u={onSuccess:(e,t,n,i)=>{const{frag:a,keyInfo:l}=n,c=al(l.decryptdata);if(!a.decryptdata||l!==this.keyIdToKeyInfo[c])return s(this.createKeyLoadError(a,o.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),i));l.decryptdata.key=a.decryptdata.key=new Uint8Array(e.data),a.keyLoader=null,l.loader=null,r({frag:a,keyInfo:l})},onError:(e,n,i,r)=>{this.resetLoader(n),s(this.createKeyLoadError(t,o.KEY_LOAD_ERROR,new Error("HTTP Error ".concat(e.code," loading key ").concat(e.text)),i,b({url:a.url,data:void 0},e)))},onTimeout:(e,n,i)=>{this.resetLoader(n),s(this.createKeyLoadError(t,o.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),i))},onAbort:(e,n,i)=>{this.resetLoader(n),s(this.createKeyLoadError(t,o.INTERNAL_ABORTED,new Error("key loading aborted"),i))}};i.load(a,c,u)})}resetLoader(e){const{frag:t,keyInfo:n,url:i}=e,r=n.loader;t.keyLoader===r&&(t.keyLoader=null,n.loader=null);const s=al(n.decryptdata)||i;delete this.keyIdToKeyInfo[s],r&&r.destroy()}}function al(e){if(e.keyFormat!==fn.FAIRPLAY){const t=e.keyId;if(t)return L(t)}return e.uri}function ol(e){const{type:t}=e;switch(t){case h:return f.AUDIO;case d:return f.SUBTITLE;default:return f.MAIN}}function ll(e,t){let n=e.url;return void 0!==n&&0!==n.indexOf("data:")||(n=t.url),n}class cl{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(l.MANIFEST_LOADING,this.onManifestLoading,this),e.on(l.LEVEL_LOADING,this.onLevelLoading,this),e.on(l.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(l.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(l.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(l.MANIFEST_LOADING,this.onManifestLoading,this),e.off(l.LEVEL_LOADING,this.onLevelLoading,this),e.off(l.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(l.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(l.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,n=t.pLoader,i=t.loader,r=new(n||i)(t);return this.loaders[e.type]=r,r}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:n}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:c,url:n,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:n,level:i,pathwayId:r,url:s,deliveryDirectives:a,levelInfo:o}=t;this.load({id:n,level:i,pathwayId:r,responseType:"text",type:u,url:s,deliveryDirectives:a,levelOrTrack:o})}onAudioTrackLoading(e,t){const{id:n,groupId:i,url:r,deliveryDirectives:s,track:a}=t;this.load({id:n,groupId:i,level:null,responseType:"text",type:h,url:r,deliveryDirectives:s,levelOrTrack:a})}onSubtitleTrackLoading(e,t){const{id:n,groupId:i,url:r,deliveryDirectives:s,track:a}=t;this.load({id:n,groupId:i,level:null,responseType:"text",type:d,url:r,deliveryDirectives:s,levelOrTrack:a})}onLevelsUpdated(e,t){const n=this.loaders[u];if(n){const e=n.context;e&&!t.levels.some(t=>t===e.levelOrTrack)&&(n.abort(),delete this.loaders[u])}}load(e){var t;const n=this.hls.config;let r,s=this.getInternalLoader(e);if(s){const t=this.hls.logger,n=s.context;if(n&&n.levelOrTrack===e.levelOrTrack&&(n.url===e.url||n.deliveryDirectives&&!e.deliveryDirectives))return void(n.url===e.url?t.log("[playlist-loader]: ignore ".concat(e.url," ongoing request")):t.log("[playlist-loader]: ignore ".concat(e.url," in favor of ").concat(n.url)));t.log("[playlist-loader]: aborting previous loader for type: ".concat(e.type)),s.abort()}if(r=e.type===c?n.manifestLoadPolicy.default:v({},n.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),s=this.createInternalLoader(e),i(null==(t=e.deliveryDirectives)?void 0:t.part)){let t;if(e.type===u&&null!==e.level?t=this.hls.levels[e.level].details:e.type===h&&null!==e.id?t=this.hls.audioTracks[e.id].details:e.type===d&&null!==e.id&&(t=this.hls.subtitleTracks[e.id].details),t){const e=t.partTarget,n=t.targetduration;if(e&&n){const t=1e3*Math.max(3*e,.8*n);r=v({},r,{maxTimeToFirstByteMs:Math.min(t,r.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(t,r.maxTimeToFirstByteMs)})}}}const a=r.errorRetry||r.timeoutRetry||{},o={loadPolicy:r,timeout:r.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},l={onSuccess:(e,t,n,i)=>{const r=this.getInternalLoader(n);this.resetInternalLoader(n.type);const s=e.data;t.parsing.start=performance.now(),Rn.isMediaPlaylist(s)||n.type!==c?this.handleTrackOrLevelPlaylist(e,t,n,i||null,r):this.handleMasterPlaylist(e,t,n,i)},onError:(e,t,n,i)=>{this.handleNetworkError(t,n,!1,e,i)},onTimeout:(e,t,n)=>{this.handleNetworkError(t,n,!0,void 0,e)}};s.load(e,o,l)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:n}=this.hls;(e||n)&&(this.hls.logger.log("".concat(e?"auto":"force"," startLoad with configured startPosition ").concat(t)),this.hls.startLoad(t))}handleMasterPlaylist(e,t,n,i){const r=this.hls,s=e.data,a=ll(e,n),o=Rn.parseMasterPlaylist(s,a);if(o.playlistParsingError)return t.parsing.end=performance.now(),void this.handleManifestParsingError(e,n,o.playlistParsingError,i,t);const{contentSteering:c,levels:u,sessionData:h,sessionKeys:d,startTimeOffset:f,variableList:p}=o;this.variableList=p,u.forEach(e=>{const{unknownCodecs:t}=e;if(t){const{preferManagedMediaSource:n}=this.hls.config;let{audioCodec:i,videoCodec:r}=e;for(let s=t.length;s--;){const a=t[s];xe(a,"audio",n)?(e.audioCodec=i=i?"".concat(i,",").concat(a):a,ye.audio[i.substring(0,4)]=2,t.splice(s,1)):xe(a,"video",n)&&(e.videoCodec=r=r?"".concat(r,",").concat(a):a,ye.video[r.substring(0,4)]=2,t.splice(s,1))}}});const{AUDIO:m=[],SUBTITLES:g,"CLOSED-CAPTIONS":v}=Rn.parseMasterPlaylistMedia(s,a,o);if(m.length){m.some(e=>!e.url)||!u[0].audioCodec||u[0].attrs.AUDIO||(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),m.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new Jt({}),bitrate:0,url:""}))}r.trigger(l.MANIFEST_LOADED,{levels:u,audioTracks:m,subtitles:g,captions:v,contentSteering:c,url:a,stats:t,networkDetails:i,sessionData:h,sessionKeys:d,startTimeOffset:f,variableList:p})}handleTrackOrLevelPlaylist(e,t,n,r,s){const a=this.hls,{id:o,level:u,type:h}=n,d=ll(e,n),f=i(u)?u:i(o)?o:0,p=ol(n),m=Rn.parseLevelPlaylist(e.data,d,f,p,0,this.variableList);if(h===c){const e={attrs:new Jt({}),bitrate:0,details:m,name:"",url:d};m.requestScheduled=t.loading.start+Yn(m,0),a.trigger(l.MANIFEST_LOADED,{levels:[e],audioTracks:[],url:d,stats:t,networkDetails:r,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),n.levelDetails=m,this.handlePlaylistLoaded(m,e,t,n,r,s)}handleManifestParsingError(e,t,n,i,r){this.hls.trigger(l.ERROR,{type:a.NETWORK_ERROR,details:o.MANIFEST_PARSING_ERROR,fatal:t.type===c,url:e.url,err:n,error:n,reason:n.message,response:e,context:t,networkDetails:i,stats:r})}handleNetworkError(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0,s="A network ".concat(n?"timeout":"error"+(i?" (status "+i.code+")":"")," occurred while loading ").concat(e.type);e.type===u?s+=": ".concat(e.level," id: ").concat(e.id):e.type!==h&&e.type!==d||(s+=" id: ".concat(e.id,' group-id: "').concat(e.groupId,'"'));const f=new Error(s);this.hls.logger.warn("[playlist-loader]: ".concat(s));let p=o.UNKNOWN,m=!1;const g=this.getInternalLoader(e);switch(e.type){case c:p=n?o.MANIFEST_LOAD_TIMEOUT:o.MANIFEST_LOAD_ERROR,m=!0;break;case u:p=n?o.LEVEL_LOAD_TIMEOUT:o.LEVEL_LOAD_ERROR,m=!1;break;case h:p=n?o.AUDIO_TRACK_LOAD_TIMEOUT:o.AUDIO_TRACK_LOAD_ERROR,m=!1;break;case d:p=n?o.SUBTITLE_TRACK_LOAD_TIMEOUT:o.SUBTITLE_LOAD_ERROR,m=!1}g&&this.resetInternalLoader(e.type);const v={type:a.NETWORK_ERROR,details:p,fatal:m,url:e.url,loader:g,context:e,error:f,networkDetails:t,stats:r};if(i){const n=(null==t?void 0:t.url)||e.url;v.response=b({url:n,data:void 0},i)}this.hls.trigger(l.ERROR,v)}handlePlaylistLoaded(e,t,n,i,r,s){const p=this.hls,{type:m,level:g,levelOrTrack:v,id:y,groupId:b,deliveryDirectives:x}=i,_=ll(t,i),S=ol(i);let E="number"===typeof i.level&&S===f.MAIN?g:void 0;const T=e.playlistParsingError;if(T){if(this.hls.logger.warn("".concat(T," ").concat(e.url)),!p.config.ignorePlaylistParsingErrors)return void p.trigger(l.ERROR,{type:a.NETWORK_ERROR,details:o.LEVEL_PARSING_ERROR,fatal:!1,url:_,error:T,reason:T.message,response:t,context:i,level:E,parent:S,networkDetails:r,stats:n});e.playlistParsingError=null}if(!e.fragments.length){const s=e.playlistParsingError=new Error("No Segments found in Playlist");return void p.trigger(l.ERROR,{type:a.NETWORK_ERROR,details:o.LEVEL_EMPTY_ERROR,fatal:!1,url:_,error:s,reason:s.message,response:t,context:i,level:E,parent:S,networkDetails:r,stats:n})}switch(e.live&&s&&(s.getCacheAge&&(e.ageHeader=s.getCacheAge()||0),s.getCacheAge&&!isNaN(e.ageHeader)||(e.ageHeader=0)),m){case c:case u:if(E)if(v){if(v!==p.levels[E]){const e=p.levels.indexOf(v);e>-1&&(E=e)}}else E=0;p.trigger(l.LEVEL_LOADED,{details:e,levelInfo:v||p.levels[0],level:E||0,id:y||0,stats:n,networkDetails:r,deliveryDirectives:x,withoutMultiVariant:m===c});break;case h:p.trigger(l.AUDIO_TRACK_LOADED,{details:e,track:v,id:y||0,groupId:b||"",stats:n,networkDetails:r,deliveryDirectives:x});break;case d:p.trigger(l.SUBTITLE_TRACK_LOADED,{details:e,track:v,id:y||0,groupId:b||"",stats:n,networkDetails:r,deliveryDirectives:x})}}}class ul{static get version(){return Ai}static isMSESupported(){return nl()}static isSupported(){return il()}static getMediaSource(){return M()}static get Events(){return l}static get MetadataSchema(){return Ki}static get ErrorTypes(){return a}static get ErrorDetails(){return o}static get DefaultConfig(){return ul.defaultConfig?ul.defaultConfig:Go}static set DefaultConfig(e){ul.defaultConfig=e}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new wi,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=function(e,t,n){const i=E();if("object"===typeof console&&!0===e||"object"===typeof e){const s=["debug","log","info","warn","error"];s.forEach(t=>{i[t]=T(t,e,n)});try{i.log('Debug logs enabled for "'.concat(t,'" in hls.js version ',"1.6.15"))}catch(r){return E()}s.forEach(t=>{w[t]=T(t,e)})}else v(w,i);return i}(e.debug||!1,"Hls instance",e.assetPlayerId),n=this.config=function(e,t,n){if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==t.liveMaxLatencyDurationCount&&(void 0===t.liveSyncDurationCount||t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==t.liveMaxLatencyDuration&&(void 0===t.liveSyncDuration||t.liveMaxLatencyDuration<=t.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const i=Vo(e),r=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return["manifest","level","frag"].forEach(e=>{const s="".concat("level"===e?"playlist":e,"LoadPolicy"),a=void 0===t[s],o=[];r.forEach(n=>{const r="".concat(e,"Loading").concat(n),l=t[r];if(void 0!==l&&a){o.push(r);const e=i[s].default;switch(t[s]={default:e},n){case"TimeOut":e.maxLoadTimeMs=l,e.maxTimeToFirstByteMs=l;break;case"MaxRetry":e.errorRetry.maxNumRetry=l,e.timeoutRetry.maxNumRetry=l;break;case"RetryDelay":e.errorRetry.retryDelayMs=l,e.timeoutRetry.retryDelayMs=l;break;case"MaxRetryTimeout":e.errorRetry.maxRetryDelayMs=l,e.timeoutRetry.maxRetryDelayMs=l}}}),o.length&&n.warn('hls.js config: "'.concat(o.join('", "'),'" setting(s) are deprecated, use "').concat(s,'": ').concat(qe(t[s])))}),b(b({},i),t)}(ul.DefaultConfig,e,t);this.userConfig=e,n.progressive&&function(e,t){const n=e.loader;n!==Fo&&n!==jo?(t.log("[config]: Custom loader detected, cannot enable progressive streaming"),e.progressive=!1):No()&&(e.loader=Fo,e.progressive=!0,e.enableSoftwareAES=!0,t.log("[config]: Progressive streaming enabled, using FetchLoader"))}(n,t);const{abrController:i,bufferController:r,capLevelController:s,errorController:a,fpsController:o}=n,c=new a(this),u=this.abrController=new i(this),h=new wt(this),d=n.interstitialsController,f=d?this.interstitialsController=new d(this,ul):null,p=this.bufferController=new r(this,h),m=this.capLevelController=new s(this),g=new o(this),y=new cl(this),x=n.contentSteeringController,_=x?new x(this):null,S=this.levelController=new $o(this,_),A=new Jo(this),M=new sl(this.config,this.logger),R=this.streamController=new rl(this,h,M),C=this.gapController=new Ho(this,h);m.setStreamController(R),g.setStreamController(R);const L=[y,S,R];f&&L.splice(1,0,f),_&&L.splice(1,0,_),this.networkControllers=L;const I=[u,p,C,m,g,A,h];this.audioTrackController=this.createController(n.audioTrackController,L);const P=n.audioStreamController;P&&L.push(this.audioStreamController=new P(this,h,M)),this.subtitleTrackController=this.createController(n.subtitleTrackController,L);const k=n.subtitleStreamController;k&&L.push(this.subtititleStreamController=new k(this,h,M)),this.createController(n.timelineController,I),M.emeController=this.emeController=this.createController(n.emeController,I),this.cmcdController=this.createController(n.cmcdController,I),this.latencyController=this.createController(Qo,I),this.coreComponents=I,L.push(c);const D=c.onErrorOut;"function"===typeof D&&this.on(l.ERROR,D,c),this.on(l.MANIFEST_LOADED,y.onManifestLoaded,y)}createController(e,t){if(e){const n=new e(this);return t&&t.push(n),n}return null}on(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;this._emitter.on(e,t,n)}once(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;this._emitter.once(e,t,n)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,i=arguments.length>3?arguments[3]:void 0;this._emitter.off(e,t,n,i)}listeners(e){return this._emitter.listeners(e)}emit(e,t,n){return this._emitter.emit(e,t,n)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(n){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+n.message+'". Here is a stacktrace:',n),!this.triggeringException){this.triggeringException=!0;const t=e===l.ERROR;this.trigger(l.ERROR,{type:a.OTHER_ERROR,details:o.INTERNAL_EXCEPTION,fatal:t,event:e,error:n}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(l.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(e=>e.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(e=>e.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const t=new Error("attachMedia failed: invalid argument (".concat(e,")"));return void this.trigger(l.ERROR,{type:a.OTHER_ERROR,details:o.ATTACH_MEDIA_ERROR,fatal:!0,error:t})}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,n=t?e.media:e,i=t?e:{media:n};this._media=n,this.trigger(l.MEDIA_ATTACHING,i)}detachMedia(){this.logger.log("detachMedia"),this.trigger(l.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(l.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,n=this._url,i=this._url=N.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log("loadSource:".concat(i)),t&&n&&(n!==i||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(l.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=arguments.length>1?arguments[1]:void 0;this.logger.log("startLoad(".concat(e+(t?", <skip seek to start>":""),")")),this.started=!0,this.resumeBuffering();for(let n=0;n<this.networkControllers.length&&(this.networkControllers[n].startLoad(e,t),this.started&&this.networkControllers);n++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!this.started&&this.networkControllers);e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[f.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[f.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[f.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=null==e?void 0:e.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=function(){try{return crypto.randomUUID()}catch(e){try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch(e){let t=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const n=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?n:3&n|8).toString(16)})}}}()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log("set currentLevel:".concat(e)),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log("set nextLevel:".concat(e)),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log("set loadLevel:".concat(e)),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log("set firstLevel:".concat(e)),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return-1===e&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log("set startLevel:".concat(e)),-1!==e&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log("set autoLevelCapping:".concat(e)),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){(function(e){return ze.indexOf(e)>-1})(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return-1===this.levelController.manualLevel}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const n=e.length;for(let i=0;i<n;i++)if(e[i].maxBitrate>=t)return i;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:n}=this;let i;if(i=-1===t&&null!=e&&e.length?e.length-1:t,n)for(let r=i;r--;){const t=e[r].attrs["HDCP-LEVEL"];if(t&&t<=n)return r}return i}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return(null==(t=this.audioTrackController)?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return(null==(t=this.subtitleTrackController)?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return!!e&&e.subtitleDisplay}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!(null==(e=this.bufferController)||!e.bufferedToEnd)}get interstitialsManager(){var e;return(null==(e=this.interstitialsController)?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e){return Fe(e,Ze(arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.allAudioTracks),navigator.mediaCapabilities)}}ul.defaultConfig=void 0},813:(e,t)=>{"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var i=n-1>>>1,r=e[i];if(!(0<s(r,t)))break e;e[i]=t,e[n]=r,n=i}}function i(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var i=0,r=e.length,a=r>>>1;i<a;){var o=2*(i+1)-1,l=e[o],c=o+1,u=e[c];if(0>s(l,n))c<r&&0>s(u,l)?(e[i]=u,e[c]=n,i=c):(e[i]=l,e[o]=n,i=o);else{if(!(c<r&&0>s(u,n)))break e;e[i]=u,e[c]=n,i=c}}}return t}function s(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var a=performance;t.unstable_now=function(){return a.now()}}else{var o=Date,l=o.now();t.unstable_now=function(){return o.now()-l}}var c=[],u=[],h=1,d=null,f=3,p=!1,m=!1,g=!1,v="function"===typeof setTimeout?setTimeout:null,y="function"===typeof clearTimeout?clearTimeout:null,b="undefined"!==typeof setImmediate?setImmediate:null;function x(e){for(var t=i(u);null!==t;){if(null===t.callback)r(u);else{if(!(t.startTime<=e))break;r(u),t.sortIndex=t.expirationTime,n(c,t)}t=i(u)}}function _(e){if(g=!1,x(e),!m)if(null!==i(c))m=!0,k(S);else{var t=i(u);null!==t&&D(_,t.startTime-e)}}function S(e,n){m=!1,g&&(g=!1,y(A),A=-1),p=!0;var s=f;try{for(x(n),d=i(c);null!==d&&(!(d.expirationTime>n)||e&&!C());){var a=d.callback;if("function"===typeof a){d.callback=null,f=d.priorityLevel;var o=a(d.expirationTime<=n);n=t.unstable_now(),"function"===typeof o?d.callback=o:d===i(c)&&r(c),x(n)}else r(c);d=i(c)}if(null!==d)var l=!0;else{var h=i(u);null!==h&&D(_,h.startTime-n),l=!1}return l}finally{d=null,f=s,p=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var E,T=!1,w=null,A=-1,M=5,R=-1;function C(){return!(t.unstable_now()-R<M)}function L(){if(null!==w){var e=t.unstable_now();R=e;var n=!0;try{n=w(!0,e)}finally{n?E():(T=!1,w=null)}}else T=!1}if("function"===typeof b)E=function(){b(L)};else if("undefined"!==typeof MessageChannel){var I=new MessageChannel,P=I.port2;I.port1.onmessage=L,E=function(){P.postMessage(null)}}else E=function(){v(L,0)};function k(e){w=e,T||(T=!0,E())}function D(e,n){A=v(function(){e(t.unstable_now())},n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){m||p||(m=!0,k(S))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):M=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return i(c)},t.unstable_next=function(e){switch(f){case 1:case 2:case 3:var t=3;break;default:t=f}var n=f;f=t;try{return e()}finally{f=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=f;f=e;try{return t()}finally{f=n}},t.unstable_scheduleCallback=function(e,r,s){var a=t.unstable_now();switch("object"===typeof s&&null!==s?s="number"===typeof(s=s.delay)&&0<s?a+s:a:s=a,e){case 1:var o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}return e={id:h++,callback:r,priorityLevel:e,startTime:s,expirationTime:o=s+o,sortIndex:-1},s>a?(e.sortIndex=s,n(u,e),null===i(c)&&e===i(u)&&(g?(y(A),A=-1):g=!0,D(_,s-a))):(e.sortIndex=o,n(c,e),m||p||(m=!0,k(S))),e},t.unstable_shouldYield=C,t.unstable_wrapCallback=function(e){var t=f;return function(){var n=f;f=t;try{return e.apply(this,arguments)}finally{f=n}}}},853:(e,t,n)=>{"use strict";e.exports=n(234)},950:(e,t,n)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(730)},958:(e,t,n)=>{e.exports=function(e){var t={},i=n(43),r=n(513),s=Object.assign;function a(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,l=Symbol.for("react.element"),c=Symbol.for("react.portal"),u=Symbol.for("react.fragment"),h=Symbol.for("react.strict_mode"),d=Symbol.for("react.profiler"),f=Symbol.for("react.provider"),p=Symbol.for("react.context"),m=Symbol.for("react.forward_ref"),g=Symbol.for("react.suspense"),v=Symbol.for("react.suspense_list"),y=Symbol.for("react.memo"),b=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var x=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var _=Symbol.iterator;function S(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=_&&e[_]||e["@@iterator"])?e:null}function E(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case u:return"Fragment";case c:return"Portal";case d:return"Profiler";case h:return"StrictMode";case g:return"Suspense";case v:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case p:return(e.displayName||"Context")+".Consumer";case f:return(e._context.displayName||"Context")+".Provider";case m:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case y:return null!==(t=e.displayName||null)?t:E(e.type)||"Memo";case b:t=e._payload,e=e._init;try{return E(e(t))}catch(n){}}return null}function T(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return E(t);case 8:return t===h?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function w(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function A(e){if(w(e)!==e)throw Error(a(188))}function M(e){var t=e.alternate;if(!t){if(null===(t=w(e)))throw Error(a(188));return t!==e?null:e}for(var n=e,i=t;;){var r=n.return;if(null===r)break;var s=r.alternate;if(null===s){if(null!==(i=r.return)){n=i;continue}break}if(r.child===s.child){for(s=r.child;s;){if(s===n)return A(r),e;if(s===i)return A(r),t;s=s.sibling}throw Error(a(188))}if(n.return!==i.return)n=r,i=s;else{for(var o=!1,l=r.child;l;){if(l===n){o=!0,n=r,i=s;break}if(l===i){o=!0,i=r,n=s;break}l=l.sibling}if(!o){for(l=s.child;l;){if(l===n){o=!0,n=s,i=r;break}if(l===i){o=!0,i=s,n=r;break}l=l.sibling}if(!o)throw Error(a(189))}}if(n.alternate!==i)throw Error(a(190))}if(3!==n.tag)throw Error(a(188));return n.stateNode.current===n?e:t}function R(e){return null!==(e=M(e))?C(e):null}function C(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=C(e);if(null!==t)return t;e=e.sibling}return null}function L(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){if(4!==e.tag){var t=L(e);if(null!==t)return t}e=e.sibling}return null}var I,P=Array.isArray,k=e.getPublicInstance,D=e.getRootHostContext,N=e.getChildHostContext,O=e.prepareForCommit,F=e.resetAfterCommit,U=e.createInstance,B=e.appendInitialChild,z=e.finalizeInitialChildren,j=e.prepareUpdate,G=e.shouldSetTextContent,V=e.createTextInstance,H=e.scheduleTimeout,W=e.cancelTimeout,Y=e.noTimeout,X=e.isPrimaryRenderer,q=e.supportsMutation,K=e.supportsPersistence,Z=e.supportsHydration,J=e.getInstanceFromNode,Q=e.preparePortalMount,$=e.getCurrentEventPriority,ee=e.detachDeletedInstance,te=e.supportsMicrotasks,ne=e.scheduleMicrotask,ie=e.supportsTestSelectors,re=e.findFiberRoot,se=e.getBoundingRect,ae=e.getTextContent,oe=e.isHiddenSubtree,le=e.matchAccessibilityRole,ce=e.setFocusIfFocusable,ue=e.setupIntersectionObserver,he=e.appendChild,de=e.appendChildToContainer,fe=e.commitTextUpdate,pe=e.commitMount,me=e.commitUpdate,ge=e.insertBefore,ve=e.insertInContainerBefore,ye=e.removeChild,be=e.removeChildFromContainer,xe=e.resetTextContent,_e=e.hideInstance,Se=e.hideTextInstance,Ee=e.unhideInstance,Te=e.unhideTextInstance,we=e.clearContainer,Ae=e.cloneInstance,Me=e.createContainerChildSet,Re=e.appendChildToContainerChildSet,Ce=e.finalizeContainerChildren,Le=e.replaceContainerChildren,Ie=e.cloneHiddenInstance,Pe=e.cloneHiddenTextInstance,ke=e.canHydrateInstance,De=e.canHydrateTextInstance,Ne=e.canHydrateSuspenseInstance,Oe=e.isSuspenseInstancePending,Fe=e.isSuspenseInstanceFallback,Ue=e.registerSuspenseInstanceRetry,Be=e.getNextHydratableSibling,ze=e.getFirstHydratableChild,je=e.getFirstHydratableChildWithinContainer,Ge=e.getFirstHydratableChildWithinSuspenseInstance,Ve=e.hydrateInstance,He=e.hydrateTextInstance,We=e.hydrateSuspenseInstance,Ye=e.getNextHydratableInstanceAfterSuspenseInstance,Xe=e.commitHydratedContainer,qe=e.commitHydratedSuspenseInstance,Ke=e.clearSuspenseBoundary,Ze=e.clearSuspenseBoundaryFromContainer,Je=e.shouldDeleteUnhydratedTailInstances,Qe=e.didNotMatchHydratedContainerTextInstance,$e=e.didNotMatchHydratedTextInstance;function et(e){if(void 0===I)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);I=t&&t[1]||""}return"\n"+I+e}var tt=!1;function nt(e,t){if(!e||tt)return"";tt=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var i=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){i=c}e.call(t.prototype)}else{try{throw Error()}catch(c){i=c}e()}}catch(c){if(c&&i&&"string"===typeof c.stack){for(var r=c.stack.split("\n"),s=i.stack.split("\n"),a=r.length-1,o=s.length-1;1<=a&&0<=o&&r[a]!==s[o];)o--;for(;1<=a&&0<=o;a--,o--)if(r[a]!==s[o]){if(1!==a||1!==o)do{if(a--,0>--o||r[a]!==s[o]){var l="\n"+r[a].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=a&&0<=o);break}}}finally{tt=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?et(e):""}var it=Object.prototype.hasOwnProperty,rt=[],st=-1;function at(e){return{current:e}}function ot(e){0>st||(e.current=rt[st],rt[st]=null,st--)}function lt(e,t){st++,rt[st]=e.current,e.current=t}var ct={},ut=at(ct),ht=at(!1),dt=ct;function ft(e,t){var n=e.type.contextTypes;if(!n)return ct;var i=e.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===t)return i.__reactInternalMemoizedMaskedChildContext;var r,s={};for(r in n)s[r]=t[r];return i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=s),s}function pt(e){return null!==(e=e.childContextTypes)&&void 0!==e}function mt(){ot(ht),ot(ut)}function gt(e,t,n){if(ut.current!==ct)throw Error(a(168));lt(ut,t),lt(ht,n)}function vt(e,t,n){var i=e.stateNode;if(t=t.childContextTypes,"function"!==typeof i.getChildContext)return n;for(var r in i=i.getChildContext())if(!(r in t))throw Error(a(108,T(e)||"Unknown",r));return s({},n,i)}function yt(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||ct,dt=ut.current,lt(ut,e),lt(ht,ht.current),!0}function bt(e,t,n){var i=e.stateNode;if(!i)throw Error(a(169));n?(e=vt(e,t,dt),i.__reactInternalMemoizedMergedChildContext=e,ot(ht),ot(ut),lt(ut,e)):ot(ht),lt(ht,n)}var xt=Math.clz32?Math.clz32:function(e){return 0===(e>>>=0)?32:31-(_t(e)/St|0)|0},_t=Math.log,St=Math.LN2;var Et=64,Tt=4194304;function wt(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function At(e,t){var n=e.pendingLanes;if(0===n)return 0;var i=0,r=e.suspendedLanes,s=e.pingedLanes,a=268435455&n;if(0!==a){var o=a&~r;0!==o?i=wt(o):0!==(s&=a)&&(i=wt(s))}else 0!==(a=n&~r)?i=wt(a):0!==s&&(i=wt(s));if(0===i)return 0;if(0!==t&&t!==i&&0===(t&r)&&((r=i&-i)>=(s=t&-t)||16===r&&0!==(4194240&s)))return t;if(0!==(4&i)&&(i|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=i;0<t;)r=1<<(n=31-xt(t)),i|=e[n],t&=~r;return i}function Mt(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function Rt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function Ct(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function Lt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-xt(t)]=n}function It(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var i=31-xt(n),r=1<<i;r&t|e[i]&t&&(e[i]|=t),n&=~r}}var Pt=0;function kt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var Dt=r.unstable_scheduleCallback,Nt=r.unstable_cancelCallback,Ot=r.unstable_shouldYield,Ft=r.unstable_requestPaint,Ut=r.unstable_now,Bt=r.unstable_ImmediatePriority,zt=r.unstable_UserBlockingPriority,jt=r.unstable_NormalPriority,Gt=r.unstable_IdlePriority,Vt=null,Ht=null;var Wt="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t},Yt=null,Xt=!1,qt=!1;function Kt(e){null===Yt?Yt=[e]:Yt.push(e)}function Zt(){if(!qt&&null!==Yt){qt=!0;var e=0,t=Pt;try{var n=Yt;for(Pt=1;e<n.length;e++){var i=n[e];do{i=i(!0)}while(null!==i)}Yt=null,Xt=!1}catch(r){throw null!==Yt&&(Yt=Yt.slice(e+1)),Dt(Bt,Zt),r}finally{Pt=t,qt=!1}}return null}var Jt=o.ReactCurrentBatchConfig;function Qt(e,t){if(Wt(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!it.call(t,r)||!Wt(e[r],t[r]))return!1}return!0}function $t(e){switch(e.tag){case 5:return et(e.type);case 16:return et("Lazy");case 13:return et("Suspense");case 19:return et("SuspenseList");case 0:case 2:case 15:return e=nt(e.type,!1);case 11:return e=nt(e.type.render,!1);case 1:return e=nt(e.type,!0);default:return""}}function en(e,t){if(e&&e.defaultProps){for(var n in t=s({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}var tn=at(null),nn=null,rn=null,sn=null;function an(){sn=rn=nn=null}function on(e,t,n){X?(lt(tn,t._currentValue),t._currentValue=n):(lt(tn,t._currentValue2),t._currentValue2=n)}function ln(e){var t=tn.current;ot(tn),X?e._currentValue=t:e._currentValue2=t}function cn(e,t,n){for(;null!==e;){var i=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==i&&(i.childLanes|=t)):null!==i&&(i.childLanes&t)!==t&&(i.childLanes|=t),e===n)break;e=e.return}}function un(e,t){nn=e,sn=rn=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(Or=!0),e.firstContext=null)}function hn(e){var t=X?e._currentValue:e._currentValue2;if(sn!==e)if(e={context:e,memoizedValue:t,next:null},null===rn){if(null===nn)throw Error(a(308));rn=e,nn.dependencies={lanes:0,firstContext:e}}else rn=rn.next=e;return t}var dn=null,fn=!1;function pn(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function mn(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function gn(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function vn(e,t){var n=e.updateQueue;null!==n&&(n=n.shared,null!==qs&&0!==(1&e.mode)&&0===(2&Xs)?(null===(e=n.interleaved)?(t.next=t,null===dn?dn=[n]:dn.push(n)):(t.next=e.next,e.next=t),n.interleaved=t):(null===(e=n.pending)?t.next=t:(t.next=e.next,e.next=t),n.pending=t))}function yn(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,It(e,n)}}function bn(e,t){var n=e.updateQueue,i=e.alternate;if(null!==i&&n===(i=i.updateQueue)){var r=null,s=null;if(null!==(n=n.firstBaseUpdate)){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===s?r=s=a:s=s.next=a,n=n.next}while(null!==n);null===s?r=s=t:s=s.next=t}else r=s=t;return n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:s,shared:i.shared,effects:i.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function xn(e,t,n,i){var r=e.updateQueue;fn=!1;var a=r.firstBaseUpdate,o=r.lastBaseUpdate,l=r.shared.pending;if(null!==l){r.shared.pending=null;var c=l,u=c.next;c.next=null,null===o?a=u:o.next=u,o=c;var h=e.alternate;null!==h&&((l=(h=h.updateQueue).lastBaseUpdate)!==o&&(null===l?h.firstBaseUpdate=u:l.next=u,h.lastBaseUpdate=c))}if(null!==a){var d=r.baseState;for(o=0,h=u=c=null,l=a;;){var f=l.lane,p=l.eventTime;if((i&f)===f){null!==h&&(h=h.next={eventTime:p,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var m=e,g=l;switch(f=t,p=n,g.tag){case 1:if("function"===typeof(m=g.payload)){d=m.call(p,d,f);break e}d=m;break e;case 3:m.flags=-65537&m.flags|128;case 0:if(null===(f="function"===typeof(m=g.payload)?m.call(p,d,f):m)||void 0===f)break e;d=s({},d,f);break e;case 2:fn=!0}}null!==l.callback&&0!==l.lane&&(e.flags|=64,null===(f=r.effects)?r.effects=[l]:f.push(l))}else p={eventTime:p,lane:f,tag:l.tag,payload:l.payload,callback:l.callback,next:null},null===h?(u=h=p,c=d):h=h.next=p,o|=f;if(null===(l=l.next)){if(null===(l=r.shared.pending))break;l=(f=l).next,f.next=null,r.lastBaseUpdate=f,r.shared.pending=null}}if(null===h&&(c=d),r.baseState=c,r.firstBaseUpdate=u,r.lastBaseUpdate=h,null!==(t=r.shared.interleaved)){r=t;do{o|=r.lane,r=r.next}while(r!==t)}else null===a&&(r.shared.lanes=0);ta|=o,e.lanes=o,e.memoizedState=d}}function _n(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var i=e[t],r=i.callback;if(null!==r){if(i.callback=null,i=n,"function"!==typeof r)throw Error(a(191,r));r.call(i)}}}var Sn=(new i.Component).refs;function En(e,t,n,i){n=null===(n=n(i,t=e.memoizedState))||void 0===n?t:s({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var Tn={isMounted:function(e){return!!(e=e._reactInternals)&&w(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var i=xa(),r=_a(e),s=gn(i,r);s.payload=t,void 0!==n&&null!==n&&(s.callback=n),vn(e,s),null!==(t=Sa(e,r,i))&&yn(t,e,r)},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var i=xa(),r=_a(e),s=gn(i,r);s.tag=1,s.payload=t,void 0!==n&&null!==n&&(s.callback=n),vn(e,s),null!==(t=Sa(e,r,i))&&yn(t,e,r)},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=xa(),i=_a(e),r=gn(n,i);r.tag=2,void 0!==t&&null!==t&&(r.callback=t),vn(e,r),null!==(t=Sa(e,i,n))&&yn(t,e,i)}};function wn(e,t,n,i,r,s,a){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(i,s,a):!t.prototype||!t.prototype.isPureReactComponent||(!Qt(n,i)||!Qt(r,s))}function An(e,t,n){var i=!1,r=ct,s=t.contextType;return"object"===typeof s&&null!==s?s=hn(s):(r=pt(t)?dt:ut.current,s=(i=null!==(i=t.contextTypes)&&void 0!==i)?ft(e,r):ct),t=new t(n,s),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=Tn,e.stateNode=t,t._reactInternals=e,i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=r,e.__reactInternalMemoizedMaskedChildContext=s),t}function Mn(e,t,n,i){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,i),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,i),t.state!==e&&Tn.enqueueReplaceState(t,t.state,null)}function Rn(e,t,n,i){var r=e.stateNode;r.props=n,r.state=e.memoizedState,r.refs=Sn,pn(e);var s=t.contextType;"object"===typeof s&&null!==s?r.context=hn(s):(s=pt(t)?dt:ut.current,r.context=ft(e,s)),r.state=e.memoizedState,"function"===typeof(s=t.getDerivedStateFromProps)&&(En(e,t,s,n),r.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof r.getSnapshotBeforeUpdate||"function"!==typeof r.UNSAFE_componentWillMount&&"function"!==typeof r.componentWillMount||(t=r.state,"function"===typeof r.componentWillMount&&r.componentWillMount(),"function"===typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount(),t!==r.state&&Tn.enqueueReplaceState(r,r.state,null),xn(e,n,r,i),r.state=e.memoizedState),"function"===typeof r.componentDidMount&&(e.flags|=4194308)}var Cn=[],Ln=0,In=null,Pn=0,kn=[],Dn=0,Nn=null,On=1,Fn="";function Un(e,t){Cn[Ln++]=Pn,Cn[Ln++]=In,In=e,Pn=t}function Bn(e,t,n){kn[Dn++]=On,kn[Dn++]=Fn,kn[Dn++]=Nn,Nn=e;var i=On;e=Fn;var r=32-xt(i)-1;i&=~(1<<r),n+=1;var s=32-xt(t)+r;if(30<s){var a=r-r%5;s=(i&(1<<a)-1).toString(32),i>>=a,r-=a,On=1<<32-xt(t)+r|n<<r|i,Fn=s+e}else On=1<<s|n<<r|i,Fn=e}function zn(e){null!==e.return&&(Un(e,1),Bn(e,1,0))}function jn(e){for(;e===In;)In=Cn[--Ln],Cn[Ln]=null,Pn=Cn[--Ln],Cn[Ln]=null;for(;e===Nn;)Nn=kn[--Dn],kn[Dn]=null,Fn=kn[--Dn],kn[Dn]=null,On=kn[--Dn],kn[Dn]=null}var Gn=null,Vn=null,Hn=!1,Wn=!1,Yn=null;function Xn(e,t){var n=Ja(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function qn(e,t){switch(e.tag){case 5:return null!==(t=ke(t,e.type,e.pendingProps))&&(e.stateNode=t,Gn=e,Vn=ze(t),!0);case 6:return null!==(t=De(t,e.pendingProps))&&(e.stateNode=t,Gn=e,Vn=null,!0);case 13:if(null!==(t=Ne(t))){var n=null!==Nn?{id:On,overflow:Fn}:null;return e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Ja(18,null,null,0)).stateNode=t,n.return=e,e.child=n,Gn=e,Vn=null,!0}return!1;default:return!1}}function Kn(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function Zn(e){if(Hn){var t=Vn;if(t){var n=t;if(!qn(e,t)){if(Kn(e))throw Error(a(418));t=Be(n);var i=Gn;t&&qn(e,t)?Xn(i,n):(e.flags=-4097&e.flags|2,Hn=!1,Gn=e)}}else{if(Kn(e))throw Error(a(418));e.flags=-4097&e.flags|2,Hn=!1,Gn=e}}}function Jn(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;Gn=e}function Qn(e){if(!Z||e!==Gn)return!1;if(!Hn)return Jn(e),Hn=!0,!1;if(3!==e.tag&&(5!==e.tag||Je(e.type)&&!G(e.type,e.memoizedProps))){var t=Vn;if(t){if(Kn(e)){for(e=Vn;e;)e=Be(e);throw Error(a(418))}for(;t;)Xn(e,t),t=Be(t)}}if(Jn(e),13===e.tag){if(!Z)throw Error(a(316));if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(a(317));Vn=Ye(e)}else Vn=Gn?Be(e.stateNode):null;return!0}function $n(){Z&&(Vn=Gn=null,Wn=Hn=!1)}function ei(e){null===Yn?Yn=[e]:Yn.push(e)}function ti(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(a(309));var i=n.stateNode}if(!i)throw Error(a(147,e));var r=i,s=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===s?t.ref:(t=function(e){var t=r.refs;t===Sn&&(t=r.refs={}),null===e?delete t[s]:t[s]=e},t._stringRef=s,t)}if("string"!==typeof e)throw Error(a(284));if(!n._owner)throw Error(a(290,e))}return e}function ni(e,t){throw e=Object.prototype.toString.call(t),Error(a(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function ii(e){return(0,e._init)(e._payload)}function ri(e){function t(t,n){if(e){var i=t.deletions;null===i?(t.deletions=[n],t.flags|=16):i.push(n)}}function n(n,i){if(!e)return null;for(;null!==i;)t(n,i),i=i.sibling;return null}function i(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function r(e,t){return(e=$a(e,t)).index=0,e.sibling=null,e}function s(t,n,i){return t.index=i,e?null!==(i=t.alternate)?(i=i.index)<n?(t.flags|=2,n):i:(t.flags|=2,n):(t.flags|=1048576,n)}function o(t){return e&&null===t.alternate&&(t.flags|=2),t}function h(e,t,n,i){return null===t||6!==t.tag?((t=io(n,e.mode,i)).return=e,t):((t=r(t,n)).return=e,t)}function d(e,t,n,i){var s=n.type;return s===u?p(e,t,n.props.children,i,n.key):null!==t&&(t.elementType===s||"object"===typeof s&&null!==s&&s.$$typeof===b&&ii(s)===t.type)?((i=r(t,n.props)).ref=ti(e,t,n),i.return=e,i):((i=eo(n.type,n.key,n.props,null,e.mode,i)).ref=ti(e,t,n),i.return=e,i)}function f(e,t,n,i){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=ro(n,e.mode,i)).return=e,t):((t=r(t,n.children||[])).return=e,t)}function p(e,t,n,i,s){return null===t||7!==t.tag?((t=to(n,e.mode,i,s)).return=e,t):((t=r(t,n)).return=e,t)}function m(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=io(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case l:return(n=eo(t.type,t.key,t.props,null,e.mode,n)).ref=ti(e,null,t),n.return=e,n;case c:return(t=ro(t,e.mode,n)).return=e,t;case b:return m(e,(0,t._init)(t._payload),n)}if(P(t)||S(t))return(t=to(t,e.mode,n,null)).return=e,t;ni(e,t)}return null}function g(e,t,n,i){var r=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==r?null:h(e,t,""+n,i);if("object"===typeof n&&null!==n){switch(n.$$typeof){case l:return n.key===r?d(e,t,n,i):null;case c:return n.key===r?f(e,t,n,i):null;case b:return g(e,t,(r=n._init)(n._payload),i)}if(P(n)||S(n))return null!==r?null:p(e,t,n,i,null);ni(e,n)}return null}function v(e,t,n,i,r){if("string"===typeof i&&""!==i||"number"===typeof i)return h(t,e=e.get(n)||null,""+i,r);if("object"===typeof i&&null!==i){switch(i.$$typeof){case l:return d(t,e=e.get(null===i.key?n:i.key)||null,i,r);case c:return f(t,e=e.get(null===i.key?n:i.key)||null,i,r);case b:return v(e,t,n,(0,i._init)(i._payload),r)}if(P(i)||S(i))return p(t,e=e.get(n)||null,i,r,null);ni(t,i)}return null}function y(r,a,o,l){for(var c=null,u=null,h=a,d=a=0,f=null;null!==h&&d<o.length;d++){h.index>d?(f=h,h=null):f=h.sibling;var p=g(r,h,o[d],l);if(null===p){null===h&&(h=f);break}e&&h&&null===p.alternate&&t(r,h),a=s(p,a,d),null===u?c=p:u.sibling=p,u=p,h=f}if(d===o.length)return n(r,h),Hn&&Un(r,d),c;if(null===h){for(;d<o.length;d++)null!==(h=m(r,o[d],l))&&(a=s(h,a,d),null===u?c=h:u.sibling=h,u=h);return Hn&&Un(r,d),c}for(h=i(r,h);d<o.length;d++)null!==(f=v(h,r,d,o[d],l))&&(e&&null!==f.alternate&&h.delete(null===f.key?d:f.key),a=s(f,a,d),null===u?c=f:u.sibling=f,u=f);return e&&h.forEach(function(e){return t(r,e)}),Hn&&Un(r,d),c}function x(r,o,l,c){var u=S(l);if("function"!==typeof u)throw Error(a(150));if(null==(l=u.call(l)))throw Error(a(151));for(var h=u=null,d=o,f=o=0,p=null,y=l.next();null!==d&&!y.done;f++,y=l.next()){d.index>f?(p=d,d=null):p=d.sibling;var b=g(r,d,y.value,c);if(null===b){null===d&&(d=p);break}e&&d&&null===b.alternate&&t(r,d),o=s(b,o,f),null===h?u=b:h.sibling=b,h=b,d=p}if(y.done)return n(r,d),Hn&&Un(r,f),u;if(null===d){for(;!y.done;f++,y=l.next())null!==(y=m(r,y.value,c))&&(o=s(y,o,f),null===h?u=y:h.sibling=y,h=y);return Hn&&Un(r,f),u}for(d=i(r,d);!y.done;f++,y=l.next())null!==(y=v(d,r,f,y.value,c))&&(e&&null!==y.alternate&&d.delete(null===y.key?f:y.key),o=s(y,o,f),null===h?u=y:h.sibling=y,h=y);return e&&d.forEach(function(e){return t(r,e)}),Hn&&Un(r,f),u}return function e(i,s,a,h){if("object"===typeof a&&null!==a&&a.type===u&&null===a.key&&(a=a.props.children),"object"===typeof a&&null!==a){switch(a.$$typeof){case l:e:{for(var d=a.key,f=s;null!==f;){if(f.key===d){if((d=a.type)===u){if(7===f.tag){n(i,f.sibling),(s=r(f,a.props.children)).return=i,i=s;break e}}else if(f.elementType===d||"object"===typeof d&&null!==d&&d.$$typeof===b&&ii(d)===f.type){n(i,f.sibling),(s=r(f,a.props)).ref=ti(i,f,a),s.return=i,i=s;break e}n(i,f);break}t(i,f),f=f.sibling}a.type===u?((s=to(a.props.children,i.mode,h,a.key)).return=i,i=s):((h=eo(a.type,a.key,a.props,null,i.mode,h)).ref=ti(i,s,a),h.return=i,i=h)}return o(i);case c:e:{for(f=a.key;null!==s;){if(s.key===f){if(4===s.tag&&s.stateNode.containerInfo===a.containerInfo&&s.stateNode.implementation===a.implementation){n(i,s.sibling),(s=r(s,a.children||[])).return=i,i=s;break e}n(i,s);break}t(i,s),s=s.sibling}(s=ro(a,i.mode,h)).return=i,i=s}return o(i);case b:return e(i,s,(f=a._init)(a._payload),h)}if(P(a))return y(i,s,a,h);if(S(a))return x(i,s,a,h);ni(i,a)}return"string"===typeof a&&""!==a||"number"===typeof a?(a=""+a,null!==s&&6===s.tag?(n(i,s.sibling),(s=r(s,a)).return=i,i=s):(n(i,s),(s=io(a,i.mode,h)).return=i,i=s),o(i)):n(i,s)}}var si=ri(!0),ai=ri(!1),oi={},li=at(oi),ci=at(oi),ui=at(oi);function hi(e){if(e===oi)throw Error(a(174));return e}function di(e,t){lt(ui,t),lt(ci,e),lt(li,oi),e=D(t),ot(li),lt(li,e)}function fi(){ot(li),ot(ci),ot(ui)}function pi(e){var t=hi(ui.current),n=hi(li.current);n!==(t=N(n,e.type,t))&&(lt(ci,e),lt(li,t))}function mi(e){ci.current===e&&(ot(li),ot(ci))}var gi=at(0);function vi(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||Oe(n)||Fe(n)))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var yi=[];function bi(){for(var e=0;e<yi.length;e++){var t=yi[e];X?t._workInProgressVersionPrimary=null:t._workInProgressVersionSecondary=null}yi.length=0}var xi=o.ReactCurrentDispatcher,_i=o.ReactCurrentBatchConfig,Si=0,Ei=null,Ti=null,wi=null,Ai=!1,Mi=!1,Ri=0,Ci=0;function Li(){throw Error(a(321))}function Ii(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!Wt(e[n],t[n]))return!1;return!0}function Pi(e,t,n,i,r,s){if(Si=s,Ei=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,xi.current=null===e||null===e.memoizedState?pr:mr,e=n(i,r),Mi){s=0;do{if(Mi=!1,Ri=0,25<=s)throw Error(a(301));s+=1,wi=Ti=null,t.updateQueue=null,xi.current=gr,e=n(i,r)}while(Mi)}if(xi.current=fr,t=null!==Ti&&null!==Ti.next,Si=0,wi=Ti=Ei=null,Ai=!1,t)throw Error(a(300));return e}function ki(){var e=0!==Ri;return Ri=0,e}function Di(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===wi?Ei.memoizedState=wi=e:wi=wi.next=e,wi}function Ni(){if(null===Ti){var e=Ei.alternate;e=null!==e?e.memoizedState:null}else e=Ti.next;var t=null===wi?Ei.memoizedState:wi.next;if(null!==t)wi=t,Ti=e;else{if(null===e)throw Error(a(310));e={memoizedState:(Ti=e).memoizedState,baseState:Ti.baseState,baseQueue:Ti.baseQueue,queue:Ti.queue,next:null},null===wi?Ei.memoizedState=wi=e:wi=wi.next=e}return wi}function Oi(e,t){return"function"===typeof t?t(e):t}function Fi(e){var t=Ni(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var i=Ti,r=i.baseQueue,s=n.pending;if(null!==s){if(null!==r){var o=r.next;r.next=s.next,s.next=o}i.baseQueue=r=s,n.pending=null}if(null!==r){s=r.next,i=i.baseState;var l=o=null,c=null,u=s;do{var h=u.lane;if((Si&h)===h)null!==c&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),i=u.hasEagerState?u.eagerState:e(i,u.action);else{var d={lane:h,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===c?(l=c=d,o=i):c=c.next=d,Ei.lanes|=h,ta|=h}u=u.next}while(null!==u&&u!==s);null===c?o=i:c.next=l,Wt(i,t.memoizedState)||(Or=!0),t.memoizedState=i,t.baseState=o,t.baseQueue=c,n.lastRenderedState=i}if(null!==(e=n.interleaved)){r=e;do{s=r.lane,Ei.lanes|=s,ta|=s,r=r.next}while(r!==e)}else null===r&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Ui(e){var t=Ni(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var i=n.dispatch,r=n.pending,s=t.memoizedState;if(null!==r){n.pending=null;var o=r=r.next;do{s=e(s,o.action),o=o.next}while(o!==r);Wt(s,t.memoizedState)||(Or=!0),t.memoizedState=s,null===t.baseQueue&&(t.baseState=s),n.lastRenderedState=s}return[s,i]}function Bi(){}function zi(e,t){var n=Ei,i=Ni(),r=t(),s=!Wt(i.memoizedState,r);if(s&&(i.memoizedState=r,Or=!0),i=i.queue,Ji(Vi.bind(null,n,i,e),[e]),i.getSnapshot!==t||s||null!==wi&&1&wi.memoizedState.tag){if(n.flags|=2048,Yi(9,Gi.bind(null,n,i,r,t),void 0,null),null===qs)throw Error(a(349));0!==(30&Si)||ji(n,t,r)}return r}function ji(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=Ei.updateQueue)?(t={lastEffect:null,stores:null},Ei.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Gi(e,t,n,i){t.value=n,t.getSnapshot=i,Hi(t)&&Sa(e,1,-1)}function Vi(e,t,n){return n(function(){Hi(t)&&Sa(e,1,-1)})}function Hi(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!Wt(e,n)}catch(i){return!0}}function Wi(e){var t=Di();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Oi,lastRenderedState:e},t.queue=e,e=e.dispatch=lr.bind(null,Ei,e),[t.memoizedState,e]}function Yi(e,t,n,i){return e={tag:e,create:t,destroy:n,deps:i,next:null},null===(t=Ei.updateQueue)?(t={lastEffect:null,stores:null},Ei.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(i=n.next,n.next=e,e.next=i,t.lastEffect=e),e}function Xi(){return Ni().memoizedState}function qi(e,t,n,i){var r=Di();Ei.flags|=e,r.memoizedState=Yi(1|t,n,void 0,void 0===i?null:i)}function Ki(e,t,n,i){var r=Ni();i=void 0===i?null:i;var s=void 0;if(null!==Ti){var a=Ti.memoizedState;if(s=a.destroy,null!==i&&Ii(i,a.deps))return void(r.memoizedState=Yi(t,n,s,i))}Ei.flags|=e,r.memoizedState=Yi(1|t,n,s,i)}function Zi(e,t){return qi(8390656,8,e,t)}function Ji(e,t){return Ki(2048,8,e,t)}function Qi(e,t){return Ki(4,2,e,t)}function $i(e,t){return Ki(4,4,e,t)}function er(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function tr(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Ki(4,4,er.bind(null,t,e),n)}function nr(){}function ir(e,t){var n=Ni();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&Ii(t,i[1])?i[0]:(n.memoizedState=[e,t],e)}function rr(e,t){var n=Ni();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&Ii(t,i[1])?i[0]:(e=e(),n.memoizedState=[e,t],e)}function sr(e,t){var n=Pt;Pt=0!==n&&4>n?n:4,e(!0);var i=_i.transition;_i.transition={};try{e(!1),t()}finally{Pt=n,_i.transition=i}}function ar(){return Ni().memoizedState}function or(e,t,n){var i=_a(e);n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},cr(e)?ur(t,n):(hr(e,t,n),null!==(e=Sa(e,i,n=xa()))&&dr(e,t,i))}function lr(e,t,n){var i=_a(e),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(cr(e))ur(t,r);else{hr(e,t,r);var s=e.alternate;if(0===e.lanes&&(null===s||0===s.lanes)&&null!==(s=t.lastRenderedReducer))try{var a=t.lastRenderedState,o=s(a,n);if(r.hasEagerState=!0,r.eagerState=o,Wt(o,a))return}catch(l){}null!==(e=Sa(e,i,n=xa()))&&dr(e,t,i)}}function cr(e){var t=e.alternate;return e===Ei||null!==t&&t===Ei}function ur(e,t){Mi=Ai=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function hr(e,t,n){null!==qs&&0!==(1&e.mode)&&0===(2&Xs)?(null===(e=t.interleaved)?(n.next=n,null===dn?dn=[t]:dn.push(t)):(n.next=e.next,e.next=n),t.interleaved=n):(null===(e=t.pending)?n.next=n:(n.next=e.next,e.next=n),t.pending=n)}function dr(e,t,n){if(0!==(4194240&n)){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,It(e,n)}}var fr={readContext:hn,useCallback:Li,useContext:Li,useEffect:Li,useImperativeHandle:Li,useInsertionEffect:Li,useLayoutEffect:Li,useMemo:Li,useReducer:Li,useRef:Li,useState:Li,useDebugValue:Li,useDeferredValue:Li,useTransition:Li,useMutableSource:Li,useSyncExternalStore:Li,useId:Li,unstable_isNewReconciler:!1},pr={readContext:hn,useCallback:function(e,t){return Di().memoizedState=[e,void 0===t?null:t],e},useContext:hn,useEffect:Zi,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,qi(4194308,4,er.bind(null,t,e),n)},useLayoutEffect:function(e,t){return qi(4194308,4,e,t)},useInsertionEffect:function(e,t){return qi(4,2,e,t)},useMemo:function(e,t){var n=Di();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var i=Di();return t=void 0!==n?n(t):t,i.memoizedState=i.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},i.queue=e,e=e.dispatch=or.bind(null,Ei,e),[i.memoizedState,e]},useRef:function(e){return e={current:e},Di().memoizedState=e},useState:Wi,useDebugValue:nr,useDeferredValue:function(e){var t=Wi(e),n=t[0],i=t[1];return Zi(function(){var t=_i.transition;_i.transition={};try{i(e)}finally{_i.transition=t}},[e]),n},useTransition:function(){var e=Wi(!1),t=e[0];return e=sr.bind(null,e[1]),Di().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var i=Ei,r=Di();if(Hn){if(void 0===n)throw Error(a(407));n=n()}else{if(n=t(),null===qs)throw Error(a(349));0!==(30&Si)||ji(i,t,n)}r.memoizedState=n;var s={value:n,getSnapshot:t};return r.queue=s,Zi(Vi.bind(null,i,s,e),[e]),i.flags|=2048,Yi(9,Gi.bind(null,i,s,n,t),void 0,null),n},useId:function(){var e=Di(),t=qs.identifierPrefix;if(Hn){var n=Fn;t=":"+t+"R"+(n=(On&~(1<<32-xt(On)-1)).toString(32)+n),0<(n=Ri++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=Ci++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},mr={readContext:hn,useCallback:ir,useContext:hn,useEffect:Ji,useImperativeHandle:tr,useInsertionEffect:Qi,useLayoutEffect:$i,useMemo:rr,useReducer:Fi,useRef:Xi,useState:function(){return Fi(Oi)},useDebugValue:nr,useDeferredValue:function(e){var t=Fi(Oi),n=t[0],i=t[1];return Ji(function(){var t=_i.transition;_i.transition={};try{i(e)}finally{_i.transition=t}},[e]),n},useTransition:function(){return[Fi(Oi)[0],Ni().memoizedState]},useMutableSource:Bi,useSyncExternalStore:zi,useId:ar,unstable_isNewReconciler:!1},gr={readContext:hn,useCallback:ir,useContext:hn,useEffect:Ji,useImperativeHandle:tr,useInsertionEffect:Qi,useLayoutEffect:$i,useMemo:rr,useReducer:Ui,useRef:Xi,useState:function(){return Ui(Oi)},useDebugValue:nr,useDeferredValue:function(e){var t=Ui(Oi),n=t[0],i=t[1];return Ji(function(){var t=_i.transition;_i.transition={};try{i(e)}finally{_i.transition=t}},[e]),n},useTransition:function(){return[Ui(Oi)[0],Ni().memoizedState]},useMutableSource:Bi,useSyncExternalStore:zi,useId:ar,unstable_isNewReconciler:!1};function vr(e,t){try{var n="",i=t;do{n+=$t(i),i=i.return}while(i);var r=n}catch(s){r="\nError generating stack: "+s.message+"\n"+s.stack}return{value:e,source:t,stack:r}}function yr(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var br,xr,_r,Sr,Er="function"===typeof WeakMap?WeakMap:Map;function Tr(e,t,n){(n=gn(-1,n)).tag=3,n.payload={element:null};var i=t.value;return n.callback=function(){ua||(ua=!0,ha=i),yr(0,t)},n}function wr(e,t,n){(n=gn(-1,n)).tag=3;var i=e.type.getDerivedStateFromError;if("function"===typeof i){var r=t.value;n.payload=function(){return i(r)},n.callback=function(){yr(0,t)}}var s=e.stateNode;return null!==s&&"function"===typeof s.componentDidCatch&&(n.callback=function(){yr(0,t),"function"!==typeof i&&(null===da?da=new Set([this]):da.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function Ar(e,t,n){var i=e.pingCache;if(null===i){i=e.pingCache=new Er;var r=new Set;i.set(t,r)}else void 0===(r=i.get(t))&&(r=new Set,i.set(t,r));r.has(n)||(r.add(n),e=Wa.bind(null,e,t,n),t.then(e,e))}function Mr(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function Rr(e,t,n,i,r){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=gn(-1,1)).tag=2,vn(n,t))),n.lanes|=1),e):(e.flags|=65536,e.lanes=r,e)}function Cr(e){e.flags|=4}function Lr(e,t){if(null!==e&&e.child===t.child)return!0;if(0!==(16&t.flags))return!1;for(e=t.child;null!==e;){if(0!==(12854&e.flags)||0!==(12854&e.subtreeFlags))return!1;e=e.sibling}return!0}if(q)br=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)B(e,n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},xr=function(){},_r=function(e,t,n,i,r){if((e=e.memoizedProps)!==i){var s=t.stateNode,a=hi(li.current);n=j(s,n,e,i,r,a),(t.updateQueue=n)&&Cr(t)}},Sr=function(e,t,n,i){n!==i&&Cr(t)};else if(K){br=function(e,t,n,i){for(var r=t.child;null!==r;){if(5===r.tag){var s=r.stateNode;n&&i&&(s=Ie(s,r.type,r.memoizedProps,r)),B(e,s)}else if(6===r.tag)s=r.stateNode,n&&i&&(s=Pe(s,r.memoizedProps,r)),B(e,s);else if(4!==r.tag)if(22===r.tag&&null!==r.memoizedState)null!==(s=r.child)&&(s.return=r),br(e,r,!0,!0);else if(null!==r.child){r.child.return=r,r=r.child;continue}if(r===t)break;for(;null===r.sibling;){if(null===r.return||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};var Ir=function(e,t,n,i){for(var r=t.child;null!==r;){if(5===r.tag){var s=r.stateNode;n&&i&&(s=Ie(s,r.type,r.memoizedProps,r)),Re(e,s)}else if(6===r.tag)s=r.stateNode,n&&i&&(s=Pe(s,r.memoizedProps,r)),Re(e,s);else if(4!==r.tag)if(22===r.tag&&null!==r.memoizedState)null!==(s=r.child)&&(s.return=r),Ir(e,r,!0,!0);else if(null!==r.child){r.child.return=r,r=r.child;continue}if(r===t)break;for(;null===r.sibling;){if(null===r.return||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};xr=function(e,t){var n=t.stateNode;if(!Lr(e,t)){e=n.containerInfo;var i=Me(e);Ir(i,t,!1,!1),n.pendingChildren=i,Cr(t),Ce(e,i)}},_r=function(e,t,n,i,r){var s=e.stateNode,a=e.memoizedProps;if((e=Lr(e,t))&&a===i)t.stateNode=s;else{var o=t.stateNode,l=hi(li.current),c=null;a!==i&&(c=j(o,n,a,i,r,l)),e&&null===c?t.stateNode=s:(s=Ae(s,c,n,a,i,t,e,o),z(s,n,i,r,l)&&Cr(t),t.stateNode=s,e?Cr(t):br(s,t,!1,!1))}},Sr=function(e,t,n,i){n!==i?(e=hi(ui.current),n=hi(li.current),t.stateNode=V(i,e,n,t),Cr(t)):t.stateNode=e.stateNode}}else xr=function(){},_r=function(){},Sr=function(){};function Pr(e,t){if(!Hn)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var i=null;null!==n;)null!==n.alternate&&(i=n),n=n.sibling;null===i?t||null===e.tail?e.tail=null:e.tail.sibling=null:i.sibling=null}}function kr(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,i=0;if(t)for(var r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=14680064&r.subtreeFlags,i|=14680064&r.flags,r.return=e,r=r.sibling;else for(r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=e,r=r.sibling;return e.subtreeFlags|=i,e.childLanes=n,t}function Dr(e,t,n){var i=t.pendingProps;switch(jn(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return kr(t),null;case 1:case 17:return pt(t.type)&&mt(),kr(t),null;case 3:return i=t.stateNode,fi(),ot(ht),ot(ut),bi(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),null!==e&&null!==e.child||(Qn(t)?Cr(t):null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==Yn&&(Ma(Yn),Yn=null))),xr(e,t),kr(t),null;case 5:mi(t),n=hi(ui.current);var r=t.type;if(null!==e&&null!=t.stateNode)_r(e,t,r,i,n),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!i){if(null===t.stateNode)throw Error(a(166));return kr(t),null}if(e=hi(li.current),Qn(t)){if(!Z)throw Error(a(175));e=Ve(t.stateNode,t.type,t.memoizedProps,n,e,t,!Wn),t.updateQueue=e,null!==e&&Cr(t)}else{var s=U(r,i,n,e,t);br(s,t,!1,!1),t.stateNode=s,z(s,r,i,n,e)&&Cr(t)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return kr(t),null;case 6:if(e&&null!=t.stateNode)Sr(e,t,e.memoizedProps,i);else{if("string"!==typeof i&&null===t.stateNode)throw Error(a(166));if(e=hi(ui.current),n=hi(li.current),Qn(t)){if(!Z)throw Error(a(176));if(e=t.stateNode,i=t.memoizedProps,(n=He(e,i,t,!Wn))&&null!==(r=Gn))switch(s=0!==(1&r.mode),r.tag){case 3:Qe(r.stateNode.containerInfo,e,i,s);break;case 5:$e(r.type,r.memoizedProps,r.stateNode,e,i,s)}n&&Cr(t)}else t.stateNode=V(i,e,n,t)}return kr(t),null;case 13:if(ot(gi),i=t.memoizedState,Hn&&null!==Vn&&0!==(1&t.mode)&&0===(128&t.flags)){for(e=Vn;e;)e=Be(e);return $n(),t.flags|=98560,t}if(null!==i&&null!==i.dehydrated){if(i=Qn(t),null===e){if(!i)throw Error(a(318));if(!Z)throw Error(a(344));if(!(e=null!==(e=t.memoizedState)?e.dehydrated:null))throw Error(a(317));We(e,t)}else $n(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;return kr(t),null}return null!==Yn&&(Ma(Yn),Yn=null),0!==(128&t.flags)?(t.lanes=n,t):(i=null!==i,n=!1,null===e?Qn(t):n=null!==e.memoizedState,i&&!n&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&gi.current)?0===$s&&($s=3):Na())),null!==t.updateQueue&&(t.flags|=4),kr(t),null);case 4:return fi(),xr(e,t),null===e&&Q(t.stateNode.containerInfo),kr(t),null;case 10:return ln(t.type._context),kr(t),null;case 19:if(ot(gi),null===(r=t.memoizedState))return kr(t),null;if(i=0!==(128&t.flags),null===(s=r.rendering))if(i)Pr(r,!1);else{if(0!==$s||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(s=vi(e))){for(t.flags|=128,Pr(r,!1),null!==(e=s.updateQueue)&&(t.updateQueue=e,t.flags|=4),t.subtreeFlags=0,e=n,i=t.child;null!==i;)r=e,(n=i).flags&=14680066,null===(s=n.alternate)?(n.childLanes=0,n.lanes=r,n.child=null,n.subtreeFlags=0,n.memoizedProps=null,n.memoizedState=null,n.updateQueue=null,n.dependencies=null,n.stateNode=null):(n.childLanes=s.childLanes,n.lanes=s.lanes,n.child=s.child,n.subtreeFlags=0,n.deletions=null,n.memoizedProps=s.memoizedProps,n.memoizedState=s.memoizedState,n.updateQueue=s.updateQueue,n.type=s.type,r=s.dependencies,n.dependencies=null===r?null:{lanes:r.lanes,firstContext:r.firstContext}),i=i.sibling;return lt(gi,1&gi.current|2),t.child}e=e.sibling}null!==r.tail&&Ut()>oa&&(t.flags|=128,i=!0,Pr(r,!1),t.lanes=4194304)}else{if(!i)if(null!==(e=vi(s))){if(t.flags|=128,i=!0,null!==(e=e.updateQueue)&&(t.updateQueue=e,t.flags|=4),Pr(r,!0),null===r.tail&&"hidden"===r.tailMode&&!s.alternate&&!Hn)return kr(t),null}else 2*Ut()-r.renderingStartTime>oa&&1073741824!==n&&(t.flags|=128,i=!0,Pr(r,!1),t.lanes=4194304);r.isBackwards?(s.sibling=t.child,t.child=s):(null!==(e=r.last)?e.sibling=s:t.child=s,r.last=s)}return null!==r.tail?(t=r.tail,r.rendering=t,r.tail=t.sibling,r.renderingStartTime=Ut(),t.sibling=null,e=gi.current,lt(gi,i?1&e|2:1&e),t):(kr(t),null);case 22:case 23:return Ia(),i=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==i&&(t.flags|=8192),i&&0!==(1&t.mode)?0!==(1073741824&Js)&&(kr(t),q&&6&t.subtreeFlags&&(t.flags|=8192)):kr(t),null;case 24:case 25:return null}throw Error(a(156,t.tag))}var Nr=o.ReactCurrentOwner,Or=!1;function Fr(e,t,n,i){t.child=null===e?ai(t,null,n,i):si(t,e.child,n,i)}function Ur(e,t,n,i,r){n=n.render;var s=t.ref;return un(t,r),i=Pi(e,t,n,i,s,r),n=ki(),null===e||Or?(Hn&&n&&zn(t),t.flags|=1,Fr(e,t,i,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,rs(e,t,r))}function Br(e,t,n,i,r){if(null===e){var s=n.type;return"function"!==typeof s||Qa(s)||void 0!==s.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=eo(n.type,null,i,t,t.mode,r)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=s,zr(e,t,s,i,r))}if(s=e.child,0===(e.lanes&r)){var a=s.memoizedProps;if((n=null!==(n=n.compare)?n:Qt)(a,i)&&e.ref===t.ref)return rs(e,t,r)}return t.flags|=1,(e=$a(s,i)).ref=t.ref,e.return=t,t.child=e}function zr(e,t,n,i,r){if(null!==e&&Qt(e.memoizedProps,i)&&e.ref===t.ref){if(Or=!1,0===(e.lanes&r))return t.lanes=e.lanes,rs(e,t,r);0!==(131072&e.flags)&&(Or=!0)}return Vr(e,t,n,i,r)}function jr(e,t,n){var i=t.pendingProps,r=i.children,s=null!==e?e.memoizedState:null;if("hidden"===i.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null},lt(Qs,Js),Js|=n;else{if(0===(1073741824&n))return e=null!==s?s.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null},t.updateQueue=null,lt(Qs,Js),Js|=e,null;t.memoizedState={baseLanes:0,cachePool:null},i=null!==s?s.baseLanes:n,lt(Qs,Js),Js|=i}else null!==s?(i=s.baseLanes|n,t.memoizedState=null):i=n,lt(Qs,Js),Js|=i;return Fr(e,t,r,n),t.child}function Gr(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Vr(e,t,n,i,r){var s=pt(n)?dt:ut.current;return s=ft(t,s),un(t,r),n=Pi(e,t,n,i,s,r),i=ki(),null===e||Or?(Hn&&i&&zn(t),t.flags|=1,Fr(e,t,n,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,rs(e,t,r))}function Hr(e,t,n,i,r){if(pt(n)){var s=!0;yt(t)}else s=!1;if(un(t,r),null===t.stateNode)null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),An(t,n,i),Rn(t,n,i,r),i=!0;else if(null===e){var a=t.stateNode,o=t.memoizedProps;a.props=o;var l=a.context,c=n.contextType;"object"===typeof c&&null!==c?c=hn(c):c=ft(t,c=pt(n)?dt:ut.current);var u=n.getDerivedStateFromProps,h="function"===typeof u||"function"===typeof a.getSnapshotBeforeUpdate;h||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(o!==i||l!==c)&&Mn(t,a,i,c),fn=!1;var d=t.memoizedState;a.state=d,xn(t,i,a,r),l=t.memoizedState,o!==i||d!==l||ht.current||fn?("function"===typeof u&&(En(t,n,u,i),l=t.memoizedState),(o=fn||wn(t,n,o,i,d,l,c))?(h||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||("function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"===typeof a.componentDidMount&&(t.flags|=4194308)):("function"===typeof a.componentDidMount&&(t.flags|=4194308),t.memoizedProps=i,t.memoizedState=l),a.props=i,a.state=l,a.context=c,i=o):("function"===typeof a.componentDidMount&&(t.flags|=4194308),i=!1)}else{a=t.stateNode,mn(e,t),o=t.memoizedProps,c=t.type===t.elementType?o:en(t.type,o),a.props=c,h=t.pendingProps,d=a.context,"object"===typeof(l=n.contextType)&&null!==l?l=hn(l):l=ft(t,l=pt(n)?dt:ut.current);var f=n.getDerivedStateFromProps;(u="function"===typeof f||"function"===typeof a.getSnapshotBeforeUpdate)||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(o!==h||d!==l)&&Mn(t,a,i,l),fn=!1,d=t.memoizedState,a.state=d,xn(t,i,a,r);var p=t.memoizedState;o!==h||d!==p||ht.current||fn?("function"===typeof f&&(En(t,n,f,i),p=t.memoizedState),(c=fn||wn(t,n,c,i,d,p,l)||!1)?(u||"function"!==typeof a.UNSAFE_componentWillUpdate&&"function"!==typeof a.componentWillUpdate||("function"===typeof a.componentWillUpdate&&a.componentWillUpdate(i,p,l),"function"===typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(i,p,l)),"function"===typeof a.componentDidUpdate&&(t.flags|=4),"function"===typeof a.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof a.componentDidUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=i,t.memoizedState=p),a.props=i,a.state=p,a.context=l,i=c):("function"!==typeof a.componentDidUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),i=!1)}return Wr(e,t,n,i,s,r)}function Wr(e,t,n,i,r,s){Gr(e,t);var a=0!==(128&t.flags);if(!i&&!a)return r&&bt(t,n,!1),rs(e,t,s);i=t.stateNode,Nr.current=t;var o=a&&"function"!==typeof n.getDerivedStateFromError?null:i.render();return t.flags|=1,null!==e&&a?(t.child=si(t,e.child,null,s),t.child=si(t,null,o,s)):Fr(e,t,o,s),t.memoizedState=i.state,r&&bt(t,n,!0),t.child}function Yr(e){var t=e.stateNode;t.pendingContext?gt(0,t.pendingContext,t.pendingContext!==t.context):t.context&&gt(0,t.context,!1),di(e,t.containerInfo)}function Xr(e,t,n,i,r){return $n(),ei(r),t.flags|=256,Fr(e,t,n,i),t.child}var qr={dehydrated:null,treeContext:null,retryLane:0};function Kr(e){return{baseLanes:e,cachePool:null}}function Zr(e,t,n){var i,r=t.pendingProps,s=gi.current,o=!1,l=0!==(128&t.flags);if((i=l)||(i=(null===e||null!==e.memoizedState)&&0!==(2&s)),i?(o=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(s|=1),lt(gi,1&s),null===e)return Zn(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:Fe(e)?t.lanes=8:t.lanes=1073741824,null):(s=r.children,e=r.fallback,o?(r=t.mode,o=t.child,s={mode:"hidden",children:s},0===(1&r)&&null!==o?(o.childLanes=0,o.pendingProps=s):o=no(s,r,0,null),e=to(e,r,n,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=Kr(n),t.memoizedState=qr,e):Jr(t,s));if(null!==(s=e.memoizedState)){if(null!==(i=s.dehydrated)){if(l)return 256&t.flags?(t.flags&=-257,es(e,t,n,Error(a(422)))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(o=r.fallback,s=t.mode,r=no({mode:"visible",children:r.children},s,0,null),(o=to(o,s,n,null)).flags|=2,r.return=t,o.return=t,r.sibling=o,t.child=r,0!==(1&t.mode)&&si(t,e.child,null,n),t.child.memoizedState=Kr(n),t.memoizedState=qr,o);if(0===(1&t.mode))t=es(e,t,n,null);else if(Fe(i))t=es(e,t,n,Error(a(419)));else if(r=0!==(n&e.childLanes),Or||r){if(null!==(r=qs)){switch(n&-n){case 4:o=2;break;case 16:o=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:o=32;break;case 536870912:o=268435456;break;default:o=0}0!==(r=0!==(o&(r.suspendedLanes|n))?0:o)&&r!==s.retryLane&&(s.retryLane=r,Sa(e,r,-1))}Na(),t=es(e,t,n,Error(a(421)))}else Oe(i)?(t.flags|=128,t.child=e.child,t=Xa.bind(null,e),Ue(i,t),t=null):(n=s.treeContext,Z&&(Vn=Ge(i),Gn=t,Hn=!0,Yn=null,Wn=!1,null!==n&&(kn[Dn++]=On,kn[Dn++]=Fn,kn[Dn++]=Nn,On=n.id,Fn=n.overflow,Nn=t)),(t=Jr(t,t.pendingProps.children)).flags|=4096);return t}return o?(r=$r(e,t,r.children,r.fallback,n),o=t.child,s=e.child.memoizedState,o.memoizedState=null===s?Kr(n):{baseLanes:s.baseLanes|n,cachePool:null},o.childLanes=e.childLanes&~n,t.memoizedState=qr,r):(n=Qr(e,t,r.children,n),t.memoizedState=null,n)}return o?(r=$r(e,t,r.children,r.fallback,n),o=t.child,s=e.child.memoizedState,o.memoizedState=null===s?Kr(n):{baseLanes:s.baseLanes|n,cachePool:null},o.childLanes=e.childLanes&~n,t.memoizedState=qr,r):(n=Qr(e,t,r.children,n),t.memoizedState=null,n)}function Jr(e,t){return(t=no({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Qr(e,t,n,i){var r=e.child;return e=r.sibling,n=$a(r,{mode:"visible",children:n}),0===(1&t.mode)&&(n.lanes=i),n.return=t,n.sibling=null,null!==e&&(null===(i=t.deletions)?(t.deletions=[e],t.flags|=16):i.push(e)),t.child=n}function $r(e,t,n,i,r){var s=t.mode,a=(e=e.child).sibling,o={mode:"hidden",children:n};return 0===(1&s)&&t.child!==e?((n=t.child).childLanes=0,n.pendingProps=o,t.deletions=null):(n=$a(e,o)).subtreeFlags=14680064&e.subtreeFlags,null!==a?i=$a(a,i):(i=to(i,s,r,null)).flags|=2,i.return=t,n.return=t,n.sibling=i,t.child=n,i}function es(e,t,n,i){return null!==i&&ei(i),si(t,e.child,null,n),(e=Jr(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function ts(e,t,n){e.lanes|=t;var i=e.alternate;null!==i&&(i.lanes|=t),cn(e.return,t,n)}function ns(e,t,n,i,r){var s=e.memoizedState;null===s?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(s.isBackwards=t,s.rendering=null,s.renderingStartTime=0,s.last=i,s.tail=n,s.tailMode=r)}function is(e,t,n){var i=t.pendingProps,r=i.revealOrder,s=i.tail;if(Fr(e,t,i.children,n),0!==(2&(i=gi.current)))i=1&i|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&ts(e,n,t);else if(19===e.tag)ts(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}if(lt(gi,i),0===(1&t.mode))t.memoizedState=null;else switch(r){case"forwards":for(n=t.child,r=null;null!==n;)null!==(e=n.alternate)&&null===vi(e)&&(r=n),n=n.sibling;null===(n=r)?(r=t.child,t.child=null):(r=n.sibling,n.sibling=null),ns(t,!1,r,n,s);break;case"backwards":for(n=null,r=t.child,t.child=null;null!==r;){if(null!==(e=r.alternate)&&null===vi(e)){t.child=r;break}e=r.sibling,r.sibling=n,n=r,r=e}ns(t,!0,n,null,s);break;case"together":ns(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function rs(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),ta|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(a(153));if(null!==t.child){for(n=$a(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=$a(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function ss(e,t){switch(jn(t),t.tag){case 1:return pt(t.type)&&mt(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return fi(),ot(ht),ot(ut),bi(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return mi(t),null;case 13:if(ot(gi),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(a(340));$n()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return ot(gi),null;case 4:return fi(),null;case 10:return ln(t.type._context),null;case 22:case 23:return Ia(),null;default:return null}}var as=!1,os=!1,ls="function"===typeof WeakSet?WeakSet:Set,cs=null;function us(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(i){Ha(e,t,i)}else n.current=null}function hs(e,t,n){try{n()}catch(i){Ha(e,t,i)}}var ds=!1;function fs(e,t,n){var i=t.updateQueue;if(null!==(i=null!==i?i.lastEffect:null)){var r=i=i.next;do{if((r.tag&e)===e){var s=r.destroy;r.destroy=void 0,void 0!==s&&hs(t,n,s)}r=r.next}while(r!==i)}}function ps(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var i=n.create;n.destroy=i()}n=n.next}while(n!==t)}}function ms(e){var t=e.ref;if(null!==t){var n=e.stateNode;if(5===e.tag)e=k(n);else e=n;"function"===typeof t?t(e):t.current=e}}function gs(e,t,n){if(Ht&&"function"===typeof Ht.onCommitFiberUnmount)try{Ht.onCommitFiberUnmount(Vt,t)}catch(a){}switch(t.tag){case 0:case 11:case 14:case 15:if(null!==(e=t.updateQueue)&&null!==(e=e.lastEffect)){var i=e=e.next;do{var r=i,s=r.destroy;r=r.tag,void 0!==s&&(0!==(2&r)||0!==(4&r))&&hs(t,n,s),i=i.next}while(i!==e)}break;case 1:if(us(t,n),"function"===typeof(e=t.stateNode).componentWillUnmount)try{e.props=t.memoizedProps,e.state=t.memoizedState,e.componentWillUnmount()}catch(a){Ha(t,n,a)}break;case 5:us(t,n);break;case 4:q?Ts(e,t,n):K&&K&&(t=t.stateNode.containerInfo,n=Me(t),Le(t,n))}}function vs(e,t,n){for(var i=t;;)if(gs(e,i,n),null===i.child||q&&4===i.tag){if(i===t)break;for(;null===i.sibling;){if(null===i.return||i.return===t)return;i=i.return}i.sibling.return=i.return,i=i.sibling}else i.child.return=i,i=i.child}function ys(e){var t=e.alternate;null!==t&&(e.alternate=null,ys(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&ee(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function bs(e){return 5===e.tag||3===e.tag||4===e.tag}function xs(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||bs(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function _s(e){if(q){e:{for(var t=e.return;null!==t;){if(bs(t))break e;t=t.return}throw Error(a(160))}var n=t;switch(n.tag){case 5:t=n.stateNode,32&n.flags&&(xe(t),n.flags&=-33),Es(e,n=xs(e),t);break;case 3:case 4:t=n.stateNode.containerInfo,Ss(e,n=xs(e),t);break;default:throw Error(a(161))}}}function Ss(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?ve(n,e,t):de(n,e);else if(4!==i&&null!==(e=e.child))for(Ss(e,t,n),e=e.sibling;null!==e;)Ss(e,t,n),e=e.sibling}function Es(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?ge(n,e,t):he(n,e);else if(4!==i&&null!==(e=e.child))for(Es(e,t,n),e=e.sibling;null!==e;)Es(e,t,n),e=e.sibling}function Ts(e,t,n){for(var i,r,s=t,o=!1;;){if(!o){o=s.return;e:for(;;){if(null===o)throw Error(a(160));switch(i=o.stateNode,o.tag){case 5:r=!1;break e;case 3:case 4:i=i.containerInfo,r=!0;break e}o=o.return}o=!0}if(5===s.tag||6===s.tag)vs(e,s,n),r?be(i,s.stateNode):ye(i,s.stateNode);else if(18===s.tag)r?Ze(i,s.stateNode):Ke(i,s.stateNode);else if(4===s.tag){if(null!==s.child){i=s.stateNode.containerInfo,r=!0,s.child.return=s,s=s.child;continue}}else if(gs(e,s,n),null!==s.child){s.child.return=s,s=s.child;continue}if(s===t)break;for(;null===s.sibling;){if(null===s.return||s.return===t)return;4===(s=s.return).tag&&(o=!1)}s.sibling.return=s.return,s=s.sibling}}function ws(e,t){if(q){switch(t.tag){case 0:case 11:case 14:case 15:return fs(3,t,t.return),ps(3,t),void fs(5,t,t.return);case 1:case 12:case 17:return;case 5:var n=t.stateNode;if(null!=n){var i=t.memoizedProps;e=null!==e?e.memoizedProps:i;var r=t.type,s=t.updateQueue;t.updateQueue=null,null!==s&&me(n,s,r,e,i,t)}return;case 6:if(null===t.stateNode)throw Error(a(162));return n=t.memoizedProps,void fe(t.stateNode,null!==e?e.memoizedProps:n,n);case 3:return void(Z&&null!==e&&e.memoizedState.isDehydrated&&Xe(t.stateNode.containerInfo));case 13:case 19:return void As(t)}throw Error(a(163))}switch(t.tag){case 0:case 11:case 14:case 15:return fs(3,t,t.return),ps(3,t),void fs(5,t,t.return);case 12:case 22:case 23:return;case 13:case 19:return void As(t);case 3:Z&&null!==e&&e.memoizedState.isDehydrated&&Xe(t.stateNode.containerInfo)}e:if(K){switch(t.tag){case 1:case 5:case 6:break e;case 3:case 4:t=t.stateNode,Le(t.containerInfo,t.pendingChildren);break e}throw Error(a(163))}}function As(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new ls),t.forEach(function(t){var i=qa.bind(null,e,t);n.has(t)||(n.add(t),t.then(i,i))})}}function Ms(e,t,n){cs=e,Rs(e,t,n)}function Rs(e,t,n){for(var i=0!==(1&e.mode);null!==cs;){var r=cs,s=r.child;if(22===r.tag&&i){var a=null!==r.memoizedState||as;if(!a){var o=r.alternate,l=null!==o&&null!==o.memoizedState||os;o=as;var c=os;if(as=a,(os=l)&&!c)for(cs=r;null!==cs;)l=(a=cs).child,22===a.tag&&null!==a.memoizedState?Is(r):null!==l?(l.return=a,cs=l):Is(r);for(;null!==s;)cs=s,Rs(s,t,n),s=s.sibling;cs=r,as=o,os=c}Cs(e)}else 0!==(8772&r.subtreeFlags)&&null!==s?(s.return=r,cs=s):Cs(e)}}function Cs(e){for(;null!==cs;){var t=cs;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:os||ps(5,t);break;case 1:var i=t.stateNode;if(4&t.flags&&!os)if(null===n)i.componentDidMount();else{var r=t.elementType===t.type?n.memoizedProps:en(t.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var s=t.updateQueue;null!==s&&_n(t,s,i);break;case 3:var o=t.updateQueue;if(null!==o){if(n=null,null!==t.child)switch(t.child.tag){case 5:n=k(t.child.stateNode);break;case 1:n=t.child.stateNode}_n(t,o,n)}break;case 5:var l=t.stateNode;null===n&&4&t.flags&&pe(l,t.type,t.memoizedProps,t);break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:break;case 13:if(Z&&null===t.memoizedState){var c=t.alternate;if(null!==c){var u=c.memoizedState;if(null!==u){var h=u.dehydrated;null!==h&&qe(h)}}}break;default:throw Error(a(163))}os||512&t.flags&&ms(t)}catch(d){Ha(t,t.return,d)}}if(t===e){cs=null;break}if(null!==(n=t.sibling)){n.return=t.return,cs=n;break}cs=t.return}}function Ls(e){for(;null!==cs;){var t=cs;if(t===e){cs=null;break}var n=t.sibling;if(null!==n){n.return=t.return,cs=n;break}cs=t.return}}function Is(e){for(;null!==cs;){var t=cs;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{ps(4,t)}catch(l){Ha(t,n,l)}break;case 1:var i=t.stateNode;if("function"===typeof i.componentDidMount){var r=t.return;try{i.componentDidMount()}catch(l){Ha(t,r,l)}}var s=t.return;try{ms(t)}catch(l){Ha(t,s,l)}break;case 5:var a=t.return;try{ms(t)}catch(l){Ha(t,a,l)}}}catch(l){Ha(t,t.return,l)}if(t===e){cs=null;break}var o=t.sibling;if(null!==o){o.return=t.return,cs=o;break}cs=t.return}}var Ps=0,ks=1,Ds=2,Ns=3,Os=4;if("function"===typeof Symbol&&Symbol.for){var Fs=Symbol.for;Ps=Fs("selector.component"),ks=Fs("selector.has_pseudo_class"),Ds=Fs("selector.role"),Ns=Fs("selector.test_id"),Os=Fs("selector.text")}function Us(e){var t=J(e);if(null!=t){if("string"!==typeof t.memoizedProps["data-testname"])throw Error(a(364));return t}if(null===(e=re(e)))throw Error(a(362));return e.stateNode.current}function Bs(e,t){switch(t.$$typeof){case Ps:if(e.type===t.value)return!0;break;case ks:e:{t=t.value,e=[e,0];for(var n=0;n<e.length;){var i=e[n++],r=e[n++],s=t[r];if(5!==i.tag||!oe(i)){for(;null!=s&&Bs(i,s);)s=t[++r];if(r===t.length){t=!0;break e}for(i=i.child;null!==i;)e.push(i,r),i=i.sibling}}t=!1}return t;case Ds:if(5===e.tag&&le(e.stateNode,t.value))return!0;break;case Os:if((5===e.tag||6===e.tag)&&(null!==(e=ae(e))&&0<=e.indexOf(t.value)))return!0;break;case Ns:if(5===e.tag&&("string"===typeof(e=e.memoizedProps["data-testname"])&&e.toLowerCase()===t.value.toLowerCase()))return!0;break;default:throw Error(a(365))}return!1}function zs(e){switch(e.$$typeof){case Ps:return"<"+(E(e.value)||"Unknown")+">";case ks:return":has("+(zs(e)||"")+")";case Ds:return'[role="'+e.value+'"]';case Os:return'"'+e.value+'"';case Ns:return'[data-testname="'+e.value+'"]';default:throw Error(a(365))}}function js(e,t){var n=[];e=[e,0];for(var i=0;i<e.length;){var r=e[i++],s=e[i++],a=t[s];if(5!==r.tag||!oe(r)){for(;null!=a&&Bs(r,a);)a=t[++s];if(s===t.length)n.push(r);else for(r=r.child;null!==r;)e.push(r,s),r=r.sibling}}return n}function Gs(e,t){if(!ie)throw Error(a(363));e=js(e=Us(e),t),t=[],e=Array.from(e);for(var n=0;n<e.length;){var i=e[n++];if(5===i.tag)oe(i)||t.push(i.stateNode);else for(i=i.child;null!==i;)e.push(i),i=i.sibling}return t}var Vs=Math.ceil,Hs=o.ReactCurrentDispatcher,Ws=o.ReactCurrentOwner,Ys=o.ReactCurrentBatchConfig,Xs=0,qs=null,Ks=null,Zs=0,Js=0,Qs=at(0),$s=0,ea=null,ta=0,na=0,ia=0,ra=null,sa=null,aa=0,oa=1/0;function la(){oa=Ut()+500}var ca,ua=!1,ha=null,da=null,fa=!1,pa=null,ma=0,ga=0,va=null,ya=-1,ba=0;function xa(){return 0!==(6&Xs)?Ut():-1!==ya?ya:ya=Ut()}function _a(e){return 0===(1&e.mode)?1:0!==(2&Xs)&&0!==Zs?Zs&-Zs:null!==Jt.transition?(0===ba&&(e=Et,0===(4194240&(Et<<=1))&&(Et=64),ba=e),ba):0!==(e=Pt)?e:$()}function Sa(e,t,n){if(50<ga)throw ga=0,va=null,Error(a(185));var i=Ea(e,t);return null===i?null:(Lt(i,t,n),0!==(2&Xs)&&i===qs||(i===qs&&(0===(2&Xs)&&(na|=t),4===$s&&Ra(i,Zs)),Ta(i,n),1===t&&0===Xs&&0===(1&e.mode)&&(la(),Xt&&Zt())),i)}function Ea(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}function Ta(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,i=e.pingedLanes,r=e.expirationTimes,s=e.pendingLanes;0<s;){var a=31-xt(s),o=1<<a,l=r[a];-1===l?0!==(o&n)&&0===(o&i)||(r[a]=Mt(o,t)):l<=t&&(e.expiredLanes|=o),s&=~o}}(e,t);var i=At(e,e===qs?Zs:0);if(0===i)null!==n&&Nt(n),e.callbackNode=null,e.callbackPriority=0;else if(t=i&-i,e.callbackPriority!==t){if(null!=n&&Nt(n),1===t)0===e.tag?function(e){Xt=!0,Kt(e)}(Ca.bind(null,e)):Kt(Ca.bind(null,e)),te?ne(function(){0===Xs&&Zt()}):Dt(Bt,Zt),n=null;else{switch(kt(i)){case 1:n=Bt;break;case 4:n=zt;break;case 16:default:n=jt;break;case 536870912:n=Gt}n=Ka(n,wa.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function wa(e,t){if(ya=-1,ba=0,0!==(6&Xs))throw Error(a(327));var n=e.callbackNode;if(Ga()&&e.callbackNode!==n)return null;var i=At(e,e===qs?Zs:0);if(0===i)return null;if(0!==(30&i)||0!==(i&e.expiredLanes)||t)t=Oa(e,i);else{t=i;var r=Xs;Xs|=2;var s=Da();for(qs===e&&Zs===t||(la(),Pa(e,t));;)try{Ua();break}catch(l){ka(e,l)}an(),Hs.current=s,Xs=r,null!==Ks?t=0:(qs=null,Zs=0,t=$s)}if(0!==t){if(2===t&&(0!==(r=Rt(e))&&(i=r,t=Aa(e,r))),1===t)throw n=ea,Pa(e,0),Ra(e,i),Ta(e,Ut()),n;if(6===t)Ra(e,i);else{if(r=e.current.alternate,0===(30&i)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var i=0;i<n.length;i++){var r=n[i],s=r.getSnapshot;r=r.value;try{if(!Wt(s(),r))return!1}catch(o){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(r)&&(2===(t=Oa(e,i))&&(0!==(s=Rt(e))&&(i=s,t=Aa(e,s))),1===t))throw n=ea,Pa(e,0),Ra(e,i),Ta(e,Ut()),n;switch(e.finishedWork=r,e.finishedLanes=i,t){case 0:case 1:throw Error(a(345));case 2:case 5:ja(e,sa);break;case 3:if(Ra(e,i),(130023424&i)===i&&10<(t=aa+500-Ut())){if(0!==At(e,0))break;if(((r=e.suspendedLanes)&i)!==i){xa(),e.pingedLanes|=e.suspendedLanes&r;break}e.timeoutHandle=H(ja.bind(null,e,sa),t);break}ja(e,sa);break;case 4:if(Ra(e,i),(4194240&i)===i)break;for(t=e.eventTimes,r=-1;0<i;){var o=31-xt(i);s=1<<o,(o=t[o])>r&&(r=o),i&=~s}if(i=r,10<(i=(120>(i=Ut()-i)?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*Vs(i/1960))-i)){e.timeoutHandle=H(ja.bind(null,e,sa),i);break}ja(e,sa);break;default:throw Error(a(329))}}}return Ta(e,Ut()),e.callbackNode===n?wa.bind(null,e):null}function Aa(e,t){var n=ra;return e.current.memoizedState.isDehydrated&&(Pa(e,t).flags|=256),2!==(e=Oa(e,t))&&(t=sa,sa=n,null!==t&&Ma(t)),e}function Ma(e){null===sa?sa=e:sa.push.apply(sa,e)}function Ra(e,t){for(t&=~ia,t&=~na,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-xt(t),i=1<<n;e[n]=-1,t&=~i}}function Ca(e){if(0!==(6&Xs))throw Error(a(327));Ga();var t=At(e,0);if(0===(1&t))return Ta(e,Ut()),null;var n=Oa(e,t);if(0!==e.tag&&2===n){var i=Rt(e);0!==i&&(t=i,n=Aa(e,i))}if(1===n)throw n=ea,Pa(e,0),Ra(e,t),Ta(e,Ut()),n;if(6===n)throw Error(a(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,ja(e,sa),Ta(e,Ut()),null}function La(e){null!==pa&&0===pa.tag&&0===(6&Xs)&&Ga();var t=Xs;Xs|=1;var n=Ys.transition,i=Pt;try{if(Ys.transition=null,Pt=1,e)return e()}finally{Pt=i,Ys.transition=n,0===(6&(Xs=t))&&Zt()}}function Ia(){Js=Qs.current,ot(Qs)}function Pa(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(n!==Y&&(e.timeoutHandle=Y,W(n)),null!==Ks)for(n=Ks.return;null!==n;){var i=n;switch(jn(i),i.tag){case 1:null!==(i=i.type.childContextTypes)&&void 0!==i&&mt();break;case 3:fi(),ot(ht),ot(ut),bi();break;case 5:mi(i);break;case 4:fi();break;case 13:case 19:ot(gi);break;case 10:ln(i.type._context);break;case 22:case 23:Ia()}n=n.return}if(qs=e,Ks=e=$a(e.current,null),Zs=Js=t,$s=0,ea=null,ia=na=ta=0,sa=ra=null,null!==dn){for(t=0;t<dn.length;t++)if(null!==(i=(n=dn[t]).interleaved)){n.interleaved=null;var r=i.next,s=n.pending;if(null!==s){var a=s.next;s.next=r,i.next=a}n.pending=i}dn=null}return e}function ka(e,t){for(;;){var n=Ks;try{if(an(),xi.current=fr,Ai){for(var i=Ei.memoizedState;null!==i;){var r=i.queue;null!==r&&(r.pending=null),i=i.next}Ai=!1}if(Si=0,wi=Ti=Ei=null,Mi=!1,Ri=0,Ws.current=null,null===n||null===n.return){$s=1,ea=t,Ks=null;break}e:{var s=e,o=n.return,l=n,c=t;if(t=Zs,l.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var u=c,h=l,d=h.tag;if(0===(1&h.mode)&&(0===d||11===d||15===d)){var f=h.alternate;f?(h.updateQueue=f.updateQueue,h.memoizedState=f.memoizedState,h.lanes=f.lanes):(h.updateQueue=null,h.memoizedState=null)}var p=Mr(o);if(null!==p){p.flags&=-257,Rr(p,o,l,0,t),1&p.mode&&Ar(s,u,t),c=u;var m=(t=p).updateQueue;if(null===m){var g=new Set;g.add(c),t.updateQueue=g}else m.add(c);break e}if(0===(1&t)){Ar(s,u,t),Na();break e}c=Error(a(426))}else if(Hn&&1&l.mode){var v=Mr(o);if(null!==v){0===(65536&v.flags)&&(v.flags|=256),Rr(v,o,l,0,t),ei(c);break e}}s=c,4!==$s&&($s=2),null===ra?ra=[s]:ra.push(s),c=vr(c,l),l=o;do{switch(l.tag){case 3:l.flags|=65536,t&=-t,l.lanes|=t,bn(l,Tr(0,c,t));break e;case 1:s=c;var y=l.type,b=l.stateNode;if(0===(128&l.flags)&&("function"===typeof y.getDerivedStateFromError||null!==b&&"function"===typeof b.componentDidCatch&&(null===da||!da.has(b)))){l.flags|=65536,t&=-t,l.lanes|=t,bn(l,wr(l,s,t));break e}}l=l.return}while(null!==l)}za(n)}catch(x){t=x,Ks===n&&null!==n&&(Ks=n=n.return);continue}break}}function Da(){var e=Hs.current;return Hs.current=fr,null===e?fr:e}function Na(){0!==$s&&3!==$s&&2!==$s||($s=4),null===qs||0===(268435455&ta)&&0===(268435455&na)||Ra(qs,Zs)}function Oa(e,t){var n=Xs;Xs|=2;var i=Da();for(qs===e&&Zs===t||Pa(e,t);;)try{Fa();break}catch(r){ka(e,r)}if(an(),Xs=n,Hs.current=i,null!==Ks)throw Error(a(261));return qs=null,Zs=0,$s}function Fa(){for(;null!==Ks;)Ba(Ks)}function Ua(){for(;null!==Ks&&!Ot();)Ba(Ks)}function Ba(e){var t=ca(e.alternate,e,Js);e.memoizedProps=e.pendingProps,null===t?za(e):Ks=t,Ws.current=null}function za(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=Dr(n,t,Js)))return void(Ks=n)}else{if(null!==(n=ss(n,t)))return n.flags&=32767,void(Ks=n);if(null===e)return $s=6,void(Ks=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Ks=t);Ks=t=e}while(null!==t);0===$s&&($s=5)}function ja(e,t){var n=Pt,i=Ys.transition;try{Ys.transition=null,Pt=1,function(e,t,n){do{Ga()}while(null!==pa);if(0!==(6&Xs))throw Error(a(327));var i=e.finishedWork,r=e.finishedLanes;if(null===i)return null;if(e.finishedWork=null,e.finishedLanes=0,i===e.current)throw Error(a(177));e.callbackNode=null,e.callbackPriority=0;var s=i.lanes|i.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var i=e.eventTimes;for(e=e.expirationTimes;0<n;){var r=31-xt(n),s=1<<r;t[r]=0,i[r]=-1,e[r]=-1,n&=~s}}(e,s),e===qs&&(Ks=qs=null,Zs=0),0===(2064&i.subtreeFlags)&&0===(2064&i.flags)||fa||(fa=!0,Ka(jt,function(){return Ga(),null})),s=0!==(15990&i.flags),0!==(15990&i.subtreeFlags)||s){s=Ys.transition,Ys.transition=null;var o=Pt;Pt=1;var l=Xs;Xs|=4,Ws.current=null,function(e,t){for(O(e.containerInfo),cs=t;null!==cs;)if(t=(e=cs).child,0!==(1028&e.subtreeFlags)&&null!==t)t.return=e,cs=t;else for(;null!==cs;){e=cs;try{var n=e.alternate;if(0!==(1024&e.flags))switch(e.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==n){var i=n.memoizedProps,r=n.memoizedState,s=e.stateNode,o=s.getSnapshotBeforeUpdate(e.elementType===e.type?i:en(e.type,i),r);s.__reactInternalSnapshotBeforeUpdate=o}break;case 3:q&&we(e.stateNode.containerInfo);break;default:throw Error(a(163))}}catch(l){Ha(e,e.return,l)}if(null!==(t=e.sibling)){t.return=e.return,cs=t;break}cs=e.return}n=ds,ds=!1}(e,i),function(e,t){for(cs=t;null!==cs;){var n=(t=cs).deletions;if(null!==n)for(var i=0;i<n.length;i++){var r=n[i];try{var s=e;q?Ts(s,r,t):vs(s,r,t);var a=r.alternate;null!==a&&(a.return=null),r.return=null}catch(_){Ha(r,t,_)}}if(n=t.child,0!==(12854&t.subtreeFlags)&&null!==n)n.return=t,cs=n;else for(;null!==cs;){t=cs;try{var o=t.flags;if(32&o&&q&&xe(t.stateNode),512&o){var l=t.alternate;if(null!==l){var c=l.ref;null!==c&&("function"===typeof c?c(null):c.current=null)}}if(8192&o)switch(t.tag){case 13:if(null!==t.memoizedState){var u=t.alternate;null!==u&&null!==u.memoizedState||(aa=Ut())}break;case 22:var h=null!==t.memoizedState,d=t.alternate,f=null!==d&&null!==d.memoizedState;if(n=t,q)e:if(i=n,r=h,s=null,q)for(var p=i;;){if(5===p.tag){if(null===s){s=p;var m=p.stateNode;r?_e(m):Ee(p.stateNode,p.memoizedProps)}}else if(6===p.tag){if(null===s){var g=p.stateNode;r?Se(g):Te(g,p.memoizedProps)}}else if((22!==p.tag&&23!==p.tag||null===p.memoizedState||p===i)&&null!==p.child){p.child.return=p,p=p.child;continue}if(p===i)break;for(;null===p.sibling;){if(null===p.return||p.return===i)break e;s===p&&(s=null),p=p.return}s===p&&(s=null),p.sibling.return=p.return,p=p.sibling}if(h&&!f&&0!==(1&n.mode)){cs=n;for(var v=n.child;null!==v;){for(n=cs=v;null!==cs;){var y=(i=cs).child;switch(i.tag){case 0:case 11:case 14:case 15:fs(4,i,i.return);break;case 1:us(i,i.return);var b=i.stateNode;if("function"===typeof b.componentWillUnmount){var x=i.return;try{b.props=i.memoizedProps,b.state=i.memoizedState,b.componentWillUnmount()}catch(_){Ha(i,x,_)}}break;case 5:us(i,i.return);break;case 22:if(null!==i.memoizedState){Ls(n);continue}}null!==y?(y.return=i,cs=y):Ls(n)}v=v.sibling}}}switch(4102&o){case 2:_s(t),t.flags&=-3;break;case 6:_s(t),t.flags&=-3,ws(t.alternate,t);break;case 4096:t.flags&=-4097;break;case 4100:t.flags&=-4097,ws(t.alternate,t);break;case 4:ws(t.alternate,t)}}catch(_){Ha(t,t.return,_)}if(null!==(n=t.sibling)){n.return=t.return,cs=n;break}cs=t.return}}}(e,i),F(e.containerInfo),e.current=i,Ms(i,e,r),Ft(),Xs=l,Pt=o,Ys.transition=s}else e.current=i;if(fa&&(fa=!1,pa=e,ma=r),s=e.pendingLanes,0===s&&(da=null),function(e){if(Ht&&"function"===typeof Ht.onCommitFiberRoot)try{Ht.onCommitFiberRoot(Vt,e,void 0,128===(128&e.current.flags))}catch(t){}}(i.stateNode),Ta(e,Ut()),null!==t)for(n=e.onRecoverableError,i=0;i<t.length;i++)n(t[i]);if(ua)throw ua=!1,e=ha,ha=null,e;0!==(1&ma)&&0!==e.tag&&Ga(),s=e.pendingLanes,0!==(1&s)?e===va?ga++:(ga=0,va=e):ga=0,Zt()}(e,t,n)}finally{Ys.transition=i,Pt=n}return null}function Ga(){if(null!==pa){var e=kt(ma),t=Ys.transition,n=Pt;try{if(Ys.transition=null,Pt=16>e?16:e,null===pa)var i=!1;else{if(e=pa,pa=null,ma=0,0!==(6&Xs))throw Error(a(331));var r=Xs;for(Xs|=4,cs=e.current;null!==cs;){var s=cs,o=s.child;if(0!==(16&cs.flags)){var l=s.deletions;if(null!==l){for(var c=0;c<l.length;c++){var u=l[c];for(cs=u;null!==cs;){var h=cs;switch(h.tag){case 0:case 11:case 15:fs(8,h,s)}var d=h.child;if(null!==d)d.return=h,cs=d;else for(;null!==cs;){var f=(h=cs).sibling,p=h.return;if(ys(h),h===u){cs=null;break}if(null!==f){f.return=p,cs=f;break}cs=p}}}var m=s.alternate;if(null!==m){var g=m.child;if(null!==g){m.child=null;do{var v=g.sibling;g.sibling=null,g=v}while(null!==g)}}cs=s}}if(0!==(2064&s.subtreeFlags)&&null!==o)o.return=s,cs=o;else e:for(;null!==cs;){if(0!==(2048&(s=cs).flags))switch(s.tag){case 0:case 11:case 15:fs(9,s,s.return)}var y=s.sibling;if(null!==y){y.return=s.return,cs=y;break e}cs=s.return}}var b=e.current;for(cs=b;null!==cs;){var x=(o=cs).child;if(0!==(2064&o.subtreeFlags)&&null!==x)x.return=o,cs=x;else e:for(o=b;null!==cs;){if(0!==(2048&(l=cs).flags))try{switch(l.tag){case 0:case 11:case 15:ps(9,l)}}catch(S){Ha(l,l.return,S)}if(l===o){cs=null;break e}var _=l.sibling;if(null!==_){_.return=l.return,cs=_;break e}cs=l.return}}if(Xs=r,Zt(),Ht&&"function"===typeof Ht.onPostCommitFiberRoot)try{Ht.onPostCommitFiberRoot(Vt,e)}catch(S){}i=!0}return i}finally{Pt=n,Ys.transition=t}}return!1}function Va(e,t,n){vn(e,t=Tr(0,t=vr(n,t),1)),t=xa(),null!==(e=Ea(e,1))&&(Lt(e,1,t),Ta(e,t))}function Ha(e,t,n){if(3===e.tag)Va(e,e,n);else for(;null!==t;){if(3===t.tag){Va(t,e,n);break}if(1===t.tag){var i=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof i.componentDidCatch&&(null===da||!da.has(i))){vn(t,e=wr(t,e=vr(n,e),1)),e=xa(),null!==(t=Ea(t,1))&&(Lt(t,1,e),Ta(t,e));break}}t=t.return}}function Wa(e,t,n){var i=e.pingCache;null!==i&&i.delete(t),t=xa(),e.pingedLanes|=e.suspendedLanes&n,qs===e&&(Zs&n)===n&&(4===$s||3===$s&&(130023424&Zs)===Zs&&500>Ut()-aa?Pa(e,0):ia|=n),Ta(e,t)}function Ya(e,t){0===t&&(0===(1&e.mode)?t=1:(t=Tt,0===(130023424&(Tt<<=1))&&(Tt=4194304)));var n=xa();null!==(e=Ea(e,t))&&(Lt(e,t,n),Ta(e,n))}function Xa(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Ya(e,n)}function qa(e,t){var n=0;switch(e.tag){case 13:var i=e.stateNode,r=e.memoizedState;null!==r&&(n=r.retryLane);break;case 19:i=e.stateNode;break;default:throw Error(a(314))}null!==i&&i.delete(t),Ya(e,n)}function Ka(e,t){return Dt(e,t)}function Za(e,t,n,i){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ja(e,t,n,i){return new Za(e,t,n,i)}function Qa(e){return!(!(e=e.prototype)||!e.isReactComponent)}function $a(e,t){var n=e.alternate;return null===n?((n=Ja(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function eo(e,t,n,i,r,s){var o=2;if(i=e,"function"===typeof e)Qa(e)&&(o=1);else if("string"===typeof e)o=5;else e:switch(e){case u:return to(n.children,r,s,t);case h:o=8,r|=8;break;case d:return(e=Ja(12,n,t,2|r)).elementType=d,e.lanes=s,e;case g:return(e=Ja(13,n,t,r)).elementType=g,e.lanes=s,e;case v:return(e=Ja(19,n,t,r)).elementType=v,e.lanes=s,e;case x:return no(n,r,s,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case f:o=10;break e;case p:o=9;break e;case m:o=11;break e;case y:o=14;break e;case b:o=16,i=null;break e}throw Error(a(130,null==e?e:typeof e,""))}return(t=Ja(o,n,t,r)).elementType=e,t.type=i,t.lanes=s,t}function to(e,t,n,i){return(e=Ja(7,e,i,t)).lanes=n,e}function no(e,t,n,i){return(e=Ja(22,e,i,t)).elementType=x,e.lanes=n,e.stateNode={},e}function io(e,t,n){return(e=Ja(6,e,null,t)).lanes=n,e}function ro(e,t,n){return(t=Ja(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function so(e,t,n,i,r){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=Y,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Ct(0),this.expirationTimes=Ct(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ct(0),this.identifierPrefix=i,this.onRecoverableError=r,Z&&(this.mutableSourceEagerHydrationData=null)}function ao(e,t,n,i,r,s,a,o,l){return e=new so(e,t,n,o,l),1===t?(t=1,!0===s&&(t|=8)):t=0,s=Ja(3,null,null,t),e.current=s,s.stateNode=e,s.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null},pn(s),e}function oo(e){if(!e)return ct;e:{if(w(e=e._reactInternals)!==e||1!==e.tag)throw Error(a(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(pt(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(a(171))}if(1===e.tag){var n=e.type;if(pt(n))return vt(e,n,t)}return t}function lo(e){var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(a(188));throw e=Object.keys(e).join(","),Error(a(268,e))}return null===(e=R(t))?null:e.stateNode}function co(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function uo(e,t){co(e,t),(e=e.alternate)&&co(e,t)}function ho(e){return null===(e=R(e))?null:e.stateNode}function fo(){return null}return ca=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||ht.current)Or=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return Or=!1,function(e,t,n){switch(t.tag){case 3:Yr(t),$n();break;case 5:pi(t);break;case 1:pt(t.type)&&yt(t);break;case 4:di(t,t.stateNode.containerInfo);break;case 10:on(0,t.type._context,t.memoizedProps.value);break;case 13:var i=t.memoizedState;if(null!==i)return null!==i.dehydrated?(lt(gi,1&gi.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Zr(e,t,n):(lt(gi,1&gi.current),null!==(e=rs(e,t,n))?e.sibling:null);lt(gi,1&gi.current);break;case 19:if(i=0!==(n&t.childLanes),0!==(128&e.flags)){if(i)return is(e,t,n);t.flags|=128}var r=t.memoizedState;if(null!==r&&(r.rendering=null,r.tail=null,r.lastEffect=null),lt(gi,gi.current),i)break;return null;case 22:case 23:return t.lanes=0,jr(e,t,n)}return rs(e,t,n)}(e,t,n);Or=0!==(131072&e.flags)}else Or=!1,Hn&&0!==(1048576&t.flags)&&Bn(t,Pn,t.index);switch(t.lanes=0,t.tag){case 2:var i=t.type;null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps;var r=ft(t,ut.current);un(t,n),r=Pi(null,t,i,e,r,n);var s=ki();return t.flags|=1,"object"===typeof r&&null!==r&&"function"===typeof r.render&&void 0===r.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,pt(i)?(s=!0,yt(t)):s=!1,t.memoizedState=null!==r.state&&void 0!==r.state?r.state:null,pn(t),r.updater=Tn,t.stateNode=r,r._reactInternals=t,Rn(t,i,e,n),t=Wr(null,t,i,!0,s,n)):(t.tag=0,Hn&&s&&zn(t),Fr(null,t,r,n),t=t.child),t;case 16:i=t.elementType;e:{switch(null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps,i=(r=i._init)(i._payload),t.type=i,r=t.tag=function(e){if("function"===typeof e)return Qa(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===m)return 11;if(e===y)return 14}return 2}(i),e=en(i,e),r){case 0:t=Vr(null,t,i,e,n);break e;case 1:t=Hr(null,t,i,e,n);break e;case 11:t=Ur(null,t,i,e,n);break e;case 14:t=Br(null,t,i,en(i.type,e),n);break e}throw Error(a(306,i,""))}return t;case 0:return i=t.type,r=t.pendingProps,Vr(e,t,i,r=t.elementType===i?r:en(i,r),n);case 1:return i=t.type,r=t.pendingProps,Hr(e,t,i,r=t.elementType===i?r:en(i,r),n);case 3:e:{if(Yr(t),null===e)throw Error(a(387));i=t.pendingProps,r=(s=t.memoizedState).element,mn(e,t),xn(t,i,null,n);var o=t.memoizedState;if(i=o.element,Z&&s.isDehydrated){if(s={element:i,isDehydrated:!1,cache:o.cache,transitions:o.transitions},t.updateQueue.baseState=s,t.memoizedState=s,256&t.flags){t=Xr(e,t,i,n,r=Error(a(423)));break e}if(i!==r){t=Xr(e,t,i,n,r=Error(a(424)));break e}for(Z&&(Vn=je(t.stateNode.containerInfo),Gn=t,Hn=!0,Yn=null,Wn=!1),n=ai(t,null,i,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if($n(),i===r){t=rs(e,t,n);break e}Fr(e,t,i,n)}t=t.child}return t;case 5:return pi(t),null===e&&Zn(t),i=t.type,r=t.pendingProps,s=null!==e?e.memoizedProps:null,o=r.children,G(i,r)?o=null:null!==s&&G(i,s)&&(t.flags|=32),Gr(e,t),Fr(e,t,o,n),t.child;case 6:return null===e&&Zn(t),null;case 13:return Zr(e,t,n);case 4:return di(t,t.stateNode.containerInfo),i=t.pendingProps,null===e?t.child=si(t,null,i,n):Fr(e,t,i,n),t.child;case 11:return i=t.type,r=t.pendingProps,Ur(e,t,i,r=t.elementType===i?r:en(i,r),n);case 7:return Fr(e,t,t.pendingProps,n),t.child;case 8:case 12:return Fr(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(i=t.type._context,r=t.pendingProps,s=t.memoizedProps,on(0,i,o=r.value),null!==s)if(Wt(s.value,o)){if(s.children===r.children&&!ht.current){t=rs(e,t,n);break e}}else for(null!==(s=t.child)&&(s.return=t);null!==s;){var l=s.dependencies;if(null!==l){o=s.child;for(var c=l.firstContext;null!==c;){if(c.context===i){if(1===s.tag){(c=gn(-1,n&-n)).tag=2;var u=s.updateQueue;if(null!==u){var h=(u=u.shared).pending;null===h?c.next=c:(c.next=h.next,h.next=c),u.pending=c}}s.lanes|=n,null!==(c=s.alternate)&&(c.lanes|=n),cn(s.return,n,t),l.lanes|=n;break}c=c.next}}else if(10===s.tag)o=s.type===t.type?null:s.child;else if(18===s.tag){if(null===(o=s.return))throw Error(a(341));o.lanes|=n,null!==(l=o.alternate)&&(l.lanes|=n),cn(o,n,t),o=s.sibling}else o=s.child;if(null!==o)o.return=s;else for(o=s;null!==o;){if(o===t){o=null;break}if(null!==(s=o.sibling)){s.return=o.return,o=s;break}o=o.return}s=o}Fr(e,t,r.children,n),t=t.child}return t;case 9:return r=t.type,i=t.pendingProps.children,un(t,n),i=i(r=hn(r)),t.flags|=1,Fr(e,t,i,n),t.child;case 14:return r=en(i=t.type,t.pendingProps),Br(e,t,i,r=en(i.type,r),n);case 15:return zr(e,t,t.type,t.pendingProps,n);case 17:return i=t.type,r=t.pendingProps,r=t.elementType===i?r:en(i,r),null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),t.tag=1,pt(i)?(e=!0,yt(t)):e=!1,un(t,n),An(t,i,r),Rn(t,i,r,n),Wr(null,t,i,!0,e,n);case 19:return is(e,t,n);case 22:return jr(e,t,n)}throw Error(a(156,t.tag))},t.attemptContinuousHydration=function(e){13===e.tag&&(Sa(e,134217728,xa()),uo(e,134217728))},t.attemptHydrationAtCurrentPriority=function(e){if(13===e.tag){var t=xa(),n=_a(e);Sa(e,n,t),uo(e,n)}},t.attemptSynchronousHydration=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=wt(t.pendingLanes);0!==n&&(It(t,1|n),Ta(t,Ut()),0===(6&Xs)&&(la(),Zt()))}break;case 13:var i=xa();La(function(){return Sa(e,1,i)}),uo(e,1)}},t.batchedUpdates=function(e,t){var n=Xs;Xs|=1;try{return e(t)}finally{0===(Xs=n)&&(la(),Xt&&Zt())}},t.createComponentSelector=function(e){return{$$typeof:Ps,value:e}},t.createContainer=function(e,t,n,i,r,s,a){return ao(e,t,!1,null,0,i,0,s,a)},t.createHasPseudoClassSelector=function(e){return{$$typeof:ks,value:e}},t.createHydrationContainer=function(e,t,n,i,r,s,a,o,l){return(e=ao(n,i,!0,e,0,s,0,o,l)).context=oo(null),n=e.current,(s=gn(i=xa(),r=_a(n))).callback=void 0!==t&&null!==t?t:null,vn(n,s),e.current.lanes=r,Lt(e,r,i),Ta(e,i),e},t.createPortal=function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:c,key:null==i?null:""+i,children:e,containerInfo:t,implementation:n}},t.createRoleSelector=function(e){return{$$typeof:Ds,value:e}},t.createTestNameSelector=function(e){return{$$typeof:Ns,value:e}},t.createTextSelector=function(e){return{$$typeof:Os,value:e}},t.deferredUpdates=function(e){var t=Pt,n=Ys.transition;try{return Ys.transition=null,Pt=16,e()}finally{Pt=t,Ys.transition=n}},t.discreteUpdates=function(e,t,n,i,r){var s=Pt,a=Ys.transition;try{return Ys.transition=null,Pt=1,e(t,n,i,r)}finally{Pt=s,Ys.transition=a,0===Xs&&la()}},t.findAllNodes=Gs,t.findBoundingRects=function(e,t){if(!ie)throw Error(a(363));t=Gs(e,t),e=[];for(var n=0;n<t.length;n++)e.push(se(t[n]));for(t=e.length-1;0<t;t--)for(var i=(n=e[t]).x,r=i+n.width,s=n.y,o=s+n.height,l=t-1;0<=l;l--)if(t!==l){var c=e[l],u=c.x,h=u+c.width,d=c.y,f=d+c.height;if(i>=u&&s>=d&&r<=h&&o<=f){e.splice(t,1);break}if(!(i!==u||n.width!==c.width||f<s||d>o)){d>s&&(c.height+=d-s,c.y=s),f<o&&(c.height=o-d),e.splice(t,1);break}if(!(s!==d||n.height!==c.height||h<i||u>r)){u>i&&(c.width+=u-i,c.x=i),h<r&&(c.width=r-u),e.splice(t,1);break}}return e},t.findHostInstance=lo,t.findHostInstanceWithNoPortals=function(e){return null===(e=null!==(e=M(e))?L(e):null)?null:e.stateNode},t.findHostInstanceWithWarning=function(e){return lo(e)},t.flushControlled=function(e){var t=Xs;Xs|=1;var n=Ys.transition,i=Pt;try{Ys.transition=null,Pt=1,e()}finally{Pt=i,Ys.transition=n,0===(Xs=t)&&(la(),Zt())}},t.flushPassiveEffects=Ga,t.flushSync=La,t.focusWithin=function(e,t){if(!ie)throw Error(a(363));for(t=js(e=Us(e),t),t=Array.from(t),e=0;e<t.length;){var n=t[e++];if(!oe(n)){if(5===n.tag&&ce(n.stateNode))return!0;for(n=n.child;null!==n;)t.push(n),n=n.sibling}}return!1},t.getCurrentUpdatePriority=function(){return Pt},t.getFindAllNodesFailureDescription=function(e,t){if(!ie)throw Error(a(363));var n=0,i=[];e=[Us(e),0];for(var r=0;r<e.length;){var s=e[r++],o=e[r++],l=t[o];if((5!==s.tag||!oe(s))&&(Bs(s,l)&&(i.push(zs(l)),++o>n&&(n=o)),o<t.length))for(s=s.child;null!==s;)e.push(s,o),s=s.sibling}if(n<t.length){for(e=[];n<t.length;n++)e.push(zs(t[n]));return"findAllNodes was able to match part of the selector:\n  "+i.join(" > ")+"\n\nNo matching component was found for:\n  "+e.join(" > ")}return null},t.getPublicRootInstance=function(e){return(e=e.current).child?5===e.child.tag?k(e.child.stateNode):e.child.stateNode:null},t.injectIntoDevTools=function(e){if(e={bundleType:e.bundleType,version:e.version,rendererPackageName:e.rendererPackageName,rendererConfig:e.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:o.ReactCurrentDispatcher,findHostInstanceByFiber:ho,findFiberByHostInstance:e.findFiberByHostInstance||fo,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.0.0-fc46dba67-20220329"},"undefined"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)e=!1;else{var t=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(t.isDisabled||!t.supportsFiber)e=!0;else{try{Vt=t.inject(e),Ht=t}catch(n){}e=!!t.checkDCE}}return e},t.isAlreadyRendering=function(){return!1},t.observeVisibleRects=function(e,t,n,i){if(!ie)throw Error(a(363));e=Gs(e,t);var r=ue(e,n,i).disconnect;return{disconnect:function(){r()}}},t.registerMutableSourceForHydration=function(e,t){var n=t._getVersion;n=n(t._source),null==e.mutableSourceEagerHydrationData?e.mutableSourceEagerHydrationData=[t,n]:e.mutableSourceEagerHydrationData.push(t,n)},t.runWithPriority=function(e,t){var n=Pt;try{return Pt=e,t()}finally{Pt=n}},t.shouldError=function(){return null},t.shouldSuspend=function(){return!1},t.updateContainer=function(e,t,n,i){var r=t.current,s=xa(),a=_a(r);return n=oo(n),null===t.context?t.context=n:t.pendingContext=n,(t=gn(s,a)).payload={element:e},null!==(i=void 0===i?null:i)&&(t.callback=i),vn(r,t),null!==(e=Sa(r,a,s))&&yn(e,r,a),a},t}}},t={};function n(i){var r=t[i];if(void 0!==r)return r.exports;var s=t[i]={exports:{}};return e[i](s,s.exports,n),s.exports}n.m=e,n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;n.t=function(i,r){if(1&r&&(i=this(i)),8&r)return i;if("object"===typeof i&&i){if(4&r&&i.__esModule)return i;if(16&r&&"function"===typeof i.then)return i}var s=Object.create(null);n.r(s);var a={};e=e||[null,t({}),t([]),t(t)];for(var o=2&r&&i;("object"==typeof o||"function"==typeof o)&&!~e.indexOf(o);o=t(o))Object.getOwnPropertyNames(o).forEach(e=>a[e]=()=>i[e]);return a.default=()=>i,n.d(s,a),s}})(),n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.f={},n.e=e=>Promise.all(Object.keys(n.f).reduce((t,i)=>(n.f[i](e,t),t),[])),n.u=e=>"static/js/"+e+".974d5ae6.chunk.js",n.miniCssF=e=>{},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={},t="greetins-frontend:";n.l=(i,r,s,a)=>{if(e[i])e[i].push(r);else{var o,l;if(void 0!==s)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var h=c[u];if(h.getAttribute("src")==i||h.getAttribute("data-webpack")==t+s){o=h;break}}o||(l=!0,(o=document.createElement("script")).charset="utf-8",n.nc&&o.setAttribute("nonce",n.nc),o.setAttribute("data-webpack",t+s),o.src=i),e[i]=[r];var d=(t,n)=>{o.onerror=o.onload=null,clearTimeout(f);var r=e[i];if(delete e[i],o.parentNode&&o.parentNode.removeChild(o),r&&r.forEach(e=>e(n)),t)return t(n)},f=setTimeout(d.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=d.bind(null,o.onerror),o.onload=d.bind(null,o.onload),l&&document.head.appendChild(o)}}})(),n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.p="/",(()=>{var e={792:0};n.f.j=(t,i)=>{var r=n.o(e,t)?e[t]:void 0;if(0!==r)if(r)i.push(r[2]);else{var s=new Promise((n,i)=>r=e[t]=[n,i]);i.push(r[2]=s);var a=n.p+n.u(t),o=new Error;n.l(a,i=>{if(n.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var s=i&&("load"===i.type?"missing":i.type),a=i&&i.target&&i.target.src;o.message="Loading chunk "+t+" failed.\n("+s+": "+a+")",o.name="ChunkLoadError",o.type=s,o.request=a,r[1](o)}},"chunk-"+t,t)}};var t=(t,i)=>{var r,s,[a,o,l]=i,c=0;if(a.some(t=>0!==e[t])){for(r in o)n.o(o,r)&&(n.m[r]=o[r]);if(l)l(n)}for(t&&t(i);c<a.length;c++)s=a[c],n.o(e,s)&&e[s]&&e[s][0](),e[s]=0},i=self.webpackChunkgreetins_frontend=self.webpackChunkgreetins_frontend||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})(),(()=>{"use strict";var e={};n.r(e),n.d(e,{ACESFilmicToneMapping:()=>Bt,AddEquation:()=>rt,AddOperation:()=>Dt,AdditiveAnimationBlendMode:()=>Mi,AdditiveBlending:()=>et,AgXToneMapping:()=>jt,AlphaFormat:()=>Tn,AlwaysCompare:()=>pr,AlwaysDepth:()=>wt,AlwaysStencilFunc:()=>ar,AmbientLight:()=>Fd,AnimationAction:()=>Cf,AnimationClip:()=>ld,AnimationLoader:()=>vd,AnimationMixer:()=>If,AnimationObjectGroup:()=>Rf,AnimationUtils:()=>Kh,ArcCurve:()=>xu,ArrayCamera:()=>sf,ArrowHelper:()=>Pp,AttachedBindMode:()=>Vt,Audio:()=>ff,AudioAnalyser:()=>bf,AudioContext:()=>Qd,AudioListener:()=>df,AudioLoader:()=>$d,AxesHelper:()=>kp,BackSide:()=>Ze,BasicDepthPacking:()=>Ii,BasicShadowMap:()=>We,BatchedMesh:()=>Cc,Bone:()=>zl,BooleanKeyframeTrack:()=>td,Box2:()=>qf,Box3:()=>Is,Box3Helper:()=>Mp,BoxGeometry:()=>jo,BoxHelper:()=>Ap,BufferAttribute:()=>co,BufferGeometry:()=>Mo,BufferGeometryLoader:()=>Hd,ByteType:()=>dn,Cache:()=>ud,Camera:()=>Xo,CameraHelper:()=>Ep,CanvasTexture:()=>iu,CapsuleGeometry:()=>ou,CatmullRomCurve3:()=>Au,CineonToneMapping:()=>Ut,CircleGeometry:()=>lu,ClampToEdgeWrapping:()=>Qt,Clock:()=>af,Color:()=>Za,ColorKeyframeTrack:()=>nd,ColorManagement:()=>fs,CompressedArrayTexture:()=>tu,CompressedCubeTexture:()=>nu,CompressedTexture:()=>eu,CompressedTextureLoader:()=>yd,ConeGeometry:()=>uu,ConstantAlphaFactor:()=>St,ConstantColorFactor:()=>xt,Controls:()=>Np,CubeCamera:()=>$o,CubeDepthTexture:()=>su,CubeReflectionMapping:()=>Yt,CubeRefractionMapping:()=>Xt,CubeTexture:()=>el,CubeTextureLoader:()=>_d,CubeUVReflectionMapping:()=>Zt,CubicBezierCurve:()=>Lu,CubicBezierCurve3:()=>Iu,CubicInterpolant:()=>Jh,CullFaceBack:()=>Ge,CullFaceFront:()=>Ve,CullFaceFrontBack:()=>He,CullFaceNone:()=>je,Curve:()=>yu,CurvePath:()=>Uu,CustomBlending:()=>it,CustomToneMapping:()=>zt,CylinderGeometry:()=>cu,Cylindrical:()=>Wf,Data3DTexture:()=>Cs,DataArrayTexture:()=>Ms,DataTexture:()=>jl,DataTextureLoader:()=>Sd,DataUtils:()=>so,DecrementStencilOp:()=>Ki,DecrementWrapStencilOp:()=>Ji,DefaultLoadingManager:()=>dd,DepthFormat:()=>Mn,DepthStencilFormat:()=>Rn,DepthTexture:()=>ru,DetachedBindMode:()=>Ht,DirectionalLight:()=>Od,DirectionalLightHelper:()=>xp,DiscreteInterpolant:()=>$h,DodecahedronGeometry:()=>du,DoubleSide:()=>Je,DstAlphaFactor:()=>mt,DstColorFactor:()=>vt,DynamicCopyUsage:()=>Sr,DynamicDrawUsage:()=>gr,DynamicReadUsage:()=>br,EdgesGeometry:()=>vu,EllipseCurve:()=>bu,EqualCompare:()=>cr,EqualDepth:()=>Rt,EqualStencilFunc:()=>tr,EquirectangularReflectionMapping:()=>qt,EquirectangularRefractionMapping:()=>Kt,Euler:()=>pa,EventDispatcher:()=>Wr,ExternalTexture:()=>au,ExtrudeGeometry:()=>vh,FileLoader:()=>gd,Float16BufferAttribute:()=>yo,Float32BufferAttribute:()=>bo,FloatType:()=>vn,Fog:()=>al,FogExp2:()=>sl,FramebufferTexture:()=>$c,FrontSide:()=>Ke,Frustum:()=>oc,FrustumArray:()=>uc,GLBufferAttribute:()=>Ff,GLSL1:()=>Tr,GLSL3:()=>wr,GreaterCompare:()=>hr,GreaterDepth:()=>Lt,GreaterEqualCompare:()=>fr,GreaterEqualDepth:()=>Ct,GreaterEqualStencilFunc:()=>sr,GreaterStencilFunc:()=>ir,GridHelper:()=>mp,Group:()=>nl,HalfFloatType:()=>yn,HemisphereLight:()=>wd,HemisphereLightHelper:()=>pp,IcosahedronGeometry:()=>bh,ImageBitmapLoader:()=>Zd,ImageLoader:()=>xd,ImageUtils:()=>vs,IncrementStencilOp:()=>qi,IncrementWrapStencilOp:()=>Zi,InstancedBufferAttribute:()=>Wl,InstancedBufferGeometry:()=>Vd,InstancedInterleavedBuffer:()=>Of,InstancedMesh:()=>$l,Int16BufferAttribute:()=>po,Int32BufferAttribute:()=>go,Int8BufferAttribute:()=>uo,IntType:()=>mn,InterleavedBuffer:()=>ll,InterleavedBufferAttribute:()=>ul,Interpolant:()=>Zh,InterpolateDiscrete:()=>xi,InterpolateLinear:()=>_i,InterpolateSmooth:()=>Si,InterpolationSamplingMode:()=>Lr,InterpolationSamplingType:()=>Cr,InvertStencilOp:()=>Qi,KeepStencilOp:()=>Yi,KeyframeTrack:()=>ed,LOD:()=>Cl,LatheGeometry:()=>xh,Layers:()=>ma,LessCompare:()=>lr,LessDepth:()=>At,LessEqualCompare:()=>ur,LessEqualDepth:()=>Mt,LessEqualStencilFunc:()=>nr,LessStencilFunc:()=>er,Light:()=>Td,LightProbe:()=>zd,Line:()=>Uc,Line3:()=>np,LineBasicMaterial:()=>Lc,LineCurve:()=>Pu,LineCurve3:()=>ku,LineDashedMaterial:()=>Hh,LineLoop:()=>Vc,LineSegments:()=>Gc,LinearFilter:()=>an,LinearInterpolant:()=>Qh,LinearMipMapLinearFilter:()=>un,LinearMipMapNearestFilter:()=>ln,LinearMipmapLinearFilter:()=>cn,LinearMipmapNearestFilter:()=>on,LinearSRGBColorSpace:()=>Bi,LinearToneMapping:()=>Ot,LinearTransfer:()=>zi,Loader:()=>fd,LoaderUtils:()=>Gd,LoadingManager:()=>hd,LoopOnce:()=>vi,LoopPingPong:()=>bi,LoopRepeat:()=>yi,MOUSE:()=>Be,Material:()=>$a,MaterialLoader:()=>jd,MathUtils:()=>ns,Matrix2:()=>Yf,Matrix3:()=>ls,Matrix4:()=>ra,MaxEquation:()=>lt,Mesh:()=>Bo,MeshBasicMaterial:()=>eo,MeshDepthMaterial:()=>jh,MeshDistanceMaterial:()=>Gh,MeshLambertMaterial:()=>zh,MeshMatcapMaterial:()=>Vh,MeshNormalMaterial:()=>Bh,MeshPhongMaterial:()=>Fh,MeshPhysicalMaterial:()=>Oh,MeshStandardMaterial:()=>Nh,MeshToonMaterial:()=>Uh,MinEquation:()=>ot,MirroredRepeatWrapping:()=>$t,MixOperation:()=>kt,MultiplyBlending:()=>nt,MultiplyOperation:()=>Pt,NearestFilter:()=>en,NearestMipMapLinearFilter:()=>sn,NearestMipMapNearestFilter:()=>nn,NearestMipmapLinearFilter:()=>rn,NearestMipmapNearestFilter:()=>tn,NeutralToneMapping:()=>Gt,NeverCompare:()=>or,NeverDepth:()=>Tt,NeverStencilFunc:()=>$i,NoBlending:()=>Qe,NoColorSpace:()=>Fi,NoNormalPacking:()=>Gi,NoToneMapping:()=>Nt,NormalAnimationBlendMode:()=>Ai,NormalBlending:()=>$e,NormalGAPacking:()=>Hi,NormalRGPacking:()=>Vi,NotEqualCompare:()=>dr,NotEqualDepth:()=>It,NotEqualStencilFunc:()=>rr,NumberKeyframeTrack:()=>id,Object3D:()=>Ia,ObjectLoader:()=>Wd,ObjectSpaceNormalMap:()=>Oi,OctahedronGeometry:()=>_h,OneFactor:()=>ut,OneMinusConstantAlphaFactor:()=>Et,OneMinusConstantColorFactor:()=>_t,OneMinusDstAlphaFactor:()=>gt,OneMinusDstColorFactor:()=>yt,OneMinusSrcAlphaFactor:()=>pt,OneMinusSrcColorFactor:()=>dt,OrthographicCamera:()=>Dd,PCFShadowMap:()=>Ye,PCFSoftShadowMap:()=>Xe,PMREMGenerator:()=>om,Path:()=>Bu,PerspectiveCamera:()=>Jo,Plane:()=>ic,PlaneGeometry:()=>Sh,PlaneHelper:()=>Rp,PointLight:()=>kd,PointLightHelper:()=>up,Points:()=>Kc,PointsMaterial:()=>Hc,PolarGridHelper:()=>gp,PolyhedronGeometry:()=>hu,PositionalAudio:()=>yf,PropertyBinding:()=>Mf,PropertyMixer:()=>xf,QuadraticBezierCurve:()=>Du,QuadraticBezierCurve3:()=>Nu,Quaternion:()=>rs,QuaternionKeyframeTrack:()=>sd,QuaternionLinearInterpolant:()=>rd,R11_EAC_Format:()=>Yn,RED_GREEN_RGTC2_Format:()=>mi,RED_RGTC1_Format:()=>fi,REVISION:()=>Ue,RG11_EAC_Format:()=>qn,RGBADepthPacking:()=>Pi,RGBAFormat:()=>An,RGBAIntegerFormat:()=>Dn,RGBA_ASTC_10x10_Format:()=>oi,RGBA_ASTC_10x5_Format:()=>ri,RGBA_ASTC_10x6_Format:()=>si,RGBA_ASTC_10x8_Format:()=>ai,RGBA_ASTC_12x10_Format:()=>li,RGBA_ASTC_12x12_Format:()=>ci,RGBA_ASTC_4x4_Format:()=>Zn,RGBA_ASTC_5x4_Format:()=>Jn,RGBA_ASTC_5x5_Format:()=>Qn,RGBA_ASTC_6x5_Format:()=>$n,RGBA_ASTC_6x6_Format:()=>ei,RGBA_ASTC_8x5_Format:()=>ti,RGBA_ASTC_8x6_Format:()=>ni,RGBA_ASTC_8x8_Format:()=>ii,RGBA_BPTC_Format:()=>ui,RGBA_ETC2_EAC_Format:()=>Wn,RGBA_PVRTC_2BPPV1_Format:()=>Gn,RGBA_PVRTC_4BPPV1_Format:()=>jn,RGBA_S3TC_DXT1_Format:()=>On,RGBA_S3TC_DXT3_Format:()=>Fn,RGBA_S3TC_DXT5_Format:()=>Un,RGBDepthPacking:()=>ki,RGBFormat:()=>wn,RGBIntegerFormat:()=>kn,RGB_BPTC_SIGNED_Format:()=>hi,RGB_BPTC_UNSIGNED_Format:()=>di,RGB_ETC1_Format:()=>Vn,RGB_ETC2_Format:()=>Hn,RGB_PVRTC_2BPPV1_Format:()=>zn,RGB_PVRTC_4BPPV1_Format:()=>Bn,RGB_S3TC_DXT1_Format:()=>Nn,RGDepthPacking:()=>Di,RGFormat:()=>In,RGIntegerFormat:()=>Pn,RawShaderMaterial:()=>Dh,Ray:()=>ia,Raycaster:()=>Bf,RectAreaLight:()=>Ud,RedFormat:()=>Cn,RedIntegerFormat:()=>Ln,ReinhardToneMapping:()=>Ft,RenderTarget:()=>ws,RenderTarget3D:()=>Pf,RepeatWrapping:()=>Jt,ReplaceStencilOp:()=>Xi,ReverseSubtractEquation:()=>at,RingGeometry:()=>Eh,SIGNED_R11_EAC_Format:()=>Xn,SIGNED_RED_GREEN_RGTC2_Format:()=>gi,SIGNED_RED_RGTC1_Format:()=>pi,SIGNED_RG11_EAC_Format:()=>Kn,SRGBColorSpace:()=>Ui,SRGBTransfer:()=>ji,Scene:()=>ol,ShaderChunk:()=>zp,ShaderLib:()=>Gp,ShaderMaterial:()=>Yo,ShadowMaterial:()=>kh,Shape:()=>zu,ShapeGeometry:()=>Th,ShapePath:()=>Dp,ShapeUtils:()=>ph,ShortType:()=>fn,Skeleton:()=>Hl,SkeletonHelper:()=>lp,SkinnedMesh:()=>Bl,Source:()=>bs,Sphere:()=>Ks,SphereGeometry:()=>wh,Spherical:()=>Hf,SphericalHarmonics3:()=>Bd,SplineCurve:()=>Ou,SpotLight:()=>Id,SpotLightHelper:()=>rp,Sprite:()=>wl,SpriteMaterial:()=>hl,SrcAlphaFactor:()=>ft,SrcAlphaSaturateFactor:()=>bt,SrcColorFactor:()=>ht,StaticCopyUsage:()=>_r,StaticDrawUsage:()=>mr,StaticReadUsage:()=>yr,StereoCamera:()=>rf,StreamCopyUsage:()=>Er,StreamDrawUsage:()=>vr,StreamReadUsage:()=>xr,StringKeyframeTrack:()=>ad,SubtractEquation:()=>st,SubtractiveBlending:()=>tt,TOUCH:()=>ze,TangentSpaceNormalMap:()=>Ni,TetrahedronGeometry:()=>Ah,Texture:()=>Es,TextureLoader:()=>Ed,TextureUtils:()=>Fp,Timer:()=>Gf,TimestampQuery:()=>Rr,TorusGeometry:()=>Mh,TorusKnotGeometry:()=>Rh,Triangle:()=>Wa,TriangleFanDrawMode:()=>Li,TriangleStripDrawMode:()=>Ci,TrianglesDrawMode:()=>Ri,TubeGeometry:()=>Ch,UVMapping:()=>Wt,Uint16BufferAttribute:()=>mo,Uint32BufferAttribute:()=>vo,Uint8BufferAttribute:()=>ho,Uint8ClampedBufferAttribute:()=>fo,Uniform:()=>kf,UniformsGroup:()=>Nf,UniformsLib:()=>jp,UniformsUtils:()=>Wo,UnsignedByteType:()=>hn,UnsignedInt101111Type:()=>En,UnsignedInt248Type:()=>_n,UnsignedInt5999Type:()=>Sn,UnsignedIntType:()=>gn,UnsignedShort4444Type:()=>bn,UnsignedShort5551Type:()=>xn,UnsignedShortType:()=>pn,VSMShadowMap:()=>qe,Vector2:()=>is,Vector3:()=>ss,Vector4:()=>Ts,VectorKeyframeTrack:()=>od,VideoFrameTexture:()=>Qc,VideoTexture:()=>Jc,WebGL3DRenderTarget:()=>Ls,WebGLArrayRenderTarget:()=>Rs,WebGLCoordinateSystem:()=>Ar,WebGLCubeRenderTarget:()=>tl,WebGLRenderTarget:()=>As,WebGLRenderer:()=>Lv,WebGLUtils:()=>_v,WebGPUCoordinateSystem:()=>Mr,WebXRController:()=>rl,WireframeGeometry:()=>Lh,WrapAroundEnding:()=>wi,ZeroCurvatureEnding:()=>Ei,ZeroFactor:()=>ct,ZeroSlopeEnding:()=>Ti,ZeroStencilOp:()=>Wi,createCanvasElement:()=>Or,error:()=>Vr,getConsoleFunction:()=>zr,log:()=>jr,setConsoleFunction:()=>Br,warn:()=>Gr,warnOnce:()=>Hr});var t,i=n(43),r=n.t(i,2),s=n(391),a=n(950),o=n.t(a,2);function l(){return l=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},l.apply(this,arguments)}!function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"}(t||(t={}));const c="popstate";function u(e,t){if(!1===e||null===e||"undefined"===typeof e)throw new Error(t)}function h(e,t){if(!e){"undefined"!==typeof console&&console.warn(t);try{throw new Error(t)}catch(n){}}}function d(e,t){return{usr:e.state,key:e.key,idx:t}}function f(e,t,n,i){return void 0===n&&(n=null),l({pathname:"string"===typeof e?e:e.pathname,search:"",hash:""},"string"===typeof t?m(t):t,{state:n,key:t&&t.key||i||Math.random().toString(36).substr(2,8)})}function p(e){let{pathname:t="/",search:n="",hash:i=""}=e;return n&&"?"!==n&&(t+="?"===n.charAt(0)?n:"?"+n),i&&"#"!==i&&(t+="#"===i.charAt(0)?i:"#"+i),t}function m(e){let t={};if(e){let n=e.indexOf("#");n>=0&&(t.hash=e.substr(n),e=e.substr(0,n));let i=e.indexOf("?");i>=0&&(t.search=e.substr(i),e=e.substr(0,i)),e&&(t.pathname=e)}return t}function g(e,n,i,r){void 0===r&&(r={});let{window:s=document.defaultView,v5Compat:a=!1}=r,o=s.history,h=t.Pop,m=null,g=v();function v(){return(o.state||{idx:null}).idx}function y(){h=t.Pop;let e=v(),n=null==e?null:e-g;g=e,m&&m({action:h,location:x.location,delta:n})}function b(e){let t="null"!==s.location.origin?s.location.origin:s.location.href,n="string"===typeof e?e:p(e);return n=n.replace(/ $/,"%20"),u(t,"No window.location.(origin|href) available to create URL for href: "+n),new URL(n,t)}null==g&&(g=0,o.replaceState(l({},o.state,{idx:g}),""));let x={get action(){return h},get location(){return e(s,o)},listen(e){if(m)throw new Error("A history only accepts one active listener");return s.addEventListener(c,y),m=e,()=>{s.removeEventListener(c,y),m=null}},createHref:e=>n(s,e),createURL:b,encodeLocation(e){let t=b(e);return{pathname:t.pathname,search:t.search,hash:t.hash}},push:function(e,n){h=t.Push;let r=f(x.location,e,n);i&&i(r,e),g=v()+1;let l=d(r,g),c=x.createHref(r);try{o.pushState(l,"",c)}catch(Vr){if(Vr instanceof DOMException&&"DataCloneError"===Vr.name)throw Vr;s.location.assign(c)}a&&m&&m({action:h,location:x.location,delta:1})},replace:function(e,n){h=t.Replace;let r=f(x.location,e,n);i&&i(r,e),g=v();let s=d(r,g),l=x.createHref(r);o.replaceState(s,"",l),a&&m&&m({action:h,location:x.location,delta:0})},go:e=>o.go(e)};return x}var v;!function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"}(v||(v={}));new Set(["lazy","caseSensitive","path","id","index","children"]);function y(e,t,n){return void 0===n&&(n="/"),b(e,t,n,!1)}function b(e,t,n,i){let r=k(("string"===typeof t?m(t):t).pathname||"/",n);if(null==r)return null;let s=x(e);!function(e){e.sort((e,t)=>e.score!==t.score?t.score-e.score:function(e,t){let n=e.length===t.length&&e.slice(0,-1).every((e,n)=>e===t[n]);return n?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map(e=>e.childrenIndex),t.routesMeta.map(e=>e.childrenIndex)))}(s);let a=null;for(let o=0;null==a&&o<s.length;++o){let e=P(r);a=L(s[o],e,i)}return a}function x(e,t,n,i){void 0===t&&(t=[]),void 0===n&&(n=[]),void 0===i&&(i="");let r=(e,r,s)=>{let a={relativePath:void 0===s?e.path||"":s,caseSensitive:!0===e.caseSensitive,childrenIndex:r,route:e};a.relativePath.startsWith("/")&&(u(a.relativePath.startsWith(i),'Absolute route path "'+a.relativePath+'" nested under path "'+i+'" is not valid. An absolute child route path must start with the combined path of all its parent routes.'),a.relativePath=a.relativePath.slice(i.length));let o=j([i,a.relativePath]),l=n.concat(a);e.children&&e.children.length>0&&(u(!0!==e.index,'Index routes must not have child routes. Please remove all child routes from route path "'+o+'".'),x(e.children,t,l,o)),(null!=e.path||e.index)&&t.push({path:o,score:C(o,e.index),routesMeta:l})};return e.forEach((e,t)=>{var n;if(""!==e.path&&null!=(n=e.path)&&n.includes("?"))for(let i of _(e.path))r(e,t,i);else r(e,t)}),t}function _(e){let t=e.split("/");if(0===t.length)return[];let[n,...i]=t,r=n.endsWith("?"),s=n.replace(/\?$/,"");if(0===i.length)return r?[s,""]:[s];let a=_(i.join("/")),o=[];return o.push(...a.map(e=>""===e?s:[s,e].join("/"))),r&&o.push(...a),o.map(t=>e.startsWith("/")&&""===t?"/":t)}const S=/^:[\w-]+$/,E=3,T=2,w=1,A=10,M=-2,R=e=>"*"===e;function C(e,t){let n=e.split("/"),i=n.length;return n.some(R)&&(i+=M),t&&(i+=T),n.filter(e=>!R(e)).reduce((e,t)=>e+(S.test(t)?E:""===t?w:A),i)}function L(e,t,n){void 0===n&&(n=!1);let{routesMeta:i}=e,r={},s="/",a=[];for(let o=0;o<i.length;++o){let e=i[o],l=o===i.length-1,c="/"===s?t:t.slice(s.length)||"/",u=I({path:e.relativePath,caseSensitive:e.caseSensitive,end:l},c),h=e.route;if(!u&&l&&n&&!i[i.length-1].route.index&&(u=I({path:e.relativePath,caseSensitive:e.caseSensitive,end:!1},c)),!u)return null;Object.assign(r,u.params),a.push({params:r,pathname:j([s,u.pathname]),pathnameBase:G(j([s,u.pathnameBase])),route:h}),"/"!==u.pathnameBase&&(s=j([s,u.pathnameBase]))}return a}function I(e,t){"string"===typeof e&&(e={path:e,caseSensitive:!1,end:!0});let[n,i]=function(e,t,n){void 0===t&&(t=!1);void 0===n&&(n=!0);h("*"===e||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were "'+e.replace(/\*$/,"/*")+'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "'+e.replace(/\*$/,"/*")+'".');let i=[],r="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(e,t,n)=>(i.push({paramName:t,isOptional:null!=n}),n?"/?([^\\/]+)?":"/([^\\/]+)"));e.endsWith("*")?(i.push({paramName:"*"}),r+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?r+="\\/*$":""!==e&&"/"!==e&&(r+="(?:(?=\\/|$))");let s=new RegExp(r,t?void 0:"i");return[s,i]}(e.path,e.caseSensitive,e.end),r=t.match(n);if(!r)return null;let s=r[0],a=s.replace(/(.)\/+$/,"$1"),o=r.slice(1);return{params:i.reduce((e,t,n)=>{let{paramName:i,isOptional:r}=t;if("*"===i){let e=o[n]||"";a=s.slice(0,s.length-e.length).replace(/(.)\/+$/,"$1")}const l=o[n];return e[i]=r&&!l?void 0:(l||"").replace(/%2F/g,"/"),e},{}),pathname:s,pathnameBase:a,pattern:e}}function P(e){try{return e.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(Vr){return h(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding ('+Vr+")."),e}}function k(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=t.endsWith("/")?t.length-1:t.length,i=e.charAt(n);return i&&"/"!==i?null:e.slice(n)||"/"}const D=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i;function N(e,t){void 0===t&&(t="/");let n,{pathname:i,search:r="",hash:s=""}="string"===typeof e?m(e):e;if(i)if(a=i,D.test(a))n=i;else{if(i.includes("//")){let e=i;i=i.replace(/\/\/+/g,"/"),h(!1,"Pathnames cannot have embedded double slashes - normalizing "+e+" -> "+i)}n=i.startsWith("/")?O(i.substring(1),"/"):O(i,t)}else n=t;var a;return{pathname:n,search:V(r),hash:H(s)}}function O(e,t){let n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(e=>{".."===e?n.length>1&&n.pop():"."!==e&&n.push(e)}),n.length>1?n.join("/"):"/"}function F(e,t,n,i){return"Cannot include a '"+e+"' character in a manually specified `to."+t+"` field ["+JSON.stringify(i)+"].  Please separate it out to the `to."+n+'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.'}function U(e){return e.filter((e,t)=>0===t||e.route.path&&e.route.path.length>0)}function B(e,t){let n=U(e);return t?n.map((e,t)=>t===n.length-1?e.pathname:e.pathnameBase):n.map(e=>e.pathnameBase)}function z(e,t,n,i){let r;void 0===i&&(i=!1),"string"===typeof e?r=m(e):(r=l({},e),u(!r.pathname||!r.pathname.includes("?"),F("?","pathname","search",r)),u(!r.pathname||!r.pathname.includes("#"),F("#","pathname","hash",r)),u(!r.search||!r.search.includes("#"),F("#","search","hash",r)));let s,a=""===e||""===r.pathname,o=a?"/":r.pathname;if(null==o)s=n;else{let e=t.length-1;if(!i&&o.startsWith("..")){let t=o.split("/");for(;".."===t[0];)t.shift(),e-=1;r.pathname=t.join("/")}s=e>=0?t[e]:"/"}let c=N(r,s),h=o&&"/"!==o&&o.endsWith("/"),d=(a||"."===o)&&n.endsWith("/");return c.pathname.endsWith("/")||!h&&!d||(c.pathname+="/"),c}const j=e=>e.join("/").replace(/\/\/+/g,"/"),G=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),V=e=>e&&"?"!==e?e.startsWith("?")?e:"?"+e:"",H=e=>e&&"#"!==e?e.startsWith("#")?e:"#"+e:"";Error;function W(e){return null!=e&&"number"===typeof e.status&&"string"===typeof e.statusText&&"boolean"===typeof e.internal&&"data"in e}const Y=["post","put","patch","delete"],X=(new Set(Y),["get",...Y]);new Set(X),new Set([301,302,303,307,308]),new Set([307,308]);Symbol("deferred");function q(){return q=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},q.apply(this,arguments)}const K=i.createContext(null);const Z=i.createContext(null);const J=i.createContext(null);const Q=i.createContext(null);const $=i.createContext({outlet:null,matches:[],isDataRoute:!1});const ee=i.createContext(null);function te(){return null!=i.useContext(Q)}function ne(){return te()||u(!1),i.useContext(Q).location}function ie(e){i.useContext(J).static||i.useLayoutEffect(e)}function re(){let{isDataRoute:e}=i.useContext($);return e?function(){let{router:e}=pe(de.UseNavigateStable),t=ge(fe.UseNavigateStable),n=i.useRef(!1);return ie(()=>{n.current=!0}),i.useCallback(function(i,r){void 0===r&&(r={}),n.current&&("number"===typeof i?e.navigate(i):e.navigate(i,q({fromRouteId:t},r)))},[e,t])}():function(){te()||u(!1);let e=i.useContext(K),{basename:t,future:n,navigator:r}=i.useContext(J),{matches:s}=i.useContext($),{pathname:a}=ne(),o=JSON.stringify(B(s,n.v7_relativeSplatPath)),l=i.useRef(!1);return ie(()=>{l.current=!0}),i.useCallback(function(n,i){if(void 0===i&&(i={}),!l.current)return;if("number"===typeof n)return void r.go(n);let s=z(n,JSON.parse(o),a,"path"===i.relative);null==e&&"/"!==t&&(s.pathname="/"===s.pathname?t:j([t,s.pathname])),(i.replace?r.replace:r.push)(s,i.state,i)},[t,r,o,a,e])}()}function se(e,t){let{relative:n}=void 0===t?{}:t,{future:r}=i.useContext(J),{matches:s}=i.useContext($),{pathname:a}=ne(),o=JSON.stringify(B(s,r.v7_relativeSplatPath));return i.useMemo(()=>z(e,JSON.parse(o),a,"path"===n),[e,o,a,n])}function ae(e,n,r,s){te()||u(!1);let{navigator:a}=i.useContext(J),{matches:o}=i.useContext($),l=o[o.length-1],c=l?l.params:{},h=(l&&l.pathname,l?l.pathnameBase:"/");l&&l.route;let d,f=ne();if(n){var p;let e="string"===typeof n?m(n):n;"/"===h||(null==(p=e.pathname)?void 0:p.startsWith(h))||u(!1),d=e}else d=f;let g=d.pathname||"/",v=g;if("/"!==h){let e=h.replace(/^\//,"").split("/");v="/"+g.replace(/^\//,"").split("/").slice(e.length).join("/")}let b=y(e,{pathname:v});let x=he(b&&b.map(e=>Object.assign({},e,{params:Object.assign({},c,e.params),pathname:j([h,a.encodeLocation?a.encodeLocation(e.pathname).pathname:e.pathname]),pathnameBase:"/"===e.pathnameBase?h:j([h,a.encodeLocation?a.encodeLocation(e.pathnameBase).pathname:e.pathnameBase])})),o,r,s);return n&&x?i.createElement(Q.Provider,{value:{location:q({pathname:"/",search:"",hash:"",state:null,key:"default"},d),navigationType:t.Pop}},x):x}function oe(){let e=function(){var e;let t=i.useContext(ee),n=me(fe.UseRouteError),r=ge(fe.UseRouteError);if(void 0!==t)return t;return null==(e=n.errors)?void 0:e[r]}(),t=W(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),n=e instanceof Error?e.stack:null,r="rgba(200,200,200, 0.5)",s={padding:"0.5rem",backgroundColor:r};return i.createElement(i.Fragment,null,i.createElement("h2",null,"Unexpected Application Error!"),i.createElement("h3",{style:{fontStyle:"italic"}},t),n?i.createElement("pre",{style:s},n):null,null)}const le=i.createElement(oe,null);class ce extends i.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||"idle"!==t.revalidation&&"idle"===e.revalidation?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:void 0!==e.error?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return void 0!==this.state.error?i.createElement($.Provider,{value:this.props.routeContext},i.createElement(ee.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function ue(e){let{routeContext:t,match:n,children:r}=e,s=i.useContext(K);return s&&s.static&&s.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=n.route.id),i.createElement($.Provider,{value:t},r)}function he(e,t,n,r){var s;if(void 0===t&&(t=[]),void 0===n&&(n=null),void 0===r&&(r=null),null==e){var a;if(!n)return null;if(n.errors)e=n.matches;else{if(!(null!=(a=r)&&a.v7_partialHydration&&0===t.length&&!n.initialized&&n.matches.length>0))return null;e=n.matches}}let o=e,l=null==(s=n)?void 0:s.errors;if(null!=l){let e=o.findIndex(e=>e.route.id&&void 0!==(null==l?void 0:l[e.route.id]));e>=0||u(!1),o=o.slice(0,Math.min(o.length,e+1))}let c=!1,h=-1;if(n&&r&&r.v7_partialHydration)for(let i=0;i<o.length;i++){let e=o[i];if((e.route.HydrateFallback||e.route.hydrateFallbackElement)&&(h=i),e.route.id){let{loaderData:t,errors:i}=n,r=e.route.loader&&void 0===t[e.route.id]&&(!i||void 0===i[e.route.id]);if(e.route.lazy||r){c=!0,o=h>=0?o.slice(0,h+1):[o[0]];break}}}return o.reduceRight((e,r,s)=>{let a,u=!1,d=null,f=null;var p;n&&(a=l&&r.route.id?l[r.route.id]:void 0,d=r.route.errorElement||le,c&&(h<0&&0===s?(p="route-fallback",!1||ve[p]||(ve[p]=!0),u=!0,f=null):h===s&&(u=!0,f=r.route.hydrateFallbackElement||null)));let m=t.concat(o.slice(0,s+1)),g=()=>{let t;return t=a?d:u?f:r.route.Component?i.createElement(r.route.Component,null):r.route.element?r.route.element:e,i.createElement(ue,{match:r,routeContext:{outlet:e,matches:m,isDataRoute:null!=n},children:t})};return n&&(r.route.ErrorBoundary||r.route.errorElement||0===s)?i.createElement(ce,{location:n.location,revalidation:n.revalidation,component:d,error:a,children:g(),routeContext:{outlet:null,matches:m,isDataRoute:!0}}):g()},null)}var de=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(de||{}),fe=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(fe||{});function pe(e){let t=i.useContext(K);return t||u(!1),t}function me(e){let t=i.useContext(Z);return t||u(!1),t}function ge(e){let t=function(){let e=i.useContext($);return e||u(!1),e}(),n=t.matches[t.matches.length-1];return n.route.id||u(!1),n.route.id}const ve={};function ye(e,t){null==e||e.v7_startTransition,void 0===(null==e?void 0:e.v7_relativeSplatPath)&&(!t||t.v7_relativeSplatPath),t&&(t.v7_fetcherPersist,t.v7_normalizeFormMethod,t.v7_partialHydration,t.v7_skipActionErrorRevalidation)}r.startTransition;function be(e){u(!1)}function xe(e){let{basename:n="/",children:r=null,location:s,navigationType:a=t.Pop,navigator:o,static:l=!1,future:c}=e;te()&&u(!1);let h=n.replace(/^\/*/,"/"),d=i.useMemo(()=>({basename:h,navigator:o,static:l,future:q({v7_relativeSplatPath:!1},c)}),[h,c,o,l]);"string"===typeof s&&(s=m(s));let{pathname:f="/",search:p="",hash:g="",state:v=null,key:y="default"}=s,b=i.useMemo(()=>{let e=k(f,h);return null==e?null:{location:{pathname:e,search:p,hash:g,state:v,key:y},navigationType:a}},[h,f,p,g,v,y,a]);return null==b?null:i.createElement(J.Provider,{value:d},i.createElement(Q.Provider,{children:r,value:b}))}function _e(e){let{children:t,location:n}=e;return ae(Se(t),n)}new Promise(()=>{});i.Component;function Se(e,t){void 0===t&&(t=[]);let n=[];return i.Children.forEach(e,(e,r)=>{if(!i.isValidElement(e))return;let s=[...t,r];if(e.type===i.Fragment)return void n.push.apply(n,Se(e.props.children,s));e.type!==be&&u(!1),e.props.index&&e.props.children&&u(!1);let a={id:e.props.id||s.join("-"),caseSensitive:e.props.caseSensitive,element:e.props.element,Component:e.props.Component,index:e.props.index,path:e.props.path,loader:e.props.loader,action:e.props.action,errorElement:e.props.errorElement,ErrorBoundary:e.props.ErrorBoundary,hasErrorBoundary:null!=e.props.ErrorBoundary||null!=e.props.errorElement,shouldRevalidate:e.props.shouldRevalidate,handle:e.props.handle,lazy:e.props.lazy};e.props.children&&(a.children=Se(e.props.children,s)),n.push(a)}),n}function Ee(){return Ee=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Ee.apply(this,arguments)}function Te(e,t){if(null==e)return{};var n,i,r={},s=Object.keys(e);for(i=0;i<s.length;i++)n=s[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);const we=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"];try{window.__reactRouterVersion="6"}catch(Px){}new Map;const Ae=r.startTransition;o.flushSync,r.useId;function Me(e){let{basename:t,children:n,future:r,window:s}=e,a=i.useRef();var o;null==a.current&&(a.current=(void 0===(o={window:s,v5Compat:!0})&&(o={}),g(function(e,t){let{pathname:n,search:i,hash:r}=e.location;return f("",{pathname:n,search:i,hash:r},t.state&&t.state.usr||null,t.state&&t.state.key||"default")},function(e,t){return"string"===typeof t?t:p(t)},null,o)));let l=a.current,[c,u]=i.useState({action:l.action,location:l.location}),{v7_startTransition:h}=r||{},d=i.useCallback(e=>{h&&Ae?Ae(()=>u(e)):u(e)},[u,h]);return i.useLayoutEffect(()=>l.listen(d),[l,d]),i.useEffect(()=>ye(r),[r]),i.createElement(xe,{basename:t,children:n,location:c.location,navigationType:c.action,navigator:l,future:r})}const Re="undefined"!==typeof window&&"undefined"!==typeof window.document&&"undefined"!==typeof window.document.createElement,Ce=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Le=i.forwardRef(function(e,t){let n,{onClick:r,relative:s,reloadDocument:a,replace:o,state:l,target:c,to:h,preventScrollReset:d,viewTransition:f}=e,m=Te(e,we),{basename:g}=i.useContext(J),v=!1;if("string"===typeof h&&Ce.test(h)&&(n=h,Re))try{let e=new URL(window.location.href),t=h.startsWith("//")?new URL(e.protocol+h):new URL(h),n=k(t.pathname,g);t.origin===e.origin&&null!=n?h=n+t.search+t.hash:v=!0}catch(Px){}let y=function(e,t){let{relative:n}=void 0===t?{}:t;te()||u(!1);let{basename:r,navigator:s}=i.useContext(J),{hash:a,pathname:o,search:l}=se(e,{relative:n}),c=o;return"/"!==r&&(c="/"===o?r:j([r,o])),s.createHref({pathname:c,search:l,hash:a})}(h,{relative:s}),b=function(e,t){let{target:n,replace:r,state:s,preventScrollReset:a,relative:o,viewTransition:l}=void 0===t?{}:t,c=re(),u=ne(),h=se(e,{relative:o});return i.useCallback(t=>{if(function(e,t){return 0===e.button&&(!t||"_self"===t)&&!function(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}(e)}(t,n)){t.preventDefault();let n=void 0!==r?r:p(u)===p(h);c(e,{replace:n,state:s,preventScrollReset:a,relative:o,viewTransition:l})}},[u,c,h,r,s,n,e,a,o,l])}(h,{replace:o,state:l,target:c,preventScrollReset:d,relative:s,viewTransition:f});return i.createElement("a",Ee({},m,{href:n||y,onClick:v||a?r:function(e){r&&r(e),e.defaultPrevented||b(e)},ref:t,target:c}))});var Ie,Pe;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(Ie||(Ie={})),function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"}(Pe||(Pe={}));var ke=n(579);const De=function(){return"/"===ne().pathname?(0,ke.jsx)("header",{className:"absolute top-0 left-0 w-full z-20 py-4",children:(0,ke.jsx)("div",{className:"container mx-auto px-4",children:(0,ke.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ke.jsxs)(Le,{to:"/",className:"flex items-center gap-3",children:[(0,ke.jsx)("img",{src:"/assets/logo.jpg",alt:"RIS Logo",className:"h-10 w-10 rounded-full"}),(0,ke.jsx)("span",{className:"text-2xl font-bold text-white",children:"Greetins"})]}),(0,ke.jsxs)("nav",{className:"hidden md:flex space-x-8",children:[(0,ke.jsx)(Le,{to:"/",className:"text-gray-200 hover:text-white transition-colors",children:"Home"}),(0,ke.jsx)(Le,{to:"/services",className:"text-gray-200 hover:text-white transition-colors",children:"Services"}),(0,ke.jsx)(Le,{to:"/about",className:"text-gray-200 hover:text-white transition-colors",children:"About"})]})]})})}):(0,ke.jsx)("header",{className:"bg-white shadow-sm border-b",children:(0,ke.jsx)("div",{className:"container mx-auto px-4 py-4",children:(0,ke.jsx)("div",{className:"flex items-center justify-between",children:(0,ke.jsxs)(Le,{to:"/",className:"flex items-center gap-2",children:[(0,ke.jsx)("img",{src:"/assets/logo.jpg",alt:"RIS Logo",className:"h-10 w-auto"}),(0,ke.jsx)("span",{className:"text-2xl font-bold text-purple-600",children:"Greetins"})]})})})})};const Ne=()=>{const[e,t]=(0,i.useState)(0),[n,r]=(0,i.useState)(!1),s=[{name:"Bharat",role:"Backend Developer",image:"/assets/team/bharat.jpg"},{name:"Jagadeesh",role:"Frontend Developer",image:"/assets/team/jagadeesh.jpg"},{name:"Sanjithaa",role:"Frontend Designer",image:"/assets/team/sanjithaa.jpg"},{name:"Sai Vamsi",role:"Backend Developer",image:"/assets/team/saivamsi.jpg"},{name:"Ramu",role:"Backend Developer",image:"/assets/team/ramu.webp"},{name:"Pooja",role:"Frontend Developer",image:"/assets/team/pooja.jpg"},{name:"Dhinesh",role:"Backend Developer",image:"/assets/team/dhinesh.jpg"},{name:"Harsha",role:"Backend Developer",image:"/assets/team/harsha.jpg"},{name:"Vignesh",role:"Frontend Developer",image:"/assets/team/vingesh.jpg"},{name:"Zaffer",role:"Backend Developer",image:"/assets/team/zaffer.jpeg"},{name:"Gowtham",role:"Frontend Developer",image:"/assets/team/Gowtham.jpeg"}],a=e=>{n||(r(!0),t((e+s.length)%s.length),setTimeout(()=>r(!1),800))},o=t=>{const n=(t-e+s.length)%s.length;return 0===n?"center":1===n?"right-1":2===n?"right-2":n===s.length-1?"left-1":n===s.length-2?"left-2":"hidden"};return(0,i.useEffect)(()=>{const t=t=>{"ArrowLeft"===t.key&&a(e-1),"ArrowRight"===t.key&&a(e+1)};return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)},[e]),(0,ke.jsxs)("section",{className:"py-20 relative overflow-hidden",children:[(0,ke.jsx)("style",{children:'\n        .about-title {\n          font-size: 7.5rem;\n          font-weight: 900;\n          text-transform: uppercase;\n          letter-spacing: -0.02em;\n          position: absolute;\n          top: 45px;\n          left: 50%;\n          transform: translateX(-50%);\n          pointer-events: none;\n          white-space: nowrap;\n          font-family: "Arial Black", "Arial Bold", Arial, sans-serif;\n          background: linear-gradient(to bottom, rgb(8 42 123) 30%, rgb(8 42 123 / 70%) 76%);\n          -webkit-background-clip: text;\n          background-clip: text;\n          color: transparent;\n        }\n        .carousel-container {\n          width: 100%;\n          max-width: 1200px;\n          height: 450px;\n          position: relative;\n          perspective: 1000px;\n          margin: 80px auto 0;\n        }\n        .carousel-track {\n          width: 100%;\n          height: 100%;\n          display: flex;\n          justify-content: center;\n          align-items: center;\n          position: relative;\n          transform-style: preserve-3d;\n        }\n        .card {\n          position: absolute;\n          width: 280px;\n          height: 380px;\n          background: white;\n          border-radius: 20px;\n          overflow: hidden;\n          box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);\n          transition: all 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);\n          cursor: pointer;\n        }\n        .card img {\n          width: 100%;\n          height: 100%;\n          object-fit: cover;\n          transition: all 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);\n        }\n        .card.center {\n          z-index: 10;\n          transform: scale(1.1) translateZ(0);\n        }\n        .card.center img {\n          filter: none;\n        }\n        .card.left-2 {\n          z-index: 1;\n          transform: translateX(-400px) scale(0.8) translateZ(-300px);\n          opacity: 0.7;\n        }\n        .card.left-2 img {\n          filter: grayscale(100%);\n        }\n        .card.left-1 {\n          z-index: 5;\n          transform: translateX(-200px) scale(0.9) translateZ(-100px);\n          opacity: 0.9;\n        }\n        .card.left-1 img {\n          filter: grayscale(100%);\n        }\n        .card.right-1 {\n          z-index: 5;\n          transform: translateX(200px) scale(0.9) translateZ(-100px);\n          opacity: 0.9;\n        }\n        .card.right-1 img {\n          filter: grayscale(100%);\n        }\n        .card.right-2 {\n          z-index: 1;\n          transform: translateX(400px) scale(0.8) translateZ(-300px);\n          opacity: 0.7;\n        }\n        .card.right-2 img {\n          filter: grayscale(100%);\n        }\n        .card.hidden {\n          opacity: 0;\n          pointer-events: none;\n        }\n        .member-info {\n          text-align: center;\n          margin-top: 40px;\n          transition: all 0.5s ease-out;\n        }\n        .member-name {\n          color: rgb(8, 42, 123);\n          font-size: 2.5rem;\n          font-weight: 700;\n          margin-bottom: 10px;\n          position: relative;\n          display: inline-block;\n        }\n        .member-name::before,\n        .member-name::after {\n          content: "";\n          position: absolute;\n          top: 100%;\n          width: 100px;\n          height: 2px;\n          background: rgb(8, 42, 123);\n        }\n        .member-name::before {\n          left: -120px;\n        }\n        .member-name::after {\n          right: -120px;\n        }\n        .member-role {\n          color: #848696;\n          font-size: 1.5rem;\n          font-weight: 500;\n          opacity: 0.8;\n          text-transform: uppercase;\n          letter-spacing: 0.1em;\n          padding: 10px 0;\n          margin-top: -15px;\n        }\n        .dots {\n          display: flex;\n          justify-content: center;\n          gap: 10px;\n          margin-top: 60px;\n        }\n        .dot {\n          width: 12px;\n          height: 12px;\n          border-radius: 50%;\n          background: rgba(8, 42, 123, 0.2);\n          cursor: pointer;\n          transition: all 0.3s ease;\n        }\n        .dot.active {\n          background: rgb(8, 42, 123);\n          transform: scale(1.2);\n        }\n        .nav-arrow {\n          position: absolute;\n          top: 50%;\n          transform: translateY(-50%);\n          background: rgba(8, 42, 123, 0.6);\n          color: white;\n          width: 40px;\n          height: 40px;\n          border-radius: 50%;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          cursor: pointer;\n          z-index: 20;\n          transition: all 0.3s ease;\n          font-size: 1.5rem;\n          border: none;\n          outline: none;\n          padding-bottom: 4px;\n        }\n        .nav-arrow:hover {\n          background: rgba(0, 0, 0, 0.8);\n          transform: translateY(-50%) scale(1.1);\n        }\n        .nav-arrow.left {\n          left: 20px;\n          padding-right: 3px;\n        }\n        .nav-arrow.right {\n          right: 20px;\n          padding-left: 3px;\n        }\n        @media (max-width: 768px) {\n          .about-title {\n            font-size: 4.5rem;\n          }\n          .card {\n            width: 200px;\n            height: 280px;\n          }\n          .card.left-2 {\n            transform: translateX(-250px) scale(0.8) translateZ(-300px);\n          }\n          .card.left-1 {\n            transform: translateX(-120px) scale(0.9) translateZ(-100px);\n          }\n          .card.right-1 {\n            transform: translateX(120px) scale(0.9) translateZ(-100px);\n          }\n          .card.right-2 {\n            transform: translateX(250px) scale(0.8) translateZ(-300px);\n          }\n          .member-name {\n            font-size: 2rem;\n          }\n          .member-role {\n            font-size: 1.2rem;\n          }\n          .member-name::before,\n          .member-name::after {\n            width: 50px;\n          }\n          .member-name::before {\n            left: -70px;\n          }\n          .member-name::after {\n            right: -70px;\n          }\n        }\n      '}),(0,ke.jsxs)("div",{className:"container mx-auto px-4 relative",children:[(0,ke.jsx)("h1",{className:"about-title",children:"MEET OUR TEAM"}),(0,ke.jsxs)("div",{className:"carousel-container",children:[(0,ke.jsx)("button",{className:"nav-arrow left",onClick:()=>a(e-1),children:"\u2039"}),(0,ke.jsx)("div",{className:"carousel-track",children:s.map((e,t)=>(0,ke.jsx)("div",{className:"card ".concat(o(t)),onClick:()=>a(t),children:(0,ke.jsx)("img",{src:e.image,alt:e.name})},t))}),(0,ke.jsx)("button",{className:"nav-arrow right",onClick:()=>a(e+1),children:"\u203a"})]}),(0,ke.jsxs)("div",{className:"member-info",children:[(0,ke.jsx)("h2",{className:"member-name",children:s[e].name}),(0,ke.jsx)("p",{className:"member-role",children:s[e].role})]}),(0,ke.jsx)("div",{className:"dots",children:s.map((t,n)=>(0,ke.jsx)("div",{className:"dot ".concat(n===e?"active":""),onClick:()=>a(n)},n))})]})]})};var Oe=n(555);function Fe(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n={};for(var i in e)if({}.hasOwnProperty.call(e,i)){if(-1!==t.indexOf(i))continue;n[i]=e[i]}return n}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)n=s[i],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}const Ue="182",Be={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},ze={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},je=0,Ge=1,Ve=2,He=3,We=0,Ye=1,Xe=2,qe=3,Ke=0,Ze=1,Je=2,Qe=0,$e=1,et=2,tt=3,nt=4,it=5,rt=100,st=101,at=102,ot=103,lt=104,ct=200,ut=201,ht=202,dt=203,ft=204,pt=205,mt=206,gt=207,vt=208,yt=209,bt=210,xt=211,_t=212,St=213,Et=214,Tt=0,wt=1,At=2,Mt=3,Rt=4,Ct=5,Lt=6,It=7,Pt=0,kt=1,Dt=2,Nt=0,Ot=1,Ft=2,Ut=3,Bt=4,zt=5,jt=6,Gt=7,Vt="attached",Ht="detached",Wt=300,Yt=301,Xt=302,qt=303,Kt=304,Zt=306,Jt=1e3,Qt=1001,$t=1002,en=1003,tn=1004,nn=1004,rn=1005,sn=1005,an=1006,on=1007,ln=1007,cn=1008,un=1008,hn=1009,dn=1010,fn=1011,pn=1012,mn=1013,gn=1014,vn=1015,yn=1016,bn=1017,xn=1018,_n=1020,Sn=35902,En=35899,Tn=1021,wn=1022,An=1023,Mn=1026,Rn=1027,Cn=1028,Ln=1029,In=1030,Pn=1031,kn=1032,Dn=1033,Nn=33776,On=33777,Fn=33778,Un=33779,Bn=35840,zn=35841,jn=35842,Gn=35843,Vn=36196,Hn=37492,Wn=37496,Yn=37488,Xn=37489,qn=37490,Kn=37491,Zn=37808,Jn=37809,Qn=37810,$n=37811,ei=37812,ti=37813,ni=37814,ii=37815,ri=37816,si=37817,ai=37818,oi=37819,li=37820,ci=37821,ui=36492,hi=36494,di=36495,fi=36283,pi=36284,mi=36285,gi=36286,vi=2200,yi=2201,bi=2202,xi=2300,_i=2301,Si=2302,Ei=2400,Ti=2401,wi=2402,Ai=2500,Mi=2501,Ri=0,Ci=1,Li=2,Ii=3200,Pi=3201,ki=3202,Di=3203,Ni=0,Oi=1,Fi="",Ui="srgb",Bi="srgb-linear",zi="linear",ji="srgb",Gi="",Vi="rg",Hi="ga",Wi=0,Yi=7680,Xi=7681,qi=7682,Ki=7683,Zi=34055,Ji=34056,Qi=5386,$i=512,er=513,tr=514,nr=515,ir=516,rr=517,sr=518,ar=519,or=512,lr=513,cr=514,ur=515,hr=516,dr=517,fr=518,pr=519,mr=35044,gr=35048,vr=35040,yr=35045,br=35049,xr=35041,_r=35046,Sr=35050,Er=35042,Tr="100",wr="300 es",Ar=2e3,Mr=2001,Rr={COMPUTE:"compute",RENDER:"render"},Cr={PERSPECTIVE:"perspective",LINEAR:"linear",FLAT:"flat"},Lr={NORMAL:"normal",CENTROID:"centroid",SAMPLE:"sample",FIRST:"first",EITHER:"either"};function Ir(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}const Pr={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function kr(e,t){return new Pr[e](t)}function Dr(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function Nr(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function Or(){const e=Nr("canvas");return e.style.display="block",e}const Fr={};let Ur=null;function Br(e){Ur=e}function zr(){return Ur}function jr(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i="THREE."+t.shift();Ur?Ur("log",i,...t):console.log(i,...t)}function Gr(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i="THREE."+t.shift();Ur?Ur("warn",i,...t):console.warn(i,...t)}function Vr(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i="THREE."+t.shift();Ur?Ur("error",i,...t):console.error(i,...t)}function Hr(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=t.join(" ");i in Fr||(Fr[i]=!0,Gr(...t))}class Wr{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){const n=this._listeners;return void 0!==n&&(void 0!==n[e]&&-1!==n[e].indexOf(t))}removeEventListener(e,t){const n=this._listeners;if(void 0===n)return;const i=n[e];if(void 0!==i){const e=i.indexOf(t);-1!==e&&i.splice(e,1)}}dispatchEvent(e){const t=this._listeners;if(void 0===t)return;const n=t[e.type];if(void 0!==n){e.target=this;const t=n.slice(0);for(let n=0,i=t.length;n<i;n++)t[n].call(this,e);e.target=null}}}const Yr=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let Xr=1234567;const qr=Math.PI/180,Kr=180/Math.PI;function Zr(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(Yr[255&e]+Yr[e>>8&255]+Yr[e>>16&255]+Yr[e>>24&255]+"-"+Yr[255&t]+Yr[t>>8&255]+"-"+Yr[t>>16&15|64]+Yr[t>>24&255]+"-"+Yr[63&n|128]+Yr[n>>8&255]+"-"+Yr[n>>16&255]+Yr[n>>24&255]+Yr[255&i]+Yr[i>>8&255]+Yr[i>>16&255]+Yr[i>>24&255]).toLowerCase()}function Jr(e,t,n){return Math.max(t,Math.min(n,e))}function Qr(e,t){return(e%t+t)%t}function $r(e,t,n){return(1-n)*e+n*t}function es(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return e/4294967295;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int32Array:return Math.max(e/2147483647,-1);case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function ts(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return Math.round(4294967295*e);case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int32Array:return Math.round(2147483647*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}}const ns={DEG2RAD:qr,RAD2DEG:Kr,generateUUID:Zr,clamp:Jr,euclideanModulo:Qr,mapLinear:function(e,t,n,i,r){return i+(e-t)*(r-i)/(n-t)},inverseLerp:function(e,t,n){return e!==t?(n-e)/(t-e):0},lerp:$r,damp:function(e,t,n,i){return $r(e,t,1-Math.exp(-n*i))},pingpong:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t-Math.abs(Qr(e,2*t)-t)},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){void 0!==e&&(Xr=e);let t=Xr+=1831565813;return t=Math.imul(t^t>>>15,1|t),t^=t+Math.imul(t^t>>>7,61|t),((t^t>>>14)>>>0)/4294967296},degToRad:function(e){return e*qr},radToDeg:function(e){return e*Kr},isPowerOfTwo:function(e){return 0===(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},setQuaternionFromProperEuler:function(e,t,n,i,r){const s=Math.cos,a=Math.sin,o=s(n/2),l=a(n/2),c=s((t+i)/2),u=a((t+i)/2),h=s((t-i)/2),d=a((t-i)/2),f=s((i-t)/2),p=a((i-t)/2);switch(r){case"XYX":e.set(o*u,l*h,l*d,o*c);break;case"YZY":e.set(l*d,o*u,l*h,o*c);break;case"ZXZ":e.set(l*h,l*d,o*u,o*c);break;case"XZX":e.set(o*u,l*p,l*f,o*c);break;case"YXY":e.set(l*f,o*u,l*p,o*c);break;case"ZYZ":e.set(l*p,l*f,o*u,o*c);break;default:Gr("MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}},normalize:ts,denormalize:es};class is{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;is.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Jr(this.x,e.x,t.x),this.y=Jr(this.y,e.y,t.y),this}clampScalar(e,t){return this.x=Jr(this.x,e,t),this.y=Jr(this.y,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Jr(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Jr(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),i=Math.sin(t),r=this.x-e.x,s=this.y-e.y;return this.x=r*n-s*i+e.x,this.y=r*i+s*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class rs{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=i}static slerpFlat(e,t,n,i,r,s,a){let o=n[i+0],l=n[i+1],c=n[i+2],u=n[i+3],h=r[s+0],d=r[s+1],f=r[s+2],p=r[s+3];if(a<=0)return e[t+0]=o,e[t+1]=l,e[t+2]=c,void(e[t+3]=u);if(a>=1)return e[t+0]=h,e[t+1]=d,e[t+2]=f,void(e[t+3]=p);if(u!==p||o!==h||l!==d||c!==f){let e=o*h+l*d+c*f+u*p;e<0&&(h=-h,d=-d,f=-f,p=-p,e=-e);let t=1-a;if(e<.9995){const n=Math.acos(e),i=Math.sin(n);t=Math.sin(t*n)/i,o=o*t+h*(a=Math.sin(a*n)/i),l=l*t+d*a,c=c*t+f*a,u=u*t+p*a}else{o=o*t+h*a,l=l*t+d*a,c=c*t+f*a,u=u*t+p*a;const e=1/Math.sqrt(o*o+l*l+c*c+u*u);o*=e,l*=e,c*=e,u*=e}}e[t]=o,e[t+1]=l,e[t+2]=c,e[t+3]=u}static multiplyQuaternionsFlat(e,t,n,i,r,s){const a=n[i],o=n[i+1],l=n[i+2],c=n[i+3],u=r[s],h=r[s+1],d=r[s+2],f=r[s+3];return e[t]=a*f+c*u+o*d-l*h,e[t+1]=o*f+c*h+l*u-a*d,e[t+2]=l*f+c*d+a*h-o*u,e[t+3]=c*f-a*u-o*h-l*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=e._x,i=e._y,r=e._z,s=e._order,a=Math.cos,o=Math.sin,l=a(n/2),c=a(i/2),u=a(r/2),h=o(n/2),d=o(i/2),f=o(r/2);switch(s){case"XYZ":this._x=h*c*u+l*d*f,this._y=l*d*u-h*c*f,this._z=l*c*f+h*d*u,this._w=l*c*u-h*d*f;break;case"YXZ":this._x=h*c*u+l*d*f,this._y=l*d*u-h*c*f,this._z=l*c*f-h*d*u,this._w=l*c*u+h*d*f;break;case"ZXY":this._x=h*c*u-l*d*f,this._y=l*d*u+h*c*f,this._z=l*c*f+h*d*u,this._w=l*c*u-h*d*f;break;case"ZYX":this._x=h*c*u-l*d*f,this._y=l*d*u+h*c*f,this._z=l*c*f-h*d*u,this._w=l*c*u+h*d*f;break;case"YZX":this._x=h*c*u+l*d*f,this._y=l*d*u+h*c*f,this._z=l*c*f-h*d*u,this._w=l*c*u-h*d*f;break;case"XZY":this._x=h*c*u-l*d*f,this._y=l*d*u-h*c*f,this._z=l*c*f+h*d*u,this._w=l*c*u+h*d*f;break;default:Gr("Quaternion: .setFromEuler() encountered an unknown order: "+s)}return!0===t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],i=t[4],r=t[8],s=t[1],a=t[5],o=t[9],l=t[2],c=t[6],u=t[10],h=n+a+u;if(h>0){const e=.5/Math.sqrt(h+1);this._w=.25/e,this._x=(c-o)*e,this._y=(r-l)*e,this._z=(s-i)*e}else if(n>a&&n>u){const e=2*Math.sqrt(1+n-a-u);this._w=(c-o)/e,this._x=.25*e,this._y=(i+s)/e,this._z=(r+l)/e}else if(a>u){const e=2*Math.sqrt(1+a-n-u);this._w=(r-l)/e,this._x=(i+s)/e,this._y=.25*e,this._z=(o+c)/e}else{const e=2*Math.sqrt(1+u-n-a);this._w=(s-i)/e,this._x=(r+l)/e,this._y=(o+c)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<1e-8?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Jr(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(0===n)return this;const i=Math.min(1,t/n);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,i=e._y,r=e._z,s=e._w,a=t._x,o=t._y,l=t._z,c=t._w;return this._x=n*c+s*a+i*l-r*o,this._y=i*c+s*o+r*a-n*l,this._z=r*c+s*l+n*o-i*a,this._w=s*c-n*a-i*o-r*l,this._onChangeCallback(),this}slerp(e,t){if(t<=0)return this;if(t>=1)return this.copy(e);let n=e._x,i=e._y,r=e._z,s=e._w,a=this.dot(e);a<0&&(n=-n,i=-i,r=-r,s=-s,a=-a);let o=1-t;if(a<.9995){const e=Math.acos(a),l=Math.sin(e);o=Math.sin(o*e)/l,t=Math.sin(t*e)/l,this._x=this._x*o+n*t,this._y=this._y*o+i*t,this._z=this._z*o+r*t,this._w=this._w*o+s*t,this._onChangeCallback()}else this._x=this._x*o+n*t,this._y=this._y*o+i*t,this._z=this._z*o+r*t,this._w=this._w*o+s*t,this.normalize();return this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),n=Math.random(),i=Math.sqrt(1-n),r=Math.sqrt(n);return this.set(i*Math.sin(e),i*Math.cos(e),r*Math.sin(t),r*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class ss{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;ss.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(os.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(os.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*i,this.y=r[1]*t+r[4]*n+r[7]*i,this.z=r[2]*t+r[5]*n+r[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,r=e.elements,s=1/(r[3]*t+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*i+r[12])*s,this.y=(r[1]*t+r[5]*n+r[9]*i+r[13])*s,this.z=(r[2]*t+r[6]*n+r[10]*i+r[14])*s,this}applyQuaternion(e){const t=this.x,n=this.y,i=this.z,r=e.x,s=e.y,a=e.z,o=e.w,l=2*(s*i-a*n),c=2*(a*t-r*i),u=2*(r*n-s*t);return this.x=t+o*l+s*u-a*c,this.y=n+o*c+a*l-r*u,this.z=i+o*u+r*c-s*l,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i,this.y=r[1]*t+r[5]*n+r[9]*i,this.z=r[2]*t+r[6]*n+r[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Jr(this.x,e.x,t.x),this.y=Jr(this.y,e.y,t.y),this.z=Jr(this.z,e.z,t.z),this}clampScalar(e,t){return this.x=Jr(this.x,e,t),this.y=Jr(this.y,e,t),this.z=Jr(this.z,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Jr(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,i=e.y,r=e.z,s=t.x,a=t.y,o=t.z;return this.x=i*o-r*a,this.y=r*s-n*o,this.z=n*a-i*s,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return as.copy(this).projectOnVector(e),this.sub(as)}reflect(e){return this.sub(as.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Jr(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=2*Math.random()-1,n=Math.sqrt(1-t*t);return this.x=n*Math.cos(e),this.y=t,this.z=n*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const as=new ss,os=new rs;class ls{constructor(e,t,n,i,r,s,a,o,l){ls.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==e&&this.set(e,t,n,i,r,s,a,o,l)}set(e,t,n,i,r,s,a,o,l){const c=this.elements;return c[0]=e,c[1]=i,c[2]=a,c[3]=t,c[4]=r,c[5]=o,c[6]=n,c[7]=s,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,r=this.elements,s=n[0],a=n[3],o=n[6],l=n[1],c=n[4],u=n[7],h=n[2],d=n[5],f=n[8],p=i[0],m=i[3],g=i[6],v=i[1],y=i[4],b=i[7],x=i[2],_=i[5],S=i[8];return r[0]=s*p+a*v+o*x,r[3]=s*m+a*y+o*_,r[6]=s*g+a*b+o*S,r[1]=l*p+c*v+u*x,r[4]=l*m+c*y+u*_,r[7]=l*g+c*b+u*S,r[2]=h*p+d*v+f*x,r[5]=h*m+d*y+f*_,r[8]=h*g+d*b+f*S,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],s=e[4],a=e[5],o=e[6],l=e[7],c=e[8];return t*s*c-t*a*l-n*r*c+n*a*o+i*r*l-i*s*o}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],s=e[4],a=e[5],o=e[6],l=e[7],c=e[8],u=c*s-a*l,h=a*o-c*r,d=l*r-s*o,f=t*u+n*h+i*d;if(0===f)return this.set(0,0,0,0,0,0,0,0,0);const p=1/f;return e[0]=u*p,e[1]=(i*l-c*n)*p,e[2]=(a*n-i*s)*p,e[3]=h*p,e[4]=(c*t-i*o)*p,e[5]=(i*r-a*t)*p,e[6]=d*p,e[7]=(n*o-l*t)*p,e[8]=(s*t-n*r)*p,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,i,r,s,a){const o=Math.cos(r),l=Math.sin(r);return this.set(n*o,n*l,-n*(o*s+l*a)+s+e,-i*l,i*o,-i*(-l*s+o*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(cs.makeScale(e,t)),this}rotate(e){return this.premultiply(cs.makeRotation(-e)),this}translate(e,t){return this.premultiply(cs.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<9;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}const cs=new ls,us=(new ls).set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),hs=(new ls).set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function ds(){const e={enabled:!0,workingColorSpace:Bi,spaces:{},convert:function(e,t,n){return!1!==this.enabled&&t!==n&&t&&n?(this.spaces[t].transfer===ji&&(e.r=ps(e.r),e.g=ps(e.g),e.b=ps(e.b)),this.spaces[t].primaries!==this.spaces[n].primaries&&(e.applyMatrix3(this.spaces[t].toXYZ),e.applyMatrix3(this.spaces[n].fromXYZ)),this.spaces[n].transfer===ji&&(e.r=ms(e.r),e.g=ms(e.g),e.b=ms(e.b)),e):e},workingToColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},colorSpaceToWorking:function(e,t){return this.convert(e,t,this.workingColorSpace)},getPrimaries:function(e){return this.spaces[e].primaries},getTransfer:function(e){return e===Fi?zi:this.spaces[e].transfer},getToneMappingMode:function(e){return this.spaces[e].outputColorSpaceConfig.toneMappingMode||"standard"},getLuminanceCoefficients:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.workingColorSpace;return e.fromArray(this.spaces[t].luminanceCoefficients)},define:function(e){Object.assign(this.spaces,e)},_getMatrix:function(e,t,n){return e.copy(this.spaces[t].toXYZ).multiply(this.spaces[n].fromXYZ)},_getDrawingBufferColorSpace:function(e){return this.spaces[e].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.workingColorSpace;return this.spaces[e].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(t,n){return Hr("ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),e.workingToColorSpace(t,n)},toWorkingColorSpace:function(t,n){return Hr("ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),e.colorSpaceToWorking(t,n)}},t=[.64,.33,.3,.6,.15,.06],n=[.2126,.7152,.0722],i=[.3127,.329];return e.define({[Bi]:{primaries:t,whitePoint:i,transfer:zi,toXYZ:us,fromXYZ:hs,luminanceCoefficients:n,workingColorSpaceConfig:{unpackColorSpace:Ui},outputColorSpaceConfig:{drawingBufferColorSpace:Ui}},[Ui]:{primaries:t,whitePoint:i,transfer:ji,toXYZ:us,fromXYZ:hs,luminanceCoefficients:n,outputColorSpaceConfig:{drawingBufferColorSpace:Ui}}}),e}const fs=ds();function ps(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function ms(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}let gs;class vs{static getDataURL(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image/png";if(/^data:/i.test(e.src))return e.src;if("undefined"===typeof HTMLCanvasElement)return e.src;if(e instanceof HTMLCanvasElement)t=e;else{void 0===gs&&(gs=Nr("canvas")),gs.width=e.width,gs.height=e.height;const n=gs.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=gs}return t.toDataURL(n)}static sRGBToLinear(e){if("undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap){const t=Nr("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const i=n.getImageData(0,0,e.width,e.height),r=i.data;for(let e=0;e<r.length;e++)r[e]=255*ps(r[e]/255);return n.putImageData(i,0,0),t}if(e.data){const t=e.data.slice(0);for(let e=0;e<t.length;e++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[e]=Math.floor(255*ps(t[e]/255)):t[e]=ps(t[e]);return{data:t,width:e.width,height:e.height}}return Gr("ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let ys=0;class bs{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.isSource=!0,Object.defineProperty(this,"id",{value:ys++}),this.uuid=Zr(),this.data=e,this.dataReady=!0,this.version=0}getSize(e){const t=this.data;return"undefined"!==typeof HTMLVideoElement&&t instanceof HTMLVideoElement?e.set(t.videoWidth,t.videoHeight,0):"undefined"!==typeof VideoFrame&&t instanceof VideoFrame?e.set(t.displayHeight,t.displayWidth,0):null!==t?e.set(t.width,t.height,t.depth||0):e.set(0,0,0),e}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const t=void 0===e||"string"===typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];const n={uuid:this.uuid,url:""},i=this.data;if(null!==i){let e;if(Array.isArray(i)){e=[];for(let t=0,n=i.length;t<n;t++)i[t].isDataTexture?e.push(xs(i[t].image)):e.push(xs(i[t]))}else e=xs(i);n.url=e}return t||(e.images[this.uuid]=n),n}}function xs(e){return"undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap?vs.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(Gr("Texture: Unable to serialize Texture."),{})}let _s=0;const Ss=new ss;class Es extends Wr{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Es.DEFAULT_IMAGE,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Es.DEFAULT_MAPPING,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Qt,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Qt,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:an,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:cn,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:An,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:hn,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:Es.DEFAULT_ANISOTROPY,c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:Fi;super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:_s++}),this.uuid=Zr(),this.name="",this.source=new bs(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=i,this.magFilter=r,this.minFilter=s,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=o,this.offset=new is(0,0),this.repeat=new is(1,1),this.center=new is(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new ls,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=c,this.userData={},this.updateRanges=[],this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isArrayTexture=!!(e&&e.depth&&e.depth>1),this.pmremVersion=0}get width(){return this.source.getSize(Ss).x}get height(){return this.source.getSize(Ss).y}get depth(){return this.source.getSize(Ss).z}get image(){return this.source.data}set image(e){void 0===e&&(e=null),this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.isArrayTexture=e.isArrayTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}setValues(e){for(const t in e){const n=e[t];if(void 0===n){Gr("Texture.setValues(): parameter '".concat(t,"' has value of undefined."));continue}const i=this[t];void 0!==i?i&&n&&i.isVector2&&n.isVector2||i&&n&&i.isVector3&&n.isVector3||i&&n&&i.isMatrix3&&n.isMatrix3?i.copy(n):this[t]=n:Gr("Texture.setValues(): property '".concat(t,"' does not exist."))}}toJSON(e){const t=void 0===e||"string"===typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const n={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==Wt)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Jt:e.x=e.x-Math.floor(e.x);break;case Qt:e.x=e.x<0?0:1;break;case $t:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case Jt:e.y=e.y-Math.floor(e.y);break;case Qt:e.y=e.y<0?0:1;break;case $t:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){!0===e&&this.pmremVersion++}}Es.DEFAULT_IMAGE=null,Es.DEFAULT_MAPPING=Wt,Es.DEFAULT_ANISOTROPY=1;class Ts{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;Ts.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,r=this.w,s=e.elements;return this.x=s[0]*t+s[4]*n+s[8]*i+s[12]*r,this.y=s[1]*t+s[5]*n+s[9]*i+s[13]*r,this.z=s[2]*t+s[6]*n+s[10]*i+s[14]*r,this.w=s[3]*t+s[7]*n+s[11]*i+s[15]*r,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,i,r;const s=.01,a=.1,o=e.elements,l=o[0],c=o[4],u=o[8],h=o[1],d=o[5],f=o[9],p=o[2],m=o[6],g=o[10];if(Math.abs(c-h)<s&&Math.abs(u-p)<s&&Math.abs(f-m)<s){if(Math.abs(c+h)<a&&Math.abs(u+p)<a&&Math.abs(f+m)<a&&Math.abs(l+d+g-3)<a)return this.set(1,0,0,0),this;t=Math.PI;const e=(l+1)/2,o=(d+1)/2,v=(g+1)/2,y=(c+h)/4,b=(u+p)/4,x=(f+m)/4;return e>o&&e>v?e<s?(n=0,i=.707106781,r=.707106781):(n=Math.sqrt(e),i=y/n,r=b/n):o>v?o<s?(n=.707106781,i=0,r=.707106781):(i=Math.sqrt(o),n=y/i,r=x/i):v<s?(n=.707106781,i=.707106781,r=0):(r=Math.sqrt(v),n=b/r,i=x/r),this.set(n,i,r,t),this}let v=Math.sqrt((m-f)*(m-f)+(u-p)*(u-p)+(h-c)*(h-c));return Math.abs(v)<.001&&(v=1),this.x=(m-f)/v,this.y=(u-p)/v,this.z=(h-c)/v,this.w=Math.acos((l+d+g-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Jr(this.x,e.x,t.x),this.y=Jr(this.y,e.y,t.y),this.z=Jr(this.z,e.z,t.z),this.w=Jr(this.w,e.w,t.w),this}clampScalar(e,t){return this.x=Jr(this.x,e,t),this.y=Jr(this.y,e,t),this.z=Jr(this.z,e,t),this.w=Jr(this.w,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Jr(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class ws extends Wr{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};super(),n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:an,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1,depth:1,multiview:!1},n),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=n.depth,this.scissor=new Ts(0,0,e,t),this.scissorTest=!1,this.viewport=new Ts(0,0,e,t);const i={width:e,height:t,depth:n.depth},r=new Es(i);this.textures=[];const s=n.count;for(let a=0;a<s;a++)this.textures[a]=r.clone(),this.textures[a].isRenderTargetTexture=!0,this.textures[a].renderTarget=this;this._setTextureOptions(n),this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.resolveDepthBuffer=n.resolveDepthBuffer,this.resolveStencilBuffer=n.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=n.depthTexture,this.samples=n.samples,this.multiview=n.multiview}_setTextureOptions(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t={minFilter:an,generateMipmaps:!1,flipY:!1,internalFormat:null};void 0!==e.mapping&&(t.mapping=e.mapping),void 0!==e.wrapS&&(t.wrapS=e.wrapS),void 0!==e.wrapT&&(t.wrapT=e.wrapT),void 0!==e.wrapR&&(t.wrapR=e.wrapR),void 0!==e.magFilter&&(t.magFilter=e.magFilter),void 0!==e.minFilter&&(t.minFilter=e.minFilter),void 0!==e.format&&(t.format=e.format),void 0!==e.type&&(t.type=e.type),void 0!==e.anisotropy&&(t.anisotropy=e.anisotropy),void 0!==e.colorSpace&&(t.colorSpace=e.colorSpace),void 0!==e.flipY&&(t.flipY=e.flipY),void 0!==e.generateMipmaps&&(t.generateMipmaps=e.generateMipmaps),void 0!==e.internalFormat&&(t.internalFormat=e.internalFormat);for(let n=0;n<this.textures.length;n++){this.textures[n].setValues(t)}}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){null!==this._depthTexture&&(this._depthTexture.renderTarget=null),null!==e&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let i=0,r=this.textures.length;i<r;i++)this.textures[i].image.width=e,this.textures[i].image.height=t,this.textures[i].image.depth=n,!0!==this.textures[i].isData3DTexture&&(this.textures[i].isArrayTexture=this.textures[i].image.depth>1);this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let t=0,n=e.textures.length;t<n;t++){this.textures[t]=e.textures[t].clone(),this.textures[t].isRenderTargetTexture=!0,this.textures[t].renderTarget=this;const n=Object.assign({},e.textures[t].image);this.textures[t].source=new bs(n)}return this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class As extends ws{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}),this.isWebGLRenderTarget=!0}}class Ms extends Es{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=en,this.minFilter=en,this.wrapR=Qt,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class Rs extends As{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(e,t,i),this.isWebGLArrayRenderTarget=!0,this.depth=n,this.texture=new Ms(null,e,t,n),this._setTextureOptions(i),this.texture.isRenderTargetTexture=!0}}class Cs extends Es{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=en,this.minFilter=en,this.wrapR=Qt,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Ls extends As{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(e,t,i),this.isWebGL3DRenderTarget=!0,this.depth=n,this.texture=new Cs(null,e,t,n),this._setTextureOptions(i),this.texture.isRenderTargetTexture=!0}}class Is{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ss(1/0,1/0,1/0),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ss(-1/0,-1/0,-1/0);this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(ks.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint(ks.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=ks.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.updateWorldMatrix(!1,!1);const n=e.geometry;if(void 0!==n){const i=n.getAttribute("position");if(!0===t&&void 0!==i&&!0!==e.isInstancedMesh)for(let t=0,n=i.count;t<n;t++)!0===e.isMesh?e.getVertexPosition(t,ks):ks.fromBufferAttribute(i,t),ks.applyMatrix4(e.matrixWorld),this.expandByPoint(ks);else void 0!==e.boundingBox?(null===e.boundingBox&&e.computeBoundingBox(),Ds.copy(e.boundingBox)):(null===n.boundingBox&&n.computeBoundingBox(),Ds.copy(n.boundingBox)),Ds.applyMatrix4(e.matrixWorld),this.union(Ds)}const i=e.children;for(let r=0,s=i.length;r<s;r++)this.expandByObject(i[r],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,ks),ks.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(js),Gs.subVectors(this.max,js),Ns.subVectors(e.a,js),Os.subVectors(e.b,js),Fs.subVectors(e.c,js),Us.subVectors(Os,Ns),Bs.subVectors(Fs,Os),zs.subVectors(Ns,Fs);let t=[0,-Us.z,Us.y,0,-Bs.z,Bs.y,0,-zs.z,zs.y,Us.z,0,-Us.x,Bs.z,0,-Bs.x,zs.z,0,-zs.x,-Us.y,Us.x,0,-Bs.y,Bs.x,0,-zs.y,zs.x,0];return!!Ws(t,Ns,Os,Fs,Gs)&&(t=[1,0,0,0,1,0,0,0,1],!!Ws(t,Ns,Os,Fs,Gs)&&(Vs.crossVectors(Us,Bs),t=[Vs.x,Vs.y,Vs.z],Ws(t,Ns,Os,Fs,Gs)))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,ks).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=.5*this.getSize(ks).length()),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(Ps[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Ps[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Ps[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Ps[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Ps[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Ps[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Ps[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Ps[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Ps)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}toJSON(){return{min:this.min.toArray(),max:this.max.toArray()}}fromJSON(e){return this.min.fromArray(e.min),this.max.fromArray(e.max),this}}const Ps=[new ss,new ss,new ss,new ss,new ss,new ss,new ss,new ss],ks=new ss,Ds=new Is,Ns=new ss,Os=new ss,Fs=new ss,Us=new ss,Bs=new ss,zs=new ss,js=new ss,Gs=new ss,Vs=new ss,Hs=new ss;function Ws(e,t,n,i,r){for(let s=0,a=e.length-3;s<=a;s+=3){Hs.fromArray(e,s);const a=r.x*Math.abs(Hs.x)+r.y*Math.abs(Hs.y)+r.z*Math.abs(Hs.z),o=t.dot(Hs),l=n.dot(Hs),c=i.dot(Hs);if(Math.max(-Math.max(o,l,c),Math.min(o,l,c))>a)return!1}return!0}const Ys=new Is,Xs=new ss,qs=new ss;class Ks{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ss,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;void 0!==t?n.copy(t):Ys.setFromPoints(e).getCenter(n);let i=0;for(let r=0,s=e.length;r<s;r++)i=Math.max(i,n.distanceToSquared(e[r]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Xs.subVectors(e,this.center);const t=Xs.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),n=.5*(e-this.radius);this.center.addScaledVector(Xs,n/e),this.radius+=n}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(qs.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Xs.copy(e.center).add(qs)),this.expandByPoint(Xs.copy(e.center).sub(qs))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}toJSON(){return{radius:this.radius,center:this.center.toArray()}}fromJSON(e){return this.radius=e.radius,this.center.fromArray(e.center),this}}const Zs=new ss,Js=new ss,Qs=new ss,$s=new ss,ea=new ss,ta=new ss,na=new ss;class ia{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ss,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ss(0,0,-1);this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Zs)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Zs.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Zs.copy(this.origin).addScaledVector(this.direction,t),Zs.distanceToSquared(e))}distanceSqToSegment(e,t,n,i){Js.copy(e).add(t).multiplyScalar(.5),Qs.copy(t).sub(e).normalize(),$s.copy(this.origin).sub(Js);const r=.5*e.distanceTo(t),s=-this.direction.dot(Qs),a=$s.dot(this.direction),o=-$s.dot(Qs),l=$s.lengthSq(),c=Math.abs(1-s*s);let u,h,d,f;if(c>0)if(u=s*o-a,h=s*a-o,f=r*c,u>=0)if(h>=-f)if(h<=f){const e=1/c;u*=e,h*=e,d=u*(u+s*h+2*a)+h*(s*u+h+2*o)+l}else h=r,u=Math.max(0,-(s*h+a)),d=-u*u+h*(h+2*o)+l;else h=-r,u=Math.max(0,-(s*h+a)),d=-u*u+h*(h+2*o)+l;else h<=-f?(u=Math.max(0,-(-s*r+a)),h=u>0?-r:Math.min(Math.max(-r,-o),r),d=-u*u+h*(h+2*o)+l):h<=f?(u=0,h=Math.min(Math.max(-r,-o),r),d=h*(h+2*o)+l):(u=Math.max(0,-(s*r+a)),h=u>0?r:Math.min(Math.max(-r,-o),r),d=-u*u+h*(h+2*o)+l);else h=s>0?-r:r,u=Math.max(0,-(s*h+a)),d=-u*u+h*(h+2*o)+l;return n&&n.copy(this.origin).addScaledVector(this.direction,u),i&&i.copy(Js).addScaledVector(Qs,h),d}intersectSphere(e,t){Zs.subVectors(e.center,this.origin);const n=Zs.dot(this.direction),i=Zs.dot(Zs)-n*n,r=e.radius*e.radius;if(i>r)return null;const s=Math.sqrt(r-i),a=n-s,o=n+s;return o<0?null:a<0?this.at(o,t):this.at(a,t)}intersectsSphere(e){return!(e.radius<0)&&this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);if(0===t)return!0;return e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,i,r,s,a,o;const l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(n=(e.min.x-h.x)*l,i=(e.max.x-h.x)*l):(n=(e.max.x-h.x)*l,i=(e.min.x-h.x)*l),c>=0?(r=(e.min.y-h.y)*c,s=(e.max.y-h.y)*c):(r=(e.max.y-h.y)*c,s=(e.min.y-h.y)*c),n>s||r>i?null:((r>n||isNaN(n))&&(n=r),(s<i||isNaN(i))&&(i=s),u>=0?(a=(e.min.z-h.z)*u,o=(e.max.z-h.z)*u):(a=(e.max.z-h.z)*u,o=(e.min.z-h.z)*u),n>o||a>i?null:((a>n||n!==n)&&(n=a),(o<i||i!==i)&&(i=o),i<0?null:this.at(n>=0?n:i,t)))}intersectsBox(e){return null!==this.intersectBox(e,Zs)}intersectTriangle(e,t,n,i,r){ea.subVectors(t,e),ta.subVectors(n,e),na.crossVectors(ea,ta);let s,a=this.direction.dot(na);if(a>0){if(i)return null;s=1}else{if(!(a<0))return null;s=-1,a=-a}$s.subVectors(this.origin,e);const o=s*this.direction.dot(ta.crossVectors($s,ta));if(o<0)return null;const l=s*this.direction.dot(ea.cross($s));if(l<0)return null;if(o+l>a)return null;const c=-s*$s.dot(na);return c<0?null:this.at(c/a,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class ra{constructor(e,t,n,i,r,s,a,o,l,c,u,h,d,f,p,m){ra.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==e&&this.set(e,t,n,i,r,s,a,o,l,c,u,h,d,f,p,m)}set(e,t,n,i,r,s,a,o,l,c,u,h,d,f,p,m){const g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=i,g[1]=r,g[5]=s,g[9]=a,g[13]=o,g[2]=l,g[6]=c,g[10]=u,g[14]=h,g[3]=d,g[7]=f,g[11]=p,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new ra).fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return 0===this.determinant()?(e.set(1,0,0),t.set(0,1,0),n.set(0,0,1),this):(e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this)}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){if(0===e.determinant())return this.identity();const t=this.elements,n=e.elements,i=1/sa.setFromMatrixColumn(e,0).length(),r=1/sa.setFromMatrixColumn(e,1).length(),s=1/sa.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*r,t[5]=n[5]*r,t[6]=n[6]*r,t[7]=0,t[8]=n[8]*s,t[9]=n[9]*s,t[10]=n[10]*s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,i=e.y,r=e.z,s=Math.cos(n),a=Math.sin(n),o=Math.cos(i),l=Math.sin(i),c=Math.cos(r),u=Math.sin(r);if("XYZ"===e.order){const e=s*c,n=s*u,i=a*c,r=a*u;t[0]=o*c,t[4]=-o*u,t[8]=l,t[1]=n+i*l,t[5]=e-r*l,t[9]=-a*o,t[2]=r-e*l,t[6]=i+n*l,t[10]=s*o}else if("YXZ"===e.order){const e=o*c,n=o*u,i=l*c,r=l*u;t[0]=e+r*a,t[4]=i*a-n,t[8]=s*l,t[1]=s*u,t[5]=s*c,t[9]=-a,t[2]=n*a-i,t[6]=r+e*a,t[10]=s*o}else if("ZXY"===e.order){const e=o*c,n=o*u,i=l*c,r=l*u;t[0]=e-r*a,t[4]=-s*u,t[8]=i+n*a,t[1]=n+i*a,t[5]=s*c,t[9]=r-e*a,t[2]=-s*l,t[6]=a,t[10]=s*o}else if("ZYX"===e.order){const e=s*c,n=s*u,i=a*c,r=a*u;t[0]=o*c,t[4]=i*l-n,t[8]=e*l+r,t[1]=o*u,t[5]=r*l+e,t[9]=n*l-i,t[2]=-l,t[6]=a*o,t[10]=s*o}else if("YZX"===e.order){const e=s*o,n=s*l,i=a*o,r=a*l;t[0]=o*c,t[4]=r-e*u,t[8]=i*u+n,t[1]=u,t[5]=s*c,t[9]=-a*c,t[2]=-l*c,t[6]=n*u+i,t[10]=e-r*u}else if("XZY"===e.order){const e=s*o,n=s*l,i=a*o,r=a*l;t[0]=o*c,t[4]=-u,t[8]=l*c,t[1]=e*u+r,t[5]=s*c,t[9]=n*u-i,t[2]=i*u-n,t[6]=a*c,t[10]=r*u+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(oa,e,la)}lookAt(e,t,n){const i=this.elements;return ha.subVectors(e,t),0===ha.lengthSq()&&(ha.z=1),ha.normalize(),ca.crossVectors(n,ha),0===ca.lengthSq()&&(1===Math.abs(n.z)?ha.x+=1e-4:ha.z+=1e-4,ha.normalize(),ca.crossVectors(n,ha)),ca.normalize(),ua.crossVectors(ha,ca),i[0]=ca.x,i[4]=ua.x,i[8]=ha.x,i[1]=ca.y,i[5]=ua.y,i[9]=ha.y,i[2]=ca.z,i[6]=ua.z,i[10]=ha.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,r=this.elements,s=n[0],a=n[4],o=n[8],l=n[12],c=n[1],u=n[5],h=n[9],d=n[13],f=n[2],p=n[6],m=n[10],g=n[14],v=n[3],y=n[7],b=n[11],x=n[15],_=i[0],S=i[4],E=i[8],T=i[12],w=i[1],A=i[5],M=i[9],R=i[13],C=i[2],L=i[6],I=i[10],P=i[14],k=i[3],D=i[7],N=i[11],O=i[15];return r[0]=s*_+a*w+o*C+l*k,r[4]=s*S+a*A+o*L+l*D,r[8]=s*E+a*M+o*I+l*N,r[12]=s*T+a*R+o*P+l*O,r[1]=c*_+u*w+h*C+d*k,r[5]=c*S+u*A+h*L+d*D,r[9]=c*E+u*M+h*I+d*N,r[13]=c*T+u*R+h*P+d*O,r[2]=f*_+p*w+m*C+g*k,r[6]=f*S+p*A+m*L+g*D,r[10]=f*E+p*M+m*I+g*N,r[14]=f*T+p*R+m*P+g*O,r[3]=v*_+y*w+b*C+x*k,r[7]=v*S+y*A+b*L+x*D,r[11]=v*E+y*M+b*I+x*N,r[15]=v*T+y*R+b*P+x*O,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],i=e[8],r=e[12],s=e[1],a=e[5],o=e[9],l=e[13],c=e[2],u=e[6],h=e[10],d=e[14],f=e[3],p=e[7],m=e[11],g=e[15],v=o*d-l*h,y=a*d-l*u,b=a*h-o*u,x=s*d-l*c,_=s*h-o*c,S=s*u-a*c;return t*(p*v-m*y+g*b)-n*(f*v-m*x+g*_)+i*(f*y-p*x+g*S)-r*(f*b-p*_+m*S)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],s=e[4],a=e[5],o=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11],f=e[12],p=e[13],m=e[14],g=e[15],v=u*m*l-p*h*l+p*o*d-a*m*d-u*o*g+a*h*g,y=f*h*l-c*m*l-f*o*d+s*m*d+c*o*g-s*h*g,b=c*p*l-f*u*l+f*a*d-s*p*d-c*a*g+s*u*g,x=f*u*o-c*p*o-f*a*h+s*p*h+c*a*m-s*u*m,_=t*v+n*y+i*b+r*x;if(0===_)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const S=1/_;return e[0]=v*S,e[1]=(p*h*r-u*m*r-p*i*d+n*m*d+u*i*g-n*h*g)*S,e[2]=(a*m*r-p*o*r+p*i*l-n*m*l-a*i*g+n*o*g)*S,e[3]=(u*o*r-a*h*r-u*i*l+n*h*l+a*i*d-n*o*d)*S,e[4]=y*S,e[5]=(c*m*r-f*h*r+f*i*d-t*m*d-c*i*g+t*h*g)*S,e[6]=(f*o*r-s*m*r-f*i*l+t*m*l+s*i*g-t*o*g)*S,e[7]=(s*h*r-c*o*r+c*i*l-t*h*l-s*i*d+t*o*d)*S,e[8]=b*S,e[9]=(f*u*r-c*p*r-f*n*d+t*p*d+c*n*g-t*u*g)*S,e[10]=(s*p*r-f*a*r+f*n*l-t*p*l-s*n*g+t*a*g)*S,e[11]=(c*a*r-s*u*r-c*n*l+t*u*l+s*n*d-t*a*d)*S,e[12]=x*S,e[13]=(c*p*i-f*u*i+f*n*h-t*p*h-c*n*m+t*u*m)*S,e[14]=(f*a*i-s*p*i-f*n*o+t*p*o+s*n*m-t*a*m)*S,e[15]=(s*u*i-c*a*i+c*n*o-t*u*o-s*n*h+t*a*h)*S,this}scale(e){const t=this.elements,n=e.x,i=e.y,r=e.z;return t[0]*=n,t[4]*=i,t[8]*=r,t[1]*=n,t[5]*=i,t[9]*=r,t[2]*=n,t[6]*=i,t[10]*=r,t[3]*=n,t[7]*=i,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),i=Math.sin(t),r=1-n,s=e.x,a=e.y,o=e.z,l=r*s,c=r*a;return this.set(l*s+n,l*a-i*o,l*o+i*a,0,l*a+i*o,c*a+n,c*o-i*s,0,l*o-i*a,c*o+i*s,r*o*o+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,i,r,s){return this.set(1,n,r,0,e,1,s,0,t,i,1,0,0,0,0,1),this}compose(e,t,n){const i=this.elements,r=t._x,s=t._y,a=t._z,o=t._w,l=r+r,c=s+s,u=a+a,h=r*l,d=r*c,f=r*u,p=s*c,m=s*u,g=a*u,v=o*l,y=o*c,b=o*u,x=n.x,_=n.y,S=n.z;return i[0]=(1-(p+g))*x,i[1]=(d+b)*x,i[2]=(f-y)*x,i[3]=0,i[4]=(d-b)*_,i[5]=(1-(h+g))*_,i[6]=(m+v)*_,i[7]=0,i[8]=(f+y)*S,i[9]=(m-v)*S,i[10]=(1-(h+p))*S,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,n){const i=this.elements;if(e.x=i[12],e.y=i[13],e.z=i[14],0===this.determinant())return n.set(1,1,1),t.identity(),this;let r=sa.set(i[0],i[1],i[2]).length();const s=sa.set(i[4],i[5],i[6]).length(),a=sa.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),aa.copy(this);const o=1/r,l=1/s,c=1/a;return aa.elements[0]*=o,aa.elements[1]*=o,aa.elements[2]*=o,aa.elements[4]*=l,aa.elements[5]*=l,aa.elements[6]*=l,aa.elements[8]*=c,aa.elements[9]*=c,aa.elements[10]*=c,t.setFromRotationMatrix(aa),n.x=r,n.y=s,n.z=a,this}makePerspective(e,t,n,i,r,s){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Ar,o=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const l=this.elements,c=2*r/(t-e),u=2*r/(n-i),h=(t+e)/(t-e),d=(n+i)/(n-i);let f,p;if(o)f=r/(s-r),p=s*r/(s-r);else if(a===Ar)f=-(s+r)/(s-r),p=-2*s*r/(s-r);else{if(a!==Mr)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);f=-s/(s-r),p=-s*r/(s-r)}return l[0]=c,l[4]=0,l[8]=h,l[12]=0,l[1]=0,l[5]=u,l[9]=d,l[13]=0,l[2]=0,l[6]=0,l[10]=f,l[14]=p,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,t,n,i,r,s){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Ar,o=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const l=this.elements,c=2/(t-e),u=2/(n-i),h=-(t+e)/(t-e),d=-(n+i)/(n-i);let f,p;if(o)f=1/(s-r),p=s/(s-r);else if(a===Ar)f=-2/(s-r),p=-(s+r)/(s-r);else{if(a!==Mr)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);f=-1/(s-r),p=-r/(s-r)}return l[0]=c,l[4]=0,l[8]=0,l[12]=h,l[1]=0,l[5]=u,l[9]=0,l[13]=d,l[2]=0,l[6]=0,l[10]=f,l[14]=p,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<16;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const sa=new ss,aa=new ra,oa=new ss(0,0,0),la=new ss(1,1,1),ca=new ss,ua=new ss,ha=new ss,da=new ra,fa=new rs;class pa{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:pa.DEFAULT_ORDER;this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this._order;return this._x=e,this._y=t,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const i=e.elements,r=i[0],s=i[4],a=i[8],o=i[1],l=i[5],c=i[9],u=i[2],h=i[6],d=i[10];switch(t){case"XYZ":this._y=Math.asin(Jr(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-s,r)):(this._x=Math.atan2(h,l),this._z=0);break;case"YXZ":this._x=Math.asin(-Jr(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(a,d),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-u,r),this._z=0);break;case"ZXY":this._x=Math.asin(Jr(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-u,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(o,r));break;case"ZYX":this._y=Math.asin(-Jr(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(h,d),this._z=Math.atan2(o,r)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(Jr(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-u,r)):(this._x=0,this._y=Math.atan2(a,d));break;case"XZY":this._z=Math.asin(-Jr(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(h,l),this._y=Math.atan2(a,r)):(this._x=Math.atan2(-c,d),this._y=0);break;default:Gr("Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===n&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return da.makeRotationFromQuaternion(e),this.setFromRotationMatrix(da,t,n)}setFromVector3(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order;return this.set(e.x,e.y,e.z,t)}reorder(e){return fa.setFromEuler(this),this.setFromQuaternion(fa,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}pa.DEFAULT_ORDER="XYZ";class ma{constructor(){this.mask=1}set(e){this.mask=1<<e>>>0}enable(e){this.mask|=1<<e}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e}disable(e){this.mask&=~(1<<e)}disableAll(){this.mask=0}test(e){return 0!==(this.mask&e.mask)}isEnabled(e){return 0!==(this.mask&1<<e)}}let ga=0;const va=new ss,ya=new rs,ba=new ra,xa=new ss,_a=new ss,Sa=new ss,Ea=new rs,Ta=new ss(1,0,0),wa=new ss(0,1,0),Aa=new ss(0,0,1),Ma={type:"added"},Ra={type:"removed"},Ca={type:"childadded",child:null},La={type:"childremoved",child:null};class Ia extends Wr{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:ga++}),this.uuid=Zr(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Ia.DEFAULT_UP.clone();const e=new ss,t=new pa,n=new rs,i=new ss(1,1,1);t._onChange(function(){n.setFromEuler(t,!1)}),n._onChange(function(){t.setFromQuaternion(n,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new ra},normalMatrix:{value:new ls}}),this.matrix=new ra,this.matrixWorld=new ra,this.matrixAutoUpdate=Ia.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Ia.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new ma,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return ya.setFromAxisAngle(e,t),this.quaternion.multiply(ya),this}rotateOnWorldAxis(e,t){return ya.setFromAxisAngle(e,t),this.quaternion.premultiply(ya),this}rotateX(e){return this.rotateOnAxis(Ta,e)}rotateY(e){return this.rotateOnAxis(wa,e)}rotateZ(e){return this.rotateOnAxis(Aa,e)}translateOnAxis(e,t){return va.copy(e).applyQuaternion(this.quaternion),this.position.add(va.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(Ta,e)}translateY(e){return this.translateOnAxis(wa,e)}translateZ(e){return this.translateOnAxis(Aa,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(ba.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?xa.copy(e):xa.set(e,t,n);const i=this.parent;this.updateWorldMatrix(!0,!1),_a.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?ba.lookAt(_a,xa,this.up):ba.lookAt(xa,_a,this.up),this.quaternion.setFromRotationMatrix(ba),i&&(ba.extractRotation(i.matrixWorld),ya.setFromRotationMatrix(ba),this.quaternion.premultiply(ya.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(Vr("Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(Ma),Ca.child=e,this.dispatchEvent(Ca),Ca.child=null):Vr("Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(Ra),La.child=e,this.dispatchEvent(La),La.child=null),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),ba.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),ba.multiply(e.parent.matrixWorld)),e.applyMatrix4(ba),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(Ma),Ca.child=e,this.dispatchEvent(Ca),Ca.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,i=this.children.length;n<i;n++){const i=this.children[n].getObjectByProperty(e,t);if(void 0!==i)return i}}getObjectsByProperty(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];this[e]===t&&n.push(this);const i=this.children;for(let r=0,s=i.length;r<s;r++)i[r].getObjectsByProperty(e,t,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_a,e,Sa),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_a,Ea,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,i=t.length;n<i;n++){t[n].updateMatrixWorld(e)}}updateWorldMatrix(e,t){const n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),!0===t){const e=this.children;for(let t=0,n=e.length;t<n;t++){e[t].updateWorldMatrix(!1,!0)}}}toJSON(e){const t=void 0===e||"string"===typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.7,type:"Object",generator:"Object3D.toJSON"});const i={};function r(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.geometryInfo=this._geometryInfo.map(e=>(0,Oe.A)((0,Oe.A)({},e),{},{boundingBox:e.boundingBox?e.boundingBox.toJSON():void 0,boundingSphere:e.boundingSphere?e.boundingSphere.toJSON():void 0})),i.instanceInfo=this._instanceInfo.map(e=>(0,Oe.A)({},e)),i.availableInstanceIds=this._availableInstanceIds.slice(),i.availableGeometryIds=this._availableGeometryIds.slice(),i.nextIndexStart=this._nextIndexStart,i.nextVertexStart=this._nextVertexStart,i.geometryCount=this._geometryCount,i.maxInstanceCount=this._maxInstanceCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.matricesTexture=this._matricesTexture.toJSON(e),i.indirectTexture=this._indirectTexture.toJSON(e),null!==this._colorsTexture&&(i.colorsTexture=this._colorsTexture.toJSON(e)),null!==this.boundingSphere&&(i.boundingSphere=this.boundingSphere.toJSON()),null!==this.boundingBox&&(i.boundingBox=this.boundingBox.toJSON())),this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=r(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const n=t.shapes;if(Array.isArray(n))for(let t=0,i=n.length;t<i;t++){const i=n[t];r(e.shapes,i)}else r(e.shapes,n)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let n=0,i=this.material.length;n<i;n++)t.push(r(e.materials,this.material[n]));i.material=t}else i.material=r(e.materials,this.material);if(this.children.length>0){i.children=[];for(let t=0;t<this.children.length;t++)i.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let t=0;t<this.animations.length;t++){const n=this.animations[t];i.animations.push(r(e.animations,n))}}if(t){const t=s(e.geometries),i=s(e.materials),r=s(e.textures),a=s(e.images),o=s(e.shapes),l=s(e.skeletons),c=s(e.animations),u=s(e.nodes);t.length>0&&(n.geometries=t),i.length>0&&(n.materials=i),r.length>0&&(n.textures=r),a.length>0&&(n.images=a),o.length>0&&(n.shapes=o),l.length>0&&(n.skeletons=l),c.length>0&&(n.animations=c),u.length>0&&(n.nodes=u)}return n.object=i,n;function s(e){const t=[];for(const n in e){const i=e[n];delete i.metadata,t.push(i)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let n=0;n<e.children.length;n++){const t=e.children[n];this.add(t.clone())}return this}}Ia.DEFAULT_UP=new ss(0,1,0),Ia.DEFAULT_MATRIX_AUTO_UPDATE=!0,Ia.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Pa=new ss,ka=new ss,Da=new ss,Na=new ss,Oa=new ss,Fa=new ss,Ua=new ss,Ba=new ss,za=new ss,ja=new ss,Ga=new Ts,Va=new Ts,Ha=new Ts;class Wa{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ss,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ss,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new ss;this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,i){i.subVectors(n,t),Pa.subVectors(e,t),i.cross(Pa);const r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)}static getBarycoord(e,t,n,i,r){Pa.subVectors(i,t),ka.subVectors(n,t),Da.subVectors(e,t);const s=Pa.dot(Pa),a=Pa.dot(ka),o=Pa.dot(Da),l=ka.dot(ka),c=ka.dot(Da),u=s*l-a*a;if(0===u)return r.set(0,0,0),null;const h=1/u,d=(l*o-a*c)*h,f=(s*c-a*o)*h;return r.set(1-d-f,f,d)}static containsPoint(e,t,n,i){return null!==this.getBarycoord(e,t,n,i,Na)&&(Na.x>=0&&Na.y>=0&&Na.x+Na.y<=1)}static getInterpolation(e,t,n,i,r,s,a,o){return null===this.getBarycoord(e,t,n,i,Na)?(o.x=0,o.y=0,"z"in o&&(o.z=0),"w"in o&&(o.w=0),null):(o.setScalar(0),o.addScaledVector(r,Na.x),o.addScaledVector(s,Na.y),o.addScaledVector(a,Na.z),o)}static getInterpolatedAttribute(e,t,n,i,r,s){return Ga.setScalar(0),Va.setScalar(0),Ha.setScalar(0),Ga.fromBufferAttribute(e,t),Va.fromBufferAttribute(e,n),Ha.fromBufferAttribute(e,i),s.setScalar(0),s.addScaledVector(Ga,r.x),s.addScaledVector(Va,r.y),s.addScaledVector(Ha,r.z),s}static isFrontFacing(e,t,n,i){return Pa.subVectors(n,t),ka.subVectors(e,t),Pa.cross(ka).dot(i)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,n,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,i),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Pa.subVectors(this.c,this.b),ka.subVectors(this.a,this.b),.5*Pa.cross(ka).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Wa.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Wa.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,n,i,r){return Wa.getInterpolation(e,this.a,this.b,this.c,t,n,i,r)}containsPoint(e){return Wa.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Wa.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,i=this.b,r=this.c;let s,a;Oa.subVectors(i,n),Fa.subVectors(r,n),Ba.subVectors(e,n);const o=Oa.dot(Ba),l=Fa.dot(Ba);if(o<=0&&l<=0)return t.copy(n);za.subVectors(e,i);const c=Oa.dot(za),u=Fa.dot(za);if(c>=0&&u<=c)return t.copy(i);const h=o*u-c*l;if(h<=0&&o>=0&&c<=0)return s=o/(o-c),t.copy(n).addScaledVector(Oa,s);ja.subVectors(e,r);const d=Oa.dot(ja),f=Fa.dot(ja);if(f>=0&&d<=f)return t.copy(r);const p=d*l-o*f;if(p<=0&&l>=0&&f<=0)return a=l/(l-f),t.copy(n).addScaledVector(Fa,a);const m=c*f-d*u;if(m<=0&&u-c>=0&&d-f>=0)return Ua.subVectors(r,i),a=(u-c)/(u-c+(d-f)),t.copy(i).addScaledVector(Ua,a);const g=1/(m+p+h);return s=p*g,a=h*g,t.copy(n).addScaledVector(Oa,s).addScaledVector(Fa,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const Ya={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Xa={h:0,s:0,l:0},qa={h:0,s:0,l:0};function Ka(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}class Za{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(void 0===t&&void 0===n){const t=e;t&&t.isColor?this.copy(t):"number"===typeof t?this.setHex(t):"string"===typeof t&&this.setStyle(t)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ui;return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,fs.colorSpaceToWorking(this,t),this}setRGB(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:fs.workingColorSpace;return this.r=e,this.g=t,this.b=n,fs.colorSpaceToWorking(this,i),this}setHSL(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:fs.workingColorSpace;if(e=Qr(e,1),t=Jr(t,0,1),n=Jr(n,0,1),0===t)this.r=this.g=this.b=n;else{const i=n<=.5?n*(1+t):n+t-n*t,r=2*n-i;this.r=Ka(r,i,e+1/3),this.g=Ka(r,i,e),this.b=Ka(r,i,e-1/3)}return fs.colorSpaceToWorking(this,i),this}setStyle(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ui;function i(t){void 0!==t&&parseFloat(t)<1&&Gr("Color: Alpha component of "+e+" will be ignored.")}if(t=/^(\w+)\(([^\)]*)\)/.exec(e)){let r;const s=t[1],a=t[2];switch(s){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(r[4]),this.setRGB(Math.min(255,parseInt(r[1],10))/255,Math.min(255,parseInt(r[2],10))/255,Math.min(255,parseInt(r[3],10))/255,n);if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(r[4]),this.setRGB(Math.min(100,parseInt(r[1],10))/100,Math.min(100,parseInt(r[2],10))/100,Math.min(100,parseInt(r[3],10))/100,n);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(r[4]),this.setHSL(parseFloat(r[1])/360,parseFloat(r[2])/100,parseFloat(r[3])/100,n);break;default:Gr("Color: Unknown color model "+e)}}else if(t=/^\#([A-Fa-f\d]+)$/.exec(e)){const i=t[1],r=i.length;if(3===r)return this.setRGB(parseInt(i.charAt(0),16)/15,parseInt(i.charAt(1),16)/15,parseInt(i.charAt(2),16)/15,n);if(6===r)return this.setHex(parseInt(i,16),n);Gr("Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,n);return this}setColorName(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ui;const n=Ya[e.toLowerCase()];return void 0!==n?this.setHex(n,t):Gr("Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=ps(e.r),this.g=ps(e.g),this.b=ps(e.b),this}copyLinearToSRGB(e){return this.r=ms(e.r),this.g=ms(e.g),this.b=ms(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ui;return fs.workingToColorSpace(Ja.copy(this),e),65536*Math.round(Jr(255*Ja.r,0,255))+256*Math.round(Jr(255*Ja.g,0,255))+Math.round(Jr(255*Ja.b,0,255))}getHexString(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ui;return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:fs.workingColorSpace;fs.workingToColorSpace(Ja.copy(this),t);const n=Ja.r,i=Ja.g,r=Ja.b,s=Math.max(n,i,r),a=Math.min(n,i,r);let o,l;const c=(a+s)/2;if(a===s)o=0,l=0;else{const e=s-a;switch(l=c<=.5?e/(s+a):e/(2-s-a),s){case n:o=(i-r)/e+(i<r?6:0);break;case i:o=(r-n)/e+2;break;case r:o=(n-i)/e+4}o/=6}return e.h=o,e.s=l,e.l=c,e}getRGB(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:fs.workingColorSpace;return fs.workingToColorSpace(Ja.copy(this),t),e.r=Ja.r,e.g=Ja.g,e.b=Ja.b,e}getStyle(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ui;fs.workingToColorSpace(Ja.copy(this),e);const t=Ja.r,n=Ja.g,i=Ja.b;return e!==Ui?"color(".concat(e," ").concat(t.toFixed(3)," ").concat(n.toFixed(3)," ").concat(i.toFixed(3),")"):"rgb(".concat(Math.round(255*t),",").concat(Math.round(255*n),",").concat(Math.round(255*i),")")}offsetHSL(e,t,n){return this.getHSL(Xa),this.setHSL(Xa.h+e,Xa.s+t,Xa.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(Xa),e.getHSL(qa);const n=$r(Xa.h,qa.h,t),i=$r(Xa.s,qa.s,t),r=$r(Xa.l,qa.l,t);return this.setHSL(n,i,r),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,i=this.b,r=e.elements;return this.r=r[0]*t+r[3]*n+r[6]*i,this.g=r[1]*t+r[4]*n+r[7]*i,this.b=r[2]*t+r[5]*n+r[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Ja=new Za;Za.NAMES=Ya;let Qa=0;class $a extends Wr{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Qa++}),this.uuid=Zr(),this.name="",this.type="Material",this.blending=$e,this.side=Ke,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=ft,this.blendDst=pt,this.blendEquation=rt,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Za(0,0,0),this.blendAlpha=0,this.depthFunc=Mt,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=ar,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Yi,this.stencilZFail=Yi,this.stencilZPass=Yi,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!==e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const n=e[t];if(void 0===n){Gr("Material: parameter '".concat(t,"' has value of undefined."));continue}const i=this[t];void 0!==i?i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n:Gr("Material: '".concat(t,"' is not a property of THREE.").concat(this.type,"."))}}toJSON(e){const t=void 0===e||"string"===typeof e;t&&(e={textures:{},images:{}});const n={metadata:{version:4.7,type:"Material",generator:"Material.toJSON"}};function i(e){const t=[];for(const n in e){const i=e[n];delete i.metadata,t.push(i)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),void 0!==this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.sheenColorMap&&this.sheenColorMap.isTexture&&(n.sheenColorMap=this.sheenColorMap.toJSON(e).uuid),this.sheenRoughnessMap&&this.sheenRoughnessMap.isTexture&&(n.sheenRoughnessMap=this.sheenRoughnessMap.toJSON(e).uuid),void 0!==this.dispersion&&(n.dispersion=this.dispersion),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),void 0!==this.anisotropy&&(n.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapRotation&&(n.envMapRotation=this.envMapRotation.toArray()),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==$e&&(n.blending=this.blending),this.side!==Ke&&(n.side=this.side),!0===this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=!0),this.blendSrc!==ft&&(n.blendSrc=this.blendSrc),this.blendDst!==pt&&(n.blendDst=this.blendDst),this.blendEquation!==rt&&(n.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(n.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(n.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(n.blendAlpha=this.blendAlpha),this.depthFunc!==Mt&&(n.depthFunc=this.depthFunc),!1===this.depthTest&&(n.depthTest=this.depthTest),!1===this.depthWrite&&(n.depthWrite=this.depthWrite),!1===this.colorWrite&&(n.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(n.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==ar&&(n.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(n.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Yi&&(n.stencilFail=this.stencilFail),this.stencilZFail!==Yi&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==Yi&&(n.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(n.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaHash&&(n.alphaHash=!0),!0===this.alphaToCoverage&&(n.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=!0),!0===this.forceSinglePass&&(n.forceSinglePass=!0),!1===this.allowOverride&&(n.allowOverride=!1),!0===this.wireframe&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData),t){const t=i(e.textures),r=i(e.images);t.length>0&&(n.textures=t),r.length>0&&(n.images=r)}return n}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(null!==t){const e=t.length;n=new Array(e);for(let i=0;i!==e;++i)n[i]=t[i].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.allowOverride=e.allowOverride,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}class eo extends $a{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Za(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new pa,this.combine=Pt,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const to=no();function no(){const e=new ArrayBuffer(4),t=new Float32Array(e),n=new Uint32Array(e),i=new Uint32Array(512),r=new Uint32Array(512);for(let l=0;l<256;++l){const e=l-127;e<-27?(i[l]=0,i[256|l]=32768,r[l]=24,r[256|l]=24):e<-14?(i[l]=1024>>-e-14,i[256|l]=1024>>-e-14|32768,r[l]=-e-1,r[256|l]=-e-1):e<=15?(i[l]=e+15<<10,i[256|l]=e+15<<10|32768,r[l]=13,r[256|l]=13):e<128?(i[l]=31744,i[256|l]=64512,r[l]=24,r[256|l]=24):(i[l]=31744,i[256|l]=64512,r[l]=13,r[256|l]=13)}const s=new Uint32Array(2048),a=new Uint32Array(64),o=new Uint32Array(64);for(let l=1;l<1024;++l){let e=l<<13,t=0;for(;0===(8388608&e);)e<<=1,t-=8388608;e&=-8388609,t+=947912704,s[l]=e|t}for(let l=1024;l<2048;++l)s[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)a[l]=l<<23;a[31]=1199570944,a[32]=2147483648;for(let l=33;l<63;++l)a[l]=2147483648+(l-32<<23);a[63]=3347054592;for(let l=1;l<64;++l)32!==l&&(o[l]=1024);return{floatView:t,uint32View:n,baseTable:i,shiftTable:r,mantissaTable:s,exponentTable:a,offsetTable:o}}function io(e){Math.abs(e)>65504&&Gr("DataUtils.toHalfFloat(): Value out of range."),e=Jr(e,-65504,65504),to.floatView[0]=e;const t=to.uint32View[0],n=t>>23&511;return to.baseTable[n]+((8388607&t)>>to.shiftTable[n])}function ro(e){const t=e>>10;return to.uint32View[0]=to.mantissaTable[to.offsetTable[t]+(1023&e)]+to.exponentTable[t],to.floatView[0]}class so{static toHalfFloat(e){return io(e)}static fromHalfFloat(e){return ro(e)}}const ao=new ss,oo=new is;let lo=0;class co{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:lo++}),this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=n,this.usage=mr,this.updateRanges=[],this.gpuType=vn,this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let i=0,r=this.itemSize;i<r;i++)this.array[e+i]=t.array[n+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,n=this.count;t<n;t++)oo.fromBufferAttribute(this,t),oo.applyMatrix3(e),this.setXY(t,oo.x,oo.y);else if(3===this.itemSize)for(let t=0,n=this.count;t<n;t++)ao.fromBufferAttribute(this,t),ao.applyMatrix3(e),this.setXYZ(t,ao.x,ao.y,ao.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)ao.fromBufferAttribute(this,t),ao.applyMatrix4(e),this.setXYZ(t,ao.x,ao.y,ao.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)ao.fromBufferAttribute(this,t),ao.applyNormalMatrix(e),this.setXYZ(t,ao.x,ao.y,ao.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)ao.fromBufferAttribute(this,t),ao.transformDirection(e),this.setXYZ(t,ao.x,ao.y,ao.z);return this}set(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(e,t),this}getComponent(e,t){let n=this.array[e*this.itemSize+t];return this.normalized&&(n=es(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=ts(n,this.array)),this.array[e*this.itemSize+t]=n,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=es(t,this.array)),t}setX(e,t){return this.normalized&&(t=ts(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=es(t,this.array)),t}setY(e,t){return this.normalized&&(t=ts(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=es(t,this.array)),t}setZ(e,t){return this.normalized&&(t=ts(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=es(t,this.array)),t}setW(e,t){return this.normalized&&(t=ts(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=ts(t,this.array),n=ts(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,i){return e*=this.itemSize,this.normalized&&(t=ts(t,this.array),n=ts(n,this.array),i=ts(i,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this}setXYZW(e,t,n,i,r){return e*=this.itemSize,this.normalized&&(t=ts(t,this.array),n=ts(n,this.array),i=ts(i,this.array),r=ts(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==mr&&(e.usage=this.usage),e}}class uo extends co{constructor(e,t,n){super(new Int8Array(e),t,n)}}class ho extends co{constructor(e,t,n){super(new Uint8Array(e),t,n)}}class fo extends co{constructor(e,t,n){super(new Uint8ClampedArray(e),t,n)}}class po extends co{constructor(e,t,n){super(new Int16Array(e),t,n)}}class mo extends co{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class go extends co{constructor(e,t,n){super(new Int32Array(e),t,n)}}class vo extends co{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class yo extends co{constructor(e,t,n){super(new Uint16Array(e),t,n),this.isFloat16BufferAttribute=!0}getX(e){let t=ro(this.array[e*this.itemSize]);return this.normalized&&(t=es(t,this.array)),t}setX(e,t){return this.normalized&&(t=ts(t,this.array)),this.array[e*this.itemSize]=io(t),this}getY(e){let t=ro(this.array[e*this.itemSize+1]);return this.normalized&&(t=es(t,this.array)),t}setY(e,t){return this.normalized&&(t=ts(t,this.array)),this.array[e*this.itemSize+1]=io(t),this}getZ(e){let t=ro(this.array[e*this.itemSize+2]);return this.normalized&&(t=es(t,this.array)),t}setZ(e,t){return this.normalized&&(t=ts(t,this.array)),this.array[e*this.itemSize+2]=io(t),this}getW(e){let t=ro(this.array[e*this.itemSize+3]);return this.normalized&&(t=es(t,this.array)),t}setW(e,t){return this.normalized&&(t=ts(t,this.array)),this.array[e*this.itemSize+3]=io(t),this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=ts(t,this.array),n=ts(n,this.array)),this.array[e+0]=io(t),this.array[e+1]=io(n),this}setXYZ(e,t,n,i){return e*=this.itemSize,this.normalized&&(t=ts(t,this.array),n=ts(n,this.array),i=ts(i,this.array)),this.array[e+0]=io(t),this.array[e+1]=io(n),this.array[e+2]=io(i),this}setXYZW(e,t,n,i,r){return e*=this.itemSize,this.normalized&&(t=ts(t,this.array),n=ts(n,this.array),i=ts(i,this.array),r=ts(r,this.array)),this.array[e+0]=io(t),this.array[e+1]=io(n),this.array[e+2]=io(i),this.array[e+3]=io(r),this}}class bo extends co{constructor(e,t,n){super(new Float32Array(e),t,n)}}let xo=0;const _o=new ra,So=new Ia,Eo=new ss,To=new Is,wo=new Is,Ao=new ss;class Mo extends Wr{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:xo++}),this.uuid=Zr(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.indirectOffset=0,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(Ir(e)?vo:mo)(e,1):this.index=e,this}setIndirect(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.indirect=e,this.indirectOffset=t,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const t=(new ls).getNormalMatrix(e);n.applyNormalMatrix(t),n.needsUpdate=!0}const i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(e),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return _o.makeRotationFromQuaternion(e),this.applyMatrix4(_o),this}rotateX(e){return _o.makeRotationX(e),this.applyMatrix4(_o),this}rotateY(e){return _o.makeRotationY(e),this.applyMatrix4(_o),this}rotateZ(e){return _o.makeRotationZ(e),this.applyMatrix4(_o),this}translate(e,t,n){return _o.makeTranslation(e,t,n),this.applyMatrix4(_o),this}scale(e,t,n){return _o.makeScale(e,t,n),this.applyMatrix4(_o),this}lookAt(e){return So.lookAt(e),So.updateMatrix(),this.applyMatrix4(So.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Eo).negate(),this.translate(Eo.x,Eo.y,Eo.z),this}setFromPoints(e){const t=this.getAttribute("position");if(void 0===t){const t=[];for(let n=0,i=e.length;n<i;n++){const i=e[n];t.push(i.x,i.y,i.z||0)}this.setAttribute("position",new bo(t,3))}else{const n=Math.min(e.length,t.count);for(let i=0;i<n;i++){const n=e[i];t.setXYZ(i,n.x,n.y,n.z||0)}e.length>t.count&&Gr("BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),t.needsUpdate=!0}return this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Is);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return Vr("BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),void this.boundingBox.set(new ss(-1/0,-1/0,-1/0),new ss(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,i=t.length;n<i;n++){const e=t[n];To.setFromBufferAttribute(e),this.morphTargetsRelative?(Ao.addVectors(this.boundingBox.min,To.min),this.boundingBox.expandByPoint(Ao),Ao.addVectors(this.boundingBox.max,To.max),this.boundingBox.expandByPoint(Ao)):(this.boundingBox.expandByPoint(To.min),this.boundingBox.expandByPoint(To.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&Vr('BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Ks);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return Vr("BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),void this.boundingSphere.set(new ss,1/0);if(e){const n=this.boundingSphere.center;if(To.setFromBufferAttribute(e),t)for(let e=0,r=t.length;e<r;e++){const n=t[e];wo.setFromBufferAttribute(n),this.morphTargetsRelative?(Ao.addVectors(To.min,wo.min),To.expandByPoint(Ao),Ao.addVectors(To.max,wo.max),To.expandByPoint(Ao)):(To.expandByPoint(wo.min),To.expandByPoint(wo.max))}To.getCenter(n);let i=0;for(let t=0,r=e.count;t<r;t++)Ao.fromBufferAttribute(e,t),i=Math.max(i,n.distanceToSquared(Ao));if(t)for(let r=0,s=t.length;r<s;r++){const s=t[r],a=this.morphTargetsRelative;for(let t=0,r=s.count;t<r;t++)Ao.fromBufferAttribute(s,t),a&&(Eo.fromBufferAttribute(e,t),Ao.add(Eo)),i=Math.max(i,n.distanceToSquared(Ao))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&Vr('BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void Vr("BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=t.position,i=t.normal,r=t.uv;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new co(new Float32Array(4*n.count),4));const s=this.getAttribute("tangent"),a=[],o=[];for(let E=0;E<n.count;E++)a[E]=new ss,o[E]=new ss;const l=new ss,c=new ss,u=new ss,h=new is,d=new is,f=new is,p=new ss,m=new ss;function g(e,t,i){l.fromBufferAttribute(n,e),c.fromBufferAttribute(n,t),u.fromBufferAttribute(n,i),h.fromBufferAttribute(r,e),d.fromBufferAttribute(r,t),f.fromBufferAttribute(r,i),c.sub(l),u.sub(l),d.sub(h),f.sub(h);const s=1/(d.x*f.y-f.x*d.y);isFinite(s)&&(p.copy(c).multiplyScalar(f.y).addScaledVector(u,-d.y).multiplyScalar(s),m.copy(u).multiplyScalar(d.x).addScaledVector(c,-f.x).multiplyScalar(s),a[e].add(p),a[t].add(p),a[i].add(p),o[e].add(m),o[t].add(m),o[i].add(m))}let v=this.groups;0===v.length&&(v=[{start:0,count:e.count}]);for(let E=0,T=v.length;E<T;++E){const t=v[E],n=t.start;for(let i=n,r=n+t.count;i<r;i+=3)g(e.getX(i+0),e.getX(i+1),e.getX(i+2))}const y=new ss,b=new ss,x=new ss,_=new ss;function S(e){x.fromBufferAttribute(i,e),_.copy(x);const t=a[e];y.copy(t),y.sub(x.multiplyScalar(x.dot(t))).normalize(),b.crossVectors(_,t);const n=b.dot(o[e])<0?-1:1;s.setXYZW(e,y.x,y.y,y.z,n)}for(let E=0,T=v.length;E<T;++E){const t=v[E],n=t.start;for(let i=n,r=n+t.count;i<r;i+=3)S(e.getX(i+0)),S(e.getX(i+1)),S(e.getX(i+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let n=this.getAttribute("normal");if(void 0===n)n=new co(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(let e=0,t=n.count;e<t;e++)n.setXYZ(e,0,0,0);const i=new ss,r=new ss,s=new ss,a=new ss,o=new ss,l=new ss,c=new ss,u=new ss;if(e)for(let h=0,d=e.count;h<d;h+=3){const d=e.getX(h+0),f=e.getX(h+1),p=e.getX(h+2);i.fromBufferAttribute(t,d),r.fromBufferAttribute(t,f),s.fromBufferAttribute(t,p),c.subVectors(s,r),u.subVectors(i,r),c.cross(u),a.fromBufferAttribute(n,d),o.fromBufferAttribute(n,f),l.fromBufferAttribute(n,p),a.add(c),o.add(c),l.add(c),n.setXYZ(d,a.x,a.y,a.z),n.setXYZ(f,o.x,o.y,o.z),n.setXYZ(p,l.x,l.y,l.z)}else for(let e=0,h=t.count;e<h;e+=3)i.fromBufferAttribute(t,e+0),r.fromBufferAttribute(t,e+1),s.fromBufferAttribute(t,e+2),c.subVectors(s,r),u.subVectors(i,r),c.cross(u),n.setXYZ(e+0,c.x,c.y,c.z),n.setXYZ(e+1,c.x,c.y,c.z),n.setXYZ(e+2,c.x,c.y,c.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)Ao.fromBufferAttribute(e,t),Ao.normalize(),e.setXYZ(t,Ao.x,Ao.y,Ao.z)}toNonIndexed(){function e(e,t){const n=e.array,i=e.itemSize,r=e.normalized,s=new n.constructor(t.length*i);let a=0,o=0;for(let l=0,c=t.length;l<c;l++){a=e.isInterleavedBufferAttribute?t[l]*e.data.stride+e.offset:t[l]*i;for(let e=0;e<i;e++)s[o++]=n[a++]}return new co(s,i,r)}if(null===this.index)return Gr("BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Mo,n=this.index.array,i=this.attributes;for(const a in i){const r=e(i[a],n);t.setAttribute(a,r)}const r=this.morphAttributes;for(const a in r){const i=[],s=r[a];for(let t=0,r=s.length;t<r;t++){const r=e(s[t],n);i.push(r)}t.morphAttributes[a]=i}t.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let a=0,o=s.length;a<o;a++){const e=s[a];t.addGroup(e.start,e.count,e.materialIndex)}return t}toJSON(){const e={metadata:{version:4.7,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const o in n){const t=n[o];e.data.attributes[o]=t.toJSON(e.data)}const i={};let r=!1;for(const o in this.morphAttributes){const t=this.morphAttributes[o],n=[];for(let i=0,r=t.length;i<r;i++){const r=t[i];n.push(r.toJSON(e.data))}n.length>0&&(i[o]=n,r=!0)}r&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(e.data.groups=JSON.parse(JSON.stringify(s)));const a=this.boundingSphere;return null!==a&&(e.data.boundingSphere=a.toJSON()),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;null!==n&&this.setIndex(n.clone());const i=e.attributes;for(const l in i){const e=i[l];this.setAttribute(l,e.clone(t))}const r=e.morphAttributes;for(const l in r){const e=[],n=r[l];for(let i=0,r=n.length;i<r;i++)e.push(n[i].clone(t));this.morphAttributes[l]=e}this.morphTargetsRelative=e.morphTargetsRelative;const s=e.groups;for(let l=0,c=s.length;l<c;l++){const e=s[l];this.addGroup(e.start,e.count,e.materialIndex)}const a=e.boundingBox;null!==a&&(this.boundingBox=a.clone());const o=e.boundingSphere;return null!==o&&(this.boundingSphere=o.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const Ro=new ra,Co=new ia,Lo=new Ks,Io=new ss,Po=new ss,ko=new ss,Do=new ss,No=new ss,Oo=new ss,Fo=new ss,Uo=new ss;class Bo extends Ia{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Mo,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new eo;super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.count=1,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}getVertexPosition(e,t){const n=this.geometry,i=n.attributes.position,r=n.morphAttributes.position,s=n.morphTargetsRelative;t.fromBufferAttribute(i,e);const a=this.morphTargetInfluences;if(r&&a){Oo.set(0,0,0);for(let n=0,i=r.length;n<i;n++){const i=a[n],o=r[n];0!==i&&(No.fromBufferAttribute(o,e),s?Oo.addScaledVector(No,i):Oo.addScaledVector(No.sub(t),i))}t.add(Oo)}return t}raycast(e,t){const n=this.geometry,i=this.material,r=this.matrixWorld;if(void 0!==i){if(null===n.boundingSphere&&n.computeBoundingSphere(),Lo.copy(n.boundingSphere),Lo.applyMatrix4(r),Co.copy(e.ray).recast(e.near),!1===Lo.containsPoint(Co.origin)){if(null===Co.intersectSphere(Lo,Io))return;if(Co.origin.distanceToSquared(Io)>(e.far-e.near)**2)return}Ro.copy(r).invert(),Co.copy(e.ray).applyMatrix4(Ro),null!==n.boundingBox&&!1===Co.intersectsBox(n.boundingBox)||this._computeIntersections(e,t,Co)}}_computeIntersections(e,t,n){let i;const r=this.geometry,s=this.material,a=r.index,o=r.attributes.position,l=r.attributes.uv,c=r.attributes.uv1,u=r.attributes.normal,h=r.groups,d=r.drawRange;if(null!==a)if(Array.isArray(s))for(let f=0,p=h.length;f<p;f++){const r=h[f],o=s[r.materialIndex];for(let s=Math.max(r.start,d.start),h=Math.min(a.count,Math.min(r.start+r.count,d.start+d.count));s<h;s+=3){i=zo(this,o,e,n,l,c,u,a.getX(s),a.getX(s+1),a.getX(s+2)),i&&(i.faceIndex=Math.floor(s/3),i.face.materialIndex=r.materialIndex,t.push(i))}}else{for(let r=Math.max(0,d.start),o=Math.min(a.count,d.start+d.count);r<o;r+=3){i=zo(this,s,e,n,l,c,u,a.getX(r),a.getX(r+1),a.getX(r+2)),i&&(i.faceIndex=Math.floor(r/3),t.push(i))}}else if(void 0!==o)if(Array.isArray(s))for(let f=0,p=h.length;f<p;f++){const r=h[f],a=s[r.materialIndex];for(let s=Math.max(r.start,d.start),h=Math.min(o.count,Math.min(r.start+r.count,d.start+d.count));s<h;s+=3){i=zo(this,a,e,n,l,c,u,s,s+1,s+2),i&&(i.faceIndex=Math.floor(s/3),i.face.materialIndex=r.materialIndex,t.push(i))}}else{for(let r=Math.max(0,d.start),a=Math.min(o.count,d.start+d.count);r<a;r+=3){i=zo(this,s,e,n,l,c,u,r,r+1,r+2),i&&(i.faceIndex=Math.floor(r/3),t.push(i))}}}}function zo(e,t,n,i,r,s,a,o,l,c){e.getVertexPosition(o,Po),e.getVertexPosition(l,ko),e.getVertexPosition(c,Do);const u=function(e,t,n,i,r,s,a,o){let l;if(l=t.side===Ze?i.intersectTriangle(a,s,r,!0,o):i.intersectTriangle(r,s,a,t.side===Ke,o),null===l)return null;Uo.copy(o),Uo.applyMatrix4(e.matrixWorld);const c=n.ray.origin.distanceTo(Uo);return c<n.near||c>n.far?null:{distance:c,point:Uo.clone(),object:e}}(e,t,n,i,Po,ko,Do,Fo);if(u){const e=new ss;Wa.getBarycoord(Fo,Po,ko,Do,e),r&&(u.uv=Wa.getInterpolatedAttribute(r,o,l,c,e,new is)),s&&(u.uv1=Wa.getInterpolatedAttribute(s,o,l,c,e,new is)),a&&(u.normal=Wa.getInterpolatedAttribute(a,o,l,c,e,new ss),u.normal.dot(i.direction)>0&&u.normal.multiplyScalar(-1));const t={a:o,b:l,c:c,normal:new ss,materialIndex:0};Wa.getNormal(Po,ko,Do,t.normal),u.face=t,u.barycoord=e}return u}class jo extends Mo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:i,heightSegments:r,depthSegments:s};const a=this;i=Math.floor(i),r=Math.floor(r),s=Math.floor(s);const o=[],l=[],c=[],u=[];let h=0,d=0;function f(e,t,n,i,r,s,f,p,m,g,v){const y=s/m,b=f/g,x=s/2,_=f/2,S=p/2,E=m+1,T=g+1;let w=0,A=0;const M=new ss;for(let a=0;a<T;a++){const s=a*b-_;for(let o=0;o<E;o++){const h=o*y-x;M[e]=h*i,M[t]=s*r,M[n]=S,l.push(M.x,M.y,M.z),M[e]=0,M[t]=0,M[n]=p>0?1:-1,c.push(M.x,M.y,M.z),u.push(o/m),u.push(1-a/g),w+=1}}for(let a=0;a<g;a++)for(let e=0;e<m;e++){const t=h+e+E*a,n=h+e+E*(a+1),i=h+(e+1)+E*(a+1),r=h+(e+1)+E*a;o.push(t,n,r),o.push(n,i,r),A+=6}a.addGroup(d,A,v),d+=A,h+=w}f("z","y","x",-1,-1,n,t,e,s,r,0),f("z","y","x",1,-1,n,t,-e,s,r,1),f("x","z","y",1,1,e,n,t,i,s,2),f("x","z","y",1,-1,e,n,-t,i,s,3),f("x","y","z",1,-1,e,t,n,i,r,4),f("x","y","z",-1,-1,e,t,-n,i,r,5),this.setIndex(o),this.setAttribute("position",new bo(l,3)),this.setAttribute("normal",new bo(c,3)),this.setAttribute("uv",new bo(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new jo(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Go(e){const t={};for(const n in e){t[n]={};for(const i in e[n]){const r=e[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(Gr("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[n][i]=null):t[n][i]=r.clone():Array.isArray(r)?t[n][i]=r.slice():t[n][i]=r}}return t}function Vo(e){const t={};for(let n=0;n<e.length;n++){const i=Go(e[n]);for(const e in i)t[e]=i[e]}return t}function Ho(e){const t=e.getRenderTarget();return null===t?e.outputColorSpace:!0===t.isXRRenderTarget?t.texture.colorSpace:fs.workingColorSpace}const Wo={clone:Go,merge:Vo};class Yo extends $a{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Go(e.uniforms),this.uniformsGroups=function(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n].clone());return t}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this.defaultAttributeValues=Object.assign({},e.defaultAttributeValues),this.index0AttributeName=e.index0AttributeName,this.uniformsNeedUpdate=e.uniformsNeedUpdate,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const i in this.uniforms){const n=this.uniforms[i].value;n&&n.isTexture?t.uniforms[i]={type:"t",value:n.toJSON(e).uuid}:n&&n.isColor?t.uniforms[i]={type:"c",value:n.getHex()}:n&&n.isVector2?t.uniforms[i]={type:"v2",value:n.toArray()}:n&&n.isVector3?t.uniforms[i]={type:"v3",value:n.toArray()}:n&&n.isVector4?t.uniforms[i]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?t.uniforms[i]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?t.uniforms[i]={type:"m4",value:n.toArray()}:t.uniforms[i]={value:n}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const n={};for(const i in this.extensions)!0===this.extensions[i]&&(n[i]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}class Xo extends Ia{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new ra,this.projectionMatrix=new ra,this.projectionMatrixInverse=new ra,this.coordinateSystem=Ar,this._reversedDepth=!1}get reversedDepth(){return this._reversedDepth}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}const qo=new ss,Ko=new is,Zo=new is;class Jo extends Xo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2e3;super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*Kr*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*qr*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*Kr*Math.atan(Math.tan(.5*qr*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,n){qo.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(qo.x,qo.y).multiplyScalar(-e/qo.z),qo.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(qo.x,qo.y).multiplyScalar(-e/qo.z)}getViewSize(e,t){return this.getViewBounds(e,Ko,Zo),t.subVectors(Zo,Ko)}setViewOffset(e,t,n,i,r,s){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*qr*this.fov)/this.zoom,n=2*t,i=this.aspect*n,r=-.5*i;const s=this.view;if(null!==this.view&&this.view.enabled){const e=s.fullWidth,a=s.fullHeight;r+=s.offsetX*i/e,t-=s.offsetY*n/a,i*=s.width/e,n*=s.height/a}const a=this.filmOffset;0!==a&&(r+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,t,t-n,e,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const Qo=-90;class $o extends Ia{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const i=new Jo(Qo,1,e,t);i.layers=this.layers,this.add(i);const r=new Jo(Qo,1,e,t);r.layers=this.layers,this.add(r);const s=new Jo(Qo,1,e,t);s.layers=this.layers,this.add(s);const a=new Jo(Qo,1,e,t);a.layers=this.layers,this.add(a);const o=new Jo(Qo,1,e,t);o.layers=this.layers,this.add(o);const l=new Jo(Qo,1,e,t);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[n,i,r,s,a,o]=t;for(const l of t)this.remove(l);if(e===Ar)n.up.set(0,1,0),n.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),r.up.set(0,0,-1),r.lookAt(0,1,0),s.up.set(0,0,1),s.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),o.up.set(0,1,0),o.lookAt(0,0,-1);else{if(e!==Mr)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);n.up.set(0,-1,0),n.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),r.up.set(0,0,1),r.lookAt(0,1,0),s.up.set(0,0,-1),s.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),o.up.set(0,-1,0),o.lookAt(0,0,-1)}for(const l of t)this.add(l),l.updateMatrixWorld()}update(e,t){null===this.parent&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:i}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[r,s,a,o,l,c]=this.children,u=e.getRenderTarget(),h=e.getActiveCubeFace(),d=e.getActiveMipmapLevel(),f=e.xr.enabled;e.xr.enabled=!1;const p=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,i),e.render(t,r),e.setRenderTarget(n,1,i),e.render(t,s),e.setRenderTarget(n,2,i),e.render(t,a),e.setRenderTarget(n,3,i),e.render(t,o),e.setRenderTarget(n,4,i),e.render(t,l),n.texture.generateMipmaps=p,e.setRenderTarget(n,5,i),e.render(t,c),e.setRenderTarget(u,h,d),e.xr.enabled=f,n.texture.needsPMREMUpdate=!0}}class el extends Es{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],arguments.length>1&&void 0!==arguments[1]?arguments[1]:Yt,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0,arguments.length>5?arguments[5]:void 0,arguments.length>6?arguments[6]:void 0,arguments.length>7?arguments[7]:void 0,arguments.length>8?arguments[8]:void 0,arguments.length>9?arguments[9]:void 0),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class tl extends As{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},i=[n,n,n,n,n,n];this.texture=new el(i),this._setTextureOptions(t),this.texture.isRenderTargetTexture=!0}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={tEquirect:{value:null}},i="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",r="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",s=new jo(5,5,5),a=new Yo({name:"CubemapFromEquirect",uniforms:Go(n),vertexShader:i,fragmentShader:r,side:Ze,blending:Qe});a.uniforms.tEquirect.value=t;const o=new Bo(s,a),l=t.minFilter;t.minFilter===cn&&(t.minFilter=an);return new $o(1,10,this).update(e,o),t.minFilter=l,o.geometry.dispose(),o.material.dispose(),this}clear(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const r=e.getRenderTarget();for(let s=0;s<6;s++)e.setRenderTarget(this,s),e.clear(t,n,i);e.setRenderTarget(r)}}class nl extends Ia{constructor(){super(),this.isGroup=!0,this.type="Group"}}const il={type:"move"};class rl{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new nl,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new nl,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new ss,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new ss),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new nl,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new ss,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new ss),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,n){let i=null,r=null,s=null;const a=this._targetRay,o=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(l&&e.hand){s=!0;for(const s of e.hand.values()){const e=t.getJointPose(s,n),i=this._getHandJoint(l,s);null!==e&&(i.matrix.fromArray(e.transform.matrix),i.matrix.decompose(i.position,i.rotation,i.scale),i.matrixWorldNeedsUpdate=!0,i.jointRadius=e.radius),i.visible=null!==e}const i=l.joints["index-finger-tip"],r=l.joints["thumb-tip"],a=i.position.distanceTo(r.position),o=.02,c=.005;l.inputState.pinching&&a>o+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&a<=o-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==o&&e.gripSpace&&(r=t.getPose(e.gripSpace,n),null!==r&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,r.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(r.linearVelocity)):o.hasLinearVelocity=!1,r.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(r.angularVelocity)):o.hasAngularVelocity=!1));null!==a&&(i=t.getPose(e.targetRaySpace,n),null===i&&null!==r&&(i=r),null!==i&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,i.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(i.linearVelocity)):a.hasLinearVelocity=!1,i.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(i.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(il)))}return null!==a&&(a.visible=null!==i),null!==o&&(o.visible=null!==r),null!==l&&(l.visible=null!==s),this}_getHandJoint(e,t){if(void 0===e.joints[t.jointName]){const n=new nl;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}class sl{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:25e-5;this.isFogExp2=!0,this.name="",this.color=new Za(e),this.density=t}clone(){return new sl(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class al{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;this.isFog=!0,this.name="",this.color=new Za(e),this.near=t,this.far=n}clone(){return new al(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class ol extends Ia{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new pa,this.environmentIntensity=1,this.environmentRotation=new pa,this.overrideMaterial=null,"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),1!==this.environmentIntensity&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class ll{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=mr,this.updateRanges=[],this.version=0,this.uuid=Zr()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let i=0,r=this.stride;i<r;i++)this.array[e+i]=t.array[n+i];return this}set(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Zr()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Zr()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const cl=new ss;class ul{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)cl.fromBufferAttribute(this,t),cl.applyMatrix4(e),this.setXYZ(t,cl.x,cl.y,cl.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)cl.fromBufferAttribute(this,t),cl.applyNormalMatrix(e),this.setXYZ(t,cl.x,cl.y,cl.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)cl.fromBufferAttribute(this,t),cl.transformDirection(e),this.setXYZ(t,cl.x,cl.y,cl.z);return this}getComponent(e,t){let n=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(n=es(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=ts(n,this.array)),this.data.array[e*this.data.stride+this.offset+t]=n,this}setX(e,t){return this.normalized&&(t=ts(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=ts(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=ts(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=ts(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=es(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=es(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=es(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=es(t,this.array)),t}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=ts(t,this.array),n=ts(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=ts(t,this.array),n=ts(n,this.array),i=ts(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this}setXYZW(e,t,n,i,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=ts(t,this.array),n=ts(n,this.array),i=ts(i,this.array),r=ts(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this.data.array[e+3]=r,this}clone(e){if(void 0===e){jr("InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return new co(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new ul(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){jr("InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class hl extends $a{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Za(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let dl;const fl=new ss,pl=new ss,ml=new ss,gl=new is,vl=new is,yl=new ra,bl=new ss,xl=new ss,_l=new ss,Sl=new is,El=new is,Tl=new is;class wl extends Ia{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new hl;if(super(),this.isSprite=!0,this.type="Sprite",void 0===dl){dl=new Mo;const e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),t=new ll(e,5);dl.setIndex([0,1,2,0,2,3]),dl.setAttribute("position",new ul(t,3,0,!1)),dl.setAttribute("uv",new ul(t,2,3,!1))}this.geometry=dl,this.material=e,this.center=new is(.5,.5),this.count=1}raycast(e,t){null===e.camera&&Vr('Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),pl.setFromMatrixScale(this.matrixWorld),yl.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),ml.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&pl.multiplyScalar(-ml.z);const n=this.material.rotation;let i,r;0!==n&&(r=Math.cos(n),i=Math.sin(n));const s=this.center;Al(bl.set(-.5,-.5,0),ml,s,pl,i,r),Al(xl.set(.5,-.5,0),ml,s,pl,i,r),Al(_l.set(.5,.5,0),ml,s,pl,i,r),Sl.set(0,0),El.set(1,0),Tl.set(1,1);let a=e.ray.intersectTriangle(bl,xl,_l,!1,fl);if(null===a&&(Al(xl.set(-.5,.5,0),ml,s,pl,i,r),El.set(0,1),a=e.ray.intersectTriangle(bl,_l,xl,!1,fl),null===a))return;const o=e.ray.origin.distanceTo(fl);o<e.near||o>e.far||t.push({distance:o,point:fl.clone(),uv:Wa.getInterpolation(fl,bl,xl,_l,Sl,El,Tl,new is),face:null,object:this})}copy(e,t){return super.copy(e,t),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}function Al(e,t,n,i,r,s){gl.subVectors(e,n).addScalar(.5).multiply(i),void 0!==r?(vl.x=s*gl.x-r*gl.y,vl.y=r*gl.x+s*gl.y):vl.copy(gl),e.copy(t),e.x+=vl.x,e.y+=vl.y,e.applyMatrix4(yl)}const Ml=new ss,Rl=new ss;class Cl extends Ia{constructor(){super(),this.isLOD=!0,this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let n=0,i=t.length;n<i;n++){const e=t[n];this.addLevel(e.object.clone(),e.distance,e.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;t=Math.abs(t);const i=this.levels;let r;for(r=0;r<i.length&&!(t<i[r].distance);r++);return i.splice(r,0,{distance:t,hysteresis:n,object:e}),this.add(e),this}removeLevel(e){const t=this.levels;for(let n=0;n<t.length;n++)if(t[n].distance===e){const e=t.splice(n,1);return this.remove(e[0].object),!0}return!1}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let n,i;for(n=1,i=t.length;n<i;n++){let i=t[n].distance;if(t[n].object.visible&&(i-=i*t[n].hysteresis),e<i)break}return t[n-1].object}return null}raycast(e,t){if(this.levels.length>0){Ml.setFromMatrixPosition(this.matrixWorld);const n=e.ray.origin.distanceTo(Ml);this.getObjectForDistance(n).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){Ml.setFromMatrixPosition(e.matrixWorld),Rl.setFromMatrixPosition(this.matrixWorld);const n=Ml.distanceTo(Rl)/e.zoom;let i,r;for(t[0].object.visible=!0,i=1,r=t.length;i<r;i++){let e=t[i].distance;if(t[i].object.visible&&(e-=e*t[i].hysteresis),!(n>=e))break;t[i-1].object.visible=!1,t[i].object.visible=!0}for(this._currentLevel=i-1;i<r;i++)t[i].object.visible=!1}}toJSON(e){const t=super.toJSON(e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];const n=this.levels;for(let i=0,r=n.length;i<r;i++){const e=n[i];t.object.levels.push({object:e.object.uuid,distance:e.distance,hysteresis:e.hysteresis})}return t}}const Ll=new ss,Il=new Ts,Pl=new Ts,kl=new ss,Dl=new ra,Nl=new ss,Ol=new Ks,Fl=new ra,Ul=new ia;class Bl extends Bo{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=Vt,this.bindMatrix=new ra,this.bindMatrixInverse=new ra,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;null===this.boundingBox&&(this.boundingBox=new Is),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let n=0;n<t.count;n++)this.getVertexPosition(n,Nl),this.boundingBox.expandByPoint(Nl)}computeBoundingSphere(){const e=this.geometry;null===this.boundingSphere&&(this.boundingSphere=new Ks),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let n=0;n<t.count;n++)this.getVertexPosition(n,Nl),this.boundingSphere.expandByPoint(Nl)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const n=this.material,i=this.matrixWorld;void 0!==n&&(null===this.boundingSphere&&this.computeBoundingSphere(),Ol.copy(this.boundingSphere),Ol.applyMatrix4(i),!1!==e.ray.intersectsSphere(Ol)&&(Fl.copy(i).invert(),Ul.copy(e.ray).applyMatrix4(Fl),null!==this.boundingBox&&!1===Ul.intersectsBox(this.boundingBox)||this._computeIntersections(e,t,Ul)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Ts,t=this.geometry.attributes.skinWeight;for(let n=0,i=t.count;n<i;n++){e.fromBufferAttribute(t,n);const i=1/e.manhattanLength();i!==1/0?e.multiplyScalar(i):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===Vt?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===Ht?this.bindMatrixInverse.copy(this.bindMatrix).invert():Gr("SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const n=this.skeleton,i=this.geometry;Il.fromBufferAttribute(i.attributes.skinIndex,e),Pl.fromBufferAttribute(i.attributes.skinWeight,e),Ll.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let r=0;r<4;r++){const e=Pl.getComponent(r);if(0!==e){const i=Il.getComponent(r);Dl.multiplyMatrices(n.bones[i].matrixWorld,n.boneInverses[i]),t.addScaledVector(kl.copy(Ll).applyMatrix4(Dl),e)}}return t.applyMatrix4(this.bindMatrixInverse)}}class zl extends Ia{constructor(){super(),this.isBone=!0,this.type="Bone"}}class jl extends Es{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;super(null,arguments.length>5?arguments[5]:void 0,arguments.length>6?arguments[6]:void 0,arguments.length>7?arguments[7]:void 0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:en,arguments.length>9&&void 0!==arguments[9]?arguments[9]:en,arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0,arguments.length>10?arguments[10]:void 0,arguments.length>11?arguments[11]:void 0),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const Gl=new ra,Vl=new ra;class Hl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.uuid=Zr(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.previousBoneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){Gr("Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new ra)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const t=new ra;this.bones[e]&&t.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(t)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&t.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&(t.parent&&t.parent.isBone?(t.matrix.copy(t.parent.matrixWorld).invert(),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))}}update(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,i=this.boneTexture;for(let r=0,s=e.length;r<s;r++){const i=e[r]?e[r].matrixWorld:Vl;Gl.multiplyMatrices(i,t[r]),Gl.toArray(n,16*r)}null!==i&&(i.needsUpdate=!0)}clone(){return new Hl(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=4*Math.ceil(e/4),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const n=new jl(t,e,e,An,vn);return n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){const n=this.bones[t];if(n.name===e)return n}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,i=e.bones.length;n<i;n++){const i=e.bones[n];let r=t[i];void 0===r&&(Gr("Skeleton: No bone found with UUID:",i),r=new zl),this.bones.push(r),this.boneInverses.push((new ra).fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.7,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let i=0,r=t.length;i<r;i++){const r=t[i];e.bones.push(r.uuid);const s=n[i];e.boneInverses.push(s.toArray())}return e}}class Wl extends co{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(e,t,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const Yl=new ra,Xl=new ra,ql=[],Kl=new Is,Zl=new ra,Jl=new Bo,Ql=new Ks;class $l extends Bo{constructor(e,t,n){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new Wl(new Float32Array(16*n),16),this.instanceColor=null,this.morphTexture=null,this.count=n,this.boundingBox=null,this.boundingSphere=null;for(let i=0;i<n;i++)this.setMatrixAt(i,Zl)}computeBoundingBox(){const e=this.geometry,t=this.count;null===this.boundingBox&&(this.boundingBox=new Is),null===e.boundingBox&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,Yl),Kl.copy(e.boundingBox).applyMatrix4(Yl),this.boundingBox.union(Kl)}computeBoundingSphere(){const e=this.geometry,t=this.count;null===this.boundingSphere&&(this.boundingSphere=new Ks),null===e.boundingSphere&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,Yl),Ql.copy(e.boundingSphere).applyMatrix4(Yl),this.boundingSphere.union(Ql)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),null!==e.morphTexture&&(this.morphTexture=e.morphTexture.clone()),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}getMorphAt(e,t){const n=t.morphTargetInfluences,i=this.morphTexture.source.data.data,r=e*(n.length+1)+1;for(let s=0;s<n.length;s++)n[s]=i[r+s]}raycast(e,t){const n=this.matrixWorld,i=this.count;if(Jl.geometry=this.geometry,Jl.material=this.material,void 0!==Jl.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),Ql.copy(this.boundingSphere),Ql.applyMatrix4(n),!1!==e.ray.intersectsSphere(Ql)))for(let r=0;r<i;r++){this.getMatrixAt(r,Yl),Xl.multiplyMatrices(n,Yl),Jl.matrixWorld=Xl,Jl.raycast(e,ql);for(let e=0,n=ql.length;e<n;e++){const n=ql[e];n.instanceId=r,n.object=this,t.push(n)}ql.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new Wl(new Float32Array(3*this.instanceMatrix.count).fill(1),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}setMorphAt(e,t){const n=t.morphTargetInfluences,i=n.length+1;null===this.morphTexture&&(this.morphTexture=new jl(new Float32Array(i*this.count),i,this.count,Cn,vn));const r=this.morphTexture.source.data.data;let s=0;for(let l=0;l<n.length;l++)s+=n[l];const a=this.geometry.morphTargetsRelative?1:1-s,o=i*e;r[o]=a,r.set(n,o+1)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"}),null!==this.morphTexture&&(this.morphTexture.dispose(),this.morphTexture=null)}}const ec=new ss,tc=new ss,nc=new ls;class ic{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ss(1,0,0),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const i=ec.subVectors(n,t).cross(tc.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(ec),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const r=-(e.start.dot(this.normal)+this.constant)/i;return r<0||r>1?null:t.copy(e.start).addScaledVector(n,r)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||nc.getNormalMatrix(e),i=this.coplanarPoint(ec).applyMatrix4(e),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const rc=new Ks,sc=new is(.5,.5),ac=new ss;class oc{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ic,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ic,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new ic,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new ic,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new ic,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new ic;this.planes=[e,t,n,i,r,s]}set(e,t,n,i,r,s){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(n),a[3].copy(i),a[4].copy(r),a[5].copy(s),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ar,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=this.planes,r=e.elements,s=r[0],a=r[1],o=r[2],l=r[3],c=r[4],u=r[5],h=r[6],d=r[7],f=r[8],p=r[9],m=r[10],g=r[11],v=r[12],y=r[13],b=r[14],x=r[15];if(i[0].setComponents(l-s,d-c,g-f,x-v).normalize(),i[1].setComponents(l+s,d+c,g+f,x+v).normalize(),i[2].setComponents(l+a,d+u,g+p,x+y).normalize(),i[3].setComponents(l-a,d-u,g-p,x-y).normalize(),n)i[4].setComponents(o,h,m,b).normalize(),i[5].setComponents(l-o,d-h,g-m,x-b).normalize();else if(i[4].setComponents(l-o,d-h,g-m,x-b).normalize(),t===Ar)i[5].setComponents(l+o,d+h,g+m,x+b).normalize();else{if(t!==Mr)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);i[5].setComponents(o,h,m,b).normalize()}return this}intersectsObject(e){if(void 0!==e.boundingSphere)null===e.boundingSphere&&e.computeBoundingSphere(),rc.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;null===t.boundingSphere&&t.computeBoundingSphere(),rc.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(rc)}intersectsSprite(e){rc.center.set(0,0,0);const t=sc.distanceTo(e.center);return rc.radius=.7071067811865476+t,rc.applyMatrix4(e.matrixWorld),this.intersectsSphere(rc)}intersectsSphere(e){const t=this.planes,n=e.center,i=-e.radius;for(let r=0;r<6;r++){if(t[r].distanceToPoint(n)<i)return!1}return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const i=t[n];if(ac.x=i.normal.x>0?e.max.x:e.min.x,ac.y=i.normal.y>0?e.max.y:e.min.y,ac.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(ac)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}const lc=new ra,cc=new oc;class uc{constructor(){this.coordinateSystem=Ar}intersectsObject(e,t){if(!t.isArrayCamera||0===t.cameras.length)return!1;for(let n=0;n<t.cameras.length;n++){const i=t.cameras[n];if(lc.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),cc.setFromProjectionMatrix(lc,i.coordinateSystem,i.reversedDepth),cc.intersectsObject(e))return!0}return!1}intersectsSprite(e,t){if(!t||!t.cameras||0===t.cameras.length)return!1;for(let n=0;n<t.cameras.length;n++){const i=t.cameras[n];if(lc.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),cc.setFromProjectionMatrix(lc,i.coordinateSystem,i.reversedDepth),cc.intersectsSprite(e))return!0}return!1}intersectsSphere(e,t){if(!t||!t.cameras||0===t.cameras.length)return!1;for(let n=0;n<t.cameras.length;n++){const i=t.cameras[n];if(lc.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),cc.setFromProjectionMatrix(lc,i.coordinateSystem,i.reversedDepth),cc.intersectsSphere(e))return!0}return!1}intersectsBox(e,t){if(!t||!t.cameras||0===t.cameras.length)return!1;for(let n=0;n<t.cameras.length;n++){const i=t.cameras[n];if(lc.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),cc.setFromProjectionMatrix(lc,i.coordinateSystem,i.reversedDepth),cc.intersectsBox(e))return!0}return!1}containsPoint(e,t){if(!t||!t.cameras||0===t.cameras.length)return!1;for(let n=0;n<t.cameras.length;n++){const i=t.cameras[n];if(lc.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),cc.setFromProjectionMatrix(lc,i.coordinateSystem,i.reversedDepth),cc.containsPoint(e))return!0}return!1}clone(){return new uc}}function hc(e,t){return e-t}function dc(e,t){return e.z-t.z}function fc(e,t){return t.z-e.z}class pc{constructor(){this.index=0,this.pool=[],this.list=[]}push(e,t,n,i){const r=this.pool,s=this.list;this.index>=r.length&&r.push({start:-1,count:-1,z:-1,index:-1});const a=r[this.index];s.push(a),this.index++,a.start=e,a.count=t,a.z=n,a.index=i}reset(){this.list.length=0,this.index=0}}const mc=new ra,gc=new Za(1,1,1),vc=new oc,yc=new uc,bc=new Is,xc=new Ks,_c=new ss,Sc=new ss,Ec=new ss,Tc=new pc,wc=new Bo,Ac=[];function Mc(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const i=t.itemSize;if(e.isInterleavedBufferAttribute||e.array.constructor!==t.array.constructor){const r=e.count;for(let s=0;s<r;s++)for(let r=0;r<i;r++)t.setComponent(s+n,r,e.getComponent(s,r))}else t.array.set(e.array,n*i);t.needsUpdate=!0}function Rc(e,t){if(e.constructor!==t.constructor){const n=Math.min(e.length,t.length);for(let i=0;i<n;i++)t[i]=e[i]}else{const n=Math.min(e.length,t.length);t.set(new e.constructor(e.buffer,0,n))}}class Cc extends Bo{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2*t,i=arguments.length>3?arguments[3]:void 0;super(new Mo,i),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._instanceInfo=[],this._geometryInfo=[],this._availableInstanceIds=[],this._availableGeometryIds=[],this._nextIndexStart=0,this._nextVertexStart=0,this._geometryCount=0,this._visibilityChanged=!0,this._geometryInitialized=!1,this._maxInstanceCount=e,this._maxVertexCount=t,this._maxIndexCount=n,this._multiDrawCounts=new Int32Array(e),this._multiDrawStarts=new Int32Array(e),this._multiDrawCount=0,this._multiDrawInstances=null,this._matricesTexture=null,this._indirectTexture=null,this._colorsTexture=null,this._initMatricesTexture(),this._initIndirectTexture()}get maxInstanceCount(){return this._maxInstanceCount}get instanceCount(){return this._instanceInfo.length-this._availableInstanceIds.length}get unusedVertexCount(){return this._maxVertexCount-this._nextVertexStart}get unusedIndexCount(){return this._maxIndexCount-this._nextIndexStart}_initMatricesTexture(){let e=Math.sqrt(4*this._maxInstanceCount);e=4*Math.ceil(e/4),e=Math.max(e,4);const t=new Float32Array(e*e*4),n=new jl(t,e,e,An,vn);this._matricesTexture=n}_initIndirectTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const t=new Uint32Array(e*e),n=new jl(t,e,e,Ln,gn);this._indirectTexture=n}_initColorsTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const t=new Float32Array(e*e*4).fill(1),n=new jl(t,e,e,An,vn);n.colorSpace=fs.workingColorSpace,this._colorsTexture=n}_initializeGeometry(e){const t=this.geometry,n=this._maxVertexCount,i=this._maxIndexCount;if(!1===this._geometryInitialized){for(const i in e.attributes){const r=e.getAttribute(i),{array:s,itemSize:a,normalized:o}=r,l=new s.constructor(n*a),c=new co(l,a,o);t.setAttribute(i,c)}if(null!==e.getIndex()){const e=n>65535?new Uint32Array(i):new Uint16Array(i);t.setIndex(new co(e,1))}this._geometryInitialized=!0}}_validateGeometry(e){const t=this.geometry;if(Boolean(e.getIndex())!==Boolean(t.getIndex()))throw new Error('THREE.BatchedMesh: All geometries must consistently have "index".');for(const n in t.attributes){if(!e.hasAttribute(n))throw new Error('THREE.BatchedMesh: Added geometry missing "'.concat(n,'". All geometries must have consistent attributes.'));const i=e.getAttribute(n),r=t.getAttribute(n);if(i.itemSize!==r.itemSize||i.normalized!==r.normalized)throw new Error("THREE.BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}validateInstanceId(e){const t=this._instanceInfo;if(e<0||e>=t.length||!1===t[e].active)throw new Error("THREE.BatchedMesh: Invalid instanceId ".concat(e,". Instance is either out of range or has been deleted."))}validateGeometryId(e){const t=this._geometryInfo;if(e<0||e>=t.length||!1===t[e].active)throw new Error("THREE.BatchedMesh: Invalid geometryId ".concat(e,". Geometry is either out of range or has been deleted."))}setCustomSort(e){return this.customSort=e,this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Is);const e=this.boundingBox,t=this._instanceInfo;e.makeEmpty();for(let n=0,i=t.length;n<i;n++){if(!1===t[n].active)continue;const i=t[n].geometryIndex;this.getMatrixAt(n,mc),this.getBoundingBoxAt(i,bc).applyMatrix4(mc),e.union(bc)}}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Ks);const e=this.boundingSphere,t=this._instanceInfo;e.makeEmpty();for(let n=0,i=t.length;n<i;n++){if(!1===t[n].active)continue;const i=t[n].geometryIndex;this.getMatrixAt(n,mc),this.getBoundingSphereAt(i,xc).applyMatrix4(mc),e.union(xc)}}addInstance(e){if(this._instanceInfo.length>=this.maxInstanceCount&&0===this._availableInstanceIds.length)throw new Error("THREE.BatchedMesh: Maximum item count reached.");const t={visible:!0,active:!0,geometryIndex:e};let n=null;this._availableInstanceIds.length>0?(this._availableInstanceIds.sort(hc),n=this._availableInstanceIds.shift(),this._instanceInfo[n]=t):(n=this._instanceInfo.length,this._instanceInfo.push(t));const i=this._matricesTexture;mc.identity().toArray(i.image.data,16*n),i.needsUpdate=!0;const r=this._colorsTexture;return r&&(gc.toArray(r.image.data,4*n),r.needsUpdate=!0),this._visibilityChanged=!0,n}addGeometry(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this._initializeGeometry(e),this._validateGeometry(e);const i={vertexStart:-1,vertexCount:-1,reservedVertexCount:-1,indexStart:-1,indexCount:-1,reservedIndexCount:-1,start:-1,count:-1,boundingBox:null,boundingSphere:null,active:!0},r=this._geometryInfo;i.vertexStart=this._nextVertexStart,i.reservedVertexCount=-1===t?e.getAttribute("position").count:t;const s=e.getIndex();if(null!==s&&(i.indexStart=this._nextIndexStart,i.reservedIndexCount=-1===n?s.count:n),-1!==i.indexStart&&i.indexStart+i.reservedIndexCount>this._maxIndexCount||i.vertexStart+i.reservedVertexCount>this._maxVertexCount)throw new Error("THREE.BatchedMesh: Reserved space request exceeds the maximum buffer size.");let a;return this._availableGeometryIds.length>0?(this._availableGeometryIds.sort(hc),a=this._availableGeometryIds.shift(),r[a]=i):(a=this._geometryCount,this._geometryCount++,r.push(i)),this.setGeometryAt(a,e),this._nextIndexStart=i.indexStart+i.reservedIndexCount,this._nextVertexStart=i.vertexStart+i.reservedVertexCount,a}setGeometryAt(e,t){if(e>=this._geometryCount)throw new Error("THREE.BatchedMesh: Maximum geometry count reached.");this._validateGeometry(t);const n=this.geometry,i=null!==n.getIndex(),r=n.getIndex(),s=t.getIndex(),a=this._geometryInfo[e];if(i&&s.count>a.reservedIndexCount||t.attributes.position.count>a.reservedVertexCount)throw new Error("THREE.BatchedMesh: Reserved space not large enough for provided geometry.");const o=a.vertexStart,l=a.reservedVertexCount;a.vertexCount=t.getAttribute("position").count;for(const c in n.attributes){const e=t.getAttribute(c),i=n.getAttribute(c);Mc(e,i,o);const r=e.itemSize;for(let t=e.count,n=l;t<n;t++){const e=o+t;for(let t=0;t<r;t++)i.setComponent(e,t,0)}i.needsUpdate=!0,i.addUpdateRange(o*r,l*r)}if(i){const e=a.indexStart,n=a.reservedIndexCount;a.indexCount=t.getIndex().count;for(let t=0;t<s.count;t++)r.setX(e+t,o+s.getX(t));for(let t=s.count,i=n;t<i;t++)r.setX(e+t,o);r.needsUpdate=!0,r.addUpdateRange(e,a.reservedIndexCount)}return a.start=i?a.indexStart:a.vertexStart,a.count=i?a.indexCount:a.vertexCount,a.boundingBox=null,null!==t.boundingBox&&(a.boundingBox=t.boundingBox.clone()),a.boundingSphere=null,null!==t.boundingSphere&&(a.boundingSphere=t.boundingSphere.clone()),this._visibilityChanged=!0,e}deleteGeometry(e){const t=this._geometryInfo;if(e>=t.length||!1===t[e].active)return this;const n=this._instanceInfo;for(let i=0,r=n.length;i<r;i++)n[i].active&&n[i].geometryIndex===e&&this.deleteInstance(i);return t[e].active=!1,this._availableGeometryIds.push(e),this._visibilityChanged=!0,this}deleteInstance(e){return this.validateInstanceId(e),this._instanceInfo[e].active=!1,this._availableInstanceIds.push(e),this._visibilityChanged=!0,this}optimize(){let e=0,t=0;const n=this._geometryInfo,i=n.map((e,t)=>t).sort((e,t)=>n[e].vertexStart-n[t].vertexStart),r=this.geometry;for(let s=0,a=n.length;s<a;s++){const a=i[s],o=n[a];if(!1!==o.active){if(null!==r.index){if(o.indexStart!==t){const{indexStart:n,vertexStart:i,reservedIndexCount:s}=o,a=r.index,l=a.array,c=e-i;for(let e=n;e<n+s;e++)l[e]=l[e]+c;a.array.copyWithin(t,n,n+s),a.addUpdateRange(t,s),a.needsUpdate=!0,o.indexStart=t}t+=o.reservedIndexCount}if(o.vertexStart!==e){const{vertexStart:t,reservedVertexCount:n}=o,i=r.attributes;for(const r in i){const s=i[r],{array:a,itemSize:o}=s;a.copyWithin(e*o,t*o,(t+n)*o),s.addUpdateRange(e*o,n*o),s.needsUpdate=!0}o.vertexStart=e}e+=o.reservedVertexCount,o.start=r.index?o.indexStart:o.vertexStart,this._nextIndexStart=r.index?o.indexStart+o.reservedIndexCount:0,this._nextVertexStart=o.vertexStart+o.reservedVertexCount}}return this._visibilityChanged=!0,this}getBoundingBoxAt(e,t){if(e>=this._geometryCount)return null;const n=this.geometry,i=this._geometryInfo[e];if(null===i.boundingBox){const e=new Is,t=n.index,r=n.attributes.position;for(let n=i.start,s=i.start+i.count;n<s;n++){let i=n;t&&(i=t.getX(i)),e.expandByPoint(_c.fromBufferAttribute(r,i))}i.boundingBox=e}return t.copy(i.boundingBox),t}getBoundingSphereAt(e,t){if(e>=this._geometryCount)return null;const n=this.geometry,i=this._geometryInfo[e];if(null===i.boundingSphere){const t=new Ks;this.getBoundingBoxAt(e,bc),bc.getCenter(t.center);const r=n.index,s=n.attributes.position;let a=0;for(let e=i.start,n=i.start+i.count;e<n;e++){let n=e;r&&(n=r.getX(n)),_c.fromBufferAttribute(s,n),a=Math.max(a,t.center.distanceToSquared(_c))}t.radius=Math.sqrt(a),i.boundingSphere=t}return t.copy(i.boundingSphere),t}setMatrixAt(e,t){this.validateInstanceId(e);const n=this._matricesTexture,i=this._matricesTexture.image.data;return t.toArray(i,16*e),n.needsUpdate=!0,this}getMatrixAt(e,t){return this.validateInstanceId(e),t.fromArray(this._matricesTexture.image.data,16*e)}setColorAt(e,t){return this.validateInstanceId(e),null===this._colorsTexture&&this._initColorsTexture(),t.toArray(this._colorsTexture.image.data,4*e),this._colorsTexture.needsUpdate=!0,this}getColorAt(e,t){return this.validateInstanceId(e),t.fromArray(this._colorsTexture.image.data,4*e)}setVisibleAt(e,t){return this.validateInstanceId(e),this._instanceInfo[e].visible===t||(this._instanceInfo[e].visible=t,this._visibilityChanged=!0),this}getVisibleAt(e){return this.validateInstanceId(e),this._instanceInfo[e].visible}setGeometryIdAt(e,t){return this.validateInstanceId(e),this.validateGeometryId(t),this._instanceInfo[e].geometryIndex=t,this}getGeometryIdAt(e){return this.validateInstanceId(e),this._instanceInfo[e].geometryIndex}getGeometryRangeAt(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.validateGeometryId(e);const n=this._geometryInfo[e];return t.vertexStart=n.vertexStart,t.vertexCount=n.vertexCount,t.reservedVertexCount=n.reservedVertexCount,t.indexStart=n.indexStart,t.indexCount=n.indexCount,t.reservedIndexCount=n.reservedIndexCount,t.start=n.start,t.count=n.count,t}setInstanceCount(e){const t=this._availableInstanceIds,n=this._instanceInfo;for(t.sort(hc);t[t.length-1]===n.length-1;)n.pop(),t.pop();if(e<n.length)throw new Error("BatchedMesh: Instance ids outside the range ".concat(e," are being used. Cannot shrink instance count."));const i=new Int32Array(e),r=new Int32Array(e);Rc(this._multiDrawCounts,i),Rc(this._multiDrawStarts,r),this._multiDrawCounts=i,this._multiDrawStarts=r,this._maxInstanceCount=e;const s=this._indirectTexture,a=this._matricesTexture,o=this._colorsTexture;s.dispose(),this._initIndirectTexture(),Rc(s.image.data,this._indirectTexture.image.data),a.dispose(),this._initMatricesTexture(),Rc(a.image.data,this._matricesTexture.image.data),o&&(o.dispose(),this._initColorsTexture(),Rc(o.image.data,this._colorsTexture.image.data))}setGeometrySize(e,t){const n=[...this._geometryInfo].filter(e=>e.active);if(Math.max(...n.map(e=>e.vertexStart+e.reservedVertexCount))>e)throw new Error("BatchedMesh: Geometry vertex values are being used outside the range ".concat(t,". Cannot shrink further."));if(this.geometry.index){if(Math.max(...n.map(e=>e.indexStart+e.reservedIndexCount))>t)throw new Error("BatchedMesh: Geometry index values are being used outside the range ".concat(t,". Cannot shrink further."))}const i=this.geometry;i.dispose(),this._maxVertexCount=e,this._maxIndexCount=t,this._geometryInitialized&&(this._geometryInitialized=!1,this.geometry=new Mo,this._initializeGeometry(i));const r=this.geometry;i.index&&Rc(i.index.array,r.index.array);for(const s in i.attributes)Rc(i.attributes[s].array,r.attributes[s].array)}raycast(e,t){const n=this._instanceInfo,i=this._geometryInfo,r=this.matrixWorld,s=this.geometry;wc.material=this.material,wc.geometry.index=s.index,wc.geometry.attributes=s.attributes,null===wc.geometry.boundingBox&&(wc.geometry.boundingBox=new Is),null===wc.geometry.boundingSphere&&(wc.geometry.boundingSphere=new Ks);for(let a=0,o=n.length;a<o;a++){if(!n[a].visible||!n[a].active)continue;const s=n[a].geometryIndex,o=i[s];wc.geometry.setDrawRange(o.start,o.count),this.getMatrixAt(a,wc.matrixWorld).premultiply(r),this.getBoundingBoxAt(s,wc.geometry.boundingBox),this.getBoundingSphereAt(s,wc.geometry.boundingSphere),wc.raycast(e,Ac);for(let e=0,n=Ac.length;e<n;e++){const n=Ac[e];n.object=this,n.batchId=a,t.push(n)}Ac.length=0}wc.material=null,wc.geometry.index=null,wc.geometry.attributes={},wc.geometry.setDrawRange(0,1/0)}copy(e){return super.copy(e),this.geometry=e.geometry.clone(),this.perObjectFrustumCulled=e.perObjectFrustumCulled,this.sortObjects=e.sortObjects,this.boundingBox=null!==e.boundingBox?e.boundingBox.clone():null,this.boundingSphere=null!==e.boundingSphere?e.boundingSphere.clone():null,this._geometryInfo=e._geometryInfo.map(e=>(0,Oe.A)((0,Oe.A)({},e),{},{boundingBox:null!==e.boundingBox?e.boundingBox.clone():null,boundingSphere:null!==e.boundingSphere?e.boundingSphere.clone():null})),this._instanceInfo=e._instanceInfo.map(e=>(0,Oe.A)({},e)),this._availableInstanceIds=e._availableInstanceIds.slice(),this._availableGeometryIds=e._availableGeometryIds.slice(),this._nextIndexStart=e._nextIndexStart,this._nextVertexStart=e._nextVertexStart,this._geometryCount=e._geometryCount,this._maxInstanceCount=e._maxInstanceCount,this._maxVertexCount=e._maxVertexCount,this._maxIndexCount=e._maxIndexCount,this._geometryInitialized=e._geometryInitialized,this._multiDrawCounts=e._multiDrawCounts.slice(),this._multiDrawStarts=e._multiDrawStarts.slice(),this._indirectTexture=e._indirectTexture.clone(),this._indirectTexture.image.data=this._indirectTexture.image.data.slice(),this._matricesTexture=e._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.data.slice(),null!==this._colorsTexture&&(this._colorsTexture=e._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.data.slice()),this}dispose(){this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this._indirectTexture.dispose(),this._indirectTexture=null,null!==this._colorsTexture&&(this._colorsTexture.dispose(),this._colorsTexture=null)}onBeforeRender(e,t,n,i,r){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const s=i.getIndex(),a=null===s?1:s.array.BYTES_PER_ELEMENT,o=this._instanceInfo,l=this._multiDrawStarts,c=this._multiDrawCounts,u=this._geometryInfo,h=this.perObjectFrustumCulled,d=this._indirectTexture,f=d.image.data,p=n.isArrayCamera?yc:vc;h&&!n.isArrayCamera&&(mc.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse).multiply(this.matrixWorld),vc.setFromProjectionMatrix(mc,n.coordinateSystem,n.reversedDepth));let m=0;if(this.sortObjects){mc.copy(this.matrixWorld).invert(),_c.setFromMatrixPosition(n.matrixWorld).applyMatrix4(mc),Sc.set(0,0,-1).transformDirection(n.matrixWorld).transformDirection(mc);for(let i=0,r=o.length;i<r;i++)if(o[i].visible&&o[i].active){const e=o[i].geometryIndex;this.getMatrixAt(i,mc),this.getBoundingSphereAt(e,xc).applyMatrix4(mc);let t=!1;if(h&&(t=!p.intersectsSphere(xc,n)),!t){const t=u[e],n=Ec.subVectors(xc.center,_c).dot(Sc);Tc.push(t.start,t.count,n,i)}}const e=Tc.list,t=this.customSort;null===t?e.sort(r.transparent?fc:dc):t.call(this,e,n);for(let n=0,i=e.length;n<i;n++){const t=e[n];l[m]=t.start*a,c[m]=t.count,f[m]=t.index,m++}Tc.reset()}else for(let g=0,v=o.length;g<v;g++)if(o[g].visible&&o[g].active){const e=o[g].geometryIndex;let t=!1;if(h&&(this.getMatrixAt(g,mc),this.getBoundingSphereAt(e,xc).applyMatrix4(mc),t=!p.intersectsSphere(xc,n)),!t){const t=u[e];l[m]=t.start*a,c[m]=t.count,f[m]=g,m++}}d.needsUpdate=!0,this._multiDrawCount=m,this._visibilityChanged=!1}onBeforeShadow(e,t,n,i,r,s){this.onBeforeRender(e,null,i,r,s)}}class Lc extends $a{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Za(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const Ic=new ss,Pc=new ss,kc=new ra,Dc=new ia,Nc=new Ks,Oc=new ss,Fc=new ss;class Uc extends Ia{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Mo,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Lc;super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,n=[0];for(let e=1,i=t.count;e<i;e++)Ic.fromBufferAttribute(t,e-1),Pc.fromBufferAttribute(t,e),n[e]=n[e-1],n[e]+=Ic.distanceTo(Pc);e.setAttribute("lineDistance",new bo(n,1))}else Gr("Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,r=e.params.Line.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Nc.copy(n.boundingSphere),Nc.applyMatrix4(i),Nc.radius+=r,!1===e.ray.intersectsSphere(Nc))return;kc.copy(i).invert(),Dc.copy(e.ray).applyMatrix4(kc);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,l=this.isLineSegments?2:1,c=n.index,u=n.attributes.position;if(null!==c){const n=Math.max(0,s.start),i=Math.min(c.count,s.start+s.count);for(let r=n,s=i-1;r<s;r+=l){const n=c.getX(r),i=c.getX(r+1),s=Bc(this,e,Dc,o,n,i,r);s&&t.push(s)}if(this.isLineLoop){const r=c.getX(i-1),s=c.getX(n),a=Bc(this,e,Dc,o,r,s,i-1);a&&t.push(a)}}else{const n=Math.max(0,s.start),i=Math.min(u.count,s.start+s.count);for(let r=n,s=i-1;r<s;r+=l){const n=Bc(this,e,Dc,o,r,r+1,r);n&&t.push(n)}if(this.isLineLoop){const r=Bc(this,e,Dc,o,i-1,n,i-1);r&&t.push(r)}}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}function Bc(e,t,n,i,r,s,a){const o=e.geometry.attributes.position;Ic.fromBufferAttribute(o,r),Pc.fromBufferAttribute(o,s);if(n.distanceSqToSegment(Ic,Pc,Oc,Fc)>i)return;Oc.applyMatrix4(e.matrixWorld);const l=t.ray.origin.distanceTo(Oc);return l<t.near||l>t.far?void 0:{distance:l,point:Fc.clone().applyMatrix4(e.matrixWorld),index:a,face:null,faceIndex:null,barycoord:null,object:e}}const zc=new ss,jc=new ss;class Gc extends Uc{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,n=[];for(let e=0,i=t.count;e<i;e+=2)zc.fromBufferAttribute(t,e),jc.fromBufferAttribute(t,e+1),n[e]=0===e?0:n[e-1],n[e+1]=n[e]+zc.distanceTo(jc);e.setAttribute("lineDistance",new bo(n,1))}else Gr("LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class Vc extends Uc{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class Hc extends $a{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Za(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const Wc=new ra,Yc=new ia,Xc=new Ks,qc=new ss;class Kc extends Ia{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Mo,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Hc;super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,r=e.params.Points.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Xc.copy(n.boundingSphere),Xc.applyMatrix4(i),Xc.radius+=r,!1===e.ray.intersectsSphere(Xc))return;Wc.copy(i).invert(),Yc.copy(e.ray).applyMatrix4(Wc);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,l=n.index,c=n.attributes.position;if(null!==l){for(let n=Math.max(0,s.start),r=Math.min(l.count,s.start+s.count);n<r;n++){const r=l.getX(n);qc.fromBufferAttribute(c,r),Zc(qc,r,o,i,e,t,this)}}else{for(let n=Math.max(0,s.start),r=Math.min(c.count,s.start+s.count);n<r;n++)qc.fromBufferAttribute(c,n),Zc(qc,n,o,i,e,t,this)}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}function Zc(e,t,n,i,r,s,a){const o=Yc.distanceSqToPoint(e);if(o<n){const n=new ss;Yc.closestPointToPoint(e,n),n.applyMatrix4(i);const l=r.ray.origin.distanceTo(n);if(l<r.near||l>r.far)return;s.push({distance:l,distanceToRay:Math.sqrt(o),point:n,index:t,face:null,faceIndex:null,barycoord:null,object:a})}}class Jc extends Es{constructor(e,t,n,i){super(e,t,n,i,arguments.length>4&&void 0!==arguments[4]?arguments[4]:an,arguments.length>5&&void 0!==arguments[5]?arguments[5]:an,arguments.length>6?arguments[6]:void 0,arguments.length>7?arguments[7]:void 0,arguments.length>8?arguments[8]:void 0),this.isVideoTexture=!0,this.generateMipmaps=!1,this._requestVideoFrameCallbackId=0;const r=this;"requestVideoFrameCallback"in e&&(this._requestVideoFrameCallbackId=e.requestVideoFrameCallback(function t(){r.needsUpdate=!0,r._requestVideoFrameCallbackId=e.requestVideoFrameCallback(t)}))}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;!1==="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}dispose(){0!==this._requestVideoFrameCallbackId&&(this.source.data.cancelVideoFrameCallback(this._requestVideoFrameCallbackId),this._requestVideoFrameCallbackId=0),super.dispose()}}class Qc extends Jc{constructor(e,t,n,i,r,s,a,o){super({},e,t,n,i,r,s,a,o),this.isVideoFrameTexture=!0}update(){}clone(){return(new this.constructor).copy(this)}setFrame(e){this.image=e,this.needsUpdate=!0}}class $c extends Es{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=en,this.minFilter=en,this.generateMipmaps=!1,this.needsUpdate=!0}}class eu extends Es{constructor(e,t,n,i,r,s,a,o,l,c,u,h){super(null,s,a,o,l,c,i,r,u,h),this.isCompressedTexture=!0,this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class tu extends eu{constructor(e,t,n,i,r,s){super(e,t,n,r,s),this.isCompressedArrayTexture=!0,this.image.depth=i,this.wrapR=Qt,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class nu extends eu{constructor(e,t,n){super(void 0,e[0].width,e[0].height,t,n,Yt),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}}class iu extends Es{constructor(e,t,n,i,r,s,a,o,l){super(e,t,n,i,r,s,a,o,l),this.isCanvasTexture=!0,this.needsUpdate=!0}}class ru extends Es{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:gn,i=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0,s=arguments.length>5?arguments[5]:void 0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:en,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:en,l=arguments.length>8?arguments[8]:void 0,c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:Mn,u=arguments.length>10&&void 0!==arguments[10]?arguments[10]:1;if(c!==Mn&&c!==Rn)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");super({width:e,height:t,depth:u},i,r,s,a,o,c,n,l),this.isDepthTexture=!0,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.source=new bs(Object.assign({},e.image)),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return null!==this.compareFunction&&(t.compareFunction=this.compareFunction),t}}class su extends ru{constructor(e){const t={width:e,height:e,depth:1},n=[t,t,t,t,t,t];super(e,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:gn,arguments.length>2&&void 0!==arguments[2]?arguments[2]:Yt,arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0,arguments.length>5&&void 0!==arguments[5]?arguments[5]:en,arguments.length>6&&void 0!==arguments[6]?arguments[6]:en,arguments.length>7?arguments[7]:void 0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:Mn),this.image=n,this.isCubeDepthTexture=!0,this.isCubeTexture=!0}get images(){return this.image}set images(e){this.image=e}}class au extends Es{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;super(),this.sourceTexture=e,this.isExternalTexture=!0}copy(e){return super.copy(e),this.sourceTexture=e.sourceTexture,this}}class ou extends Mo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;super(),this.type="CapsuleGeometry",this.parameters={radius:e,height:t,capSegments:n,radialSegments:i,heightSegments:r},t=Math.max(0,t),n=Math.max(1,Math.floor(n)),i=Math.max(3,Math.floor(i)),r=Math.max(1,Math.floor(r));const s=[],a=[],o=[],l=[],c=t/2,u=Math.PI/2*e,h=t,d=2*u+h,f=2*n+r,p=i+1,m=new ss,g=new ss;for(let v=0;v<=f;v++){let y=0,b=0,x=0,_=0;if(v<=n){const t=v/n,i=t*Math.PI/2;b=-c-e*Math.cos(i),x=e*Math.sin(i),_=-e*Math.cos(i),y=t*u}else if(v<=n+r){const i=(v-n)/r;b=i*t-c,x=e,_=0,y=u+i*h}else{const t=(v-n-r)/n,i=t*Math.PI/2;b=c+e*Math.sin(i),x=e*Math.cos(i),_=e*Math.sin(i),y=u+h+t*u}const S=Math.max(0,Math.min(1,y/d));let E=0;0===v?E=.5/i:v===f&&(E=-.5/i);for(let e=0;e<=i;e++){const t=e/i,n=t*Math.PI*2,r=Math.sin(n),s=Math.cos(n);g.x=-x*s,g.y=b,g.z=x*r,a.push(g.x,g.y,g.z),m.set(-x*s,_,x*r),m.normalize(),o.push(m.x,m.y,m.z),l.push(t+E,S)}if(v>0){const e=(v-1)*p;for(let t=0;t<i;t++){const n=e+t,i=e+t+1,r=v*p+t,a=v*p+t+1;s.push(n,i,r),s.push(i,a,r)}}}this.setIndex(s),this.setAttribute("position",new bo(a,3)),this.setAttribute("normal",new bo(o,3)),this.setAttribute("uv",new bo(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ou(e.radius,e.height,e.capSegments,e.radialSegments,e.heightSegments)}}class lu extends Mo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2*Math.PI;super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:i},t=Math.max(3,t);const r=[],s=[],a=[],o=[],l=new ss,c=new is;s.push(0,0,0),a.push(0,0,1),o.push(.5,.5);for(let u=0,h=3;u<=t;u++,h+=3){const r=n+u/t*i;l.x=e*Math.cos(r),l.y=e*Math.sin(r),s.push(l.x,l.y,l.z),a.push(0,0,1),c.x=(s[h]/e+1)/2,c.y=(s[h+1]/e+1)/2,o.push(c.x,c.y)}for(let u=1;u<=t;u++)r.push(u,u+1,0);this.setIndex(r),this.setAttribute("position",new bo(s,3)),this.setAttribute("normal",new bo(a,3)),this.setAttribute("uv",new bo(o,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new lu(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class cu extends Mo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:32,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:2*Math.PI;super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:i,heightSegments:r,openEnded:s,thetaStart:a,thetaLength:o};const l=this;i=Math.floor(i),r=Math.floor(r);const c=[],u=[],h=[],d=[];let f=0;const p=[],m=n/2;let g=0;function v(n){const r=f,s=new is,p=new ss;let v=0;const y=!0===n?e:t,b=!0===n?1:-1;for(let e=1;e<=i;e++)u.push(0,m*b,0),h.push(0,b,0),d.push(.5,.5),f++;const x=f;for(let e=0;e<=i;e++){const t=e/i*o+a,n=Math.cos(t),r=Math.sin(t);p.x=y*r,p.y=m*b,p.z=y*n,u.push(p.x,p.y,p.z),h.push(0,b,0),s.x=.5*n+.5,s.y=.5*r*b+.5,d.push(s.x,s.y),f++}for(let e=0;e<i;e++){const t=r+e,i=x+e;!0===n?c.push(i,i+1,t):c.push(i+1,i,t),v+=3}l.addGroup(g,v,!0===n?1:2),g+=v}!function(){const s=new ss,v=new ss;let y=0;const b=(t-e)/n;for(let l=0;l<=r;l++){const c=[],g=l/r,y=g*(t-e)+e;for(let e=0;e<=i;e++){const t=e/i,r=t*o+a,l=Math.sin(r),p=Math.cos(r);v.x=y*l,v.y=-g*n+m,v.z=y*p,u.push(v.x,v.y,v.z),s.set(l,b,p).normalize(),h.push(s.x,s.y,s.z),d.push(t,1-g),c.push(f++)}p.push(c)}for(let n=0;n<i;n++)for(let i=0;i<r;i++){const s=p[i][n],a=p[i+1][n],o=p[i+1][n+1],l=p[i][n+1];(e>0||0!==i)&&(c.push(s,a,l),y+=3),(t>0||i!==r-1)&&(c.push(a,o,l),y+=3)}l.addGroup(g,y,0),g+=y}(),!1===s&&(e>0&&v(!0),t>0&&v(!1)),this.setIndex(c),this.setAttribute("position",new bo(u,3)),this.setAttribute("normal",new bo(h,3)),this.setAttribute("uv",new bo(d,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new cu(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class uu extends cu{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:32,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:2*Math.PI;super(0,e,t,n,i,r,s,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:i,openEnded:r,thetaStart:s,thetaLength:a}}static fromJSON(e){return new uu(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class hu extends Mo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:i};const r=[],s=[];function a(e,t,n,i){const r=i+1,s=[];for(let a=0;a<=r;a++){s[a]=[];const i=e.clone().lerp(n,a/r),o=t.clone().lerp(n,a/r),l=r-a;for(let e=0;e<=l;e++)s[a][e]=0===e&&a===r?i:i.clone().lerp(o,e/l)}for(let a=0;a<r;a++)for(let e=0;e<2*(r-a)-1;e++){const t=Math.floor(e/2);e%2===0?(o(s[a][t+1]),o(s[a+1][t]),o(s[a][t])):(o(s[a][t+1]),o(s[a+1][t+1]),o(s[a+1][t]))}}function o(e){r.push(e.x,e.y,e.z)}function l(t,n){const i=3*t;n.x=e[i+0],n.y=e[i+1],n.z=e[i+2]}function c(e,t,n,i){i<0&&1===e.x&&(s[t]=e.x-1),0===n.x&&0===n.z&&(s[t]=i/2/Math.PI+.5)}function u(e){return Math.atan2(e.z,-e.x)}function h(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}!function(e){const n=new ss,i=new ss,r=new ss;for(let s=0;s<t.length;s+=3)l(t[s+0],n),l(t[s+1],i),l(t[s+2],r),a(n,i,r,e)}(i),function(e){const t=new ss;for(let n=0;n<r.length;n+=3)t.x=r[n+0],t.y=r[n+1],t.z=r[n+2],t.normalize().multiplyScalar(e),r[n+0]=t.x,r[n+1]=t.y,r[n+2]=t.z}(n),function(){const e=new ss;for(let t=0;t<r.length;t+=3){e.x=r[t+0],e.y=r[t+1],e.z=r[t+2];const n=u(e)/2/Math.PI+.5,i=h(e)/Math.PI+.5;s.push(n,1-i)}(function(){const e=new ss,t=new ss,n=new ss,i=new ss,a=new is,o=new is,l=new is;for(let h=0,d=0;h<r.length;h+=9,d+=6){e.set(r[h+0],r[h+1],r[h+2]),t.set(r[h+3],r[h+4],r[h+5]),n.set(r[h+6],r[h+7],r[h+8]),a.set(s[d+0],s[d+1]),o.set(s[d+2],s[d+3]),l.set(s[d+4],s[d+5]),i.copy(e).add(t).add(n).divideScalar(3);const f=u(i);c(a,d+0,e,f),c(o,d+2,t,f),c(l,d+4,n,f)}})(),function(){for(let e=0;e<s.length;e+=6){const t=s[e+0],n=s[e+2],i=s[e+4],r=Math.max(t,n,i),a=Math.min(t,n,i);r>.9&&a<.1&&(t<.2&&(s[e+0]+=1),n<.2&&(s[e+2]+=1),i<.2&&(s[e+4]+=1))}}()}(),this.setAttribute("position",new bo(r,3)),this.setAttribute("normal",new bo(r.slice(),3)),this.setAttribute("uv",new bo(s,2)),0===i?this.computeVertexNormals():this.normalizeNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new hu(e.vertices,e.indices,e.radius,e.detail)}}class du extends hu{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=(1+Math.sqrt(5))/2,i=1/n;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-n,0,-i,n,0,i,-n,0,i,n,-i,-n,0,-i,n,0,i,-n,0,i,n,0,-n,0,-i,n,0,-i,-n,0,i,n,0,i],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new du(e.radius,e.detail)}}const fu=new ss,pu=new ss,mu=new ss,gu=new Wa;class vu extends Mo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},null!==e){const n=4,i=Math.pow(10,n),r=Math.cos(qr*t),s=e.getIndex(),a=e.getAttribute("position"),o=s?s.count:a.count,l=[0,0,0],c=["a","b","c"],u=new Array(3),h={},d=[];for(let e=0;e<o;e+=3){s?(l[0]=s.getX(e),l[1]=s.getX(e+1),l[2]=s.getX(e+2)):(l[0]=e,l[1]=e+1,l[2]=e+2);const{a:t,b:n,c:o}=gu;if(t.fromBufferAttribute(a,l[0]),n.fromBufferAttribute(a,l[1]),o.fromBufferAttribute(a,l[2]),gu.getNormal(mu),u[0]="".concat(Math.round(t.x*i),",").concat(Math.round(t.y*i),",").concat(Math.round(t.z*i)),u[1]="".concat(Math.round(n.x*i),",").concat(Math.round(n.y*i),",").concat(Math.round(n.z*i)),u[2]="".concat(Math.round(o.x*i),",").concat(Math.round(o.y*i),",").concat(Math.round(o.z*i)),u[0]!==u[1]&&u[1]!==u[2]&&u[2]!==u[0])for(let e=0;e<3;e++){const t=(e+1)%3,n=u[e],i=u[t],s=gu[c[e]],a=gu[c[t]],o="".concat(n,"_").concat(i),f="".concat(i,"_").concat(n);f in h&&h[f]?(mu.dot(h[f].normal)<=r&&(d.push(s.x,s.y,s.z),d.push(a.x,a.y,a.z)),h[f]=null):o in h||(h[o]={index0:l[e],index1:l[t],normal:mu.clone()})}}for(const e in h)if(h[e]){const{index0:t,index1:n}=h[e];fu.fromBufferAttribute(a,t),pu.fromBufferAttribute(a,n),d.push(fu.x,fu.y,fu.z),d.push(pu.x,pu.y,pu.z)}this.setAttribute("position",new bo(d,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class yu{constructor(){this.type="Curve",this.arcLengthDivisions=200,this.needsUpdate=!1,this.cacheArcLengths=null}getPoint(){Gr("Curve: .getPoint() not implemented.")}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.arcLengthDivisions;if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,i=this.getPoint(0),r=0;t.push(0);for(let s=1;s<=e;s++)n=this.getPoint(s/e),r+=n.distanceTo(i),t.push(r),i=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=this.getLengths();let i=0;const r=n.length;let s;s=t||e*n[r-1];let a,o=0,l=r-1;for(;o<=l;)if(i=Math.floor(o+(l-o)/2),a=n[i]-s,a<0)o=i+1;else{if(!(a>0)){l=i;break}l=i-1}if(i=l,n[i]===s)return i/(r-1);const c=n[i];return(i+(s-c)/(n[i+1]-c))/(r-1)}getTangent(e,t){const n=1e-4;let i=e-n,r=e+n;i<0&&(i=0),r>1&&(r=1);const s=this.getPoint(i),a=this.getPoint(r),o=t||(s.isVector2?new is:new ss);return o.copy(a).sub(s).normalize(),o}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=new ss,i=[],r=[],s=[],a=new ss,o=new ra;for(let d=0;d<=e;d++){const t=d/e;i[d]=this.getTangentAt(t,new ss)}r[0]=new ss,s[0]=new ss;let l=Number.MAX_VALUE;const c=Math.abs(i[0].x),u=Math.abs(i[0].y),h=Math.abs(i[0].z);c<=l&&(l=c,n.set(1,0,0)),u<=l&&(l=u,n.set(0,1,0)),h<=l&&n.set(0,0,1),a.crossVectors(i[0],n).normalize(),r[0].crossVectors(i[0],a),s[0].crossVectors(i[0],r[0]);for(let d=1;d<=e;d++){if(r[d]=r[d-1].clone(),s[d]=s[d-1].clone(),a.crossVectors(i[d-1],i[d]),a.length()>Number.EPSILON){a.normalize();const e=Math.acos(Jr(i[d-1].dot(i[d]),-1,1));r[d].applyMatrix4(o.makeRotationAxis(a,e))}s[d].crossVectors(i[d],r[d])}if(!0===t){let t=Math.acos(Jr(r[0].dot(r[e]),-1,1));t/=e,i[0].dot(a.crossVectors(r[0],r[e]))>0&&(t=-t);for(let n=1;n<=e;n++)r[n].applyMatrix4(o.makeRotationAxis(i[n],t*n)),s[n].crossVectors(i[n],r[n])}return{tangents:i,normals:r,binormals:s}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.7,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class bu extends yu{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2*Math.PI,a=arguments.length>6&&void 0!==arguments[6]&&arguments[6],o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=i,this.aStartAngle=r,this.aEndAngle=s,this.aClockwise=a,this.aRotation=o}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new is,n=2*Math.PI;let i=this.aEndAngle-this.aStartAngle;const r=Math.abs(i)<Number.EPSILON;for(;i<0;)i+=n;for(;i>n;)i-=n;i<Number.EPSILON&&(i=r?0:n),!0!==this.aClockwise||r||(i===n?i=-n:i-=n);const s=this.aStartAngle+e*i;let a=this.aX+this.xRadius*Math.cos(s),o=this.aY+this.yRadius*Math.sin(s);if(0!==this.aRotation){const e=Math.cos(this.aRotation),t=Math.sin(this.aRotation),n=a-this.aX,i=o-this.aY;a=n*e-i*t+this.aX,o=n*t+i*e+this.aY}return t.set(a,o)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class xu extends bu{constructor(e,t,n,i,r,s){super(e,t,n,n,i,r,s),this.isArcCurve=!0,this.type="ArcCurve"}}function _u(){let e=0,t=0,n=0,i=0;function r(r,s,a,o){e=r,t=a,n=-3*r+3*s-2*a-o,i=2*r-2*s+a+o}return{initCatmullRom:function(e,t,n,i,s){r(t,n,s*(n-e),s*(i-t))},initNonuniformCatmullRom:function(e,t,n,i,s,a,o){let l=(t-e)/s-(n-e)/(s+a)+(n-t)/a,c=(n-t)/a-(i-t)/(a+o)+(i-n)/o;l*=a,c*=a,r(t,n,l,c)},calc:function(r){const s=r*r;return e+t*r+n*s+i*(s*r)}}}const Su=new ss,Eu=new _u,Tu=new _u,wu=new _u;class Au extends yu{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"centripetal",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=i}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ss,n=this.points,i=n.length,r=(i-(this.closed?0:1))*e;let s,a,o=Math.floor(r),l=r-o;this.closed?o+=o>0?0:(Math.floor(Math.abs(o)/i)+1)*i:0===l&&o===i-1&&(o=i-2,l=1),this.closed||o>0?s=n[(o-1)%i]:(Su.subVectors(n[0],n[1]).add(n[0]),s=Su);const c=n[o%i],u=n[(o+1)%i];if(this.closed||o+2<i?a=n[(o+2)%i]:(Su.subVectors(n[i-1],n[i-2]).add(n[i-1]),a=Su),"centripetal"===this.curveType||"chordal"===this.curveType){const e="chordal"===this.curveType?.5:.25;let t=Math.pow(s.distanceToSquared(c),e),n=Math.pow(c.distanceToSquared(u),e),i=Math.pow(u.distanceToSquared(a),e);n<1e-4&&(n=1),t<1e-4&&(t=n),i<1e-4&&(i=n),Eu.initNonuniformCatmullRom(s.x,c.x,u.x,a.x,t,n,i),Tu.initNonuniformCatmullRom(s.y,c.y,u.y,a.y,t,n,i),wu.initNonuniformCatmullRom(s.z,c.z,u.z,a.z,t,n,i)}else"catmullrom"===this.curveType&&(Eu.initCatmullRom(s.x,c.x,u.x,a.x,this.tension),Tu.initCatmullRom(s.y,c.y,u.y,a.y,this.tension),wu.initCatmullRom(s.z,c.z,u.z,a.z,this.tension));return t.set(Eu.calc(l),Tu.calc(l),wu.calc(l)),t}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new ss).fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function Mu(e,t,n,i,r){const s=.5*(i-t),a=.5*(r-n),o=e*e;return(2*n-2*i+s+a)*(e*o)+(-3*n+3*i-2*s-a)*o+s*e+n}function Ru(e,t,n,i){return function(e,t){const n=1-e;return n*n*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,n)+function(e,t){return e*e*t}(e,i)}function Cu(e,t,n,i,r){return function(e,t){const n=1-e;return n*n*n*t}(e,t)+function(e,t){const n=1-e;return 3*n*n*e*t}(e,n)+function(e,t){return 3*(1-e)*e*e*t}(e,i)+function(e,t){return e*e*e*t}(e,r)}class Lu extends yu{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new is,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new is,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new is,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new is;super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new is,n=this.v0,i=this.v1,r=this.v2,s=this.v3;return t.set(Cu(e,n.x,i.x,r.x,s.x),Cu(e,n.y,i.y,r.y,s.y)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class Iu extends yu{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ss,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ss,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new ss,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new ss;super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ss,n=this.v0,i=this.v1,r=this.v2,s=this.v3;return t.set(Cu(e,n.x,i.x,r.x,s.x),Cu(e,n.y,i.y,r.y,s.y),Cu(e,n.z,i.z,r.z,s.z)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class Pu extends yu{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new is,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new is;super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new is;return 1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:new is).subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class ku extends yu{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ss,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ss;super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ss;return 1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ss).subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Du extends yu{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new is,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new is,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new is;super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new is,n=this.v0,i=this.v1,r=this.v2;return t.set(Ru(e,n.x,i.x,r.x),Ru(e,n.y,i.y,r.y)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Nu extends yu{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ss,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ss,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new ss;super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ss,n=this.v0,i=this.v1,r=this.v2;return t.set(Ru(e,n.x,i.x,r.x),Ru(e,n.y,i.y,r.y),Ru(e,n.z,i.z,r.z)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Ou extends yu{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new is,n=this.points,i=(n.length-1)*e,r=Math.floor(i),s=i-r,a=n[0===r?r:r-1],o=n[r],l=n[r>n.length-2?n.length-1:r+1],c=n[r>n.length-3?n.length-1:r+2];return t.set(Mu(s,a.x,o.x,l.x,c.x),Mu(s,a.y,o.y,l.y,c.y)),t}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new is).fromArray(n))}return this}}var Fu=Object.freeze({__proto__:null,ArcCurve:xu,CatmullRomCurve3:Au,CubicBezierCurve:Lu,CubicBezierCurve3:Iu,EllipseCurve:bu,LineCurve:Pu,LineCurve3:ku,QuadraticBezierCurve:Du,QuadraticBezierCurve3:Nu,SplineCurve:Ou});class Uu extends yu{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){const n=!0===e.isVector2?"LineCurve":"LineCurve3";this.curves.push(new Fu[n](t,e))}return this}getPoint(e,t){const n=e*this.getLength(),i=this.getCurveLengths();let r=0;for(;r<i.length;){if(i[r]>=n){const e=i[r]-n,s=this.curves[r],a=s.getLength(),o=0===a?0:1-e/a;return s.getPointAt(o,t)}r++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,i=this.curves.length;n<i;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:40;const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12;const t=[];let n;for(let i=0,r=this.curves;i<r.length;i++){const s=r[i],a=s.isEllipseCurve?2*e:s.isLineCurve||s.isLineCurve3?1:s.isSplineCurve?e*s.points.length:e,o=s.getPoints(a);for(let e=0;e<o.length;e++){const i=o[e];n&&n.equals(i)||(t.push(i),n=i)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push(n.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){const n=this.curves[t];e.curves.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push((new Fu[n.type]).fromJSON(n))}return this}}class Bu extends Uu{constructor(e){super(),this.type="Path",this.currentPoint=new is,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const n=new Pu(this.currentPoint.clone(),new is(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,i){const r=new Du(this.currentPoint.clone(),new is(e,t),new is(n,i));return this.curves.push(r),this.currentPoint.set(n,i),this}bezierCurveTo(e,t,n,i,r,s){const a=new Lu(this.currentPoint.clone(),new is(e,t),new is(n,i),new is(r,s));return this.curves.push(a),this.currentPoint.set(r,s),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),n=new Ou(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,i,r,s){const a=this.currentPoint.x,o=this.currentPoint.y;return this.absarc(e+a,t+o,n,i,r,s),this}absarc(e,t,n,i,r,s){return this.absellipse(e,t,n,n,i,r,s),this}ellipse(e,t,n,i,r,s,a,o){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+l,t+c,n,i,r,s,a,o),this}absellipse(e,t,n,i,r,s,a,o){const l=new bu(e,t,n,i,r,s,a,o);if(this.curves.length>0){const e=l.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(l);const c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class zu extends Bu{constructor(e){super(e),this.uuid=Zr(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let n=0,i=this.holes.length;n<i;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){const n=this.holes[t];e.holes.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push((new Bu).fromJSON(n))}return this}}function ju(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const i=t&&t.length,r=i?t[0]*n:e.length;let s=Gu(e,0,r,n,!0);const a=[];if(!s||s.next===s.prev)return a;let o,l,c;if(i&&(s=function(e,t,n,i){const r=[];for(let s=0,a=t.length;s<a;s++){const n=Gu(e,t[s]*i,s<a-1?t[s+1]*i:e.length,i,!1);n===n.next&&(n.steiner=!0),r.push($u(n))}r.sort(Ku);for(let s=0;s<r.length;s++)n=Zu(r[s],n);return n}(e,t,s,n)),e.length>80*n){o=e[0],l=e[1];let t=o,i=l;for(let s=n;s<r;s+=n){const n=e[s],r=e[s+1];n<o&&(o=n),r<l&&(l=r),n>t&&(t=n),r>i&&(i=r)}c=Math.max(t-o,i-l),c=0!==c?32767/c:0}return Hu(s,a,n,o,l,c,0),a}function Gu(e,t,n,i,r){let s;if(r===function(e,t,n,i){let r=0;for(let s=t,a=n-i;s<n;s+=i)r+=(e[a]-e[s])*(e[s+1]+e[a+1]),a=s;return r}(e,t,n,i)>0)for(let a=t;a<n;a+=i)s=uh(a/i|0,e[a],e[a+1],s);else for(let a=n-i;a>=t;a-=i)s=uh(a/i|0,e[a],e[a+1],s);return s&&rh(s,s.next)&&(hh(s),s=s.next),s}function Vu(e,t){if(!e)return e;t||(t=e);let n,i=e;do{if(n=!1,i.steiner||!rh(i,i.next)&&0!==ih(i.prev,i,i.next))i=i.next;else{if(hh(i),i=t=i.prev,i===i.next)break;n=!0}}while(n||i!==t);return t}function Hu(e,t,n,i,r,s,a){if(!e)return;!a&&s&&function(e,t,n,i){let r=e;do{0===r.z&&(r.z=Qu(r.x,r.y,t,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){let t,n=1;do{let i,r=e;e=null;let s=null;for(t=0;r;){t++;let a=r,o=0;for(let e=0;e<n&&(o++,a=a.nextZ,a);e++);let l=n;for(;o>0||l>0&&a;)0!==o&&(0===l||!a||r.z<=a.z)?(i=r,r=r.nextZ,o--):(i=a,a=a.nextZ,l--),s?s.nextZ=i:e=i,i.prevZ=s,s=i;r=a}s.nextZ=null,n*=2}while(t>1)}(r)}(e,i,r,s);let o=e;for(;e.prev!==e.next;){const l=e.prev,c=e.next;if(s?Yu(e,i,r,s):Wu(e))t.push(l.i,e.i,c.i),hh(e),e=c.next,o=c.next;else if((e=c)===o){a?1===a?Hu(e=Xu(Vu(e),t),t,n,i,r,s,2):2===a&&qu(e,t,n,i,r,s):Hu(Vu(e),t,n,i,r,s,1);break}}}function Wu(e){const t=e.prev,n=e,i=e.next;if(ih(t,n,i)>=0)return!1;const r=t.x,s=n.x,a=i.x,o=t.y,l=n.y,c=i.y,u=Math.min(r,s,a),h=Math.min(o,l,c),d=Math.max(r,s,a),f=Math.max(o,l,c);let p=i.next;for(;p!==t;){if(p.x>=u&&p.x<=d&&p.y>=h&&p.y<=f&&th(r,o,s,l,a,c,p.x,p.y)&&ih(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function Yu(e,t,n,i){const r=e.prev,s=e,a=e.next;if(ih(r,s,a)>=0)return!1;const o=r.x,l=s.x,c=a.x,u=r.y,h=s.y,d=a.y,f=Math.min(o,l,c),p=Math.min(u,h,d),m=Math.max(o,l,c),g=Math.max(u,h,d),v=Qu(f,p,t,n,i),y=Qu(m,g,t,n,i);let b=e.prevZ,x=e.nextZ;for(;b&&b.z>=v&&x&&x.z<=y;){if(b.x>=f&&b.x<=m&&b.y>=p&&b.y<=g&&b!==r&&b!==a&&th(o,u,l,h,c,d,b.x,b.y)&&ih(b.prev,b,b.next)>=0)return!1;if(b=b.prevZ,x.x>=f&&x.x<=m&&x.y>=p&&x.y<=g&&x!==r&&x!==a&&th(o,u,l,h,c,d,x.x,x.y)&&ih(x.prev,x,x.next)>=0)return!1;x=x.nextZ}for(;b&&b.z>=v;){if(b.x>=f&&b.x<=m&&b.y>=p&&b.y<=g&&b!==r&&b!==a&&th(o,u,l,h,c,d,b.x,b.y)&&ih(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;x&&x.z<=y;){if(x.x>=f&&x.x<=m&&x.y>=p&&x.y<=g&&x!==r&&x!==a&&th(o,u,l,h,c,d,x.x,x.y)&&ih(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function Xu(e,t){let n=e;do{const i=n.prev,r=n.next.next;!rh(i,r)&&sh(i,n,n.next,r)&&lh(i,r)&&lh(r,i)&&(t.push(i.i,n.i,r.i),hh(n),hh(n.next),n=e=r),n=n.next}while(n!==e);return Vu(n)}function qu(e,t,n,i,r,s){let a=e;do{let e=a.next.next;for(;e!==a.prev;){if(a.i!==e.i&&nh(a,e)){let o=ch(a,e);return a=Vu(a,a.next),o=Vu(o,o.next),Hu(a,t,n,i,r,s,0),void Hu(o,t,n,i,r,s,0)}e=e.next}a=a.next}while(a!==e)}function Ku(e,t){let n=e.x-t.x;if(0===n&&(n=e.y-t.y,0===n)){n=(e.next.y-e.y)/(e.next.x-e.x)-(t.next.y-t.y)/(t.next.x-t.x)}return n}function Zu(e,t){const n=function(e,t){let n=t;const i=e.x,r=e.y;let s,a=-1/0;if(rh(e,n))return n;do{if(rh(e,n.next))return n.next;if(r<=n.y&&r>=n.next.y&&n.next.y!==n.y){const e=n.x+(r-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(e<=i&&e>a&&(a=e,s=n.x<n.next.x?n:n.next,e===i))return s}n=n.next}while(n!==t);if(!s)return null;const o=s,l=s.x,c=s.y;let u=1/0;n=s;do{if(i>=n.x&&n.x>=l&&i!==n.x&&eh(r<c?i:a,r,l,c,r<c?a:i,r,n.x,n.y)){const t=Math.abs(r-n.y)/(i-n.x);lh(n,e)&&(t<u||t===u&&(n.x>s.x||n.x===s.x&&Ju(s,n)))&&(s=n,u=t)}n=n.next}while(n!==o);return s}(e,t);if(!n)return t;const i=ch(n,e);return Vu(i,i.next),Vu(n,n.next)}function Ju(e,t){return ih(e.prev,e,t.prev)<0&&ih(t.next,e,e.next)<0}function Qu(e,t,n,i,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function $u(e){let t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function eh(e,t,n,i,r,s,a,o){return(r-a)*(t-o)>=(e-a)*(s-o)&&(e-a)*(i-o)>=(n-a)*(t-o)&&(n-a)*(s-o)>=(r-a)*(i-o)}function th(e,t,n,i,r,s,a,o){return!(e===a&&t===o)&&eh(e,t,n,i,r,s,a,o)}function nh(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&sh(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(lh(e,t)&&lh(t,e)&&function(e,t){let n=e,i=!1;const r=(e.x+t.x)/2,s=(e.y+t.y)/2;do{n.y>s!==n.next.y>s&&n.next.y!==n.y&&r<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==e);return i}(e,t)&&(ih(e.prev,e,t.prev)||ih(e,t.prev,t))||rh(e,t)&&ih(e.prev,e,e.next)>0&&ih(t.prev,t,t.next)>0)}function ih(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function rh(e,t){return e.x===t.x&&e.y===t.y}function sh(e,t,n,i){const r=oh(ih(e,t,n)),s=oh(ih(e,t,i)),a=oh(ih(n,i,e)),o=oh(ih(n,i,t));return r!==s&&a!==o||(!(0!==r||!ah(e,n,t))||(!(0!==s||!ah(e,i,t))||(!(0!==a||!ah(n,e,i))||!(0!==o||!ah(n,t,i)))))}function ah(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function oh(e){return e>0?1:e<0?-1:0}function lh(e,t){return ih(e.prev,e,e.next)<0?ih(e,t,e.next)>=0&&ih(e,e.prev,t)>=0:ih(e,t,e.prev)<0||ih(e,e.next,t)<0}function ch(e,t){const n=dh(e.i,e.x,e.y),i=dh(t.i,t.x,t.y),r=e.next,s=t.prev;return e.next=t,t.prev=e,n.next=r,r.prev=n,i.next=n,n.prev=i,s.next=i,i.prev=s,i}function uh(e,t,n,i){const r=dh(e,t,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function hh(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function dh(e,t,n){return{i:e,x:t,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class fh{static triangulate(e,t){return ju(e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:2)}}class ph{static area(e){const t=e.length;let n=0;for(let i=t-1,r=0;r<t;i=r++)n+=e[i].x*e[r].y-e[r].x*e[i].y;return.5*n}static isClockWise(e){return ph.area(e)<0}static triangulateShape(e,t){const n=[],i=[],r=[];mh(e),gh(n,e);let s=e.length;t.forEach(mh);for(let o=0;o<t.length;o++)i.push(s),s+=t[o].length,gh(n,t[o]);const a=fh.triangulate(n,i);for(let o=0;o<a.length;o+=3)r.push(a.slice(o,o+3));return r}}function mh(e){const t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function gh(e,t){for(let n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}class vh extends Mo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new zu([new is(.5,.5),new is(-.5,.5),new is(-.5,-.5),new is(.5,-.5)]),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,i=[],r=[];for(let a=0,o=e.length;a<o;a++){s(e[a])}function s(e){const s=[],a=void 0!==t.curveSegments?t.curveSegments:12,o=void 0!==t.steps?t.steps:1,l=void 0!==t.depth?t.depth:1;let c=void 0===t.bevelEnabled||t.bevelEnabled,u=void 0!==t.bevelThickness?t.bevelThickness:.2,h=void 0!==t.bevelSize?t.bevelSize:u-.1,d=void 0!==t.bevelOffset?t.bevelOffset:0,f=void 0!==t.bevelSegments?t.bevelSegments:3;const p=t.extrudePath,m=void 0!==t.UVGenerator?t.UVGenerator:yh;let g,v,y,b,x,_=!1;if(p){g=p.getSpacedPoints(o),_=!0,c=!1;const e=!!p.isCatmullRomCurve3&&p.closed;v=p.computeFrenetFrames(o,e),y=new ss,b=new ss,x=new ss}c||(f=0,u=0,h=0,d=0);const S=e.extractPoints(a);let E=S.shape;const T=S.holes;if(!ph.isClockWise(E)){E=E.reverse();for(let e=0,t=T.length;e<t;e++){const t=T[e];ph.isClockWise(t)&&(T[e]=t.reverse())}}function w(e){const t=1e-10*1e-10;let n=e[0];for(let i=1;i<=e.length;i++){const r=i%e.length,s=e[r],a=s.x-n.x,o=s.y-n.y,l=a*a+o*o,c=Math.max(Math.abs(s.x),Math.abs(s.y),Math.abs(n.x),Math.abs(n.y));l<=t*c*c?(e.splice(r,1),i--):n=s}}w(E),T.forEach(w);const A=T.length,M=E;for(let t=0;t<A;t++){const e=T[t];E=E.concat(e)}function R(e,t,n){return t||Vr("ExtrudeGeometry: vec does not exist"),e.clone().addScaledVector(t,n)}const C=E.length;function L(e,t,n){let i,r,s;const a=e.x-t.x,o=e.y-t.y,l=n.x-e.x,c=n.y-e.y,u=a*a+o*o,h=a*c-o*l;if(Math.abs(h)>Number.EPSILON){const h=Math.sqrt(u),d=Math.sqrt(l*l+c*c),f=t.x-o/h,p=t.y+a/h,m=((n.x-c/d-f)*c-(n.y+l/d-p)*l)/(a*c-o*l);i=f+a*m-e.x,r=p+o*m-e.y;const g=i*i+r*r;if(g<=2)return new is(i,r);s=Math.sqrt(g/2)}else{let e=!1;a>Number.EPSILON?l>Number.EPSILON&&(e=!0):a<-Number.EPSILON?l<-Number.EPSILON&&(e=!0):Math.sign(o)===Math.sign(c)&&(e=!0),e?(i=-o,r=a,s=Math.sqrt(u)):(i=a,r=o,s=Math.sqrt(u/2))}return new is(i/s,r/s)}const I=[];for(let t=0,n=M.length,i=n-1,r=t+1;t<n;t++,i++,r++)i===n&&(i=0),r===n&&(r=0),I[t]=L(M[t],M[i],M[r]);const P=[];let k,D,N=I.concat();for(let t=0,n=A;t<n;t++){const e=T[t];k=[];for(let t=0,n=e.length,i=n-1,r=t+1;t<n;t++,i++,r++)i===n&&(i=0),r===n&&(r=0),k[t]=L(e[t],e[i],e[r]);P.push(k),N=N.concat(k)}if(0===f)D=ph.triangulateShape(M,T);else{const e=[],t=[];for(let n=0;n<f;n++){const i=n/f,r=u*Math.cos(i*Math.PI/2),s=h*Math.sin(i*Math.PI/2)+d;for(let t=0,n=M.length;t<n;t++){const n=R(M[t],I[t],s);B(n.x,n.y,-r),0===i&&e.push(n)}for(let e=0,n=A;e<n;e++){const n=T[e];k=P[e];const a=[];for(let e=0,t=n.length;e<t;e++){const t=R(n[e],k[e],s);B(t.x,t.y,-r),0===i&&a.push(t)}0===i&&t.push(a)}}D=ph.triangulateShape(e,t)}const O=D.length,F=h+d;for(let t=0;t<C;t++){const e=c?R(E[t],N[t],F):E[t];_?(b.copy(v.normals[0]).multiplyScalar(e.x),y.copy(v.binormals[0]).multiplyScalar(e.y),x.copy(g[0]).add(b).add(y),B(x.x,x.y,x.z)):B(e.x,e.y,0)}for(let t=1;t<=o;t++)for(let e=0;e<C;e++){const n=c?R(E[e],N[e],F):E[e];_?(b.copy(v.normals[t]).multiplyScalar(n.x),y.copy(v.binormals[t]).multiplyScalar(n.y),x.copy(g[t]).add(b).add(y),B(x.x,x.y,x.z)):B(n.x,n.y,l/o*t)}for(let t=f-1;t>=0;t--){const e=t/f,n=u*Math.cos(e*Math.PI/2),i=h*Math.sin(e*Math.PI/2)+d;for(let t=0,r=M.length;t<r;t++){const e=R(M[t],I[t],i);B(e.x,e.y,l+n)}for(let t=0,r=T.length;t<r;t++){const e=T[t];k=P[t];for(let t=0,r=e.length;t<r;t++){const r=R(e[t],k[t],i);_?B(r.x,r.y+g[o-1].y,g[o-1].x+n):B(r.x,r.y,l+n)}}}function U(e,t){let n=e.length;for(;--n>=0;){const i=n;let r=n-1;r<0&&(r=e.length-1);for(let e=0,n=o+2*f;e<n;e++){const n=C*e,s=C*(e+1);j(t+i+n,t+r+n,t+r+s,t+i+s)}}}function B(e,t,n){s.push(e),s.push(t),s.push(n)}function z(e,t,r){G(e),G(t),G(r);const s=i.length/3,a=m.generateTopUV(n,i,s-3,s-2,s-1);V(a[0]),V(a[1]),V(a[2])}function j(e,t,r,s){G(e),G(t),G(s),G(t),G(r),G(s);const a=i.length/3,o=m.generateSideWallUV(n,i,a-6,a-3,a-2,a-1);V(o[0]),V(o[1]),V(o[3]),V(o[1]),V(o[2]),V(o[3])}function G(e){i.push(s[3*e+0]),i.push(s[3*e+1]),i.push(s[3*e+2])}function V(e){r.push(e.x),r.push(e.y)}!function(){const e=i.length/3;if(c){let e=0,t=C*e;for(let n=0;n<O;n++){const e=D[n];z(e[2]+t,e[1]+t,e[0]+t)}e=o+2*f,t=C*e;for(let n=0;n<O;n++){const e=D[n];z(e[0]+t,e[1]+t,e[2]+t)}}else{for(let e=0;e<O;e++){const t=D[e];z(t[2],t[1],t[0])}for(let e=0;e<O;e++){const t=D[e];z(t[0]+C*o,t[1]+C*o,t[2]+C*o)}}n.addGroup(e,i.length/3-e,0)}(),function(){const e=i.length/3;let t=0;U(M,t),t+=M.length;for(let n=0,i=T.length;n<i;n++){const e=T[n];U(e,t),t+=e.length}n.addGroup(e,i.length/3-e,1)}()}this.setAttribute("position",new bo(i,3)),this.setAttribute("uv",new bo(r,2)),this.computeVertexNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return function(e,t,n){if(n.shapes=[],Array.isArray(e))for(let i=0,r=e.length;i<r;i++){const t=e[i];n.shapes.push(t.uuid)}else n.shapes.push(e.uuid);n.options=Object.assign({},t),void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON());return n}(this.parameters.shapes,this.parameters.options,e)}static fromJSON(e,t){const n=[];for(let r=0,s=e.shapes.length;r<s;r++){const i=t[e.shapes[r]];n.push(i)}const i=e.options.extrudePath;return void 0!==i&&(e.options.extrudePath=(new Fu[i.type]).fromJSON(i)),new vh(n,e.options)}}const yh={generateTopUV:function(e,t,n,i,r){const s=t[3*n],a=t[3*n+1],o=t[3*i],l=t[3*i+1],c=t[3*r],u=t[3*r+1];return[new is(s,a),new is(o,l),new is(c,u)]},generateSideWallUV:function(e,t,n,i,r,s){const a=t[3*n],o=t[3*n+1],l=t[3*n+2],c=t[3*i],u=t[3*i+1],h=t[3*i+2],d=t[3*r],f=t[3*r+1],p=t[3*r+2],m=t[3*s],g=t[3*s+1],v=t[3*s+2];return Math.abs(o-u)<Math.abs(a-c)?[new is(a,1-l),new is(c,1-h),new is(d,1-p),new is(m,1-v)]:[new is(o,1-l),new is(u,1-h),new is(f,1-p),new is(g,1-v)]}};class bh extends hu{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=(1+Math.sqrt(5))/2;super([-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new bh(e.radius,e.detail)}}class xh extends Mo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[new is(0,-.5),new is(.5,0),new is(0,.5)],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2*Math.PI;super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:i},t=Math.floor(t),i=Jr(i,0,2*Math.PI);const r=[],s=[],a=[],o=[],l=[],c=1/t,u=new ss,h=new is,d=new ss,f=new ss,p=new ss;let m=0,g=0;for(let v=0;v<=e.length-1;v++)switch(v){case 0:m=e[v+1].x-e[v].x,g=e[v+1].y-e[v].y,d.x=1*g,d.y=-m,d.z=0*g,p.copy(d),d.normalize(),o.push(d.x,d.y,d.z);break;case e.length-1:o.push(p.x,p.y,p.z);break;default:m=e[v+1].x-e[v].x,g=e[v+1].y-e[v].y,d.x=1*g,d.y=-m,d.z=0*g,f.copy(d),d.x+=p.x,d.y+=p.y,d.z+=p.z,d.normalize(),o.push(d.x,d.y,d.z),p.copy(f)}for(let v=0;v<=t;v++){const r=n+v*c*i,d=Math.sin(r),f=Math.cos(r);for(let n=0;n<=e.length-1;n++){u.x=e[n].x*d,u.y=e[n].y,u.z=e[n].x*f,s.push(u.x,u.y,u.z),h.x=v/t,h.y=n/(e.length-1),a.push(h.x,h.y);const i=o[3*n+0]*d,r=o[3*n+1],c=o[3*n+0]*f;l.push(i,r,c)}}for(let v=0;v<t;v++)for(let t=0;t<e.length-1;t++){const n=t+v*e.length,i=n,s=n+e.length,a=n+e.length+1,o=n+1;r.push(i,s,o),r.push(a,o,s)}this.setIndex(r),this.setAttribute("position",new bo(s,3)),this.setAttribute("uv",new bo(a,2)),this.setAttribute("normal",new bo(l,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new xh(e.points,e.segments,e.phiStart,e.phiLength)}}class _h extends hu{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new _h(e.radius,e.detail)}}class Sh extends Mo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i};const r=e/2,s=t/2,a=Math.floor(n),o=Math.floor(i),l=a+1,c=o+1,u=e/a,h=t/o,d=[],f=[],p=[],m=[];for(let g=0;g<c;g++){const e=g*h-s;for(let t=0;t<l;t++){const n=t*u-r;f.push(n,-e,0),p.push(0,0,1),m.push(t/a),m.push(1-g/o)}}for(let g=0;g<o;g++)for(let e=0;e<a;e++){const t=e+l*g,n=e+l*(g+1),i=e+1+l*(g+1),r=e+1+l*g;d.push(t,n,r),d.push(n,i,r)}this.setIndex(d),this.setAttribute("position",new bo(f,3)),this.setAttribute("normal",new bo(p,3)),this.setAttribute("uv",new bo(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Sh(e.width,e.height,e.widthSegments,e.heightSegments)}}class Eh extends Mo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:32,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2*Math.PI;super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:i,thetaStart:r,thetaLength:s},n=Math.max(3,n),i=Math.max(1,i);const a=[],o=[],l=[],c=[];let u=e;const h=(t-e)/i,d=new ss,f=new is;for(let p=0;p<=i;p++){for(let e=0;e<=n;e++){const i=r+e/n*s;d.x=u*Math.cos(i),d.y=u*Math.sin(i),o.push(d.x,d.y,d.z),l.push(0,0,1),f.x=(d.x/t+1)/2,f.y=(d.y/t+1)/2,c.push(f.x,f.y)}u+=h}for(let p=0;p<i;p++){const e=p*(n+1);for(let t=0;t<n;t++){const i=t+e,r=i,s=i+n+1,o=i+n+2,l=i+1;a.push(r,s,l),a.push(s,o,l)}}this.setIndex(a),this.setAttribute("position",new bo(o,3)),this.setAttribute("normal",new bo(l,3)),this.setAttribute("uv",new bo(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Eh(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class Th extends Mo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new zu([new is(0,.5),new is(-.5,-.5),new is(.5,-.5)]),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12;super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const n=[],i=[],r=[],s=[];let a=0,o=0;if(!1===Array.isArray(e))l(e);else for(let c=0;c<e.length;c++)l(e[c]),this.addGroup(a,o,c),a+=o,o=0;function l(e){const a=i.length/3,l=e.extractPoints(t);let c=l.shape;const u=l.holes;!1===ph.isClockWise(c)&&(c=c.reverse());for(let t=0,n=u.length;t<n;t++){const e=u[t];!0===ph.isClockWise(e)&&(u[t]=e.reverse())}const h=ph.triangulateShape(c,u);for(let t=0,n=u.length;t<n;t++){const e=u[t];c=c.concat(e)}for(let t=0,n=c.length;t<n;t++){const e=c[t];i.push(e.x,e.y,0),r.push(0,0,1),s.push(e.x,e.y)}for(let t=0,i=h.length;t<i;t++){const e=h[t],i=e[0]+a,r=e[1]+a,s=e[2]+a;n.push(i,r,s),o+=3}}this.setIndex(n),this.setAttribute("position",new bo(i,3)),this.setAttribute("normal",new bo(r,3)),this.setAttribute("uv",new bo(s,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return function(e,t){if(t.shapes=[],Array.isArray(e))for(let n=0,i=e.length;n<i;n++){const i=e[n];t.shapes.push(i.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}static fromJSON(e,t){const n=[];for(let i=0,r=e.shapes.length;i<r;i++){const r=t[e.shapes[i]];n.push(r)}return new Th(n,e.curveSegments)}}class wh extends Mo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*Math.PI,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Math.PI;super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:i,phiLength:r,thetaStart:s,thetaLength:a},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const o=Math.min(s+a,Math.PI);let l=0;const c=[],u=new ss,h=new ss,d=[],f=[],p=[],m=[];for(let g=0;g<=n;g++){const d=[],v=g/n;let y=0;0===g&&0===s?y=.5/t:g===n&&o===Math.PI&&(y=-.5/t);for(let n=0;n<=t;n++){const o=n/t;u.x=-e*Math.cos(i+o*r)*Math.sin(s+v*a),u.y=e*Math.cos(s+v*a),u.z=e*Math.sin(i+o*r)*Math.sin(s+v*a),f.push(u.x,u.y,u.z),h.copy(u).normalize(),p.push(h.x,h.y,h.z),m.push(o+y,1-v),d.push(l++)}c.push(d)}for(let g=0;g<n;g++)for(let e=0;e<t;e++){const t=c[g][e+1],i=c[g][e],r=c[g+1][e],a=c[g+1][e+1];(0!==g||s>0)&&d.push(t,i,a),(g!==n-1||o<Math.PI)&&d.push(i,r,a)}this.setIndex(d),this.setAttribute("position",new bo(f,3)),this.setAttribute("normal",new bo(p,3)),this.setAttribute("uv",new bo(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new wh(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class Ah extends hu{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Ah(e.radius,e.detail)}}class Mh extends Mo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.4,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:12,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:48,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*Math.PI;super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:i,arc:r},n=Math.floor(n),i=Math.floor(i);const s=[],a=[],o=[],l=[],c=new ss,u=new ss,h=new ss;for(let d=0;d<=n;d++)for(let s=0;s<=i;s++){const f=s/i*r,p=d/n*Math.PI*2;u.x=(e+t*Math.cos(p))*Math.cos(f),u.y=(e+t*Math.cos(p))*Math.sin(f),u.z=t*Math.sin(p),a.push(u.x,u.y,u.z),c.x=e*Math.cos(f),c.y=e*Math.sin(f),h.subVectors(u,c).normalize(),o.push(h.x,h.y,h.z),l.push(s/i),l.push(d/n)}for(let d=1;d<=n;d++)for(let e=1;e<=i;e++){const t=(i+1)*d+e-1,n=(i+1)*(d-1)+e-1,r=(i+1)*(d-1)+e,a=(i+1)*d+e;s.push(t,n,a),s.push(n,r,a)}this.setIndex(s),this.setAttribute("position",new bo(a,3)),this.setAttribute("normal",new bo(o,3)),this.setAttribute("uv",new bo(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Mh(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class Rh extends Mo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.4,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:64,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:3;super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:i,p:r,q:s},n=Math.floor(n),i=Math.floor(i);const a=[],o=[],l=[],c=[],u=new ss,h=new ss,d=new ss,f=new ss,p=new ss,m=new ss,g=new ss;for(let y=0;y<=n;++y){const a=y/n*r*Math.PI*2;v(a,r,s,e,d),v(a+.01,r,s,e,f),m.subVectors(f,d),g.addVectors(f,d),p.crossVectors(m,g),g.crossVectors(p,m),p.normalize(),g.normalize();for(let e=0;e<=i;++e){const r=e/i*Math.PI*2,s=-t*Math.cos(r),a=t*Math.sin(r);u.x=d.x+(s*g.x+a*p.x),u.y=d.y+(s*g.y+a*p.y),u.z=d.z+(s*g.z+a*p.z),o.push(u.x,u.y,u.z),h.subVectors(u,d).normalize(),l.push(h.x,h.y,h.z),c.push(y/n),c.push(e/i)}}for(let y=1;y<=n;y++)for(let e=1;e<=i;e++){const t=(i+1)*(y-1)+(e-1),n=(i+1)*y+(e-1),r=(i+1)*y+e,s=(i+1)*(y-1)+e;a.push(t,n,s),a.push(n,r,s)}function v(e,t,n,i,r){const s=Math.cos(e),a=Math.sin(e),o=n/t*e,l=Math.cos(o);r.x=i*(2+l)*.5*s,r.y=i*(2+l)*a*.5,r.z=i*Math.sin(o)*.5}this.setIndex(a),this.setAttribute("position",new bo(o,3)),this.setAttribute("normal",new bo(l,3)),this.setAttribute("uv",new bo(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Rh(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class Ch extends Mo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Nu(new ss(-1,-1,0),new ss(-1,1,0),new ss(1,1,0)),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:64,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:i,closed:r};const s=e.computeFrenetFrames(t,r);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals;const a=new ss,o=new ss,l=new is;let c=new ss;const u=[],h=[],d=[],f=[];function p(r){c=e.getPointAt(r/t,c);const l=s.normals[r],d=s.binormals[r];for(let e=0;e<=i;e++){const t=e/i*Math.PI*2,r=Math.sin(t),s=-Math.cos(t);o.x=s*l.x+r*d.x,o.y=s*l.y+r*d.y,o.z=s*l.z+r*d.z,o.normalize(),h.push(o.x,o.y,o.z),a.x=c.x+n*o.x,a.y=c.y+n*o.y,a.z=c.z+n*o.z,u.push(a.x,a.y,a.z)}}!function(){for(let e=0;e<t;e++)p(e);p(!1===r?t:0),function(){for(let e=0;e<=t;e++)for(let n=0;n<=i;n++)l.x=e/t,l.y=n/i,d.push(l.x,l.y)}(),function(){for(let e=1;e<=t;e++)for(let t=1;t<=i;t++){const n=(i+1)*(e-1)+(t-1),r=(i+1)*e+(t-1),s=(i+1)*e+t,a=(i+1)*(e-1)+t;f.push(n,r,a),f.push(r,s,a)}}()}(),this.setIndex(f),this.setAttribute("position",new bo(u,3)),this.setAttribute("normal",new bo(h,3)),this.setAttribute("uv",new bo(d,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new Ch((new Fu[e.path.type]).fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class Lh extends Mo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},null!==e){const t=[],n=new Set,i=new ss,r=new ss;if(null!==e.index){const s=e.attributes.position,a=e.index;let o=e.groups;0===o.length&&(o=[{start:0,count:a.count,materialIndex:0}]);for(let e=0,l=o.length;e<l;++e){const l=o[e],c=l.start;for(let e=c,o=c+l.count;e<o;e+=3)for(let l=0;l<3;l++){const o=a.getX(e+l),c=a.getX(e+(l+1)%3);i.fromBufferAttribute(s,o),r.fromBufferAttribute(s,c),!0===Ih(i,r,n)&&(t.push(i.x,i.y,i.z),t.push(r.x,r.y,r.z))}}}else{const s=e.attributes.position;for(let e=0,a=s.count/3;e<a;e++)for(let o=0;o<3;o++){const a=3*e+o,l=3*e+(o+1)%3;i.fromBufferAttribute(s,a),r.fromBufferAttribute(s,l),!0===Ih(i,r,n)&&(t.push(i.x,i.y,i.z),t.push(r.x,r.y,r.z))}}this.setAttribute("position",new bo(t,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function Ih(e,t,n){const i="".concat(e.x,",").concat(e.y,",").concat(e.z,"-").concat(t.x,",").concat(t.y,",").concat(t.z),r="".concat(t.x,",").concat(t.y,",").concat(t.z,"-").concat(e.x,",").concat(e.y,",").concat(e.z);return!0!==n.has(i)&&!0!==n.has(r)&&(n.add(i),n.add(r),!0)}var Ph=Object.freeze({__proto__:null,BoxGeometry:jo,CapsuleGeometry:ou,CircleGeometry:lu,ConeGeometry:uu,CylinderGeometry:cu,DodecahedronGeometry:du,EdgesGeometry:vu,ExtrudeGeometry:vh,IcosahedronGeometry:bh,LatheGeometry:xh,OctahedronGeometry:_h,PlaneGeometry:Sh,PolyhedronGeometry:hu,RingGeometry:Eh,ShapeGeometry:Th,SphereGeometry:wh,TetrahedronGeometry:Ah,TorusGeometry:Mh,TorusKnotGeometry:Rh,TubeGeometry:Ch,WireframeGeometry:Lh});class kh extends $a{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Za(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class Dh extends Yo{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class Nh extends $a{constructor(e){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new Za(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Za(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ni,this.normalScale=new is(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new pa,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Oh extends Nh{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new is(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Jr(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Za(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Za(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Za(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!==e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!==e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!==e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!==e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!==e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!==e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class Fh extends $a{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Za(16777215),this.specular=new Za(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Za(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ni,this.normalScale=new is(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new pa,this.combine=Pt,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Uh extends $a{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Za(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Za(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ni,this.normalScale=new is(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class Bh extends $a{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ni,this.normalScale=new is(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class zh extends $a{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Za(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Za(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ni,this.normalScale=new is(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new pa,this.combine=Pt,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class jh extends $a{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=Ii,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class Gh extends $a{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}class Vh extends $a{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Za(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ni,this.normalScale=new is(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Hh extends Lc{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function Wh(e,t){return e&&e.constructor!==t?"number"===typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e):e}function Yh(e){const t=e.length,n=new Array(t);for(let i=0;i!==t;++i)n[i]=i;return n.sort(function(t,n){return e[t]-e[n]}),n}function Xh(e,t,n){const i=e.length,r=new e.constructor(i);for(let s=0,a=0;a!==i;++s){const i=n[s]*t;for(let n=0;n!==t;++n)r[a++]=e[i+n]}return r}function qh(e,t,n,i){let r=1,s=e[0];for(;void 0!==s&&void 0===s[i];)s=e[r++];if(void 0===s)return;let a=s[i];if(void 0!==a)if(Array.isArray(a))do{a=s[i],void 0!==a&&(t.push(s.time),n.push(...a)),s=e[r++]}while(void 0!==s);else if(void 0!==a.toArray)do{a=s[i],void 0!==a&&(t.push(s.time),a.toArray(n,n.length)),s=e[r++]}while(void 0!==s);else do{a=s[i],void 0!==a&&(t.push(s.time),n.push(a)),s=e[r++]}while(void 0!==s)}class Kh{static convertArray(e,t){return Wh(e,t)}static isTypedArray(e){return Dr(e)}static getKeyframeOrder(e){return Yh(e)}static sortedArray(e,t,n){return Xh(e,t,n)}static flattenJSON(e,t,n,i){qh(e,t,n,i)}static subclip(e,t,n,i){return function(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:30;const s=e.clone();s.name=t;const a=[];for(let l=0;l<s.tracks.length;++l){const e=s.tracks[l],t=e.getValueSize(),o=[],c=[];for(let s=0;s<e.times.length;++s){const a=e.times[s]*r;if(!(a<n||a>=i)){o.push(e.times[s]);for(let n=0;n<t;++n)c.push(e.values[s*t+n])}}0!==o.length&&(e.times=Wh(o,e.times.constructor),e.values=Wh(c,e.values.constructor),a.push(e))}s.tracks=a;let o=1/0;for(let l=0;l<s.tracks.length;++l)o>s.tracks[l].times[0]&&(o=s.tracks[l].times[0]);for(let l=0;l<s.tracks.length;++l)s.tracks[l].shift(-1*o);return s.resetDuration(),s}(e,t,n,i,arguments.length>4&&void 0!==arguments[4]?arguments[4]:30)}static makeClipAdditive(e){return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:30;i<=0&&(i=30);const r=n.tracks.length,s=t/i;for(let a=0;a<r;++a){const t=n.tracks[a],i=t.ValueTypeName;if("bool"===i||"string"===i)continue;const r=e.tracks.find(function(e){return e.name===t.name&&e.ValueTypeName===i});if(void 0===r)continue;let o=0;const l=t.getValueSize();t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(o=l/3);let c=0;const u=r.getValueSize();r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=u/3);const h=t.times.length-1;let d;if(s<=t.times[0]){const e=o,n=l-o;d=t.values.slice(e,n)}else if(s>=t.times[h]){const e=h*l+o,n=e+l-o;d=t.values.slice(e,n)}else{const e=t.createInterpolant(),n=o,i=l-o;e.evaluate(s),d=e.resultBuffer.slice(n,i)}"quaternion"===i&&(new rs).fromArray(d).normalize().conjugate().toArray(d);const f=r.times.length;for(let e=0;e<f;++e){const t=e*u+c;if("quaternion"===i)rs.multiplyQuaternionsFlat(r.values,t,d,0,r.values,t);else{const e=u-2*c;for(let n=0;n<e;++n)r.values[t+n]-=d[n]}}}return e.blendMode=Mi,e}(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:e,arguments.length>3&&void 0!==arguments[3]?arguments[3]:30)}}class Zh{constructor(e,t,n,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,i=t[n],r=t[n-1];e:{t:{let s;n:{i:if(!(e<i)){for(let s=n+2;;){if(void 0===i){if(e<r)break i;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===s)break;if(r=i,i=t[++n],e<i)break t}s=t.length;break n}if(!(e>=r)){const a=t[1];e<a&&(n=2,r=a);for(let s=n-2;;){if(void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(n===s)break;if(i=r,r=t[--n-1],e>=r)break t}s=n,n=0;break n}break e}for(;n<s;){const i=n+s>>>1;e<t[i]?s=i:n=i+1}if(i=t[n],r=t[n-1],void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===i)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,r,i)}return this.interpolate_(n,r,e,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i;for(let s=0;s!==i;++s)t[s]=n[r+s];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class Jh extends Zh{constructor(e,t,n,i){super(e,t,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Ei,endingEnd:Ei}}intervalChanged_(e,t,n){const i=this.parameterPositions;let r=e-2,s=e+1,a=i[r],o=i[s];if(void 0===a)switch(this.getSettings_().endingStart){case Ti:r=e,a=2*t-n;break;case wi:r=i.length-2,a=t+i[r]-i[r+1];break;default:r=e,a=n}if(void 0===o)switch(this.getSettings_().endingEnd){case Ti:s=e,o=2*n-t;break;case wi:s=1,o=n+i[1]-i[0];break;default:s=e-1,o=t}const l=.5*(n-t),c=this.valueSize;this._weightPrev=l/(t-a),this._weightNext=l/(o-n),this._offsetPrev=r*c,this._offsetNext=s*c}interpolate_(e,t,n,i){const r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=e*a,l=o-a,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,d=this._weightNext,f=(n-t)/(i-t),p=f*f,m=p*f,g=-h*m+2*h*p-h*f,v=(1+h)*m+(-1.5-2*h)*p+(-.5+h)*f+1,y=(-1-d)*m+(1.5+d)*p+.5*f,b=d*m-d*p;for(let x=0;x!==a;++x)r[x]=g*s[c+x]+v*s[l+x]+y*s[o+x]+b*s[u+x];return r}}class Qh extends Zh{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=e*a,l=o-a,c=(n-t)/(i-t),u=1-c;for(let h=0;h!==a;++h)r[h]=s[l+h]*u+s[o+h]*c;return r}}class $h extends Zh{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e){return this.copySampleValue_(e-1)}}class ed{constructor(e,t,n,i){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Wh(t,this.TimeBufferType),this.values=Wh(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:Wh(e.times,Array),values:Wh(e.values,Array)};const t=e.getInterpolation();t!==e.DefaultInterpolation&&(n.interpolation=t)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new $h(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new Qh(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new Jh(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case xi:t=this.InterpolantFactoryMethodDiscrete;break;case _i:t=this.InterpolantFactoryMethodLinear;break;case Si:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return Gr("KeyframeTrack:",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return xi;case this.InterpolantFactoryMethodLinear:return _i;case this.InterpolantFactoryMethodSmooth:return Si}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]*=e}return this}trim(e,t){const n=this.times,i=n.length;let r=0,s=i-1;for(;r!==i&&n[r]<e;)++r;for(;-1!==s&&n[s]>t;)--s;if(++s,0!==r||s!==i){r>=s&&(s=Math.max(s,1),r=s-1);const e=this.getValueSize();this.times=n.slice(r,s),this.values=this.values.slice(r*e,s*e)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(Vr("KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,i=this.values,r=n.length;0===r&&(Vr("KeyframeTrack: Track is empty.",this),e=!1);let s=null;for(let a=0;a!==r;a++){const t=n[a];if("number"===typeof t&&isNaN(t)){Vr("KeyframeTrack: Time is not a valid number.",this,a,t),e=!1;break}if(null!==s&&s>t){Vr("KeyframeTrack: Out of order keys.",this,a,t,s),e=!1;break}s=t}if(void 0!==i&&Dr(i))for(let a=0,o=i.length;a!==o;++a){const t=i[a];if(isNaN(t)){Vr("KeyframeTrack: Value is not a valid number.",this,a,t),e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),n=this.getValueSize(),i=this.getInterpolation()===Si,r=e.length-1;let s=1;for(let a=1;a<r;++a){let r=!1;const o=e[a];if(o!==e[a+1]&&(1!==a||o!==e[0]))if(i)r=!0;else{const e=a*n,i=e-n,s=e+n;for(let a=0;a!==n;++a){const n=t[e+a];if(n!==t[i+a]||n!==t[s+a]){r=!0;break}}}if(r){if(a!==s){e[s]=e[a];const i=a*n,r=s*n;for(let e=0;e!==n;++e)t[r+e]=t[i+e]}++s}}if(r>0){e[s]=e[r];for(let e=r*n,i=s*n,a=0;a!==n;++a)t[i+a]=t[e+a];++s}return s!==e.length?(this.times=e.slice(0,s),this.values=t.slice(0,s*n)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}ed.prototype.ValueTypeName="",ed.prototype.TimeBufferType=Float32Array,ed.prototype.ValueBufferType=Float32Array,ed.prototype.DefaultInterpolation=_i;class td extends ed{constructor(e,t,n){super(e,t,n)}}td.prototype.ValueTypeName="bool",td.prototype.ValueBufferType=Array,td.prototype.DefaultInterpolation=xi,td.prototype.InterpolantFactoryMethodLinear=void 0,td.prototype.InterpolantFactoryMethodSmooth=void 0;class nd extends ed{constructor(e,t,n,i){super(e,t,n,i)}}nd.prototype.ValueTypeName="color";class id extends ed{constructor(e,t,n,i){super(e,t,n,i)}}id.prototype.ValueTypeName="number";class rd extends Zh{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=(n-t)/(i-t);let l=e*a;for(let c=l+a;l!==c;l+=4)rs.slerpFlat(r,0,s,l-a,s,l,o);return r}}class sd extends ed{constructor(e,t,n,i){super(e,t,n,i)}InterpolantFactoryMethodLinear(e){return new rd(this.times,this.values,this.getValueSize(),e)}}sd.prototype.ValueTypeName="quaternion",sd.prototype.InterpolantFactoryMethodSmooth=void 0;class ad extends ed{constructor(e,t,n){super(e,t,n)}}ad.prototype.ValueTypeName="string",ad.prototype.ValueBufferType=Array,ad.prototype.DefaultInterpolation=xi,ad.prototype.InterpolantFactoryMethodLinear=void 0,ad.prototype.InterpolantFactoryMethodSmooth=void 0;class od extends ed{constructor(e,t,n,i){super(e,t,n,i)}}od.prototype.ValueTypeName="vector";class ld{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Ai;this.name=e,this.tracks=n,this.duration=t,this.blendMode=i,this.uuid=Zr(),this.userData={},this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,i=1/(e.fps||1);for(let s=0,a=n.length;s!==a;++s)t.push(cd(n[s]).scale(i));const r=new this(e.name,e.duration,t,e.blendMode);return r.uuid=e.uuid,r.userData=JSON.parse(e.userData||"{}"),r}static toJSON(e){const t=[],n=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode,userData:JSON.stringify(e.userData)};for(let r=0,s=n.length;r!==s;++r)t.push(ed.toJSON(n[r]));return i}static CreateFromMorphTargetSequence(e,t,n,i){const r=t.length,s=[];for(let a=0;a<r;a++){let e=[],o=[];e.push((a+r-1)%r,a,(a+1)%r),o.push(0,1,0);const l=Yh(e);e=Xh(e,1,l),o=Xh(o,1,l),i||0!==e[0]||(e.push(r),o.push(o[0])),s.push(new id(".morphTargetInfluences["+t[a].name+"]",e,o).scale(1/n))}return new this(e,-1,s)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const t=e;n=t.geometry&&t.geometry.animations||t.animations}for(let i=0;i<n.length;i++)if(n[i].name===t)return n[i];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const i={},r=/^([\w-]*?)([\d]+)$/;for(let a=0,o=e.length;a<o;a++){const t=e[a],n=t.name.match(r);if(n&&n.length>1){const e=n[1];let r=i[e];r||(i[e]=r=[]),r.push(t)}}const s=[];for(const a in i)s.push(this.CreateFromMorphTargetSequence(a,i[a],t,n));return s}static parseAnimation(e,t){if(Gr("AnimationClip: parseAnimation() is deprecated and will be removed with r185"),!e)return Vr("AnimationClip: No animation in JSONLoader data."),null;const n=function(e,t,n,i,r){if(0!==n.length){const s=[],a=[];qh(n,s,a,i),0!==s.length&&r.push(new e(t,s,a))}},i=[],r=e.name||"default",s=e.fps||30,a=e.blendMode;let o=e.length||-1;const l=e.hierarchy||[];for(let c=0;c<l.length;c++){const e=l[c].keys;if(e&&0!==e.length)if(e[0].morphTargets){const t={};let n;for(n=0;n<e.length;n++)if(e[n].morphTargets)for(let i=0;i<e[n].morphTargets.length;i++)t[e[n].morphTargets[i]]=-1;for(const r in t){const t=[],s=[];for(let i=0;i!==e[n].morphTargets.length;++i){const i=e[n];t.push(i.time),s.push(i.morphTarget===r?1:0)}i.push(new id(".morphTargetInfluence["+r+"]",t,s))}o=t.length*s}else{const r=".bones["+t[c].name+"]";n(od,r+".position",e,"pos",i),n(sd,r+".quaternion",e,"rot",i),n(od,r+".scale",e,"scl",i)}}if(0===i.length)return null;return new this(r,o,i,a)}resetDuration(){let e=0;for(let t=0,n=this.tracks.length;t!==n;++t){const n=this.tracks[t];e=Math.max(e,n.times[n.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let n=0;n<this.tracks.length;n++)e.push(this.tracks[n].clone());const t=new this.constructor(this.name,this.duration,e,this.blendMode);return t.userData=JSON.parse(JSON.stringify(this.userData)),t}toJSON(){return this.constructor.toJSON(this)}}function cd(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return id;case"vector":case"vector2":case"vector3":case"vector4":return od;case"color":return nd;case"quaternion":return sd;case"bool":case"boolean":return td;case"string":return ad}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){const t=[],n=[];qh(e.keys,t,n,"value"),e.times=t,e.values=n}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}const ud={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class hd{constructor(e,t,n){const i=this;let r,s=!1,a=0,o=0;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this._abortController=null,this.itemStart=function(e){o++,!1===s&&void 0!==i.onStart&&i.onStart(e,a,o),s=!0},this.itemEnd=function(e){a++,void 0!==i.onProgress&&i.onProgress(e,a,o),a===o&&(s=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(e){void 0!==i.onError&&i.onError(e)},this.resolveURL=function(e){return r?r(e):e},this.setURLModifier=function(e){return r=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){const t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(let t=0,n=l.length;t<n;t+=2){const n=l[t],i=l[t+1];if(n.global&&(n.lastIndex=0),n.test(e))return i}return null},this.abort=function(){return this.abortController.abort(),this._abortController=null,this}}get abortController(){return this._abortController||(this._abortController=new AbortController),this._abortController}}const dd=new hd;class fd{constructor(e){this.manager=void 0!==e?e:dd,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise(function(i,r){n.load(e,i,t,r)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}abort(){return this}}fd.DEFAULT_MATERIAL_NAME="__DEFAULT";const pd={};class md extends Error{constructor(e,t){super(e),this.response=t}}class gd extends fd{constructor(e){super(e),this.mimeType="",this.responseType="",this._abortController=new AbortController}load(e,t,n,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=ud.get("file:".concat(e));if(void 0!==r)return this.manager.itemStart(e),setTimeout(()=>{t&&t(r),this.manager.itemEnd(e)},0),r;if(void 0!==pd[e])return void pd[e].push({onLoad:t,onProgress:n,onError:i});pd[e]=[],pd[e].push({onLoad:t,onProgress:n,onError:i});const s=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin",signal:"function"===typeof AbortSignal.any?AbortSignal.any([this._abortController.signal,this.manager.abortController.signal]):this._abortController.signal}),a=this.mimeType,o=this.responseType;fetch(s).then(t=>{if(200===t.status||0===t.status){if(0===t.status&&Gr("FileLoader: HTTP Status 0 received."),"undefined"===typeof ReadableStream||void 0===t.body||void 0===t.body.getReader)return t;const n=pd[e],i=t.body.getReader(),r=t.headers.get("X-File-Size")||t.headers.get("Content-Length"),s=r?parseInt(r):0,a=0!==s;let o=0;const l=new ReadableStream({start(e){!function t(){i.read().then(i=>{let{done:r,value:l}=i;if(r)e.close();else{o+=l.byteLength;const i=new ProgressEvent("progress",{lengthComputable:a,loaded:o,total:s});for(let e=0,t=n.length;e<t;e++){const t=n[e];t.onProgress&&t.onProgress(i)}e.enqueue(l),t()}},t=>{e.error(t)})}()}});return new Response(l)}throw new md('fetch for "'.concat(t.url,'" responded with ').concat(t.status,": ").concat(t.statusText),t)}).then(e=>{switch(o){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then(e=>(new DOMParser).parseFromString(e,a));case"json":return e.json();default:if(""===a)return e.text();{const t=/charset="?([^;"\s]*)"?/i.exec(a),n=t&&t[1]?t[1].toLowerCase():void 0,i=new TextDecoder(n);return e.arrayBuffer().then(e=>i.decode(e))}}}).then(t=>{ud.add("file:".concat(e),t);const n=pd[e];delete pd[e];for(let e=0,i=n.length;e<i;e++){const i=n[e];i.onLoad&&i.onLoad(t)}}).catch(t=>{const n=pd[e];if(void 0===n)throw this.manager.itemError(e),t;delete pd[e];for(let e=0,i=n.length;e<i;e++){const i=n[e];i.onError&&i.onError(t)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}abort(){return this._abortController.abort(),this._abortController=new AbortController,this}}class vd extends fd{constructor(e){super(e)}load(e,t,n,i){const r=this,s=new gd(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,function(n){try{t(r.parse(JSON.parse(n)))}catch(Px){i?i(Px):Vr(Px),r.manager.itemError(e)}},n,i)}parse(e){const t=[];for(let n=0;n<e.length;n++){const i=ld.parse(e[n]);t.push(i)}return t}}class yd extends fd{constructor(e){super(e)}load(e,t,n,i){const r=this,s=[],a=new eu,o=new gd(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(r.withCredentials);let l=0;function c(c){o.load(e[c],function(e){const n=r.parse(e,!0);s[c]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},l+=1,6===l&&(1===n.mipmapCount&&(a.minFilter=an),a.image=s,a.format=n.format,a.needsUpdate=!0,t&&t(a))},n,i)}if(Array.isArray(e))for(let u=0,h=e.length;u<h;++u)c(u);else o.load(e,function(e){const n=r.parse(e,!0);if(n.isCubemap){const e=n.mipmaps.length/n.mipmapCount;for(let t=0;t<e;t++){s[t]={mipmaps:[]};for(let e=0;e<n.mipmapCount;e++)s[t].mipmaps.push(n.mipmaps[t*n.mipmapCount+e]),s[t].format=n.format,s[t].width=n.width,s[t].height=n.height}a.image=s}else a.image.width=n.width,a.image.height=n.height,a.mipmaps=n.mipmaps;1===n.mipmapCount&&(a.minFilter=an),a.format=n.format,a.needsUpdate=!0,t&&t(a)},n,i);return a}}const bd=new WeakMap;class xd extends fd{constructor(e){super(e)}load(e,t,n,i){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,s=ud.get("image:".concat(e));if(void 0!==s){if(!0===s.complete)r.manager.itemStart(e),setTimeout(function(){t&&t(s),r.manager.itemEnd(e)},0);else{let e=bd.get(s);void 0===e&&(e=[],bd.set(s,e)),e.push({onLoad:t,onError:i})}return s}const a=Nr("img");function o(){c(),t&&t(this);const n=bd.get(this)||[];for(let e=0;e<n.length;e++){const t=n[e];t.onLoad&&t.onLoad(this)}bd.delete(this),r.manager.itemEnd(e)}function l(t){c(),i&&i(t),ud.remove("image:".concat(e));const n=bd.get(this)||[];for(let e=0;e<n.length;e++){const i=n[e];i.onError&&i.onError(t)}bd.delete(this),r.manager.itemError(e),r.manager.itemEnd(e)}function c(){a.removeEventListener("load",o,!1),a.removeEventListener("error",l,!1)}return a.addEventListener("load",o,!1),a.addEventListener("error",l,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),ud.add("image:".concat(e),a),r.manager.itemStart(e),a.src=e,a}}class _d extends fd{constructor(e){super(e)}load(e,t,n,i){const r=new el;r.colorSpace=Ui;const s=new xd(this.manager);s.setCrossOrigin(this.crossOrigin),s.setPath(this.path);let a=0;function o(n){s.load(e[n],function(e){r.images[n]=e,a++,6===a&&(r.needsUpdate=!0,t&&t(r))},void 0,i)}for(let l=0;l<e.length;++l)o(l);return r}}class Sd extends fd{constructor(e){super(e)}load(e,t,n,i){const r=this,s=new jl,a=new gd(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(r.withCredentials),a.load(e,function(e){let n;try{n=r.parse(e)}catch(Vr){if(void 0===i)return void Vr(Vr);i(Vr)}void 0!==n.image?s.image=n.image:void 0!==n.data&&(s.image.width=n.width,s.image.height=n.height,s.image.data=n.data),s.wrapS=void 0!==n.wrapS?n.wrapS:Qt,s.wrapT=void 0!==n.wrapT?n.wrapT:Qt,s.magFilter=void 0!==n.magFilter?n.magFilter:an,s.minFilter=void 0!==n.minFilter?n.minFilter:an,s.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.colorSpace&&(s.colorSpace=n.colorSpace),void 0!==n.flipY&&(s.flipY=n.flipY),void 0!==n.format&&(s.format=n.format),void 0!==n.type&&(s.type=n.type),void 0!==n.mipmaps&&(s.mipmaps=n.mipmaps,s.minFilter=cn),1===n.mipmapCount&&(s.minFilter=an),void 0!==n.generateMipmaps&&(s.generateMipmaps=n.generateMipmaps),s.needsUpdate=!0,t&&t(s,n)},n,i),s}}class Ed extends fd{constructor(e){super(e)}load(e,t,n,i){const r=new Es,s=new xd(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(e,function(e){r.image=e,r.needsUpdate=!0,void 0!==t&&t(r)},n,i),r}}class Td extends Ia{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;super(),this.isLight=!0,this.type="Light",this.color=new Za(e),this.intensity=t}dispose(){this.dispatchEvent({type:"dispose"})}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,t}}class wd extends Td{constructor(e,t,n){super(e,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Ia.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Za(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}toJSON(e){const t=super.toJSON(e);return t.object.groundColor=this.groundColor.getHex(),t}}const Ad=new ra,Md=new ss,Rd=new ss;class Cd{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new is(512,512),this.mapType=hn,this.map=null,this.mapPass=null,this.matrix=new ra,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new oc,this._frameExtents=new is(1,1),this._viewportCount=1,this._viewports=[new Ts(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;Md.setFromMatrixPosition(e.matrixWorld),t.position.copy(Md),Rd.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(Rd),t.updateMatrixWorld(),Ad.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Ad,t.coordinateSystem,t.reversedDepth),t.reversedDepth?n.set(.5,0,0,.5,0,.5,0,.5,0,0,1,0,0,0,0,1):n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(Ad)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.autoUpdate=e.autoUpdate,this.needsUpdate=e.needsUpdate,this.normalBias=e.normalBias,this.blurSamples=e.blurSamples,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 1!==this.intensity&&(e.intensity=this.intensity),0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class Ld extends Cd{constructor(){super(new Jo(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1,this.aspect=1}updateMatrices(e){const t=this.camera,n=2*Kr*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height*this.aspect,r=e.distance||t.far;n===t.fov&&i===t.aspect&&r===t.far||(t.fov=n,t.aspect=i,t.far=r,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class Id extends Td{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Math.PI/3,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2;super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Ia.DEFAULT_UP),this.updateMatrix(),this.target=new Ia,this.distance=n,this.angle=i,this.penumbra=r,this.decay=s,this.map=null,this.shadow=new Ld}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){super.dispose(),this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.map=e.map,this.shadow=e.shadow.clone(),this}toJSON(e){const t=super.toJSON(e);return t.object.distance=this.distance,t.object.angle=this.angle,t.object.decay=this.decay,t.object.penumbra=this.penumbra,t.object.target=this.target.uuid,this.map&&this.map.isTexture&&(t.object.map=this.map.toJSON(e).uuid),t.object.shadow=this.shadow.toJSON(),t}}class Pd extends Cd{constructor(){super(new Jo(90,1,.5,500)),this.isPointLightShadow=!0}}class kd extends Td{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=i,this.shadow=new Pd}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){super.dispose(),this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}toJSON(e){const t=super.toJSON(e);return t.object.distance=this.distance,t.object.decay=this.decay,t.object.shadow=this.shadow.toJSON(),t}}class Dd extends Xo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.1,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2e3;super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=i,this.near=r,this.far=s,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,n,i,r,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let r=n-e,s=n+e,a=i+t,o=i-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=e*this.view.offsetX,s=r+e*this.view.width,a-=t*this.view.offsetY,o=a-t*this.view.height}this.projectionMatrix.makeOrthographic(r,s,a,o,this.near,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}class Nd extends Cd{constructor(){super(new Dd(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class Od extends Td{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Ia.DEFAULT_UP),this.updateMatrix(),this.target=new Ia,this.shadow=new Nd}dispose(){super.dispose(),this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}toJSON(e){const t=super.toJSON(e);return t.object.shadow=this.shadow.toJSON(),t.object.target=this.target.uuid,t}}class Fd extends Td{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class Ud extends Td{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=i}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class Bd{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new ss)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,i=e.y,r=e.z,s=this.coefficients;return t.copy(s[0]).multiplyScalar(.282095),t.addScaledVector(s[1],.488603*i),t.addScaledVector(s[2],.488603*r),t.addScaledVector(s[3],.488603*n),t.addScaledVector(s[4],n*i*1.092548),t.addScaledVector(s[5],i*r*1.092548),t.addScaledVector(s[6],.315392*(3*r*r-1)),t.addScaledVector(s[7],n*r*1.092548),t.addScaledVector(s[8],.546274*(n*n-i*i)),t}getIrradianceAt(e,t){const n=e.x,i=e.y,r=e.z,s=this.coefficients;return t.copy(s[0]).multiplyScalar(.886227),t.addScaledVector(s[1],1.023328*i),t.addScaledVector(s[2],1.023328*r),t.addScaledVector(s[3],1.023328*n),t.addScaledVector(s[4],.858086*n*i),t.addScaledVector(s[5],.858086*i*r),t.addScaledVector(s[6],.743125*r*r-.247708),t.addScaledVector(s[7],.858086*n*r),t.addScaledVector(s[8],.429043*(n*n-i*i)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.coefficients;for(let i=0;i<9;i++)n[i].fromArray(e,t+3*i);return this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.coefficients;for(let i=0;i<9;i++)n[i].toArray(e,t+3*i);return e}static getBasisAt(e,t){const n=e.x,i=e.y,r=e.z;t[0]=.282095,t[1]=.488603*i,t[2]=.488603*r,t[3]=.488603*n,t[4]=1.092548*n*i,t[5]=1.092548*i*r,t[6]=.315392*(3*r*r-1),t[7]=1.092548*n*r,t[8]=.546274*(n*n-i*i)}}class zd extends Td{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Bd;super(void 0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class jd extends fd{constructor(e){super(e),this.textures={}}load(e,t,n,i){const r=this,s=new gd(r.manager);s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(e,function(n){try{t(r.parse(JSON.parse(n)))}catch(Px){i?i(Px):Vr(Px),r.manager.itemError(e)}},n,i)}parse(e){const t=this.textures;function n(e){return void 0===t[e]&&Gr("MaterialLoader: Undefined texture",e),t[e]}const i=this.createMaterialFromType(e.type);if(void 0!==e.uuid&&(i.uuid=e.uuid),void 0!==e.name&&(i.name=e.name),void 0!==e.color&&void 0!==i.color&&i.color.setHex(e.color),void 0!==e.roughness&&(i.roughness=e.roughness),void 0!==e.metalness&&(i.metalness=e.metalness),void 0!==e.sheen&&(i.sheen=e.sheen),void 0!==e.sheenColor&&(i.sheenColor=(new Za).setHex(e.sheenColor)),void 0!==e.sheenRoughness&&(i.sheenRoughness=e.sheenRoughness),void 0!==e.emissive&&void 0!==i.emissive&&i.emissive.setHex(e.emissive),void 0!==e.specular&&void 0!==i.specular&&i.specular.setHex(e.specular),void 0!==e.specularIntensity&&(i.specularIntensity=e.specularIntensity),void 0!==e.specularColor&&void 0!==i.specularColor&&i.specularColor.setHex(e.specularColor),void 0!==e.shininess&&(i.shininess=e.shininess),void 0!==e.clearcoat&&(i.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(i.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.dispersion&&(i.dispersion=e.dispersion),void 0!==e.iridescence&&(i.iridescence=e.iridescence),void 0!==e.iridescenceIOR&&(i.iridescenceIOR=e.iridescenceIOR),void 0!==e.iridescenceThicknessRange&&(i.iridescenceThicknessRange=e.iridescenceThicknessRange),void 0!==e.transmission&&(i.transmission=e.transmission),void 0!==e.thickness&&(i.thickness=e.thickness),void 0!==e.attenuationDistance&&(i.attenuationDistance=e.attenuationDistance),void 0!==e.attenuationColor&&void 0!==i.attenuationColor&&i.attenuationColor.setHex(e.attenuationColor),void 0!==e.anisotropy&&(i.anisotropy=e.anisotropy),void 0!==e.anisotropyRotation&&(i.anisotropyRotation=e.anisotropyRotation),void 0!==e.fog&&(i.fog=e.fog),void 0!==e.flatShading&&(i.flatShading=e.flatShading),void 0!==e.blending&&(i.blending=e.blending),void 0!==e.combine&&(i.combine=e.combine),void 0!==e.side&&(i.side=e.side),void 0!==e.shadowSide&&(i.shadowSide=e.shadowSide),void 0!==e.opacity&&(i.opacity=e.opacity),void 0!==e.transparent&&(i.transparent=e.transparent),void 0!==e.alphaTest&&(i.alphaTest=e.alphaTest),void 0!==e.alphaHash&&(i.alphaHash=e.alphaHash),void 0!==e.depthFunc&&(i.depthFunc=e.depthFunc),void 0!==e.depthTest&&(i.depthTest=e.depthTest),void 0!==e.depthWrite&&(i.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(i.colorWrite=e.colorWrite),void 0!==e.blendSrc&&(i.blendSrc=e.blendSrc),void 0!==e.blendDst&&(i.blendDst=e.blendDst),void 0!==e.blendEquation&&(i.blendEquation=e.blendEquation),void 0!==e.blendSrcAlpha&&(i.blendSrcAlpha=e.blendSrcAlpha),void 0!==e.blendDstAlpha&&(i.blendDstAlpha=e.blendDstAlpha),void 0!==e.blendEquationAlpha&&(i.blendEquationAlpha=e.blendEquationAlpha),void 0!==e.blendColor&&void 0!==i.blendColor&&i.blendColor.setHex(e.blendColor),void 0!==e.blendAlpha&&(i.blendAlpha=e.blendAlpha),void 0!==e.stencilWriteMask&&(i.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(i.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(i.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(i.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(i.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(i.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(i.stencilZPass=e.stencilZPass),void 0!==e.stencilWrite&&(i.stencilWrite=e.stencilWrite),void 0!==e.wireframe&&(i.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(i.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(i.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(i.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(i.rotation=e.rotation),void 0!==e.linewidth&&(i.linewidth=e.linewidth),void 0!==e.dashSize&&(i.dashSize=e.dashSize),void 0!==e.gapSize&&(i.gapSize=e.gapSize),void 0!==e.scale&&(i.scale=e.scale),void 0!==e.polygonOffset&&(i.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(i.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(i.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.dithering&&(i.dithering=e.dithering),void 0!==e.alphaToCoverage&&(i.alphaToCoverage=e.alphaToCoverage),void 0!==e.premultipliedAlpha&&(i.premultipliedAlpha=e.premultipliedAlpha),void 0!==e.forceSinglePass&&(i.forceSinglePass=e.forceSinglePass),void 0!==e.allowOverride&&(i.allowOverride=e.allowOverride),void 0!==e.visible&&(i.visible=e.visible),void 0!==e.toneMapped&&(i.toneMapped=e.toneMapped),void 0!==e.userData&&(i.userData=e.userData),void 0!==e.vertexColors&&("number"===typeof e.vertexColors?i.vertexColors=e.vertexColors>0:i.vertexColors=e.vertexColors),void 0!==e.uniforms)for(const r in e.uniforms){const t=e.uniforms[r];switch(i.uniforms[r]={},t.type){case"t":i.uniforms[r].value=n(t.value);break;case"c":i.uniforms[r].value=(new Za).setHex(t.value);break;case"v2":i.uniforms[r].value=(new is).fromArray(t.value);break;case"v3":i.uniforms[r].value=(new ss).fromArray(t.value);break;case"v4":i.uniforms[r].value=(new Ts).fromArray(t.value);break;case"m3":i.uniforms[r].value=(new ls).fromArray(t.value);break;case"m4":i.uniforms[r].value=(new ra).fromArray(t.value);break;default:i.uniforms[r].value=t.value}}if(void 0!==e.defines&&(i.defines=e.defines),void 0!==e.vertexShader&&(i.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(i.fragmentShader=e.fragmentShader),void 0!==e.glslVersion&&(i.glslVersion=e.glslVersion),void 0!==e.extensions)for(const r in e.extensions)i.extensions[r]=e.extensions[r];if(void 0!==e.lights&&(i.lights=e.lights),void 0!==e.clipping&&(i.clipping=e.clipping),void 0!==e.size&&(i.size=e.size),void 0!==e.sizeAttenuation&&(i.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(i.map=n(e.map)),void 0!==e.matcap&&(i.matcap=n(e.matcap)),void 0!==e.alphaMap&&(i.alphaMap=n(e.alphaMap)),void 0!==e.bumpMap&&(i.bumpMap=n(e.bumpMap)),void 0!==e.bumpScale&&(i.bumpScale=e.bumpScale),void 0!==e.normalMap&&(i.normalMap=n(e.normalMap)),void 0!==e.normalMapType&&(i.normalMapType=e.normalMapType),void 0!==e.normalScale){let t=e.normalScale;!1===Array.isArray(t)&&(t=[t,t]),i.normalScale=(new is).fromArray(t)}return void 0!==e.displacementMap&&(i.displacementMap=n(e.displacementMap)),void 0!==e.displacementScale&&(i.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(i.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(i.roughnessMap=n(e.roughnessMap)),void 0!==e.metalnessMap&&(i.metalnessMap=n(e.metalnessMap)),void 0!==e.emissiveMap&&(i.emissiveMap=n(e.emissiveMap)),void 0!==e.emissiveIntensity&&(i.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(i.specularMap=n(e.specularMap)),void 0!==e.specularIntensityMap&&(i.specularIntensityMap=n(e.specularIntensityMap)),void 0!==e.specularColorMap&&(i.specularColorMap=n(e.specularColorMap)),void 0!==e.envMap&&(i.envMap=n(e.envMap)),void 0!==e.envMapRotation&&i.envMapRotation.fromArray(e.envMapRotation),void 0!==e.envMapIntensity&&(i.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(i.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(i.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(i.lightMap=n(e.lightMap)),void 0!==e.lightMapIntensity&&(i.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(i.aoMap=n(e.aoMap)),void 0!==e.aoMapIntensity&&(i.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(i.gradientMap=n(e.gradientMap)),void 0!==e.clearcoatMap&&(i.clearcoatMap=n(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(i.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(i.clearcoatNormalMap=n(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(i.clearcoatNormalScale=(new is).fromArray(e.clearcoatNormalScale)),void 0!==e.iridescenceMap&&(i.iridescenceMap=n(e.iridescenceMap)),void 0!==e.iridescenceThicknessMap&&(i.iridescenceThicknessMap=n(e.iridescenceThicknessMap)),void 0!==e.transmissionMap&&(i.transmissionMap=n(e.transmissionMap)),void 0!==e.thicknessMap&&(i.thicknessMap=n(e.thicknessMap)),void 0!==e.anisotropyMap&&(i.anisotropyMap=n(e.anisotropyMap)),void 0!==e.sheenColorMap&&(i.sheenColorMap=n(e.sheenColorMap)),void 0!==e.sheenRoughnessMap&&(i.sheenRoughnessMap=n(e.sheenRoughnessMap)),i}setTextures(e){return this.textures=e,this}createMaterialFromType(e){return jd.createMaterialFromType(e)}static createMaterialFromType(e){return new{ShadowMaterial:kh,SpriteMaterial:hl,RawShaderMaterial:Dh,ShaderMaterial:Yo,PointsMaterial:Hc,MeshPhysicalMaterial:Oh,MeshStandardMaterial:Nh,MeshPhongMaterial:Fh,MeshToonMaterial:Uh,MeshNormalMaterial:Bh,MeshLambertMaterial:zh,MeshDepthMaterial:jh,MeshDistanceMaterial:Gh,MeshBasicMaterial:eo,MeshMatcapMaterial:Vh,LineDashedMaterial:Hh,LineBasicMaterial:Lc,Material:$a}[e]}}class Gd{static extractUrlBase(e){const t=e.lastIndexOf("/");return-1===t?"./":e.slice(0,t+1)}static resolveURL(e,t){return"string"!==typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class Vd extends Mo{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class Hd extends fd{constructor(e){super(e)}load(e,t,n,i){const r=this,s=new gd(r.manager);s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(e,function(n){try{t(r.parse(JSON.parse(n)))}catch(Px){i?i(Px):Vr(Px),r.manager.itemError(e)}},n,i)}parse(e){const t={},n={};function i(e,i){if(void 0!==t[i])return t[i];const r=e.interleavedBuffers[i],s=function(e,t){if(void 0!==n[t])return n[t];const i=e.arrayBuffers,r=i[t],s=new Uint32Array(r).buffer;return n[t]=s,s}(e,r.buffer),a=kr(r.type,s),o=new ll(a,r.stride);return o.uuid=r.uuid,t[i]=o,o}const r=e.isInstancedBufferGeometry?new Vd:new Mo,s=e.data.index;if(void 0!==s){const e=kr(s.type,s.array);r.setIndex(new co(e,1))}const a=e.data.attributes;for(const u in a){const t=a[u];let n;if(t.isInterleavedBufferAttribute){const r=i(e.data,t.data);n=new ul(r,t.itemSize,t.offset,t.normalized)}else{const e=kr(t.type,t.array);n=new(t.isInstancedBufferAttribute?Wl:co)(e,t.itemSize,t.normalized)}void 0!==t.name&&(n.name=t.name),void 0!==t.usage&&n.setUsage(t.usage),r.setAttribute(u,n)}const o=e.data.morphAttributes;if(o)for(const u in o){const t=o[u],n=[];for(let r=0,s=t.length;r<s;r++){const s=t[r];let a;if(s.isInterleavedBufferAttribute){const t=i(e.data,s.data);a=new ul(t,s.itemSize,s.offset,s.normalized)}else{const e=kr(s.type,s.array);a=new co(e,s.itemSize,s.normalized)}void 0!==s.name&&(a.name=s.name),n.push(a)}r.morphAttributes[u]=n}e.data.morphTargetsRelative&&(r.morphTargetsRelative=!0);const l=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==l)for(let u=0,h=l.length;u!==h;++u){const e=l[u];r.addGroup(e.start,e.count,e.materialIndex)}const c=e.data.boundingSphere;return void 0!==c&&(r.boundingSphere=(new Ks).fromJSON(c)),e.name&&(r.name=e.name),e.userData&&(r.userData=e.userData),r}}class Wd extends fd{constructor(e){super(e)}load(e,t,n,i){const r=this,s=""===this.path?Gd.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||s;const a=new gd(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(n){let s=null;try{s=JSON.parse(n)}catch(Vr){return void 0!==i&&i(Vr),void Vr("ObjectLoader: Can't parse "+e+".",Vr.message)}const a=s.metadata;if(void 0===a||void 0===a.type||"geometry"===a.type.toLowerCase())return void 0!==i&&i(new Error("THREE.ObjectLoader: Can't load "+e)),void Vr("ObjectLoader: Can't load "+e);r.parse(s,t)},n,i)}async loadAsync(e,t){const n=""===this.path?Gd.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||n;const i=new gd(this.manager);i.setPath(this.path),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials);const r=await i.loadAsync(e,t),s=JSON.parse(r),a=s.metadata;if(void 0===a||void 0===a.type||"geometry"===a.type.toLowerCase())throw new Error("THREE.ObjectLoader: Can't load "+e);return await this.parseAsync(s)}parse(e,t){const n=this.parseAnimations(e.animations),i=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,i),s=this.parseImages(e.images,function(){void 0!==t&&t(l)}),a=this.parseTextures(e.textures,s),o=this.parseMaterials(e.materials,a),l=this.parseObject(e.object,r,o,a,n),c=this.parseSkeletons(e.skeletons,l);if(this.bindSkeletons(l,c),this.bindLightTargets(l),void 0!==t){let e=!1;for(const t in s)if(s[t].data instanceof HTMLImageElement){e=!0;break}!1===e&&t(l)}return l}async parseAsync(e){const t=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),i=this.parseGeometries(e.geometries,n),r=await this.parseImagesAsync(e.images),s=this.parseTextures(e.textures,r),a=this.parseMaterials(e.materials,s),o=this.parseObject(e.object,i,a,s,t),l=this.parseSkeletons(e.skeletons,o);return this.bindSkeletons(o,l),this.bindLightTargets(o),o}parseShapes(e){const t={};if(void 0!==e)for(let n=0,i=e.length;n<i;n++){const i=(new zu).fromJSON(e[n]);t[i.uuid]=i}return t}parseSkeletons(e,t){const n={},i={};if(t.traverse(function(e){e.isBone&&(i[e.uuid]=e)}),void 0!==e)for(let r=0,s=e.length;r<s;r++){const t=(new Hl).fromJSON(e[r],i);n[t.uuid]=t}return n}parseGeometries(e,t){const n={};if(void 0!==e){const i=new Hd;for(let r=0,s=e.length;r<s;r++){let s;const a=e[r];switch(a.type){case"BufferGeometry":case"InstancedBufferGeometry":s=i.parse(a);break;default:a.type in Ph?s=Ph[a.type].fromJSON(a,t):Gr('ObjectLoader: Unsupported geometry type "'.concat(a.type,'"'))}s.uuid=a.uuid,void 0!==a.name&&(s.name=a.name),void 0!==a.userData&&(s.userData=a.userData),n[a.uuid]=s}}return n}parseMaterials(e,t){const n={},i={};if(void 0!==e){const r=new jd;r.setTextures(t);for(let t=0,s=e.length;t<s;t++){const s=e[t];void 0===n[s.uuid]&&(n[s.uuid]=r.parse(s)),i[s.uuid]=n[s.uuid]}}return i}parseAnimations(e){const t={};if(void 0!==e)for(let n=0;n<e.length;n++){const i=e[n],r=ld.parse(i);t[r.uuid]=r}return t}parseImages(e,t){const n=this,i={};let r;function s(e){if("string"===typeof e){const t=e;return function(e){return n.manager.itemStart(e),r.load(e,function(){n.manager.itemEnd(e)},void 0,function(){n.manager.itemError(e),n.manager.itemEnd(e)})}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(t)?t:n.resourcePath+t)}return e.data?{data:kr(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){const n=new hd(t);r=new xd(n),r.setCrossOrigin(this.crossOrigin);for(let t=0,r=e.length;t<r;t++){const n=e[t],r=n.url;if(Array.isArray(r)){const e=[];for(let t=0,n=r.length;t<n;t++){const n=s(r[t]);null!==n&&(n instanceof HTMLImageElement?e.push(n):e.push(new jl(n.data,n.width,n.height)))}i[n.uuid]=new bs(e)}else{const e=s(n.url);i[n.uuid]=new bs(e)}}}return i}async parseImagesAsync(e){const t=this,n={};let i;async function r(e){if("string"===typeof e){const n=e,r=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(n)?n:t.resourcePath+n;return await i.loadAsync(r)}return e.data?{data:kr(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){i=new xd(this.manager),i.setCrossOrigin(this.crossOrigin);for(let t=0,i=e.length;t<i;t++){const i=e[t],s=i.url;if(Array.isArray(s)){const e=[];for(let t=0,n=s.length;t<n;t++){const n=s[t],i=await r(n);null!==i&&(i instanceof HTMLImageElement?e.push(i):e.push(new jl(i.data,i.width,i.height)))}n[i.uuid]=new bs(e)}else{const e=await r(i.url);n[i.uuid]=new bs(e)}}}return n}parseTextures(e,t){function n(e,t){return"number"===typeof e?e:(Gr("ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}const i={};if(void 0!==e)for(let r=0,s=e.length;r<s;r++){const s=e[r];void 0===s.image&&Gr('ObjectLoader: No "image" specified for',s.uuid),void 0===t[s.image]&&Gr("ObjectLoader: Undefined image",s.image);const a=t[s.image],o=a.data;let l;Array.isArray(o)?(l=new el,6===o.length&&(l.needsUpdate=!0)):(l=o&&o.data?new jl:new Es,o&&(l.needsUpdate=!0)),l.source=a,l.uuid=s.uuid,void 0!==s.name&&(l.name=s.name),void 0!==s.mapping&&(l.mapping=n(s.mapping,Yd)),void 0!==s.channel&&(l.channel=s.channel),void 0!==s.offset&&l.offset.fromArray(s.offset),void 0!==s.repeat&&l.repeat.fromArray(s.repeat),void 0!==s.center&&l.center.fromArray(s.center),void 0!==s.rotation&&(l.rotation=s.rotation),void 0!==s.wrap&&(l.wrapS=n(s.wrap[0],Xd),l.wrapT=n(s.wrap[1],Xd)),void 0!==s.format&&(l.format=s.format),void 0!==s.internalFormat&&(l.internalFormat=s.internalFormat),void 0!==s.type&&(l.type=s.type),void 0!==s.colorSpace&&(l.colorSpace=s.colorSpace),void 0!==s.minFilter&&(l.minFilter=n(s.minFilter,qd)),void 0!==s.magFilter&&(l.magFilter=n(s.magFilter,qd)),void 0!==s.anisotropy&&(l.anisotropy=s.anisotropy),void 0!==s.flipY&&(l.flipY=s.flipY),void 0!==s.generateMipmaps&&(l.generateMipmaps=s.generateMipmaps),void 0!==s.premultiplyAlpha&&(l.premultiplyAlpha=s.premultiplyAlpha),void 0!==s.unpackAlignment&&(l.unpackAlignment=s.unpackAlignment),void 0!==s.compareFunction&&(l.compareFunction=s.compareFunction),void 0!==s.userData&&(l.userData=s.userData),i[s.uuid]=l}return i}parseObject(e,t,n,i,r){let s,a,o;function l(e){return void 0===t[e]&&Gr("ObjectLoader: Undefined geometry",e),t[e]}function c(e){if(void 0!==e){if(Array.isArray(e)){const t=[];for(let i=0,r=e.length;i<r;i++){const r=e[i];void 0===n[r]&&Gr("ObjectLoader: Undefined material",r),t.push(n[r])}return t}return void 0===n[e]&&Gr("ObjectLoader: Undefined material",e),n[e]}}function u(e){return void 0===i[e]&&Gr("ObjectLoader: Undefined texture",e),i[e]}switch(e.type){case"Scene":s=new ol,void 0!==e.background&&(Number.isInteger(e.background)?s.background=new Za(e.background):s.background=u(e.background)),void 0!==e.environment&&(s.environment=u(e.environment)),void 0!==e.fog&&("Fog"===e.fog.type?s.fog=new al(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(s.fog=new sl(e.fog.color,e.fog.density)),""!==e.fog.name&&(s.fog.name=e.fog.name)),void 0!==e.backgroundBlurriness&&(s.backgroundBlurriness=e.backgroundBlurriness),void 0!==e.backgroundIntensity&&(s.backgroundIntensity=e.backgroundIntensity),void 0!==e.backgroundRotation&&s.backgroundRotation.fromArray(e.backgroundRotation),void 0!==e.environmentIntensity&&(s.environmentIntensity=e.environmentIntensity),void 0!==e.environmentRotation&&s.environmentRotation.fromArray(e.environmentRotation);break;case"PerspectiveCamera":s=new Jo(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(s.focus=e.focus),void 0!==e.zoom&&(s.zoom=e.zoom),void 0!==e.filmGauge&&(s.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(s.filmOffset=e.filmOffset),void 0!==e.view&&(s.view=Object.assign({},e.view));break;case"OrthographicCamera":s=new Dd(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(s.zoom=e.zoom),void 0!==e.view&&(s.view=Object.assign({},e.view));break;case"AmbientLight":s=new Fd(e.color,e.intensity);break;case"DirectionalLight":s=new Od(e.color,e.intensity),s.target=e.target||"";break;case"PointLight":s=new kd(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":s=new Ud(e.color,e.intensity,e.width,e.height);break;case"SpotLight":s=new Id(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay),s.target=e.target||"";break;case"HemisphereLight":s=new wd(e.color,e.groundColor,e.intensity);break;case"LightProbe":const t=(new Bd).fromArray(e.sh);s=new zd(t,e.intensity);break;case"SkinnedMesh":a=l(e.geometry),o=c(e.material),s=new Bl(a,o),void 0!==e.bindMode&&(s.bindMode=e.bindMode),void 0!==e.bindMatrix&&s.bindMatrix.fromArray(e.bindMatrix),void 0!==e.skeleton&&(s.skeleton=e.skeleton);break;case"Mesh":a=l(e.geometry),o=c(e.material),s=new Bo(a,o);break;case"InstancedMesh":a=l(e.geometry),o=c(e.material);const n=e.count,i=e.instanceMatrix,r=e.instanceColor;s=new $l(a,o,n),s.instanceMatrix=new Wl(new Float32Array(i.array),16),void 0!==r&&(s.instanceColor=new Wl(new Float32Array(r.array),r.itemSize));break;case"BatchedMesh":a=l(e.geometry),o=c(e.material),s=new Cc(e.maxInstanceCount,e.maxVertexCount,e.maxIndexCount,o),s.geometry=a,s.perObjectFrustumCulled=e.perObjectFrustumCulled,s.sortObjects=e.sortObjects,s._drawRanges=e.drawRanges,s._reservedRanges=e.reservedRanges,s._geometryInfo=e.geometryInfo.map(e=>{let t=null,n=null;return void 0!==e.boundingBox&&(t=(new Is).fromJSON(e.boundingBox)),void 0!==e.boundingSphere&&(n=(new Ks).fromJSON(e.boundingSphere)),(0,Oe.A)((0,Oe.A)({},e),{},{boundingBox:t,boundingSphere:n})}),s._instanceInfo=e.instanceInfo,s._availableInstanceIds=e._availableInstanceIds,s._availableGeometryIds=e._availableGeometryIds,s._nextIndexStart=e.nextIndexStart,s._nextVertexStart=e.nextVertexStart,s._geometryCount=e.geometryCount,s._maxInstanceCount=e.maxInstanceCount,s._maxVertexCount=e.maxVertexCount,s._maxIndexCount=e.maxIndexCount,s._geometryInitialized=e.geometryInitialized,s._matricesTexture=u(e.matricesTexture.uuid),s._indirectTexture=u(e.indirectTexture.uuid),void 0!==e.colorsTexture&&(s._colorsTexture=u(e.colorsTexture.uuid)),void 0!==e.boundingSphere&&(s.boundingSphere=(new Ks).fromJSON(e.boundingSphere)),void 0!==e.boundingBox&&(s.boundingBox=(new Is).fromJSON(e.boundingBox));break;case"LOD":s=new Cl;break;case"Line":s=new Uc(l(e.geometry),c(e.material));break;case"LineLoop":s=new Vc(l(e.geometry),c(e.material));break;case"LineSegments":s=new Gc(l(e.geometry),c(e.material));break;case"PointCloud":case"Points":s=new Kc(l(e.geometry),c(e.material));break;case"Sprite":s=new wl(c(e.material));break;case"Group":s=new nl;break;case"Bone":s=new zl;break;default:s=new Ia}if(s.uuid=e.uuid,void 0!==e.name&&(s.name=e.name),void 0!==e.matrix?(s.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(s.matrixAutoUpdate=e.matrixAutoUpdate),s.matrixAutoUpdate&&s.matrix.decompose(s.position,s.quaternion,s.scale)):(void 0!==e.position&&s.position.fromArray(e.position),void 0!==e.rotation&&s.rotation.fromArray(e.rotation),void 0!==e.quaternion&&s.quaternion.fromArray(e.quaternion),void 0!==e.scale&&s.scale.fromArray(e.scale)),void 0!==e.up&&s.up.fromArray(e.up),void 0!==e.castShadow&&(s.castShadow=e.castShadow),void 0!==e.receiveShadow&&(s.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.intensity&&(s.shadow.intensity=e.shadow.intensity),void 0!==e.shadow.bias&&(s.shadow.bias=e.shadow.bias),void 0!==e.shadow.normalBias&&(s.shadow.normalBias=e.shadow.normalBias),void 0!==e.shadow.radius&&(s.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&s.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(s.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(s.visible=e.visible),void 0!==e.frustumCulled&&(s.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(s.renderOrder=e.renderOrder),void 0!==e.userData&&(s.userData=e.userData),void 0!==e.layers&&(s.layers.mask=e.layers),void 0!==e.children){const a=e.children;for(let e=0;e<a.length;e++)s.add(this.parseObject(a[e],t,n,i,r))}if(void 0!==e.animations){const t=e.animations;for(let e=0;e<t.length;e++){const n=t[e];s.animations.push(r[n])}}if("LOD"===e.type){void 0!==e.autoUpdate&&(s.autoUpdate=e.autoUpdate);const t=e.levels;for(let e=0;e<t.length;e++){const n=t[e],i=s.getObjectByProperty("uuid",n.object);void 0!==i&&s.addLevel(i,n.distance,n.hysteresis)}}return s}bindSkeletons(e,t){0!==Object.keys(t).length&&e.traverse(function(e){if(!0===e.isSkinnedMesh&&void 0!==e.skeleton){const n=t[e.skeleton];void 0===n?Gr("ObjectLoader: No skeleton found with UUID:",e.skeleton):e.bind(n,e.bindMatrix)}})}bindLightTargets(e){e.traverse(function(t){if(t.isDirectionalLight||t.isSpotLight){const n=t.target,i=e.getObjectByProperty("uuid",n);t.target=void 0!==i?i:new Ia}})}}const Yd={UVMapping:Wt,CubeReflectionMapping:Yt,CubeRefractionMapping:Xt,EquirectangularReflectionMapping:qt,EquirectangularRefractionMapping:Kt,CubeUVReflectionMapping:Zt},Xd={RepeatWrapping:Jt,ClampToEdgeWrapping:Qt,MirroredRepeatWrapping:$t},qd={NearestFilter:en,NearestMipmapNearestFilter:tn,NearestMipmapLinearFilter:rn,LinearFilter:an,LinearMipmapNearestFilter:on,LinearMipmapLinearFilter:cn},Kd=new WeakMap;class Zd extends fd{constructor(e){super(e),this.isImageBitmapLoader=!0,"undefined"===typeof createImageBitmap&&Gr("ImageBitmapLoader: createImageBitmap() not supported."),"undefined"===typeof fetch&&Gr("ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"},this._abortController=new AbortController}setOptions(e){return this.options=e,this}load(e,t,n,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,s=ud.get("image-bitmap:".concat(e));if(void 0!==s)return r.manager.itemStart(e),s.then?void s.then(n=>{if(!0!==Kd.has(s))return t&&t(n),r.manager.itemEnd(e),n;i&&i(Kd.get(s)),r.manager.itemError(e),r.manager.itemEnd(e)}):(setTimeout(function(){t&&t(s),r.manager.itemEnd(e)},0),s);const a={};a.credentials="anonymous"===this.crossOrigin?"same-origin":"include",a.headers=this.requestHeader,a.signal="function"===typeof AbortSignal.any?AbortSignal.any([this._abortController.signal,this.manager.abortController.signal]):this._abortController.signal;const o=fetch(e,a).then(function(e){return e.blob()}).then(function(e){return createImageBitmap(e,Object.assign(r.options,{colorSpaceConversion:"none"}))}).then(function(n){return ud.add("image-bitmap:".concat(e),n),t&&t(n),r.manager.itemEnd(e),n}).catch(function(t){i&&i(t),Kd.set(o,t),ud.remove("image-bitmap:".concat(e)),r.manager.itemError(e),r.manager.itemEnd(e)});ud.add("image-bitmap:".concat(e),o),r.manager.itemStart(e)}abort(){return this._abortController.abort(),this._abortController=new AbortController,this}}let Jd;class Qd{static getContext(){return void 0===Jd&&(Jd=new(window.AudioContext||window.webkitAudioContext)),Jd}static setContext(e){Jd=e}}class $d extends fd{constructor(e){super(e)}load(e,t,n,i){const r=this,s=new gd(this.manager);function a(t){i?i(t):Vr(t),r.manager.itemError(e)}s.setResponseType("arraybuffer"),s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,function(e){try{const n=e.slice(0);Qd.getContext().decodeAudioData(n,function(e){t(e)}).catch(a)}catch(Px){a(Px)}},n,i)}}const ef=new ra,tf=new ra,nf=new ra;class rf{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Jo,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Jo,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,nf.copy(e.projectionMatrix);const n=t.eyeSep/2,i=n*t.near/t.focus,r=t.near*Math.tan(qr*t.fov*.5)/t.zoom;let s,a;tf.elements[12]=-n,ef.elements[12]=n,s=-r*t.aspect+i,a=r*t.aspect+i,nf.elements[0]=2*t.near/(a-s),nf.elements[8]=(a+s)/(a-s),this.cameraL.projectionMatrix.copy(nf),s=-r*t.aspect-i,a=r*t.aspect-i,nf.elements[0]=2*t.near/(a-s),nf.elements[8]=(a+s)/(a-s),this.cameraR.projectionMatrix.copy(nf)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(tf),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(ef)}}class sf extends Jo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];super(),this.isArrayCamera=!0,this.isMultiViewCamera=!1,this.cameras=e}}class af{constructor(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=performance.now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=performance.now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}const of=new ss,lf=new rs,cf=new ss,uf=new ss,hf=new ss;class df extends Ia{constructor(){super(),this.type="AudioListener",this.context=Qd.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new af}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(of,lf,cf),uf.set(0,0,-1).applyQuaternion(lf),hf.set(0,1,0).applyQuaternion(lf),t.positionX){const e=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(of.x,e),t.positionY.linearRampToValueAtTime(of.y,e),t.positionZ.linearRampToValueAtTime(of.z,e),t.forwardX.linearRampToValueAtTime(uf.x,e),t.forwardY.linearRampToValueAtTime(uf.y,e),t.forwardZ.linearRampToValueAtTime(uf.z,e),t.upX.linearRampToValueAtTime(hf.x,e),t.upY.linearRampToValueAtTime(hf.y,e),t.upZ.linearRampToValueAtTime(hf.z,e)}else t.setPosition(of.x,of.y,of.z),t.setOrientation(uf.x,uf.y,uf.z,hf.x,hf.y,hf.z)}}class ff extends Ia{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!0===this.isPlaying)return void Gr("Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void Gr("Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;Gr("Audio: this Audio has no playback control.")}stop(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!1!==this.hasPlaybackControl)return this._progress=0,null!==this.source&&(this.source.stop(this.context.currentTime+e),this.source.onended=null),this.isPlaying=!1,this;Gr("Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(!1!==this._connected){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){return this.detune=e,!0===this.isPlaying&&void 0!==this.source.detune&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;Gr("Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1,this._progress=0}getLoop(){return!1===this.hasPlaybackControl?(Gr("Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;Gr("Audio: this Audio has no playback control.")}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}copy(e,t){return super.copy(e,t),"buffer"!==e.sourceType?(Gr("Audio: Audio source type cannot be copied."),this):(this.autoplay=e.autoplay,this.buffer=e.buffer,this.detune=e.detune,this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this.offset=e.offset,this.duration=e.duration,this.playbackRate=e.playbackRate,this.hasPlaybackControl=e.hasPlaybackControl,this.sourceType=e.sourceType,this.filters=e.filters.slice(),this)}clone(e){return new this.constructor(this.listener).copy(this,e)}}const pf=new ss,mf=new rs,gf=new ss,vf=new ss;class yf extends ff{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){return super.connect(),this.panner.connect(this.gain),this}disconnect(){return super.disconnect(),this.panner.disconnect(this.gain),this}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(pf,mf,gf),vf.set(0,0,1).applyQuaternion(mf);const t=this.panner;if(t.positionX){const e=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(pf.x,e),t.positionY.linearRampToValueAtTime(pf.y,e),t.positionZ.linearRampToValueAtTime(pf.z,e),t.orientationX.linearRampToValueAtTime(vf.x,e),t.orientationY.linearRampToValueAtTime(vf.y,e),t.orientationZ.linearRampToValueAtTime(vf.z,e)}else t.setPosition(pf.x,pf.y,pf.z),t.setOrientation(vf.x,vf.y,vf.z)}}class bf{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2048;this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let n=0;n<t.length;n++)e+=t[n];return e/t.length}}class xf{constructor(e,t,n){let i,r,s;switch(this.binding=e,this.valueSize=n,t){case"quaternion":i=this._slerp,r=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":i=this._select,r=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:i=this._lerp,r=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=r,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const n=this.buffer,i=this.valueSize,r=e*i+i;let s=this.cumulativeWeight;if(0===s){for(let e=0;e!==i;++e)n[r+e]=n[e];s=t}else{s+=t;const e=t/s;this._mixBufferRegion(n,r,0,e,i)}this.cumulativeWeight=s}accumulateAdditive(e){const t=this.buffer,n=this.valueSize,i=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,i,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,n=this.buffer,i=e*t+t,r=this.cumulativeWeight,s=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const e=t*this._origIndex;this._mixBufferRegion(n,i,e,1-r,t)}s>0&&this._mixBufferRegionAdditive(n,i,this._addIndex*t,1,t);for(let o=t,l=t+t;o!==l;++o)if(n[o]!==n[o+t]){a.setValue(n,i);break}}saveOriginalState(){const e=this.binding,t=this.buffer,n=this.valueSize,i=n*this._origIndex;e.getValue(t,i);for(let r=n,s=i;r!==s;++r)t[r]=t[i+r%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}_select(e,t,n,i,r){if(i>=.5)for(let s=0;s!==r;++s)e[t+s]=e[n+s]}_slerp(e,t,n,i){rs.slerpFlat(e,t,e,t,e,n,i)}_slerpAdditive(e,t,n,i,r){const s=this._workIndex*r;rs.multiplyQuaternionsFlat(e,s,e,t,e,n),rs.slerpFlat(e,t,e,t,e,s,i)}_lerp(e,t,n,i,r){const s=1-i;for(let a=0;a!==r;++a){const r=t+a;e[r]=e[r]*s+e[n+a]*i}}_lerpAdditive(e,t,n,i,r){for(let s=0;s!==r;++s){const r=t+s;e[r]=e[r]+e[n+s]*i}}}const _f="\\[\\]\\.:\\/",Sf=new RegExp("["+_f+"]","g"),Ef="[^"+_f+"]",Tf="[^"+_f.replace("\\.","")+"]",wf=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",Ef)+/(WCOD+)?/.source.replace("WCOD",Tf)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Ef)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Ef)+"$"),Af=["material","materials","bones","map"];class Mf{constructor(e,t,n){this.path=t,this.parsedPath=n||Mf.parseTrackName(t),this.node=Mf.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new Mf.Composite(e,t,n):new Mf(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(Sf,"")}static parseTrackName(e){const t=wf.exec(e);if(null===t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){const e=n.nodeName.substring(i+1);-1!==Af.indexOf(e)&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=e)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){const n=function(e){for(let i=0;i<e.length;i++){const r=e[i];if(r.name===t||r.uuid===t)return r;const s=n(r.children);if(s)return s}return null},i=n(e.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)e[t++]=n[i]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,i=t.propertyName;let r=t.propertyIndex;if(e||(e=Mf.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void Gr("PropertyBinding: No target node found for track: "+this.path+".");if(n){let i=t.objectIndex;switch(n){case"materials":if(!e.material)return void Vr("PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void Vr("PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void Vr("PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===i){i=t;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material)return void Vr("PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.map)return void Vr("PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);e=e.material.map;break;default:if(void 0===e[n])return void Vr("PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(void 0!==i){if(void 0===e[i])return void Vr("PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[i]}}const s=e[i];if(void 0===s){return void Vr("PropertyBinding: Trying to update property for track: "+t.nodeName+"."+i+" but it wasn't found.",e)}let a=this.Versioning.None;this.targetObject=e,!0===e.isMaterial?a=this.Versioning.NeedsUpdate:!0===e.isObject3D&&(a=this.Versioning.MatrixWorldNeedsUpdate);let o=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===i){if(!e.geometry)return void Vr("PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.morphAttributes)return void Vr("PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[r]&&(r=e.morphTargetDictionary[r])}o=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=r}else void 0!==s.fromArray&&void 0!==s.toArray?(o=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(o=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=i;this.getValue=this.GetterByBindingType[o],this.setValue=this.SetterByBindingTypeAndVersioning[o][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Mf.Composite=class{constructor(e,t,n){const i=n||Mf.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,i=this._bindings[n];void 0!==i&&i.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=n.length;i!==r;++i)n[i].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}},Mf.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Mf.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Mf.prototype.GetterByBindingType=[Mf.prototype._getValue_direct,Mf.prototype._getValue_array,Mf.prototype._getValue_arrayElement,Mf.prototype._getValue_toArray],Mf.prototype.SetterByBindingTypeAndVersioning=[[Mf.prototype._setValue_direct,Mf.prototype._setValue_direct_setNeedsUpdate,Mf.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Mf.prototype._setValue_array,Mf.prototype._setValue_array_setNeedsUpdate,Mf.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Mf.prototype._setValue_arrayElement,Mf.prototype._setValue_arrayElement_setNeedsUpdate,Mf.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Mf.prototype._setValue_fromArray,Mf.prototype._setValue_fromArray_setNeedsUpdate,Mf.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Rf{constructor(){this.isAnimationObjectGroup=!0,this.uuid=Zr(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let n=0,i=arguments.length;n!==i;++n)e[arguments[n].uuid]=n;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,n=this._paths,i=this._parsedPaths,r=this._bindings,s=r.length;let a,o=e.length,l=this.nCachedObjects_;for(let c=0,u=arguments.length;c!==u;++c){const u=arguments[c],h=u.uuid;let d=t[h];if(void 0===d){d=o++,t[h]=d,e.push(u);for(let e=0,t=s;e!==t;++e)r[e].push(new Mf(u,n[e],i[e]))}else if(d<l){a=e[d];const o=--l,c=e[o];t[c.uuid]=d,e[d]=c,t[h]=o,e[o]=u;for(let e=0,t=s;e!==t;++e){const t=r[e],s=t[o];let a=t[d];t[d]=s,void 0===a&&(a=new Mf(u,n[e],i[e])),t[o]=a}}else e[d]!==a&&Vr("AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l}remove(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length;let r=this.nCachedObjects_;for(let s=0,a=arguments.length;s!==a;++s){const a=arguments[s],o=a.uuid,l=t[o];if(void 0!==l&&l>=r){const s=r++,c=e[s];t[c.uuid]=l,e[l]=c,t[o]=s,e[s]=a;for(let e=0,t=i;e!==t;++e){const t=n[e],i=t[s],r=t[l];t[l]=i,t[s]=r}}}this.nCachedObjects_=r}uncache(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length;let r=this.nCachedObjects_,s=e.length;for(let a=0,o=arguments.length;a!==o;++a){const o=arguments[a].uuid,l=t[o];if(void 0!==l)if(delete t[o],l<r){const a=--r,o=e[a],c=--s,u=e[c];t[o.uuid]=l,e[l]=o,t[u.uuid]=a,e[a]=u,e.pop();for(let e=0,t=i;e!==t;++e){const t=n[e],i=t[a],r=t[c];t[l]=i,t[a]=r,t.pop()}}else{const r=--s,a=e[r];r>0&&(t[a.uuid]=l),e[l]=a,e.pop();for(let e=0,t=i;e!==t;++e){const t=n[e];t[l]=t[r],t.pop()}}}this.nCachedObjects_=r}subscribe_(e,t){const n=this._bindingsIndicesByPath;let i=n[e];const r=this._bindings;if(void 0!==i)return r[i];const s=this._paths,a=this._parsedPaths,o=this._objects,l=o.length,c=this.nCachedObjects_,u=new Array(l);i=r.length,n[e]=i,s.push(e),a.push(t),r.push(u);for(let h=c,d=o.length;h!==d;++h){const n=o[h];u[h]=new Mf(n,e,t)}return u}unsubscribe_(e){const t=this._bindingsIndicesByPath,n=t[e];if(void 0!==n){const i=this._paths,r=this._parsedPaths,s=this._bindings,a=s.length-1,o=s[a];t[e[a]]=n,s[n]=o,s.pop(),r[n]=r[a],r.pop(),i[n]=i[a],i.pop()}}}class Cf{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.blendMode;this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=i;const r=t.tracks,s=r.length,a=new Array(s),o={endingStart:Ei,endingEnd:Ei};for(let l=0;l!==s;++l){const e=r[l].createInterpolant(null);a[l]=e,e.settings=o}this._interpolantSettings=o,this._interpolants=a,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=yi,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e.fadeOut(t),this.fadeIn(t),!0===n){const n=this._clip.duration,i=e._clip.duration,r=i/n,s=n/i;e.warp(1,r,t),this.warp(s,1,t)}return this}crossFadeTo(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e.crossFadeFrom(this,t,n)}stopFading(){const e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){const i=this._mixer,r=i.time,s=this.timeScale;let a=this._timeScaleInterpolant;null===a&&(a=i._lendControlInterpolant(),this._timeScaleInterpolant=a);const o=a.parameterPositions,l=a.sampleValues;return o[0]=r,o[1]=r+n,l[0]=e/s,l[1]=t/s,this}stopWarping(){const e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,i){if(!this.enabled)return void this._updateWeight(e);const r=this._startTime;if(null!==r){const i=(e-r)*n;i<0||0===n?t=0:(this._startTime=null,t=n*i)}t*=this._updateTimeScale(e);const s=this._updateTime(t),a=this._updateWeight(e);if(a>0){const e=this._interpolants,t=this._propertyBindings;if(this.blendMode===Mi)for(let n=0,i=e.length;n!==i;++n)e[n].evaluate(s),t[n].accumulateAdditive(a);else for(let n=0,r=e.length;n!==r;++n)e[n].evaluate(s),t[n].accumulate(i,a)}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const n=this._weightInterpolant;if(null!==n){const i=n.evaluate(e)[0];t*=i,e>n.parameterPositions[1]&&(this.stopFading(),0===i&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const n=this._timeScaleInterpolant;if(null!==n){t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,n=this.loop;let i=this.time+e,r=this._loopCount;const s=n===bi;if(0===e)return-1===r?i:s&&1===(1&r)?t-i:i;if(n===vi){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(i>=t)i=t;else{if(!(i<0)){this.time=i;break e}i=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===r&&(e>=0?(r=0,this._setEndings(!0,0===this.repetitions,s)):this._setEndings(0===this.repetitions,!0,s)),i>=t||i<0){const n=Math.floor(i/t);i-=t*n,r+=Math.abs(n);const a=this.repetitions-r;if(a<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=e>0?t:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===a){const t=e<0;this._setEndings(t,!t,s)}else this._setEndings(!1,!1,s);this._loopCount=r,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=i;if(s&&1===(1&r))return t-i}return i}_setEndings(e,t,n){const i=this._interpolantSettings;n?(i.endingStart=Ti,i.endingEnd=Ti):(i.endingStart=e?this.zeroSlopeAtStart?Ti:Ei:wi,i.endingEnd=t?this.zeroSlopeAtEnd?Ti:Ei:wi)}_scheduleFading(e,t,n){const i=this._mixer,r=i.time;let s=this._weightInterpolant;null===s&&(s=i._lendControlInterpolant(),this._weightInterpolant=s);const a=s.parameterPositions,o=s.sampleValues;return a[0]=r,o[0]=t,a[1]=r+e,o[1]=n,this}}const Lf=new Float32Array(1);class If extends Wr{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const n=e._localRoot||this._root,i=e._clip.tracks,r=i.length,s=e._propertyBindings,a=e._interpolants,o=n.uuid,l=this._bindingsByRootAndName;let c=l[o];void 0===c&&(c={},l[o]=c);for(let u=0;u!==r;++u){const e=i[u],r=e.name;let l=c[r];if(void 0!==l)++l.referenceCount,s[u]=l;else{if(l=s[u],void 0!==l){null===l._cacheIndex&&(++l.referenceCount,this._addInactiveBinding(l,o,r));continue}const i=t&&t._propertyBindings[u].binding.parsedPath;l=new xf(Mf.create(n,r,i),e.ValueTypeName,e.getValueSize()),++l.referenceCount,this._addInactiveBinding(l,o,r),s[u]=l}a[u].resultBuffer=l.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){const t=(e._localRoot||this._root).uuid,n=e._clip.uuid,i=this._actionsByClip[n];this._bindAction(e,i&&i.knownActions[0]),this._addInactiveAction(e,n,t)}const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0===n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0===--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return null!==t&&t<this._nActiveActions}_addInactiveAction(e,t,n){const i=this._actions,r=this._actionsByClip;let s=r[t];if(void 0===s)s={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[t]=s;else{const t=s.knownActions;e._byClipCacheIndex=t.length,t.push(e)}e._cacheIndex=i.length,i.push(e),s.actionByRoot[n]=e}_removeInactiveAction(e){const t=this._actions,n=t[t.length-1],i=e._cacheIndex;n._cacheIndex=i,t[i]=n,t.pop(),e._cacheIndex=null;const r=e._clip.uuid,s=this._actionsByClip,a=s[r],o=a.knownActions,l=o[o.length-1],c=e._byClipCacheIndex;l._byClipCacheIndex=c,o[c]=l,o.pop(),e._byClipCacheIndex=null;delete a.actionByRoot[(e._localRoot||this._root).uuid],0===o.length&&delete s[r],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let n=0,i=t.length;n!==i;++n){const e=t[n];0===--e.referenceCount&&this._removeInactiveBinding(e)}}_lendAction(e){const t=this._actions,n=e._cacheIndex,i=this._nActiveActions++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_takeBackAction(e){const t=this._actions,n=e._cacheIndex,i=--this._nActiveActions,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_addInactiveBinding(e,t,n){const i=this._bindingsByRootAndName,r=this._bindings;let s=i[t];void 0===s&&(s={},i[t]=s),s[n]=e,e._cacheIndex=r.length,r.push(e)}_removeInactiveBinding(e){const t=this._bindings,n=e.binding,i=n.rootNode.uuid,r=n.path,s=this._bindingsByRootAndName,a=s[i],o=t[t.length-1],l=e._cacheIndex;o._cacheIndex=l,t[l]=o,t.pop(),delete a[r],0===Object.keys(a).length&&delete s[i]}_lendBinding(e){const t=this._bindings,n=e._cacheIndex,i=this._nActiveBindings++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_takeBackBinding(e){const t=this._bindings,n=e._cacheIndex,i=--this._nActiveBindings,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=e[t];return void 0===n&&(n=new Qh(new Float32Array(2),new Float32Array(2),1,Lf),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){const t=this._controlInterpolants,n=e.__cacheIndex,i=--this._nActiveControlInterpolants,r=t[i];e.__cacheIndex=i,t[i]=e,r.__cacheIndex=n,t[n]=r}clipAction(e,t,n){const i=t||this._root,r=i.uuid;let s="string"===typeof e?ld.findByName(i,e):e;const a=null!==s?s.uuid:e,o=this._actionsByClip[a];let l=null;if(void 0===n&&(n=null!==s?s.blendMode:Ai),void 0!==o){const e=o.actionByRoot[r];if(void 0!==e&&e.blendMode===n)return e;l=o.knownActions[0],null===s&&(s=l._clip)}if(null===s)return null;const c=new Cf(this,s,t,n);return this._bindAction(c,l),this._addInactiveAction(c,a,r),c}existingAction(e,t){const n=t||this._root,i=n.uuid,r="string"===typeof e?ld.findByName(n,e):e,s=r?r.uuid:e,a=this._actionsByClip[s];return void 0!==a&&a.actionByRoot[i]||null}stopAllAction(){const e=this._actions;for(let t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this}update(e){e*=this.timeScale;const t=this._actions,n=this._nActiveActions,i=this.time+=e,r=Math.sign(e),s=this._accuIndex^=1;for(let l=0;l!==n;++l){t[l]._update(i,e,r,s)}const a=this._bindings,o=this._nActiveBindings;for(let l=0;l!==o;++l)a[l].apply(s);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,n=e.uuid,i=this._actionsByClip,r=i[n];if(void 0!==r){const e=r.knownActions;for(let n=0,i=e.length;n!==i;++n){const i=e[n];this._deactivateAction(i);const r=i._cacheIndex,s=t[t.length-1];i._cacheIndex=null,i._byClipCacheIndex=null,s._cacheIndex=r,t[r]=s,t.pop(),this._removeInactiveBindingsForAction(i)}delete i[n]}}uncacheRoot(e){const t=e.uuid,n=this._actionsByClip;for(const r in n){const e=n[r].actionByRoot[t];void 0!==e&&(this._deactivateAction(e),this._removeInactiveAction(e))}const i=this._bindingsByRootAndName[t];if(void 0!==i)for(const r in i){const e=i[r];e.restoreOriginalState(),this._removeInactiveBinding(e)}}uncacheAction(e,t){const n=this.existingAction(e,t);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}class Pf extends ws{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(e,t,i),this.isRenderTarget3D=!0,this.depth=n,this.texture=new Cs(null,e,t,n),this._setTextureOptions(i),this.texture.isRenderTargetTexture=!0}}class kf{constructor(e){this.value=e}clone(){return new kf(void 0===this.value.clone?this.value:this.value.clone())}}let Df=0;class Nf extends Wr{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:Df++}),this.name="",this.usage=mr,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const t=this.uniforms.indexOf(e);return-1!==t&&this.uniforms.splice(t,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){this.dispatchEvent({type:"dispose"})}copy(e){this.name=e.name,this.usage=e.usage;const t=e.uniforms;this.uniforms.length=0;for(let n=0,i=t.length;n<i;n++){const e=Array.isArray(t[n])?t[n]:[t[n]];for(let t=0;t<e.length;t++)this.uniforms.push(e[t].clone())}return this}clone(){return(new this.constructor).copy(this)}}class Of extends ll{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}class Ff{constructor(e,t,n,i,r){let s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=i,this.count=r,this.normalized=s,this.version=0}set needsUpdate(e){!0===e&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}const Uf=new ra;class Bf{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;this.ray=new ia(e,t),this.near=n,this.far=i,this.camera=null,this.layers=new ma,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):Vr("Raycaster: Unsupported camera type: "+t.type)}setFromXRController(e){return Uf.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(Uf),this}intersectObject(e){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return jf(e,this,t,!(arguments.length>1&&void 0!==arguments[1])||arguments[1]),t.sort(zf),t}intersectObjects(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];for(let i=0,r=e.length;i<r;i++)jf(e[i],this,n,t);return n.sort(zf),n}}function zf(e,t){return e.distance-t.distance}function jf(e,t,n,i){let r=!0;if(e.layers.test(t.layers)){!1===e.raycast(t,n)&&(r=!1)}if(!0===r&&!0===i){const i=e.children;for(let e=0,r=i.length;e<r;e++)jf(i[e],t,n,!0)}}class Gf{constructor(){this._previousTime=0,this._currentTime=0,this._startTime=performance.now(),this._delta=0,this._elapsed=0,this._timescale=1,this._document=null,this._pageVisibilityHandler=null}connect(e){this._document=e,void 0!==e.hidden&&(this._pageVisibilityHandler=Vf.bind(this),e.addEventListener("visibilitychange",this._pageVisibilityHandler,!1))}disconnect(){null!==this._pageVisibilityHandler&&(this._document.removeEventListener("visibilitychange",this._pageVisibilityHandler),this._pageVisibilityHandler=null),this._document=null}getDelta(){return this._delta/1e3}getElapsed(){return this._elapsed/1e3}getTimescale(){return this._timescale}setTimescale(e){return this._timescale=e,this}reset(){return this._currentTime=performance.now()-this._startTime,this}dispose(){this.disconnect()}update(e){return null!==this._pageVisibilityHandler&&!0===this._document.hidden?this._delta=0:(this._previousTime=this._currentTime,this._currentTime=(void 0!==e?e:performance.now())-this._startTime,this._delta=(this._currentTime-this._previousTime)*this._timescale,this._elapsed+=this._delta),this}}function Vf(){!1===this._document.hidden&&this.reset()}class Hf{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=e,this.phi=t,this.theta=n}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){const e=1e-6;return this.phi=Jr(this.phi,e,Math.PI-e),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(Jr(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}class Wf{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=e,this.theta=t,this.y=n}set(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}clone(){return(new this.constructor).copy(this)}}class Yf{constructor(e,t,n,i){Yf.prototype.isMatrix2=!0,this.elements=[1,0,0,1],void 0!==e&&this.set(e,t,n,i)}identity(){return this.set(1,0,0,1),this}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let n=0;n<4;n++)this.elements[n]=e[n+t];return this}set(e,t,n,i){const r=this.elements;return r[0]=e,r[2]=t,r[1]=n,r[3]=i,this}}const Xf=new is;class qf{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new is(1/0,1/0),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new is(-1/0,-1/0);this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=Xf.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Xf).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Kf=new ss,Zf=new ss,Jf=new ss,Qf=new ss,$f=new ss,ep=new ss,tp=new ss;class np{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ss,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ss;this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){Kf.subVectors(e,this.start),Zf.subVectors(this.end,this.start);const n=Zf.dot(Zf);let i=Zf.dot(Kf)/n;return t&&(i=Jr(i,0,1)),i}closestPointToPoint(e,t,n){const i=this.closestPointToPointParameter(e,t);return this.delta(n).multiplyScalar(i).add(this.start)}distanceSqToLine3(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ep,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:tp;const i=1e-8*1e-8;let r,s;const a=this.start,o=e.start,l=this.end,c=e.end;Jf.subVectors(l,a),Qf.subVectors(c,o),$f.subVectors(a,o);const u=Jf.dot(Jf),h=Qf.dot(Qf),d=Qf.dot($f);if(u<=i&&h<=i)return t.copy(a),n.copy(o),t.sub(n),t.dot(t);if(u<=i)r=0,s=d/h,s=Jr(s,0,1);else{const e=Jf.dot($f);if(h<=i)s=0,r=Jr(-e/u,0,1);else{const t=Jf.dot(Qf),n=u*h-t*t;r=0!==n?Jr((t*d-e*h)/n,0,1):0,s=(t*r+d)/h,s<0?(s=0,r=Jr(-e/u,0,1)):s>1&&(s=1,r=Jr((t-e)/u,0,1))}}return t.copy(a).add(Jf.multiplyScalar(r)),n.copy(o).add(Qf.multiplyScalar(s)),t.sub(n),t.dot(t)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}const ip=new ss;class rp extends Ia{constructor(e,t){super(),this.light=e,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";const n=new Mo,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let s=0,a=1,o=32;s<o;s++,a++){const e=s/o*Math.PI*2,t=a/o*Math.PI*2;i.push(Math.cos(e),Math.sin(e),1,Math.cos(t),Math.sin(t),1)}n.setAttribute("position",new bo(i,3));const r=new Lc({fog:!1,toneMapped:!1});this.cone=new Gc(n,r),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),ip.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(ip),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const sp=new ss,ap=new ra,op=new ra;class lp extends Gc{constructor(e){const t=cp(e),n=new Mo,i=[],r=[];for(let o=0;o<t.length;o++){const e=t[o];e.parent&&e.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),r.push(0,0,0),r.push(0,0,0))}n.setAttribute("position",new bo(i,3)),n.setAttribute("color",new bo(r,3));super(n,new Lc({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1;const s=new Za(255),a=new Za(65280);this.setColors(s,a)}updateMatrixWorld(e){const t=this.bones,n=this.geometry,i=n.getAttribute("position");op.copy(this.root.matrixWorld).invert();for(let r=0,s=0;r<t.length;r++){const e=t[r];e.parent&&e.parent.isBone&&(ap.multiplyMatrices(op,e.matrixWorld),sp.setFromMatrixPosition(ap),i.setXYZ(s,sp.x,sp.y,sp.z),ap.multiplyMatrices(op,e.parent.matrixWorld),sp.setFromMatrixPosition(ap),i.setXYZ(s+1,sp.x,sp.y,sp.z),s+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}setColors(e,t){const n=this.geometry.getAttribute("color");for(let i=0;i<n.count;i+=2)n.setXYZ(i,e.r,e.g,e.b),n.setXYZ(i+1,t.r,t.g,t.b);return n.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}function cp(e){const t=[];!0===e.isBone&&t.push(e);for(let n=0;n<e.children.length;n++)t.push(...cp(e.children[n]));return t}class up extends Bo{constructor(e,t,n){super(new wh(t,4,2),new eo({wireframe:!0,fog:!1,toneMapped:!1})),this.light=e,this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const hp=new ss,dp=new Za,fp=new Za;class pp extends Ia{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="HemisphereLightHelper";const i=new _h(t);i.rotateY(.5*Math.PI),this.material=new eo({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const r=i.getAttribute("position"),s=new Float32Array(3*r.count);i.setAttribute("color",new co(s,3)),this.add(new Bo(i,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");dp.copy(this.light.color),fp.copy(this.light.groundColor);for(let e=0,n=t.count;e<n;e++){const i=e<n/2?dp:fp;t.setXYZ(e,i.r,i.g,i.b)}t.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(hp.setFromMatrixPosition(this.light.matrixWorld).negate())}}class mp extends Gc{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4473924,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8947848;n=new Za(n),i=new Za(i);const r=t/2,s=e/t,a=e/2,o=[],l=[];for(let u=0,h=0,d=-a;u<=t;u++,d+=s){o.push(-a,0,d,a,0,d),o.push(d,0,-a,d,0,a);const e=u===r?n:i;e.toArray(l,h),h+=3,e.toArray(l,h),h+=3,e.toArray(l,h),h+=3,e.toArray(l,h),h+=3}const c=new Mo;c.setAttribute("position",new bo(o,3)),c.setAttribute("color",new bo(l,3));super(c,new Lc({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class gp extends Gc{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:64,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4473924,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:8947848;r=new Za(r),s=new Za(s);const a=[],o=[];if(t>1)for(let c=0;c<t;c++){const n=c/t*(2*Math.PI),i=Math.sin(n)*e,l=Math.cos(n)*e;a.push(0,0,0),a.push(i,0,l);const u=1&c?r:s;o.push(u.r,u.g,u.b),o.push(u.r,u.g,u.b)}for(let c=0;c<n;c++){const t=1&c?r:s,l=e-e/n*c;for(let e=0;e<i;e++){let n=e/i*(2*Math.PI),r=Math.sin(n)*l,s=Math.cos(n)*l;a.push(r,0,s),o.push(t.r,t.g,t.b),n=(e+1)/i*(2*Math.PI),r=Math.sin(n)*l,s=Math.cos(n)*l,a.push(r,0,s),o.push(t.r,t.g,t.b)}}const l=new Mo;l.setAttribute("position",new bo(a,3)),l.setAttribute("color",new bo(o,3));super(l,new Lc({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const vp=new ss,yp=new ss,bp=new ss;class xp extends Ia{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="DirectionalLightHelper",void 0===t&&(t=1);let i=new Mo;i.setAttribute("position",new bo([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const r=new Lc({fog:!1,toneMapped:!1});this.lightPlane=new Uc(i,r),this.add(this.lightPlane),i=new Mo,i.setAttribute("position",new bo([0,0,0,0,0,1],3)),this.targetLine=new Uc(i,r),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),vp.setFromMatrixPosition(this.light.matrixWorld),yp.setFromMatrixPosition(this.light.target.matrixWorld),bp.subVectors(yp,vp),this.lightPlane.lookAt(yp),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(yp),this.targetLine.scale.z=bp.length()}}const _p=new ss,Sp=new Xo;class Ep extends Gc{constructor(e){const t=new Mo,n=new Lc({color:16777215,vertexColors:!0,toneMapped:!1}),i=[],r=[],s={};function a(e,t){o(e),o(t)}function o(e){i.push(0,0,0),r.push(0,0,0),void 0===s[e]&&(s[e]=[]),s[e].push(i.length/3-1)}a("n1","n2"),a("n2","n4"),a("n4","n3"),a("n3","n1"),a("f1","f2"),a("f2","f4"),a("f4","f3"),a("f3","f1"),a("n1","f1"),a("n2","f2"),a("n3","f3"),a("n4","f4"),a("p","n1"),a("p","n2"),a("p","n3"),a("p","n4"),a("u1","u2"),a("u2","u3"),a("u3","u1"),a("c","t"),a("p","c"),a("cn1","cn2"),a("cn3","cn4"),a("cf1","cf2"),a("cf3","cf4"),t.setAttribute("position",new bo(i,3)),t.setAttribute("color",new bo(r,3)),super(t,n),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update();const l=new Za(16755200),c=new Za(16711680),u=new Za(43775),h=new Za(16777215),d=new Za(3355443);this.setColors(l,c,u,h,d)}setColors(e,t,n,i,r){const s=this.geometry.getAttribute("color");return s.setXYZ(0,e.r,e.g,e.b),s.setXYZ(1,e.r,e.g,e.b),s.setXYZ(2,e.r,e.g,e.b),s.setXYZ(3,e.r,e.g,e.b),s.setXYZ(4,e.r,e.g,e.b),s.setXYZ(5,e.r,e.g,e.b),s.setXYZ(6,e.r,e.g,e.b),s.setXYZ(7,e.r,e.g,e.b),s.setXYZ(8,e.r,e.g,e.b),s.setXYZ(9,e.r,e.g,e.b),s.setXYZ(10,e.r,e.g,e.b),s.setXYZ(11,e.r,e.g,e.b),s.setXYZ(12,e.r,e.g,e.b),s.setXYZ(13,e.r,e.g,e.b),s.setXYZ(14,e.r,e.g,e.b),s.setXYZ(15,e.r,e.g,e.b),s.setXYZ(16,e.r,e.g,e.b),s.setXYZ(17,e.r,e.g,e.b),s.setXYZ(18,e.r,e.g,e.b),s.setXYZ(19,e.r,e.g,e.b),s.setXYZ(20,e.r,e.g,e.b),s.setXYZ(21,e.r,e.g,e.b),s.setXYZ(22,e.r,e.g,e.b),s.setXYZ(23,e.r,e.g,e.b),s.setXYZ(24,t.r,t.g,t.b),s.setXYZ(25,t.r,t.g,t.b),s.setXYZ(26,t.r,t.g,t.b),s.setXYZ(27,t.r,t.g,t.b),s.setXYZ(28,t.r,t.g,t.b),s.setXYZ(29,t.r,t.g,t.b),s.setXYZ(30,t.r,t.g,t.b),s.setXYZ(31,t.r,t.g,t.b),s.setXYZ(32,n.r,n.g,n.b),s.setXYZ(33,n.r,n.g,n.b),s.setXYZ(34,n.r,n.g,n.b),s.setXYZ(35,n.r,n.g,n.b),s.setXYZ(36,n.r,n.g,n.b),s.setXYZ(37,n.r,n.g,n.b),s.setXYZ(38,i.r,i.g,i.b),s.setXYZ(39,i.r,i.g,i.b),s.setXYZ(40,r.r,r.g,r.b),s.setXYZ(41,r.r,r.g,r.b),s.setXYZ(42,r.r,r.g,r.b),s.setXYZ(43,r.r,r.g,r.b),s.setXYZ(44,r.r,r.g,r.b),s.setXYZ(45,r.r,r.g,r.b),s.setXYZ(46,r.r,r.g,r.b),s.setXYZ(47,r.r,r.g,r.b),s.setXYZ(48,r.r,r.g,r.b),s.setXYZ(49,r.r,r.g,r.b),s.needsUpdate=!0,this}update(){const e=this.geometry,t=this.pointMap;let n,i;if(Sp.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),!0===this.camera.reversedDepth)n=1,i=0;else if(this.camera.coordinateSystem===Ar)n=-1,i=1;else{if(this.camera.coordinateSystem!==Mr)throw new Error("THREE.CameraHelper.update(): Invalid coordinate system: "+this.camera.coordinateSystem);n=0,i=1}Tp("c",t,e,Sp,0,0,n),Tp("t",t,e,Sp,0,0,i),Tp("n1",t,e,Sp,-1,-1,n),Tp("n2",t,e,Sp,1,-1,n),Tp("n3",t,e,Sp,-1,1,n),Tp("n4",t,e,Sp,1,1,n),Tp("f1",t,e,Sp,-1,-1,i),Tp("f2",t,e,Sp,1,-1,i),Tp("f3",t,e,Sp,-1,1,i),Tp("f4",t,e,Sp,1,1,i),Tp("u1",t,e,Sp,.7,1.1,n),Tp("u2",t,e,Sp,-.7,1.1,n),Tp("u3",t,e,Sp,0,2,n),Tp("cf1",t,e,Sp,-1,0,i),Tp("cf2",t,e,Sp,1,0,i),Tp("cf3",t,e,Sp,0,-1,i),Tp("cf4",t,e,Sp,0,1,i),Tp("cn1",t,e,Sp,-1,0,n),Tp("cn2",t,e,Sp,1,0,n),Tp("cn3",t,e,Sp,0,-1,n),Tp("cn4",t,e,Sp,0,1,n),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function Tp(e,t,n,i,r,s,a){_p.set(r,s,a).unproject(i);const o=t[e];if(void 0!==o){const e=n.getAttribute("position");for(let t=0,n=o.length;t<n;t++)e.setXYZ(o[t],_p.x,_p.y,_p.z)}}const wp=new Is;class Ap extends Gc{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16776960;const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(24),r=new Mo;r.setIndex(new co(n,1)),r.setAttribute("position",new co(i,3)),super(r,new Lc({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(){if(void 0!==this.object&&wp.setFromObject(this.object),wp.isEmpty())return;const e=wp.min,t=wp.max,n=this.geometry.attributes.position,i=n.array;i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=e.x,i[4]=t.y,i[5]=t.z,i[6]=e.x,i[7]=e.y,i[8]=t.z,i[9]=t.x,i[10]=e.y,i[11]=t.z,i[12]=t.x,i[13]=t.y,i[14]=e.z,i[15]=e.x,i[16]=t.y,i[17]=e.z,i[18]=e.x,i[19]=e.y,i[20]=e.z,i[21]=t.x,i[22]=e.y,i[23]=e.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Mp extends Gc{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16776960;const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Mo;i.setIndex(new co(n,1)),i.setAttribute("position",new bo([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(i,new Lc({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class Rp extends Uc{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16776960,i=new Mo;i.setAttribute("position",new bo([1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),i.computeBoundingSphere(),super(i,new Lc({color:n,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const r=new Mo;r.setAttribute("position",new bo([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),r.computeBoundingSphere(),this.add(new Bo(r,new eo({color:n,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const Cp=new ss;let Lp,Ip;class Pp extends Ia{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ss(0,0,1),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ss(0,0,0),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16776960,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.2*n,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.2*r;super(),this.type="ArrowHelper",void 0===Lp&&(Lp=new Mo,Lp.setAttribute("position",new bo([0,0,0,0,1,0],3)),Ip=new uu(.5,1,5,1),Ip.translate(0,-.5,0)),this.position.copy(t),this.line=new Uc(Lp,new Lc({color:i,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Bo(Ip,new eo({color:i,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,r,s)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{Cp.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(Cp,t)}}setLength(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2*e,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.2*t;this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class kp extends Gc{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=new Mo;n.setAttribute("position",new bo(t,3)),n.setAttribute("color",new bo([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));super(n,new Lc({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(e,t,n){const i=new Za,r=this.geometry.attributes.color.array;return i.set(e),i.toArray(r,0),i.toArray(r,3),i.set(t),i.toArray(r,6),i.toArray(r,9),i.set(n),i.toArray(r,12),i.toArray(r,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Dp{constructor(){this.type="ShapePath",this.color=new Za,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new Bu,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,n,i){return this.currentPath.quadraticCurveTo(e,t,n,i),this}bezierCurveTo(e,t,n,i,r,s){return this.currentPath.bezierCurveTo(e,t,n,i,r,s),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(e,t){const n=t.length;let i=!1;for(let r=n-1,s=0;s<n;r=s++){let n=t[r],a=t[s],o=a.x-n.x,l=a.y-n.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(n=t[s],o=-o,a=t[r],l=-l),e.y<n.y||e.y>a.y)continue;if(e.y===n.y){if(e.x===n.x)return!0}else{const t=l*(e.x-n.x)-o*(e.y-n.y);if(0===t)return!0;if(t<0)continue;i=!i}}else{if(e.y!==n.y)continue;if(a.x<=e.x&&e.x<=n.x||n.x<=e.x&&e.x<=a.x)return!0}}return i}const n=ph.isClockWise,i=this.subPaths;if(0===i.length)return[];let r,s,a;const o=[];if(1===i.length)return s=i[0],a=new zu,a.curves=s.curves,o.push(a),o;let l=!n(i[0].getPoints());l=e?!l:l;const c=[],u=[];let h,d,f=[],p=0;u[p]=void 0,f[p]=[];for(let m=0,g=i.length;m<g;m++)s=i[m],h=s.getPoints(),r=n(h),r=e?!r:r,r?(!l&&u[p]&&p++,u[p]={s:new zu,p:h},u[p].s.curves=s.curves,l&&p++,f[p]=[]):f[p].push({h:s,p:h[0]});if(!u[0])return function(e){const t=[];for(let n=0,i=e.length;n<i;n++){const i=e[n],r=new zu;r.curves=i.curves,t.push(r)}return t}(i);if(u.length>1){let e=!1,n=0;for(let t=0,i=u.length;t<i;t++)c[t]=[];for(let i=0,r=u.length;i<r;i++){const r=f[i];for(let s=0;s<r.length;s++){const a=r[s];let o=!0;for(let r=0;r<u.length;r++)t(a.p,u[r].p)&&(i!==r&&n++,o?(o=!1,c[r].push(a)):e=!0);o&&c[i].push(a)}}n>0&&!1===e&&(f=c)}for(let m=0,g=u.length;m<g;m++){a=u[m].s,o.push(a),d=f[m];for(let e=0,t=d.length;e<t;e++)a.holes.push(d[e].h)}return o}}class Np extends Wr{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(),this.object=e,this.domElement=t,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(e){void 0!==e?(null!==this.domElement&&this.disconnect(),this.domElement=e):Gr("Controls: connect() now requires an element.")}disconnect(){}dispose(){}update(){}}function Op(e,t,n,i){const r=function(e){switch(e){case hn:case dn:return{byteLength:1,components:1};case pn:case fn:case yn:return{byteLength:2,components:1};case bn:case xn:return{byteLength:2,components:4};case gn:case mn:case vn:return{byteLength:4,components:1};case Sn:case En:return{byteLength:4,components:3}}throw new Error("Unknown texture type ".concat(e,"."))}(i);switch(n){case Tn:return e*t;case Cn:case Ln:return e*t/r.components*r.byteLength;case In:case Pn:return e*t*2/r.components*r.byteLength;case wn:return e*t*3/r.components*r.byteLength;case An:case Dn:return e*t*4/r.components*r.byteLength;case Nn:case On:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*8;case Fn:case Un:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*16;case zn:case Gn:return Math.max(e,16)*Math.max(t,8)/4;case Bn:case jn:return Math.max(e,8)*Math.max(t,8)/2;case Vn:case Hn:case Yn:case Xn:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*8;case Wn:case qn:case Kn:case Zn:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*16;case Jn:return Math.floor((e+4)/5)*Math.floor((t+3)/4)*16;case Qn:return Math.floor((e+4)/5)*Math.floor((t+4)/5)*16;case $n:return Math.floor((e+5)/6)*Math.floor((t+4)/5)*16;case ei:return Math.floor((e+5)/6)*Math.floor((t+5)/6)*16;case ti:return Math.floor((e+7)/8)*Math.floor((t+4)/5)*16;case ni:return Math.floor((e+7)/8)*Math.floor((t+5)/6)*16;case ii:return Math.floor((e+7)/8)*Math.floor((t+7)/8)*16;case ri:return Math.floor((e+9)/10)*Math.floor((t+4)/5)*16;case si:return Math.floor((e+9)/10)*Math.floor((t+5)/6)*16;case ai:return Math.floor((e+9)/10)*Math.floor((t+7)/8)*16;case oi:return Math.floor((e+9)/10)*Math.floor((t+9)/10)*16;case li:return Math.floor((e+11)/12)*Math.floor((t+9)/10)*16;case ci:return Math.floor((e+11)/12)*Math.floor((t+11)/12)*16;case ui:case hi:case di:return Math.ceil(e/4)*Math.ceil(t/4)*16;case fi:case pi:return Math.ceil(e/4)*Math.ceil(t/4)*8;case mi:case gi:return Math.ceil(e/4)*Math.ceil(t/4)*16}throw new Error("Unable to determine texture byte length for ".concat(n," format."))}class Fp{static contain(e,t){return function(e,t){const n=e.image&&e.image.width?e.image.width/e.image.height:1;return n>t?(e.repeat.x=1,e.repeat.y=n/t,e.offset.x=0,e.offset.y=(1-e.repeat.y)/2):(e.repeat.x=t/n,e.repeat.y=1,e.offset.x=(1-e.repeat.x)/2,e.offset.y=0),e}(e,t)}static cover(e,t){return function(e,t){const n=e.image&&e.image.width?e.image.width/e.image.height:1;return n>t?(e.repeat.x=t/n,e.repeat.y=1,e.offset.x=(1-e.repeat.x)/2,e.offset.y=0):(e.repeat.x=1,e.repeat.y=n/t,e.offset.x=0,e.offset.y=(1-e.repeat.y)/2),e}(e,t)}static fill(e){return function(e){return e.repeat.x=1,e.repeat.y=1,e.offset.x=0,e.offset.y=0,e}(e)}static getByteLength(e,t,n,i){return Op(e,t,n,i)}}function Up(){let e=null,t=!1,n=null,i=null;function r(t,s){n(t,s),i=e.requestAnimationFrame(r)}return{start:function(){!0!==t&&null!==n&&(i=e.requestAnimationFrame(r),t=!0)},stop:function(){e.cancelAnimationFrame(i),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function Bp(e){const t=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),t.get(e)},remove:function(n){n.isInterleavedBufferAttribute&&(n=n.data);const i=t.get(n);i&&(e.deleteBuffer(i.buffer),t.delete(n))},update:function(n,i){if(n.isInterleavedBufferAttribute&&(n=n.data),n.isGLBufferAttribute){const e=t.get(n);return void((!e||e.version<n.version)&&t.set(n,{buffer:n.buffer,type:n.type,bytesPerElement:n.elementSize,version:n.version}))}const r=t.get(n);if(void 0===r)t.set(n,function(t,n){const i=t.array,r=t.usage,s=i.byteLength,a=e.createBuffer();let o;if(e.bindBuffer(n,a),e.bufferData(n,i,r),t.onUploadCallback(),i instanceof Float32Array)o=e.FLOAT;else if("undefined"!==typeof Float16Array&&i instanceof Float16Array)o=e.HALF_FLOAT;else if(i instanceof Uint16Array)o=t.isFloat16BufferAttribute?e.HALF_FLOAT:e.UNSIGNED_SHORT;else if(i instanceof Int16Array)o=e.SHORT;else if(i instanceof Uint32Array)o=e.UNSIGNED_INT;else if(i instanceof Int32Array)o=e.INT;else if(i instanceof Int8Array)o=e.BYTE;else if(i instanceof Uint8Array)o=e.UNSIGNED_BYTE;else{if(!(i instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+i);o=e.UNSIGNED_BYTE}return{buffer:a,type:o,bytesPerElement:i.BYTES_PER_ELEMENT,version:t.version,size:s}}(n,i));else if(r.version<n.version){if(r.size!==n.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");!function(t,n,i){const r=n.array,s=n.updateRanges;if(e.bindBuffer(i,t),0===s.length)e.bufferSubData(i,0,r);else{s.sort((e,t)=>e.start-t.start);let t=0;for(let e=1;e<s.length;e++){const n=s[t],i=s[e];i.start<=n.start+n.count+1?n.count=Math.max(n.count,i.start+i.count-n.start):(++t,s[t]=i)}s.length=t+1;for(let n=0,a=s.length;n<a;n++){const t=s[n];e.bufferSubData(i,t.start*r.BYTES_PER_ELEMENT,r,t.start,t.count)}n.clearUpdateRanges()}n.onUploadCallback()}(r.buffer,n,i),r.version=n.version}}}}"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Ue}})),"undefined"!==typeof window&&(window.__THREE__?Gr("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Ue);const zp={alphahash_fragment:"#ifdef USE_ALPHAHASH\n\tif ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",alphahash_pars_fragment:"#ifdef USE_ALPHAHASH\n\tconst float ALPHA_HASH_SCALE = 0.05;\n\tfloat hash2D( vec2 value ) {\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\t}\n\tfloat hash3D( vec3 value ) {\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\t}\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\t\tfloat maxDeriv = max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\t\tvec2 pixScales = vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\t\tvec2 alpha = vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\t\tfloat lerpFactor = fract( log2( pixScale ) );\n\t\tfloat x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\t\tfloat a = min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases = vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\t\tfloat threshold = ( x < ( 1.0 - a ) )\n\t\t\t? ( ( x < a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\t}\n#endif",alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\t#ifdef ALPHA_TO_COVERAGE\n\tdiffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );\n\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\tif ( diffuseColor.a < alphaTest ) discard;\n\t#endif\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_CLEARCOAT ) \n\t\tclearcoatSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_SHEEN ) \n\t\tsheenSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometryNormal, geometryViewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",batching_pars_vertex:"#ifdef USE_BATCHING\n\t#if ! defined( GL_ANGLE_multi_draw )\n\t#define gl_DrawID _gl_DrawID\n\tuniform int _gl_DrawID;\n\t#endif\n\tuniform highp sampler2D batchingTexture;\n\tuniform highp usampler2D batchingIdTexture;\n\tmat4 getBatchingMatrix( const in float i ) {\n\t\tint size = textureSize( batchingTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n\tfloat getIndirectIndex( const in int i ) {\n\t\tint size = textureSize( batchingIdTexture, 0 ).x;\n\t\tint x = i % size;\n\t\tint y = i / size;\n\t\treturn float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );\n\t}\n#endif\n#ifdef USE_BATCHING_COLOR\n\tuniform sampler2D batchingColorTexture;\n\tvec3 getBatchingColor( const in float i ) {\n\t\tint size = textureSize( batchingColorTexture, 0 ).x;\n\t\tint j = int( i );\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\treturn texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;\n\t}\n#endif",batching_vertex:"#ifdef USE_BATCHING\n\tmat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );\n#endif",begin_vertex:"vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n\tvPosition = vec3( position );\n#endif",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\treturn vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );\n\t\tvec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#ifdef ALPHA_TO_COVERAGE\n\t\tfloat distanceToPlane, distanceGradient;\n\t\tfloat clipOpacity = 1.0;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\tclipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\tif ( clipOpacity == 0.0 ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tfloat unionClipOpacity = 1.0;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\t\tunionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tclipOpacity *= 1.0 - unionClipOpacity;\n\t\t#endif\n\t\tdiffuseColor.a *= clipOpacity;\n\t\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tbool clipped = true;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tif ( clipped ) discard;\n\t\t#endif\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif\n#ifdef USE_BATCHING_COLOR\n\tvec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );\n\tvColor.xyz *= batchingColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n#ifdef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = objectTangent;\n#endif\n#ifdef USE_BATCHING\n\tmat3 bm = mat3( batchingMatrix );\n\ttransformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );\n\ttransformedNormal = bm * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = bm * transformedTangent;\n\t#endif\n#endif\n#ifdef USE_INSTANCING\n\tmat3 im = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );\n\ttransformedNormal = im * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = im * transformedTangent;\n\t#endif\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\ttransformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE\n\t\temissiveColor = sRGBTransferEOTF( emissiveColor );\n\t#endif\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:"vec4 LinearTransferOETF( in vec4 value ) {\n\treturn value;\n}\nvec4 sRGBTransferEOTF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 sRGBTransferOETF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform mat3 envMapRotation;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, pow4( roughness ) ) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n#if defined( USE_LIGHT_PROBES )\n\tuniform vec3 lightProbe[ 9 ];\n#endif\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif ( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.diffuseContribution = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.metalness = metalnessFactor;\nvec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor;\n\tmaterial.specularColorBlended = mix( material.specularColor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = vec3( 0.04 );\n\tmaterial.specularColorBlended = mix( material.specularColor, diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_DISPERSION\n\tmaterial.dispersion = dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.0001, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tif( material.anisotropy == 0.0 ) {\n\t\tanisotropyV = vec2( 1.0, 0.0 );\n\t} else {\n\t\tanisotropyV /= material.anisotropy;\n\t\tmaterial.anisotropy = saturate( material.anisotropy );\n\t}\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment:"uniform sampler2D dfgLUT;\nstruct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tvec3 diffuseContribution;\n\tvec3 specularColor;\n\tvec3 specularColorBlended;\n\tfloat roughness;\n\tfloat metalness;\n\tfloat specularF90;\n\tfloat dispersion;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t\tvec3 iridescenceFresnelDielectric;\n\t\tvec3 iridescenceFresnelMetallic;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecularDirect = vec3( 0.0 );\nvec3 clearcoatSpecularIndirect = vec3( 0.0 );\nvec3 sheenSpecularDirect = vec3( 0.0 );\nvec3 sheenSpecularIndirect = vec3(0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn v;\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColorBlended;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transpose( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat rInv = 1.0 / ( roughness + 0.1 );\n\tfloat a = -1.9362 + 1.0678 * roughness + 0.4573 * r2 - 0.8469 * rInv;\n\tfloat b = -0.6014 + 0.5538 * roughness - 0.4670 * r2 - 0.1255 * rInv;\n\tfloat DG = exp( a * dotNV + b );\n\treturn saturate( DG );\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 fab = texture2D( dfgLUT, vec2( roughness, dotNV ) ).rg;\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 fab = texture2D( dfgLUT, vec2( roughness, dotNV ) ).rg;\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nvec3 BRDF_GGX_Multiscatter( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 singleScatter = BRDF_GGX( lightDir, viewDir, normal, material );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 dfgV = texture2D( dfgLUT, vec2( material.roughness, dotNV ) ).rg;\n\tvec2 dfgL = texture2D( dfgLUT, vec2( material.roughness, dotNL ) ).rg;\n\tvec3 FssEss_V = material.specularColorBlended * dfgV.x + material.specularF90 * dfgV.y;\n\tvec3 FssEss_L = material.specularColorBlended * dfgL.x + material.specularF90 * dfgL.y;\n\tfloat Ess_V = dfgV.x + dfgV.y;\n\tfloat Ess_L = dfgL.x + dfgL.y;\n\tfloat Ems_V = 1.0 - Ess_V;\n\tfloat Ems_L = 1.0 - Ess_L;\n\tvec3 Favg = material.specularColorBlended + ( 1.0 - material.specularColorBlended ) * 0.047619;\n\tvec3 Fms = FssEss_V * FssEss_L * Favg / ( 1.0 - Ems_V * Ems_L * Favg + EPSILON );\n\tfloat compensationFactor = Ems_V * Ems_L;\n\tvec3 multiScatter = Fms * compensationFactor;\n\treturn singleScatter + multiScatter;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometryNormal;\n\t\tvec3 viewDir = geometryViewDir;\n\t\tvec3 position = geometryPosition;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColorBlended * t2.x + ( vec3( 1.0 ) - material.specularColorBlended ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseContribution * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n \n \t\tsheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n \n \t\tfloat sheenAlbedoV = IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n \t\tfloat sheenAlbedoL = IBLSheenBRDF( geometryNormal, directLight.direction, material.sheenRoughness );\n \n \t\tfloat sheenEnergyComp = 1.0 - max3( material.sheenColor ) * max( sheenAlbedoV, sheenAlbedoL );\n \n \t\tirradiance *= sheenEnergyComp;\n \n \t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX_Multiscatter( directLight.direction, geometryViewDir, geometryNormal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseContribution );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 diffuse = irradiance * BRDF_Lambert( material.diffuseContribution );\n\t#ifdef USE_SHEEN\n\t\tfloat sheenAlbedo = IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n\t\tfloat sheenEnergyComp = 1.0 - max3( material.sheenColor ) * sheenAlbedo;\n\t\tdiffuse *= sheenEnergyComp;\n\t#endif\n\treflectedLight.indirectDiffuse += diffuse;\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness ) * RECIPROCAL_PI;\n \t#endif\n\tvec3 singleScatteringDielectric = vec3( 0.0 );\n\tvec3 multiScatteringDielectric = vec3( 0.0 );\n\tvec3 singleScatteringMetallic = vec3( 0.0 );\n\tvec3 multiScatteringMetallic = vec3( 0.0 );\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnelDielectric, material.roughness, singleScatteringDielectric, multiScatteringDielectric );\n\t\tcomputeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.diffuseColor, material.specularF90, material.iridescence, material.iridescenceFresnelMetallic, material.roughness, singleScatteringMetallic, multiScatteringMetallic );\n\t#else\n\t\tcomputeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScatteringDielectric, multiScatteringDielectric );\n\t\tcomputeMultiscattering( geometryNormal, geometryViewDir, material.diffuseColor, material.specularF90, material.roughness, singleScatteringMetallic, multiScatteringMetallic );\n\t#endif\n\tvec3 singleScattering = mix( singleScatteringDielectric, singleScatteringMetallic, material.metalness );\n\tvec3 multiScattering = mix( multiScatteringDielectric, multiScatteringMetallic, material.metalness );\n\tvec3 totalScatteringDielectric = singleScatteringDielectric + multiScatteringDielectric;\n\tvec3 diffuse = material.diffuseContribution * ( 1.0 - totalScatteringDielectric );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tvec3 indirectSpecular = radiance * singleScattering;\n\tindirectSpecular += multiScattering * cosineWeightedIrradiance;\n\tvec3 indirectDiffuse = diffuse * cosineWeightedIrradiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenAlbedo = IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n\t\tfloat sheenEnergyComp = 1.0 - max3( material.sheenColor ) * sheenAlbedo;\n\t\tindirectSpecular *= sheenEnergyComp;\n\t\tindirectDiffuse *= sheenEnergyComp;\n\t#endif\n\treflectedLight.indirectSpecular += indirectSpecular;\n\treflectedLight.indirectDiffuse += indirectDiffuse;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nvec3 geometryPosition = - vViewPosition;\nvec3 geometryNormal = normal;\nvec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\nvec3 geometryClearcoatNormal = vec3( 0.0 );\n#ifdef USE_CLEARCOAT\n\tgeometryClearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometryViewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnelDielectric = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceFresnelMetallic = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.diffuseColor );\n\t\tmaterial.iridescenceFresnel = mix( material.iridescenceFresnelDielectric, material.iridescenceFresnelMetallic, material.metalness );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometryPosition, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS ) && ( defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_BASIC ) )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometryPosition, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if defined( USE_LIGHT_PROBES )\n\t\tirradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometryNormal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )\n\tgl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGARITHMIC_DEPTH_BUFFER\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGARITHMIC_DEPTH_BUFFER\n\tvFragDepth = 1.0 + gl_Position.w;\n\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphinstance_vertex:"#ifdef USE_INSTANCING_MORPH\n\tfloat morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\tfloat morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tmorphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;\n\t}\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_INSTANCING_MORPH\n\t\tuniform float morphTargetBaseInfluence;\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t#endif\n\tuniform sampler2DArray morphTargetsTexture;\n\tuniform ivec2 morphTargetsTextureSize;\n\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t}\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 nonPerturbedNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = nonPerturbedNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",opaque_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;\nconst float Inv255 = 1. / 255.;\nconst vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );\nconst vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );\nconst vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );\nconst vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );\nvec4 packDepthToRGBA( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec4( 0., 0., 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec4( 1., 1., 1., 1. );\n\tfloat vuf;\n\tfloat af = modf( v * PackFactors.a, vuf );\n\tfloat bf = modf( vuf * ShiftRight8, vuf );\n\tfloat gf = modf( vuf * ShiftRight8, vuf );\n\treturn vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );\n}\nvec3 packDepthToRGB( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec3( 0., 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec3( 1., 1., 1. );\n\tfloat vuf;\n\tfloat bf = modf( v * PackFactors.b, vuf );\n\tfloat gf = modf( vuf * ShiftRight8, vuf );\n\treturn vec3( vuf * Inv255, gf * PackUpscale, bf );\n}\nvec2 packDepthToRG( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec2( 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec2( 1., 1. );\n\tfloat vuf;\n\tfloat gf = modf( v * 256., vuf );\n\treturn vec2( vuf * Inv255, gf );\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors4 );\n}\nfloat unpackRGBToDepth( const in vec3 v ) {\n\treturn dot( v, UnpackFactors3 );\n}\nfloat unpackRGToDepth( const in vec2 v ) {\n\treturn v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;\n}\nvec4 pack2HalfToRGBA( const in vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( const in vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_BATCHING\n\tmvPosition = batchingMatrix * mvPosition;\n#endif\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tuniform sampler2DShadow directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\t#else\n\t\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\t#endif\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tuniform sampler2DShadow spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\t#else\n\t\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\t#endif\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tuniform samplerCubeShadow pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\t#elif defined( SHADOWMAP_TYPE_BASIC )\n\t\t\tuniform samplerCube pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\t#endif\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\tfloat interleavedGradientNoise( vec2 position ) {\n\t\t\treturn fract( 52.9829189 * fract( dot( position, vec2( 0.06711056, 0.00583715 ) ) ) );\n\t\t}\n\t\tvec2 vogelDiskSample( int sampleIndex, int samplesCount, float phi ) {\n\t\t\tconst float goldenAngle = 2.399963229728653;\n\t\t\tfloat r = sqrt( ( float( sampleIndex ) + 0.5 ) / float( samplesCount ) );\n\t\t\tfloat theta = float( sampleIndex ) * goldenAngle + phi;\n\t\t\treturn vec2( cos( theta ), sin( theta ) ) * r;\n\t\t}\n\t#endif\n\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\tfloat getShadow( sampler2DShadow shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\t\tfloat shadow = 1.0;\n\t\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\t\tshadowCoord.z += shadowBias;\n\t\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\t\tif ( frustumTest ) {\n\t\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\t\tfloat radius = shadowRadius * texelSize.x;\n\t\t\t\tfloat phi = interleavedGradientNoise( gl_FragCoord.xy ) * 6.28318530718;\n\t\t\t\tshadow = (\n\t\t\t\t\ttexture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 0, 5, phi ) * radius, shadowCoord.z ) ) +\n\t\t\t\t\ttexture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 1, 5, phi ) * radius, shadowCoord.z ) ) +\n\t\t\t\t\ttexture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 2, 5, phi ) * radius, shadowCoord.z ) ) +\n\t\t\t\t\ttexture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 3, 5, phi ) * radius, shadowCoord.z ) ) +\n\t\t\t\t\ttexture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 4, 5, phi ) * radius, shadowCoord.z ) )\n\t\t\t\t) * 0.2;\n\t\t\t}\n\t\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t\t}\n\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\t\tfloat shadow = 1.0;\n\t\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\t\tshadowCoord.z += shadowBias;\n\t\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\t\tif ( frustumTest ) {\n\t\t\t\tvec2 distribution = texture2D( shadowMap, shadowCoord.xy ).rg;\n\t\t\t\tfloat mean = distribution.x;\n\t\t\t\tfloat variance = distribution.y * distribution.y;\n\t\t\t\t#ifdef USE_REVERSED_DEPTH_BUFFER\n\t\t\t\t\tfloat hard_shadow = step( mean, shadowCoord.z );\n\t\t\t\t#else\n\t\t\t\t\tfloat hard_shadow = step( shadowCoord.z, mean );\n\t\t\t\t#endif\n\t\t\t\tif ( hard_shadow == 1.0 ) {\n\t\t\t\t\tshadow = 1.0;\n\t\t\t\t} else {\n\t\t\t\t\tvariance = max( variance, 0.0000001 );\n\t\t\t\t\tfloat d = shadowCoord.z - mean;\n\t\t\t\t\tfloat p_max = variance / ( variance + d * d );\n\t\t\t\t\tp_max = clamp( ( p_max - 0.3 ) / 0.65, 0.0, 1.0 );\n\t\t\t\t\tshadow = max( hard_shadow, p_max );\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t\t}\n\t#else\n\t\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\t\tfloat shadow = 1.0;\n\t\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\t\tshadowCoord.z += shadowBias;\n\t\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\t\tif ( frustumTest ) {\n\t\t\t\tfloat depth = texture2D( shadowMap, shadowCoord.xy ).r;\n\t\t\t\t#ifdef USE_REVERSED_DEPTH_BUFFER\n\t\t\t\t\tshadow = step( depth, shadowCoord.z );\n\t\t\t\t#else\n\t\t\t\t\tshadow = step( shadowCoord.z, depth );\n\t\t\t\t#endif\n\t\t\t}\n\t\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t\t}\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#if defined( SHADOWMAP_TYPE_PCF )\n\tfloat getPointShadow( samplerCubeShadow shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tfloat shadow = 1.0;\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\tvec3 absVec = abs( lightToPosition );\n\t\tfloat viewSpaceZ = max( max( absVec.x, absVec.y ), absVec.z );\n\t\tif ( viewSpaceZ - shadowCameraFar <= 0.0 && viewSpaceZ - shadowCameraNear >= 0.0 ) {\n\t\t\tfloat dp = ( shadowCameraFar * ( viewSpaceZ - shadowCameraNear ) ) / ( viewSpaceZ * ( shadowCameraFar - shadowCameraNear ) );\n\t\t\tdp += shadowBias;\n\t\t\tfloat texelSize = shadowRadius / shadowMapSize.x;\n\t\t\tvec3 absDir = abs( bd3D );\n\t\t\tvec3 tangent = absDir.x > absDir.z ? vec3( 0.0, 1.0, 0.0 ) : vec3( 1.0, 0.0, 0.0 );\n\t\t\ttangent = normalize( cross( bd3D, tangent ) );\n\t\t\tvec3 bitangent = cross( bd3D, tangent );\n\t\t\tfloat phi = interleavedGradientNoise( gl_FragCoord.xy ) * 6.28318530718;\n\t\t\tshadow = (\n\t\t\t\ttexture( shadowMap, vec4( bd3D + ( tangent * vogelDiskSample( 0, 5, phi ).x + bitangent * vogelDiskSample( 0, 5, phi ).y ) * texelSize, dp ) ) +\n\t\t\t\ttexture( shadowMap, vec4( bd3D + ( tangent * vogelDiskSample( 1, 5, phi ).x + bitangent * vogelDiskSample( 1, 5, phi ).y ) * texelSize, dp ) ) +\n\t\t\t\ttexture( shadowMap, vec4( bd3D + ( tangent * vogelDiskSample( 2, 5, phi ).x + bitangent * vogelDiskSample( 2, 5, phi ).y ) * texelSize, dp ) ) +\n\t\t\t\ttexture( shadowMap, vec4( bd3D + ( tangent * vogelDiskSample( 3, 5, phi ).x + bitangent * vogelDiskSample( 3, 5, phi ).y ) * texelSize, dp ) ) +\n\t\t\t\ttexture( shadowMap, vec4( bd3D + ( tangent * vogelDiskSample( 4, 5, phi ).x + bitangent * vogelDiskSample( 4, 5, phi ).y ) * texelSize, dp ) )\n\t\t\t) * 0.2;\n\t\t}\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t}\n\t#elif defined( SHADOWMAP_TYPE_BASIC )\n\tfloat getPointShadow( samplerCube shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tfloat shadow = 1.0;\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\tvec3 absVec = abs( lightToPosition );\n\t\tfloat viewSpaceZ = max( max( absVec.x, absVec.y ), absVec.z );\n\t\tif ( viewSpaceZ - shadowCameraFar <= 0.0 && viewSpaceZ - shadowCameraNear >= 0.0 ) {\n\t\t\tfloat dp = ( shadowCameraFar * ( viewSpaceZ - shadowCameraNear ) ) / ( viewSpaceZ * ( shadowCameraFar - shadowCameraNear ) );\n\t\t\tdp += shadowBias;\n\t\t\tfloat depth = textureCube( shadowMap, bd3D ).r;\n\t\t\t#ifdef USE_REVERSED_DEPTH_BUFFER\n\t\t\t\tshadow = step( depth, dp );\n\t\t\t#else\n\t\t\t\tshadow = step( dp, depth );\n\t\t\t#endif\n\t\t}\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t}\n\t#endif\n\t#endif\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0 && ( defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_BASIC ) )\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tint size = textureSize( boneTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 CineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nconst mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.6605, - 0.1246, - 0.0182 ),\n\tvec3( - 0.5876, 1.1329, - 0.1006 ),\n\tvec3( - 0.0728, - 0.0083, 1.1187 )\n);\nconst mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(\n\tvec3( 0.6274, 0.0691, 0.0164 ),\n\tvec3( 0.3293, 0.9195, 0.0880 ),\n\tvec3( 0.0433, 0.0113, 0.8956 )\n);\nvec3 agxDefaultContrastApprox( vec3 x ) {\n\tvec3 x2 = x * x;\n\tvec3 x4 = x2 * x2;\n\treturn + 15.5 * x4 * x2\n\t\t- 40.14 * x4 * x\n\t\t+ 31.96 * x4\n\t\t- 6.868 * x2 * x\n\t\t+ 0.4298 * x2\n\t\t+ 0.1191 * x\n\t\t- 0.00232;\n}\nvec3 AgXToneMapping( vec3 color ) {\n\tconst mat3 AgXInsetMatrix = mat3(\n\t\tvec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),\n\t\tvec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),\n\t\tvec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )\n\t);\n\tconst mat3 AgXOutsetMatrix = mat3(\n\t\tvec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),\n\t\tvec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),\n\t\tvec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )\n\t);\n\tconst float AgxMinEv = - 12.47393;\tconst float AgxMaxEv = 4.026069;\n\tcolor *= toneMappingExposure;\n\tcolor = LINEAR_SRGB_TO_LINEAR_REC2020 * color;\n\tcolor = AgXInsetMatrix * color;\n\tcolor = max( color, 1e-10 );\tcolor = log2( color );\n\tcolor = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );\n\tcolor = clamp( color, 0.0, 1.0 );\n\tcolor = agxDefaultContrastApprox( color );\n\tcolor = AgXOutsetMatrix * color;\n\tcolor = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );\n\tcolor = LINEAR_REC2020_TO_LINEAR_SRGB * color;\n\tcolor = clamp( color, 0.0, 1.0 );\n\treturn color;\n}\nvec3 NeutralToneMapping( vec3 color ) {\n\tconst float StartCompression = 0.8 - 0.04;\n\tconst float Desaturation = 0.15;\n\tcolor *= toneMappingExposure;\n\tfloat x = min( color.r, min( color.g, color.b ) );\n\tfloat offset = x < 0.08 ? x - 6.25 * x * x : 0.04;\n\tcolor -= offset;\n\tfloat peak = max( color.r, max( color.g, color.b ) );\n\tif ( peak < StartCompression ) return color;\n\tfloat d = 1. - StartCompression;\n\tfloat newPeak = 1. - d * d / ( peak + d - StartCompression );\n\tcolor *= newPeak / peak;\n\tfloat g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );\n\treturn mix( color, vec3( newPeak ), g );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseContribution, material.specularColorBlended, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec4 transmittedLight;\n\t\tvec3 transmittance;\n\t\t#ifdef USE_DISPERSION\n\t\t\tfloat halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;\n\t\t\tvec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );\n\t\t\tfor ( int i = 0; i < 3; i ++ ) {\n\t\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );\n\t\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\t\trefractionCoords += 1.0;\n\t\t\t\trefractionCoords /= 2.0;\n\t\t\t\tvec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );\n\t\t\t\ttransmittedLight[ i ] = transmissionSample[ i ];\n\t\t\t\ttransmittedLight.a += transmissionSample.a;\n\t\t\t\ttransmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];\n\t\t\t}\n\t\t\ttransmittedLight.a /= 3.0;\n\t\t#else\n\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\trefractionCoords += 1.0;\n\t\t\trefractionCoords /= 2.0;\n\t\t\ttransmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\t\ttransmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\t#endif\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif",uv_pars_fragment:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_BATCHING\n\t\tworldPosition = batchingMatrix * worldPosition;\n\t#endif\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nuniform mat3 backgroundRotation;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",depth_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <logdepthbuf_fragment>\n\t#ifdef USE_REVERSED_DEPTH_BUFFER\n\t\tfloat fragCoordZ = vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ];\n\t#else\n\t\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ] + 0.5;\n\t#endif\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#elif DEPTH_PACKING == 3202\n\t\tgl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );\n\t#elif DEPTH_PACKING == 3203\n\t\tgl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );\n\t#endif\n}",distance_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distance_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = vec4( dist, 0.0, 0.0, 1.0 );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( normalize( normal ) * 0.5 + 0.5, diffuseColor.a );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_DISPERSION\n\tuniform float dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n \n\t\toutgoingLight = outgoingLight + sheenSpecularDirect + sheenSpecularIndirect;\n \n \t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n\t#endif\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix[ 3 ];\n\tvec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}"},jp={common:{diffuse:{value:new Za(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new ls},alphaMap:{value:null},alphaMapTransform:{value:new ls},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new ls}},envmap:{envMap:{value:null},envMapRotation:{value:new ls},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98},dfgLUT:{value:null}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new ls}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new ls}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new ls},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new ls},normalScale:{value:new is(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new ls},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new ls}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new ls}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new ls}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Za(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Za(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new ls},alphaTest:{value:0},uvTransform:{value:new ls}},sprite:{diffuse:{value:new Za(16777215)},opacity:{value:1},center:{value:new is(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new ls},alphaMap:{value:null},alphaMapTransform:{value:new ls},alphaTest:{value:0}}},Gp={basic:{uniforms:Vo([jp.common,jp.specularmap,jp.envmap,jp.aomap,jp.lightmap,jp.fog]),vertexShader:zp.meshbasic_vert,fragmentShader:zp.meshbasic_frag},lambert:{uniforms:Vo([jp.common,jp.specularmap,jp.envmap,jp.aomap,jp.lightmap,jp.emissivemap,jp.bumpmap,jp.normalmap,jp.displacementmap,jp.fog,jp.lights,{emissive:{value:new Za(0)}}]),vertexShader:zp.meshlambert_vert,fragmentShader:zp.meshlambert_frag},phong:{uniforms:Vo([jp.common,jp.specularmap,jp.envmap,jp.aomap,jp.lightmap,jp.emissivemap,jp.bumpmap,jp.normalmap,jp.displacementmap,jp.fog,jp.lights,{emissive:{value:new Za(0)},specular:{value:new Za(1118481)},shininess:{value:30}}]),vertexShader:zp.meshphong_vert,fragmentShader:zp.meshphong_frag},standard:{uniforms:Vo([jp.common,jp.envmap,jp.aomap,jp.lightmap,jp.emissivemap,jp.bumpmap,jp.normalmap,jp.displacementmap,jp.roughnessmap,jp.metalnessmap,jp.fog,jp.lights,{emissive:{value:new Za(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:zp.meshphysical_vert,fragmentShader:zp.meshphysical_frag},toon:{uniforms:Vo([jp.common,jp.aomap,jp.lightmap,jp.emissivemap,jp.bumpmap,jp.normalmap,jp.displacementmap,jp.gradientmap,jp.fog,jp.lights,{emissive:{value:new Za(0)}}]),vertexShader:zp.meshtoon_vert,fragmentShader:zp.meshtoon_frag},matcap:{uniforms:Vo([jp.common,jp.bumpmap,jp.normalmap,jp.displacementmap,jp.fog,{matcap:{value:null}}]),vertexShader:zp.meshmatcap_vert,fragmentShader:zp.meshmatcap_frag},points:{uniforms:Vo([jp.points,jp.fog]),vertexShader:zp.points_vert,fragmentShader:zp.points_frag},dashed:{uniforms:Vo([jp.common,jp.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:zp.linedashed_vert,fragmentShader:zp.linedashed_frag},depth:{uniforms:Vo([jp.common,jp.displacementmap]),vertexShader:zp.depth_vert,fragmentShader:zp.depth_frag},normal:{uniforms:Vo([jp.common,jp.bumpmap,jp.normalmap,jp.displacementmap,{opacity:{value:1}}]),vertexShader:zp.meshnormal_vert,fragmentShader:zp.meshnormal_frag},sprite:{uniforms:Vo([jp.sprite,jp.fog]),vertexShader:zp.sprite_vert,fragmentShader:zp.sprite_frag},background:{uniforms:{uvTransform:{value:new ls},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:zp.background_vert,fragmentShader:zp.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new ls}},vertexShader:zp.backgroundCube_vert,fragmentShader:zp.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:zp.cube_vert,fragmentShader:zp.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:zp.equirect_vert,fragmentShader:zp.equirect_frag},distance:{uniforms:Vo([jp.common,jp.displacementmap,{referencePosition:{value:new ss},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:zp.distance_vert,fragmentShader:zp.distance_frag},shadow:{uniforms:Vo([jp.lights,jp.fog,{color:{value:new Za(0)},opacity:{value:1}}]),vertexShader:zp.shadow_vert,fragmentShader:zp.shadow_frag}};Gp.physical={uniforms:Vo([Gp.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new ls},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new ls},clearcoatNormalScale:{value:new is(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new ls},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new ls},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new ls},sheen:{value:0},sheenColor:{value:new Za(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new ls},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new ls},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new ls},transmissionSamplerSize:{value:new is},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new ls},attenuationDistance:{value:0},attenuationColor:{value:new Za(0)},specularColor:{value:new Za(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new ls},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new ls},anisotropyVector:{value:new is},anisotropyMap:{value:null},anisotropyMapTransform:{value:new ls}}]),vertexShader:zp.meshphysical_vert,fragmentShader:zp.meshphysical_frag};const Vp={r:0,b:0,g:0},Hp=new pa,Wp=new ra;function Yp(e,t,n,i,r,s,a){const o=new Za(0);let l,c,u=!0===s?0:1,h=null,d=0,f=null;function p(e){let i=!0===e.isScene?e.background:null;if(i&&i.isTexture){i=(e.backgroundBlurriness>0?n:t).get(i)}return i}function m(t,n){t.getRGB(Vp,Ho(e)),i.buffers.color.setClear(Vp.r,Vp.g,Vp.b,n,a)}return{getClearColor:function(){return o},setClearColor:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;o.set(e),u=t,m(o,u)},getClearAlpha:function(){return u},setClearAlpha:function(e){u=e,m(o,u)},render:function(t){let n=!1;const r=p(t);null===r?m(o,u):r&&r.isColor&&(m(r,1),n=!0);const s=e.xr.getEnvironmentBlendMode();"additive"===s?i.buffers.color.setClear(0,0,0,1,a):"alpha-blend"===s&&i.buffers.color.setClear(0,0,0,0,a),(e.autoClear||n)&&(i.buffers.depth.setTest(!0),i.buffers.depth.setMask(!0),i.buffers.color.setMask(!0),e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil))},addToRenderList:function(t,n){const i=p(n);i&&(i.isCubeTexture||i.mapping===Zt)?(void 0===c&&(c=new Bo(new jo(1,1,1),new Yo({name:"BackgroundCubeMaterial",uniforms:Go(Gp.backgroundCube.uniforms),vertexShader:Gp.backgroundCube.vertexShader,fragmentShader:Gp.backgroundCube.fragmentShader,side:Ze,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(c)),Hp.copy(n.backgroundRotation),Hp.x*=-1,Hp.y*=-1,Hp.z*=-1,i.isCubeTexture&&!1===i.isRenderTargetTexture&&(Hp.y*=-1,Hp.z*=-1),c.material.uniforms.envMap.value=i,c.material.uniforms.flipEnvMap.value=i.isCubeTexture&&!1===i.isRenderTargetTexture?-1:1,c.material.uniforms.backgroundBlurriness.value=n.backgroundBlurriness,c.material.uniforms.backgroundIntensity.value=n.backgroundIntensity,c.material.uniforms.backgroundRotation.value.setFromMatrix4(Wp.makeRotationFromEuler(Hp)),c.material.toneMapped=fs.getTransfer(i.colorSpace)!==ji,h===i&&d===i.version&&f===e.toneMapping||(c.material.needsUpdate=!0,h=i,d=i.version,f=e.toneMapping),c.layers.enableAll(),t.unshift(c,c.geometry,c.material,0,0,null)):i&&i.isTexture&&(void 0===l&&(l=new Bo(new Sh(2,2),new Yo({name:"BackgroundMaterial",uniforms:Go(Gp.background.uniforms),vertexShader:Gp.background.vertexShader,fragmentShader:Gp.background.fragmentShader,side:Ke,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(l)),l.material.uniforms.t2D.value=i,l.material.uniforms.backgroundIntensity.value=n.backgroundIntensity,l.material.toneMapped=fs.getTransfer(i.colorSpace)!==ji,!0===i.matrixAutoUpdate&&i.updateMatrix(),l.material.uniforms.uvTransform.value.copy(i.matrix),h===i&&d===i.version&&f===e.toneMapping||(l.material.needsUpdate=!0,h=i,d=i.version,f=e.toneMapping),l.layers.enableAll(),t.unshift(l,l.geometry,l.material,0,0,null))},dispose:function(){void 0!==c&&(c.geometry.dispose(),c.material.dispose(),c=void 0),void 0!==l&&(l.geometry.dispose(),l.material.dispose(),l=void 0)}}}function Xp(e,t){const n=e.getParameter(e.MAX_VERTEX_ATTRIBS),i={},r=c(null);let s=r,a=!1;function o(t){return e.bindVertexArray(t)}function l(t){return e.deleteVertexArray(t)}function c(e){const t=[],i=[],r=[];for(let s=0;s<n;s++)t[s]=0,i[s]=0,r[s]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:i,attributeDivisors:r,object:e,attributes:{},index:null}}function u(){const e=s.newAttributes;for(let t=0,n=e.length;t<n;t++)e[t]=0}function h(e){d(e,0)}function d(t,n){const i=s.newAttributes,r=s.enabledAttributes,a=s.attributeDivisors;i[t]=1,0===r[t]&&(e.enableVertexAttribArray(t),r[t]=1),a[t]!==n&&(e.vertexAttribDivisor(t,n),a[t]=n)}function f(){const t=s.newAttributes,n=s.enabledAttributes;for(let i=0,r=n.length;i<r;i++)n[i]!==t[i]&&(e.disableVertexAttribArray(i),n[i]=0)}function p(t,n,i,r,s,a,o){!0===o?e.vertexAttribIPointer(t,n,i,s,a):e.vertexAttribPointer(t,n,i,r,s,a)}function m(){g(),a=!0,s!==r&&(s=r,o(s.object))}function g(){r.geometry=null,r.program=null,r.wireframe=!1}return{setup:function(n,r,l,m,g){let v=!1;const y=function(t,n,r){const s=!0===r.wireframe;let a=i[t.id];void 0===a&&(a={},i[t.id]=a);let o=a[n.id];void 0===o&&(o={},a[n.id]=o);let l=o[s];void 0===l&&(l=c(e.createVertexArray()),o[s]=l);return l}(m,l,r);s!==y&&(s=y,o(s.object)),v=function(e,t,n,i){const r=s.attributes,a=t.attributes;let o=0;const l=n.getAttributes();for(const s in l){if(l[s].location>=0){const t=r[s];let n=a[s];if(void 0===n&&("instanceMatrix"===s&&e.instanceMatrix&&(n=e.instanceMatrix),"instanceColor"===s&&e.instanceColor&&(n=e.instanceColor)),void 0===t)return!0;if(t.attribute!==n)return!0;if(n&&t.data!==n.data)return!0;o++}}return s.attributesNum!==o||s.index!==i}(n,m,l,g),v&&function(e,t,n,i){const r={},a=t.attributes;let o=0;const l=n.getAttributes();for(const s in l){if(l[s].location>=0){let t=a[s];void 0===t&&("instanceMatrix"===s&&e.instanceMatrix&&(t=e.instanceMatrix),"instanceColor"===s&&e.instanceColor&&(t=e.instanceColor));const n={};n.attribute=t,t&&t.data&&(n.data=t.data),r[s]=n,o++}}s.attributes=r,s.attributesNum=o,s.index=i}(n,m,l,g),null!==g&&t.update(g,e.ELEMENT_ARRAY_BUFFER),(v||a)&&(a=!1,function(n,i,r,s){u();const a=s.attributes,o=r.getAttributes(),l=i.defaultAttributeValues;for(const c in o){const i=o[c];if(i.location>=0){let r=a[c];if(void 0===r&&("instanceMatrix"===c&&n.instanceMatrix&&(r=n.instanceMatrix),"instanceColor"===c&&n.instanceColor&&(r=n.instanceColor)),void 0!==r){const a=r.normalized,o=r.itemSize,l=t.get(r);if(void 0===l)continue;const c=l.buffer,u=l.type,f=l.bytesPerElement,m=u===e.INT||u===e.UNSIGNED_INT||r.gpuType===mn;if(r.isInterleavedBufferAttribute){const t=r.data,l=t.stride,g=r.offset;if(t.isInstancedInterleavedBuffer){for(let e=0;e<i.locationSize;e++)d(i.location+e,t.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=t.meshPerAttribute*t.count)}else for(let e=0;e<i.locationSize;e++)h(i.location+e);e.bindBuffer(e.ARRAY_BUFFER,c);for(let e=0;e<i.locationSize;e++)p(i.location+e,o/i.locationSize,u,a,l*f,(g+o/i.locationSize*e)*f,m)}else{if(r.isInstancedBufferAttribute){for(let e=0;e<i.locationSize;e++)d(i.location+e,r.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=r.meshPerAttribute*r.count)}else for(let e=0;e<i.locationSize;e++)h(i.location+e);e.bindBuffer(e.ARRAY_BUFFER,c);for(let e=0;e<i.locationSize;e++)p(i.location+e,o/i.locationSize,u,a,o*f,o/i.locationSize*e*f,m)}}else if(void 0!==l){const t=l[c];if(void 0!==t)switch(t.length){case 2:e.vertexAttrib2fv(i.location,t);break;case 3:e.vertexAttrib3fv(i.location,t);break;case 4:e.vertexAttrib4fv(i.location,t);break;default:e.vertexAttrib1fv(i.location,t)}}}}f()}(n,r,l,m),null!==g&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t.get(g).buffer))},reset:m,resetDefaultState:g,dispose:function(){m();for(const e in i){const t=i[e];for(const e in t){const n=t[e];for(const e in n)l(n[e].object),delete n[e];delete t[e]}delete i[e]}},releaseStatesOfGeometry:function(e){if(void 0===i[e.id])return;const t=i[e.id];for(const n in t){const e=t[n];for(const t in e)l(e[t].object),delete e[t];delete t[n]}delete i[e.id]},releaseStatesOfProgram:function(e){for(const t in i){const n=i[t];if(void 0===n[e.id])continue;const r=n[e.id];for(const e in r)l(r[e].object),delete r[e];delete n[e.id]}},initAttributes:u,enableAttribute:h,disableUnusedAttributes:f}}function qp(e,t,n){let i;function r(t,r,s){0!==s&&(e.drawArraysInstanced(i,t,r,s),n.update(r,i,s))}this.setMode=function(e){i=e},this.render=function(t,r){e.drawArrays(i,t,r),n.update(r,i,1)},this.renderInstances=r,this.renderMultiDraw=function(e,r,s){if(0===s)return;t.get("WEBGL_multi_draw").multiDrawArraysWEBGL(i,e,0,r,0,s);let a=0;for(let t=0;t<s;t++)a+=r[t];n.update(a,i,1)},this.renderMultiDrawInstances=function(e,s,a,o){if(0===a)return;const l=t.get("WEBGL_multi_draw");if(null===l)for(let t=0;t<e.length;t++)r(e[t],s[t],o[t]);else{l.multiDrawArraysInstancedWEBGL(i,e,0,s,0,o,0,a);let t=0;for(let e=0;e<a;e++)t+=s[e]*o[e];n.update(t,i,1)}}}function Kp(e,t,n,i){let r;function s(t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let a=void 0!==n.precision?n.precision:"highp";const o=s(a);o!==a&&(Gr("WebGLRenderer:",a,"not supported, using",o,"instead."),a=o);return{isWebGL2:!0,getMaxAnisotropy:function(){if(void 0!==r)return r;if(!0===t.has("EXT_texture_filter_anisotropic")){const n=t.get("EXT_texture_filter_anisotropic");r=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r},getMaxPrecision:s,textureFormatReadable:function(t){return t===An||i.convert(t)===e.getParameter(e.IMPLEMENTATION_COLOR_READ_FORMAT)},textureTypeReadable:function(n){const r=n===yn&&(t.has("EXT_color_buffer_half_float")||t.has("EXT_color_buffer_float"));return!(n!==hn&&i.convert(n)!==e.getParameter(e.IMPLEMENTATION_COLOR_READ_TYPE)&&n!==vn&&!r)},precision:a,logarithmicDepthBuffer:!0===n.logarithmicDepthBuffer,reversedDepthBuffer:!0===n.reversedDepthBuffer&&t.has("EXT_clip_control"),maxTextures:e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),maxVertexTextures:e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:e.getParameter(e.MAX_TEXTURE_SIZE),maxCubemapSize:e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),maxAttributes:e.getParameter(e.MAX_VERTEX_ATTRIBS),maxVertexUniforms:e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),maxVaryings:e.getParameter(e.MAX_VARYING_VECTORS),maxFragmentUniforms:e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),maxSamples:e.getParameter(e.MAX_SAMPLES),samples:e.getParameter(e.SAMPLES)}}function Zp(e){const t=this;let n=null,i=0,r=!1,s=!1;const a=new ic,o=new ls,l={value:null,needsUpdate:!1};function c(e,n,i,r){const s=null!==e?e.length:0;let c=null;if(0!==s){if(c=l.value,!0!==r||null===c){const t=i+4*s,r=n.matrixWorldInverse;o.getNormalMatrix(r),(null===c||c.length<t)&&(c=new Float32Array(t));for(let n=0,l=i;n!==s;++n,l+=4)a.copy(e[n]).applyMatrix4(r,o),a.normal.toArray(c,l),c[l+3]=a.constant}l.value=c,l.needsUpdate=!0}return t.numPlanes=s,t.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t){const n=0!==e.length||t||0!==i||r;return r=t,i=e.length,n},this.beginShadows=function(){s=!0,c(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(e,t){n=c(e,t,0)},this.setState=function(a,o,u){const h=a.clippingPlanes,d=a.clipIntersection,f=a.clipShadows,p=e.get(a);if(!r||null===h||0===h.length||s&&!f)s?c(null):function(){l.value!==n&&(l.value=n,l.needsUpdate=i>0);t.numPlanes=i,t.numIntersection=0}();else{const e=s?0:i,t=4*e;let r=p.clippingState||null;l.value=r,r=c(h,o,t,u);for(let i=0;i!==t;++i)r[i]=n[i];p.clippingState=r,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=e}}}function Jp(e){let t=new WeakMap;function n(e,t){return t===qt?e.mapping=Yt:t===Kt&&(e.mapping=Xt),e}function i(e){const n=e.target;n.removeEventListener("dispose",i);const r=t.get(n);void 0!==r&&(t.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture){const s=r.mapping;if(s===qt||s===Kt){if(t.has(r)){return n(t.get(r).texture,r.mapping)}{const s=r.image;if(s&&s.height>0){const a=new tl(s.height);return a.fromEquirectangularTexture(e,r),t.set(r,a),r.addEventListener("dispose",i),n(a.texture,r.mapping)}return null}}}return r},dispose:function(){t=new WeakMap}}}const Qp=[.125,.215,.35,.446,.526,.582],$p=20,em=new Dd,tm=new Za;let nm=null,im=0,rm=0,sm=!1;const am=new ss;class om{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._backgroundBox=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._blurMaterial=null,this._ggxMaterial=null}fromScene(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const{size:s=256,position:a=am}=r;nm=this._renderer.getRenderTarget(),im=this._renderer.getActiveCubeFace(),rm=this._renderer.getActiveMipmapLevel(),sm=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(s);const o=this._allocateTargets();return o.depthBuffer=!0,this._sceneToCubeUV(e,n,i,o,a),t>0&&this._blur(o,0,0,t),this._applyPMREM(o),this._cleanup(o),o}fromEquirectangular(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._fromTexture(e,t)}fromCubemap(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=hm(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=um(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose(),null!==this._backgroundBox&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._ggxMaterial&&this._ggxMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodMeshes.length;e++)this._lodMeshes[e].geometry.dispose()}_cleanup(e){this._renderer.setRenderTarget(nm,im,rm),this._renderer.xr.enabled=sm,e.scissorTest=!1,cm(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===Yt||e.mapping===Xt?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),nm=this._renderer.getRenderTarget(),im=this._renderer.getActiveCubeFace(),rm=this._renderer.getActiveMipmapLevel(),sm=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:an,minFilter:an,generateMipmaps:!1,type:yn,format:An,colorSpace:Bi,depthBuffer:!1},i=lm(e,t,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=lm(e,t,n);const{_lodMax:i}=this;({lodMeshes:this._lodMeshes,sizeLods:this._sizeLods,sigmas:this._sigmas}=function(e){const t=[],n=[],i=[];let r=e;const s=e-4+1+Qp.length;for(let a=0;a<s;a++){const s=Math.pow(2,r);t.push(s);let o=1/s;a>e-4?o=Qp[a-e+4-1]:0===a&&(o=0),n.push(o);const l=1/(s-2),c=-l,u=1+l,h=[c,c,u,c,u,u,c,c,u,u,c,u],d=6,f=6,p=3,m=2,g=1,v=new Float32Array(p*f*d),y=new Float32Array(m*f*d),b=new Float32Array(g*f*d);for(let e=0;e<d;e++){const t=e%3*2/3-1,n=e>2?0:-1,i=[t,n,0,t+2/3,n,0,t+2/3,n+1,0,t,n,0,t+2/3,n+1,0,t,n+1,0];v.set(i,p*f*e),y.set(h,m*f*e);const r=[e,e,e,e,e,e];b.set(r,g*f*e)}const x=new Mo;x.setAttribute("position",new co(v,p)),x.setAttribute("uv",new co(y,m)),x.setAttribute("faceIndex",new co(b,g)),i.push(new Bo(x,null)),r>4&&r--}return{lodMeshes:i,sizeLods:t,sigmas:n}}(i)),this._blurMaterial=function(e,t,n){const i=new Float32Array($p),r=new ss(0,1,0),s=new Yo({name:"SphericalGaussianBlur",defines:{n:$p,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:"".concat(e,".0")},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:Qe,depthTest:!1,depthWrite:!1});return s}(i,e,t),this._ggxMaterial=function(e,t,n){const i=new Yo({name:"PMREMGGXConvolution",defines:{GGX_SAMPLES:256,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:"".concat(e,".0")},uniforms:{envMap:{value:null},roughness:{value:0},mipInt:{value:0}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:'\n\n\t\t\tprecision highp float;\n\t\t\tprecision highp int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform float roughness;\n\t\t\tuniform float mipInt;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\t#define PI 3.14159265359\n\n\t\t\t// Van der Corput radical inverse\n\t\t\tfloat radicalInverse_VdC(uint bits) {\n\t\t\t\tbits = (bits << 16u) | (bits >> 16u);\n\t\t\t\tbits = ((bits & 0x55555555u) << 1u) | ((bits & 0xAAAAAAAAu) >> 1u);\n\t\t\t\tbits = ((bits & 0x33333333u) << 2u) | ((bits & 0xCCCCCCCCu) >> 2u);\n\t\t\t\tbits = ((bits & 0x0F0F0F0Fu) << 4u) | ((bits & 0xF0F0F0F0u) >> 4u);\n\t\t\t\tbits = ((bits & 0x00FF00FFu) << 8u) | ((bits & 0xFF00FF00u) >> 8u);\n\t\t\t\treturn float(bits) * 2.3283064365386963e-10; // / 0x100000000\n\t\t\t}\n\n\t\t\t// Hammersley sequence\n\t\t\tvec2 hammersley(uint i, uint N) {\n\t\t\t\treturn vec2(float(i) / float(N), radicalInverse_VdC(i));\n\t\t\t}\n\n\t\t\t// GGX VNDF importance sampling (Eric Heitz 2018)\n\t\t\t// "Sampling the GGX Distribution of Visible Normals"\n\t\t\t// https://jcgt.org/published/0007/04/01/\n\t\t\tvec3 importanceSampleGGX_VNDF(vec2 Xi, vec3 V, float roughness) {\n\t\t\t\tfloat alpha = roughness * roughness;\n\n\t\t\t\t// Section 3.2: Transform view direction to hemisphere configuration\n\t\t\t\tvec3 Vh = normalize(vec3(alpha * V.x, alpha * V.y, V.z));\n\n\t\t\t\t// Section 4.1: Orthonormal basis\n\t\t\t\tfloat lensq = Vh.x * Vh.x + Vh.y * Vh.y;\n\t\t\t\tvec3 T1 = lensq > 0.0 ? vec3(-Vh.y, Vh.x, 0.0) / sqrt(lensq) : vec3(1.0, 0.0, 0.0);\n\t\t\t\tvec3 T2 = cross(Vh, T1);\n\n\t\t\t\t// Section 4.2: Parameterization of projected area\n\t\t\t\tfloat r = sqrt(Xi.x);\n\t\t\t\tfloat phi = 2.0 * PI * Xi.y;\n\t\t\t\tfloat t1 = r * cos(phi);\n\t\t\t\tfloat t2 = r * sin(phi);\n\t\t\t\tfloat s = 0.5 * (1.0 + Vh.z);\n\t\t\t\tt2 = (1.0 - s) * sqrt(1.0 - t1 * t1) + s * t2;\n\n\t\t\t\t// Section 4.3: Reprojection onto hemisphere\n\t\t\t\tvec3 Nh = t1 * T1 + t2 * T2 + sqrt(max(0.0, 1.0 - t1 * t1 - t2 * t2)) * Vh;\n\n\t\t\t\t// Section 3.4: Transform back to ellipsoid configuration\n\t\t\t\treturn normalize(vec3(alpha * Nh.x, alpha * Nh.y, max(0.0, Nh.z)));\n\t\t\t}\n\n\t\t\tvoid main() {\n\t\t\t\tvec3 N = normalize(vOutputDirection);\n\t\t\t\tvec3 V = N; // Assume view direction equals normal for pre-filtering\n\n\t\t\t\tvec3 prefilteredColor = vec3(0.0);\n\t\t\t\tfloat totalWeight = 0.0;\n\n\t\t\t\t// For very low roughness, just sample the environment directly\n\t\t\t\tif (roughness < 0.001) {\n\t\t\t\t\tgl_FragColor = vec4(bilinearCubeUV(envMap, N, mipInt), 1.0);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Tangent space basis for VNDF sampling\n\t\t\t\tvec3 up = abs(N.z) < 0.999 ? vec3(0.0, 0.0, 1.0) : vec3(1.0, 0.0, 0.0);\n\t\t\t\tvec3 tangent = normalize(cross(up, N));\n\t\t\t\tvec3 bitangent = cross(N, tangent);\n\n\t\t\t\tfor(uint i = 0u; i < uint(GGX_SAMPLES); i++) {\n\t\t\t\t\tvec2 Xi = hammersley(i, uint(GGX_SAMPLES));\n\n\t\t\t\t\t// For PMREM, V = N, so in tangent space V is always (0, 0, 1)\n\t\t\t\t\tvec3 H_tangent = importanceSampleGGX_VNDF(Xi, vec3(0.0, 0.0, 1.0), roughness);\n\n\t\t\t\t\t// Transform H back to world space\n\t\t\t\t\tvec3 H = normalize(tangent * H_tangent.x + bitangent * H_tangent.y + N * H_tangent.z);\n\t\t\t\t\tvec3 L = normalize(2.0 * dot(V, H) * H - V);\n\n\t\t\t\t\tfloat NdotL = max(dot(N, L), 0.0);\n\n\t\t\t\t\tif(NdotL > 0.0) {\n\t\t\t\t\t\t// Sample environment at fixed mip level\n\t\t\t\t\t\t// VNDF importance sampling handles the distribution filtering\n\t\t\t\t\t\tvec3 sampleColor = bilinearCubeUV(envMap, L, mipInt);\n\n\t\t\t\t\t\t// Weight by NdotL for the split-sum approximation\n\t\t\t\t\t\t// VNDF PDF naturally accounts for the visible microfacet distribution\n\t\t\t\t\t\tprefilteredColor += sampleColor * NdotL;\n\t\t\t\t\t\ttotalWeight += NdotL;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (totalWeight > 0.0) {\n\t\t\t\t\tprefilteredColor = prefilteredColor / totalWeight;\n\t\t\t\t}\n\n\t\t\t\tgl_FragColor = vec4(prefilteredColor, 1.0);\n\t\t\t}\n\t\t',blending:Qe,depthTest:!1,depthWrite:!1});return i}(i,e,t)}return i}_compileMaterial(e){const t=new Bo(new Mo,e);this._renderer.compile(t,em)}_sceneToCubeUV(e,t,n,i,r){const s=new Jo(90,1,t,n),a=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],l=this._renderer,c=l.autoClear,u=l.toneMapping;l.getClearColor(tm),l.toneMapping=Nt,l.autoClear=!1;l.state.buffers.depth.getReversed()&&(l.setRenderTarget(i),l.clearDepth(),l.setRenderTarget(null)),null===this._backgroundBox&&(this._backgroundBox=new Bo(new jo,new eo({name:"PMREM.Background",side:Ze,depthWrite:!1,depthTest:!1})));const h=this._backgroundBox,d=h.material;let f=!1;const p=e.background;p?p.isColor&&(d.color.copy(p),e.background=null,f=!0):(d.color.copy(tm),f=!0);for(let m=0;m<6;m++){const t=m%3;0===t?(s.up.set(0,a[m],0),s.position.set(r.x,r.y,r.z),s.lookAt(r.x+o[m],r.y,r.z)):1===t?(s.up.set(0,0,a[m]),s.position.set(r.x,r.y,r.z),s.lookAt(r.x,r.y+o[m],r.z)):(s.up.set(0,a[m],0),s.position.set(r.x,r.y,r.z),s.lookAt(r.x,r.y,r.z+o[m]));const n=this._cubeSize;cm(i,t*n,m>2?n:0,n,n),l.setRenderTarget(i),f&&l.render(h,s),l.render(e,s)}l.toneMapping=u,l.autoClear=c,e.background=p}_textureToCubeUV(e,t){const n=this._renderer,i=e.mapping===Yt||e.mapping===Xt;i?(null===this._cubemapMaterial&&(this._cubemapMaterial=hm()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=um());const r=i?this._cubemapMaterial:this._equirectMaterial,s=this._lodMeshes[0];s.material=r;r.uniforms.envMap.value=e;const a=this._cubeSize;cm(t,0,0,3*a,2*a),n.setRenderTarget(t),n.render(s,em)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;const i=this._lodMeshes.length;for(let r=1;r<i;r++)this._applyGGXFilter(e,r-1,r);t.autoClear=n}_applyGGXFilter(e,t,n){const i=this._renderer,r=this._pingPongRenderTarget,s=this._ggxMaterial,a=this._lodMeshes[n];a.material=s;const o=s.uniforms,l=n/(this._lodMeshes.length-1),c=t/(this._lodMeshes.length-1),u=Math.sqrt(l*l-c*c)*(0+1.25*l),{_lodMax:h}=this,d=this._sizeLods[n],f=3*d*(n>h-4?n-h+4:0),p=4*(this._cubeSize-d);o.envMap.value=e.texture,o.roughness.value=u,o.mipInt.value=h-t,cm(r,f,p,3*d,2*d),i.setRenderTarget(r),i.render(a,em),o.envMap.value=r.texture,o.roughness.value=0,o.mipInt.value=h-n,cm(e,f,p,3*d,2*d),i.setRenderTarget(e),i.render(a,em)}_blur(e,t,n,i,r){const s=this._pingPongRenderTarget;this._halfBlur(e,s,t,n,i,"latitudinal",r),this._halfBlur(s,e,n,n,i,"longitudinal",r)}_halfBlur(e,t,n,i,r,s,a){const o=this._renderer,l=this._blurMaterial;"latitudinal"!==s&&"longitudinal"!==s&&Vr("blur direction must be either latitudinal or longitudinal!");const c=this._lodMeshes[i];c.material=l;const u=l.uniforms,h=this._sizeLods[n]-1,d=isFinite(r)?Math.PI/(2*h):2*Math.PI/39,f=r/d,p=isFinite(r)?1+Math.floor(3*f):$p;p>$p&&Gr("sigmaRadians, ".concat(r,", is too large and will clip, as it requested ").concat(p," samples when the maximum is set to ").concat($p));const m=[];let g=0;for(let b=0;b<$p;++b){const e=b/f,t=Math.exp(-e*e/2);m.push(t),0===b?g+=t:b<p&&(g+=2*t)}for(let b=0;b<m.length;b++)m[b]=m[b]/g;u.envMap.value=e.texture,u.samples.value=p,u.weights.value=m,u.latitudinal.value="latitudinal"===s,a&&(u.poleAxis.value=a);const{_lodMax:v}=this;u.dTheta.value=d,u.mipInt.value=v-n;const y=this._sizeLods[i];cm(t,3*y*(i>v-4?i-v+4:0),4*(this._cubeSize-y),3*y,2*y),o.setRenderTarget(t),o.render(c,em)}}function lm(e,t,n){const i=new As(e,t,n);return i.texture.mapping=Zt,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function cm(e,t,n,i,r){e.viewport.set(t,n,i,r),e.scissor.set(t,n,i,r)}function um(){return new Yo({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:Qe,depthTest:!1,depthWrite:!1})}function hm(){return new Yo({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:Qe,depthTest:!1,depthWrite:!1})}function dm(e){let t=new WeakMap,n=null;function i(e){const n=e.target;n.removeEventListener("dispose",i);const r=t.get(n);void 0!==r&&(t.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture){const s=r.mapping,a=s===qt||s===Kt,o=s===Yt||s===Xt;if(a||o){let s=t.get(r);const l=void 0!==s?s.texture.pmremVersion:0;if(r.isRenderTargetTexture&&r.pmremVersion!==l)return null===n&&(n=new om(e)),s=a?n.fromEquirectangular(r,s):n.fromCubemap(r,s),s.texture.pmremVersion=r.pmremVersion,t.set(r,s),s.texture;if(void 0!==s)return s.texture;{const l=r.image;return a&&l&&l.height>0||o&&l&&function(e){let t=0;const n=6;for(let i=0;i<n;i++)void 0!==e[i]&&t++;return t===n}(l)?(null===n&&(n=new om(e)),s=a?n.fromEquirectangular(r):n.fromCubemap(r),s.texture.pmremVersion=r.pmremVersion,t.set(r,s),r.addEventListener("dispose",i),s.texture):null}}}return r},dispose:function(){t=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function fm(e){const t={};function n(n){if(void 0!==t[n])return t[n];const i=e.getExtension(n);return t[n]=i,i}return{has:function(e){return null!==n(e)},init:function(){n("EXT_color_buffer_float"),n("WEBGL_clip_cull_distance"),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture"),n("WEBGL_render_shared_exponent")},get:function(e){const t=n(e);return null===t&&Hr("WebGLRenderer: "+e+" extension not supported."),t}}}function pm(e,t,n,i){const r={},s=new WeakMap;function a(e){const o=e.target;null!==o.index&&t.remove(o.index);for(const n in o.attributes)t.remove(o.attributes[n]);o.removeEventListener("dispose",a),delete r[o.id];const l=s.get(o);l&&(t.remove(l),s.delete(o)),i.releaseStatesOfGeometry(o),!0===o.isInstancedBufferGeometry&&delete o._maxInstanceCount,n.memory.geometries--}function o(e){const n=[],i=e.index,r=e.attributes.position;let a=0;if(null!==i){const e=i.array;a=i.version;for(let t=0,i=e.length;t<i;t+=3){const i=e[t+0],r=e[t+1],s=e[t+2];n.push(i,r,r,s,s,i)}}else{if(void 0===r)return;{const e=r.array;a=r.version;for(let t=0,i=e.length/3-1;t<i;t+=3){const e=t+0,i=t+1,r=t+2;n.push(e,i,i,r,r,e)}}}const o=new(Ir(n)?vo:mo)(n,1);o.version=a;const l=s.get(e);l&&t.remove(l),s.set(e,o)}return{get:function(e,t){return!0===r[t.id]||(t.addEventListener("dispose",a),r[t.id]=!0,n.memory.geometries++),t},update:function(n){const i=n.attributes;for(const r in i)t.update(i[r],e.ARRAY_BUFFER)},getWireframeAttribute:function(e){const t=s.get(e);if(t){const n=e.index;null!==n&&t.version<n.version&&o(e)}else o(e);return s.get(e)}}}function mm(e,t,n){let i,r,s;function a(t,a,o){0!==o&&(e.drawElementsInstanced(i,a,r,t*s,o),n.update(a,i,o))}this.setMode=function(e){i=e},this.setIndex=function(e){r=e.type,s=e.bytesPerElement},this.render=function(t,a){e.drawElements(i,a,r,t*s),n.update(a,i,1)},this.renderInstances=a,this.renderMultiDraw=function(e,s,a){if(0===a)return;t.get("WEBGL_multi_draw").multiDrawElementsWEBGL(i,s,0,r,e,0,a);let o=0;for(let t=0;t<a;t++)o+=s[t];n.update(o,i,1)},this.renderMultiDrawInstances=function(e,o,l,c){if(0===l)return;const u=t.get("WEBGL_multi_draw");if(null===u)for(let t=0;t<e.length;t++)a(e[t]/s,o[t],c[t]);else{u.multiDrawElementsInstancedWEBGL(i,o,0,r,e,0,c,0,l);let t=0;for(let e=0;e<l;e++)t+=o[e]*c[e];n.update(t,i,1)}}}function gm(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(n,i,r){switch(t.calls++,i){case e.TRIANGLES:t.triangles+=r*(n/3);break;case e.LINES:t.lines+=r*(n/2);break;case e.LINE_STRIP:t.lines+=r*(n-1);break;case e.LINE_LOOP:t.lines+=r*n;break;case e.POINTS:t.points+=r*n;break;default:Vr("WebGLInfo: Unknown draw mode:",i)}}}}function vm(e,t,n){const i=new WeakMap,r=new Ts;return{update:function(s,a,o){const l=s.morphTargetInfluences,c=a.morphAttributes.position||a.morphAttributes.normal||a.morphAttributes.color,u=void 0!==c?c.length:0;let h=i.get(a);if(void 0===h||h.count!==u){void 0!==h&&h.texture.dispose();const d=void 0!==a.morphAttributes.position,f=void 0!==a.morphAttributes.normal,p=void 0!==a.morphAttributes.color,m=a.morphAttributes.position||[],g=a.morphAttributes.normal||[],v=a.morphAttributes.color||[];let y=0;!0===d&&(y=1),!0===f&&(y=2),!0===p&&(y=3);let b=a.attributes.position.count*y,x=1;b>t.maxTextureSize&&(x=Math.ceil(b/t.maxTextureSize),b=t.maxTextureSize);const _=new Float32Array(b*x*4*u),S=new Ms(_,b,x,u);S.type=vn,S.needsUpdate=!0;const E=4*y;for(let w=0;w<u;w++){const A=m[w],M=g[w],R=v[w],C=b*x*4*w;for(let L=0;L<A.count;L++){const I=L*E;!0===d&&(r.fromBufferAttribute(A,L),_[C+I+0]=r.x,_[C+I+1]=r.y,_[C+I+2]=r.z,_[C+I+3]=0),!0===f&&(r.fromBufferAttribute(M,L),_[C+I+4]=r.x,_[C+I+5]=r.y,_[C+I+6]=r.z,_[C+I+7]=0),!0===p&&(r.fromBufferAttribute(R,L),_[C+I+8]=r.x,_[C+I+9]=r.y,_[C+I+10]=r.z,_[C+I+11]=4===R.itemSize?r.w:1)}}function T(){S.dispose(),i.delete(a),a.removeEventListener("dispose",T)}h={count:u,texture:S,size:new is(b,x)},i.set(a,h),a.addEventListener("dispose",T)}if(!0===s.isInstancedMesh&&null!==s.morphTexture)o.getUniforms().setValue(e,"morphTexture",s.morphTexture,n);else{let P=0;for(let D=0;D<l.length;D++)P+=l[D];const k=a.morphTargetsRelative?1:1-P;o.getUniforms().setValue(e,"morphTargetBaseInfluence",k),o.getUniforms().setValue(e,"morphTargetInfluences",l)}o.getUniforms().setValue(e,"morphTargetsTexture",h.texture,n),o.getUniforms().setValue(e,"morphTargetsTextureSize",h.size)}}}function ym(e,t,n,i){let r=new WeakMap;function s(e){const t=e.target;t.removeEventListener("dispose",s),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(a){const o=i.render.frame,l=a.geometry,c=t.get(a,l);if(r.get(c)!==o&&(t.update(c),r.set(c,o)),a.isInstancedMesh&&(!1===a.hasEventListener("dispose",s)&&a.addEventListener("dispose",s),r.get(a)!==o&&(n.update(a.instanceMatrix,e.ARRAY_BUFFER),null!==a.instanceColor&&n.update(a.instanceColor,e.ARRAY_BUFFER),r.set(a,o))),a.isSkinnedMesh){const e=a.skeleton;r.get(e)!==o&&(e.update(),r.set(e,o))}return c},dispose:function(){r=new WeakMap}}}const bm={[Ot]:"LINEAR_TONE_MAPPING",[Ft]:"REINHARD_TONE_MAPPING",[Ut]:"CINEON_TONE_MAPPING",[Bt]:"ACES_FILMIC_TONE_MAPPING",[jt]:"AGX_TONE_MAPPING",[Gt]:"NEUTRAL_TONE_MAPPING",[zt]:"CUSTOM_TONE_MAPPING"};function xm(e,t,n,i,r){const s=new As(t,n,{type:e,depthBuffer:i,stencilBuffer:r}),a=new As(t,n,{type:yn,depthBuffer:!1,stencilBuffer:!1}),o=new Mo;o.setAttribute("position",new bo([-1,3,0,-1,-1,0,3,-1,0],3)),o.setAttribute("uv",new bo([0,2,0,0,2,0],2));const l=new Dh({uniforms:{tDiffuse:{value:null}},vertexShader:"\n\t\t\tprecision highp float;\n\n\t\t\tuniform mat4 modelViewMatrix;\n\t\t\tuniform mat4 projectionMatrix;\n\n\t\t\tattribute vec3 position;\n\t\t\tattribute vec2 uv;\n\n\t\t\tvarying vec2 vUv;\n\n\t\t\tvoid main() {\n\t\t\t\tvUv = uv;\n\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t}",fragmentShader:"\n\t\t\tprecision highp float;\n\n\t\t\tuniform sampler2D tDiffuse;\n\n\t\t\tvarying vec2 vUv;\n\n\t\t\t#include <tonemapping_pars_fragment>\n\t\t\t#include <colorspace_pars_fragment>\n\n\t\t\tvoid main() {\n\t\t\t\tgl_FragColor = texture2D( tDiffuse, vUv );\n\n\t\t\t\t#ifdef LINEAR_TONE_MAPPING\n\t\t\t\t\tgl_FragColor.rgb = LinearToneMapping( gl_FragColor.rgb );\n\t\t\t\t#elif defined( REINHARD_TONE_MAPPING )\n\t\t\t\t\tgl_FragColor.rgb = ReinhardToneMapping( gl_FragColor.rgb );\n\t\t\t\t#elif defined( CINEON_TONE_MAPPING )\n\t\t\t\t\tgl_FragColor.rgb = CineonToneMapping( gl_FragColor.rgb );\n\t\t\t\t#elif defined( ACES_FILMIC_TONE_MAPPING )\n\t\t\t\t\tgl_FragColor.rgb = ACESFilmicToneMapping( gl_FragColor.rgb );\n\t\t\t\t#elif defined( AGX_TONE_MAPPING )\n\t\t\t\t\tgl_FragColor.rgb = AgXToneMapping( gl_FragColor.rgb );\n\t\t\t\t#elif defined( NEUTRAL_TONE_MAPPING )\n\t\t\t\t\tgl_FragColor.rgb = NeutralToneMapping( gl_FragColor.rgb );\n\t\t\t\t#elif defined( CUSTOM_TONE_MAPPING )\n\t\t\t\t\tgl_FragColor.rgb = CustomToneMapping( gl_FragColor.rgb );\n\t\t\t\t#endif\n\n\t\t\t\t#ifdef SRGB_TRANSFER\n\t\t\t\t\tgl_FragColor = sRGBTransferOETF( gl_FragColor );\n\t\t\t\t#endif\n\t\t\t}",depthTest:!1,depthWrite:!1}),c=new Bo(o,l),u=new Dd(-1,1,1,-1,0,1);let h,d=null,f=null,p=!1,m=null,g=[],v=!1;this.setSize=function(e,t){s.setSize(e,t),a.setSize(e,t);for(let n=0;n<g.length;n++){const i=g[n];i.setSize&&i.setSize(e,t)}},this.setEffects=function(e){g=e,v=g.length>0&&!0===g[0].isRenderPass;const t=s.width,n=s.height;for(let i=0;i<g.length;i++){const e=g[i];e.setSize&&e.setSize(t,n)}},this.begin=function(e,t){if(p)return!1;if(e.toneMapping===Nt&&0===g.length)return!1;if(m=t,null!==t){const e=t.width,n=t.height;s.width===e&&s.height===n||this.setSize(e,n)}return!1===v&&e.setRenderTarget(s),h=e.toneMapping,e.toneMapping=Nt,!0},this.hasRenderPass=function(){return v},this.end=function(e,t){e.toneMapping=h,p=!0;let n=s,i=a;for(let r=0;r<g.length;r++){const s=g[r];if(!1!==s.enabled&&(s.render(e,i,n,t),!1!==s.needsSwap)){const e=n;n=i,i=e}}if(d!==e.outputColorSpace||f!==e.toneMapping){d=e.outputColorSpace,f=e.toneMapping,l.defines={},fs.getTransfer(d)===ji&&(l.defines.SRGB_TRANSFER="");const t=bm[f];t&&(l.defines[t]=""),l.needsUpdate=!0}l.uniforms.tDiffuse.value=n.texture,e.setRenderTarget(m),e.render(c,u),m=null,p=!1},this.isCompositing=function(){return p},this.dispose=function(){s.dispose(),a.dispose(),o.dispose(),l.dispose()}}const _m=new Es,Sm=new ru(1,1),Em=new Ms,Tm=new Cs,wm=new el,Am=[],Mm=[],Rm=new Float32Array(16),Cm=new Float32Array(9),Lm=new Float32Array(4);function Im(e,t,n){const i=e[0];if(i<=0||i>0)return e;const r=t*n;let s=Am[r];if(void 0===s&&(s=new Float32Array(r),Am[r]=s),0!==t){i.toArray(s,0);for(let i=1,r=0;i!==t;++i)r+=n,e[i].toArray(s,r)}return s}function Pm(e,t){if(e.length!==t.length)return!1;for(let n=0,i=e.length;n<i;n++)if(e[n]!==t[n])return!1;return!0}function km(e,t){for(let n=0,i=t.length;n<i;n++)e[n]=t[n]}function Dm(e,t){let n=Mm[t];void 0===n&&(n=new Int32Array(t),Mm[t]=n);for(let i=0;i!==t;++i)n[i]=e.allocateTextureUnit();return n}function Nm(e,t){const n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function Om(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(Pm(n,t))return;e.uniform2fv(this.addr,t),km(n,t)}}function Fm(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(Pm(n,t))return;e.uniform3fv(this.addr,t),km(n,t)}}function Um(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(Pm(n,t))return;e.uniform4fv(this.addr,t),km(n,t)}}function Bm(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(Pm(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),km(n,t)}else{if(Pm(n,i))return;Lm.set(i),e.uniformMatrix2fv(this.addr,!1,Lm),km(n,i)}}function zm(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(Pm(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),km(n,t)}else{if(Pm(n,i))return;Cm.set(i),e.uniformMatrix3fv(this.addr,!1,Cm),km(n,i)}}function jm(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(Pm(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),km(n,t)}else{if(Pm(n,i))return;Rm.set(i),e.uniformMatrix4fv(this.addr,!1,Rm),km(n,i)}}function Gm(e,t){const n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function Vm(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2i(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(Pm(n,t))return;e.uniform2iv(this.addr,t),km(n,t)}}function Hm(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3i(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(Pm(n,t))return;e.uniform3iv(this.addr,t),km(n,t)}}function Wm(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(Pm(n,t))return;e.uniform4iv(this.addr,t),km(n,t)}}function Ym(e,t){const n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function Xm(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2ui(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(Pm(n,t))return;e.uniform2uiv(this.addr,t),km(n,t)}}function qm(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3ui(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(Pm(n,t))return;e.uniform3uiv(this.addr,t),km(n,t)}}function Km(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(Pm(n,t))return;e.uniform4uiv(this.addr,t),km(n,t)}}function Zm(e,t,n){const i=this.cache,r=n.allocateTextureUnit();let s;i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),this.type===e.SAMPLER_2D_SHADOW?(Sm.compareFunction=n.isReversedDepthBuffer()?fr:ur,s=Sm):s=_m,n.setTexture2D(t||s,r)}function Jm(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture3D(t||Tm,r)}function Qm(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTextureCube(t||wm,r)}function $m(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture2DArray(t||Em,r)}function eg(e,t){e.uniform1fv(this.addr,t)}function tg(e,t){const n=Im(t,this.size,2);e.uniform2fv(this.addr,n)}function ng(e,t){const n=Im(t,this.size,3);e.uniform3fv(this.addr,n)}function ig(e,t){const n=Im(t,this.size,4);e.uniform4fv(this.addr,n)}function rg(e,t){const n=Im(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function sg(e,t){const n=Im(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function ag(e,t){const n=Im(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function og(e,t){e.uniform1iv(this.addr,t)}function lg(e,t){e.uniform2iv(this.addr,t)}function cg(e,t){e.uniform3iv(this.addr,t)}function ug(e,t){e.uniform4iv(this.addr,t)}function hg(e,t){e.uniform1uiv(this.addr,t)}function dg(e,t){e.uniform2uiv(this.addr,t)}function fg(e,t){e.uniform3uiv(this.addr,t)}function pg(e,t){e.uniform4uiv(this.addr,t)}function mg(e,t,n){const i=this.cache,r=t.length,s=Dm(n,r);let a;Pm(i,s)||(e.uniform1iv(this.addr,s),km(i,s)),a=this.type===e.SAMPLER_2D_SHADOW?Sm:_m;for(let o=0;o!==r;++o)n.setTexture2D(t[o]||a,s[o])}function gg(e,t,n){const i=this.cache,r=t.length,s=Dm(n,r);Pm(i,s)||(e.uniform1iv(this.addr,s),km(i,s));for(let a=0;a!==r;++a)n.setTexture3D(t[a]||Tm,s[a])}function vg(e,t,n){const i=this.cache,r=t.length,s=Dm(n,r);Pm(i,s)||(e.uniform1iv(this.addr,s),km(i,s));for(let a=0;a!==r;++a)n.setTextureCube(t[a]||wm,s[a])}function yg(e,t,n){const i=this.cache,r=t.length,s=Dm(n,r);Pm(i,s)||(e.uniform1iv(this.addr,s),km(i,s));for(let a=0;a!==r;++a)n.setTexture2DArray(t[a]||Em,s[a])}class bg{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.setValue=function(e){switch(e){case 5126:return Nm;case 35664:return Om;case 35665:return Fm;case 35666:return Um;case 35674:return Bm;case 35675:return zm;case 35676:return jm;case 5124:case 35670:return Gm;case 35667:case 35671:return Vm;case 35668:case 35672:return Hm;case 35669:case 35673:return Wm;case 5125:return Ym;case 36294:return Xm;case 36295:return qm;case 36296:return Km;case 35678:case 36198:case 36298:case 36306:case 35682:return Zm;case 35679:case 36299:case 36307:return Jm;case 35680:case 36300:case 36308:case 36293:return Qm;case 36289:case 36303:case 36311:case 36292:return $m}}(t.type)}}class xg{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=function(e){switch(e){case 5126:return eg;case 35664:return tg;case 35665:return ng;case 35666:return ig;case 35674:return rg;case 35675:return sg;case 35676:return ag;case 5124:case 35670:return og;case 35667:case 35671:return lg;case 35668:case 35672:return cg;case 35669:case 35673:return ug;case 5125:return hg;case 36294:return dg;case 36295:return fg;case 36296:return pg;case 35678:case 36198:case 36298:case 36306:case 35682:return mg;case 35679:case 36299:case 36307:return gg;case 35680:case 36300:case 36308:case 36293:return vg;case 36289:case 36303:case 36311:case 36292:return yg}}(t.type)}}class _g{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const i=this.seq;for(let r=0,s=i.length;r!==s;++r){const s=i[r];s.setValue(e,t[s.id],n)}}}const Sg=/(\w+)(\])?(\[|\.)?/g;function Eg(e,t){e.seq.push(t),e.map[t.id]=t}function Tg(e,t,n){const i=e.name,r=i.length;for(Sg.lastIndex=0;;){const s=Sg.exec(i),a=Sg.lastIndex;let o=s[1];const l="]"===s[2],c=s[3];if(l&&(o|=0),void 0===c||"["===c&&a+2===r){Eg(n,void 0===c?new bg(o,e,t):new xg(o,e,t));break}{let e=n.map[o];void 0===e&&(e=new _g(o),Eg(n,e)),n=e}}}class wg{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let s=0;s<n;++s){const n=e.getActiveUniform(t,s);Tg(n,e.getUniformLocation(t,n.name),this)}const i=[],r=[];for(const s of this.seq)s.type===e.SAMPLER_2D_SHADOW||s.type===e.SAMPLER_CUBE_SHADOW||s.type===e.SAMPLER_2D_ARRAY_SHADOW?i.push(s):r.push(s);i.length>0&&(this.seq=i.concat(r))}setValue(e,t,n,i){const r=this.map[t];void 0!==r&&r.setValue(e,n,i)}setOptional(e,t,n){const i=t[n];void 0!==i&&this.setValue(e,n,i)}static upload(e,t,n,i){for(let r=0,s=t.length;r!==s;++r){const s=t[r],a=n[s.id];!1!==a.needsUpdate&&s.setValue(e,a.value,i)}}static seqWithValue(e,t){const n=[];for(let i=0,r=e.length;i!==r;++i){const r=e[i];r.id in t&&n.push(r)}return n}}function Ag(e,t,n){const i=e.createShader(t);return e.shaderSource(i,n),e.compileShader(i),i}let Mg=0;const Rg=new ls;function Cg(e,t,n){const i=e.getShaderParameter(t,e.COMPILE_STATUS),r=(e.getShaderInfoLog(t)||"").trim();if(i&&""===r)return"";const s=/ERROR: 0:(\d+)/.exec(r);if(s){const i=parseInt(s[1]);return n.toUpperCase()+"\n\n"+r+"\n\n"+function(e,t){const n=e.split("\n"),i=[],r=Math.max(t-6,0),s=Math.min(t+6,n.length);for(let a=r;a<s;a++){const e=a+1;i.push("".concat(e===t?">":" "," ").concat(e,": ").concat(n[a]))}return i.join("\n")}(e.getShaderSource(t),i)}return r}function Lg(e,t){const n=function(e){fs._getMatrix(Rg,fs.workingColorSpace,e);const t="mat3( ".concat(Rg.elements.map(e=>e.toFixed(4))," )");switch(fs.getTransfer(e)){case zi:return[t,"LinearTransferOETF"];case ji:return[t,"sRGBTransferOETF"];default:return Gr("WebGLProgram: Unsupported color space: ",e),[t,"LinearTransferOETF"]}}(t);return["vec4 ".concat(e,"( vec4 value ) {"),"\treturn ".concat(n[1],"( vec4( value.rgb * ").concat(n[0],", value.a ) );"),"}"].join("\n")}const Ig={[Ot]:"Linear",[Ft]:"Reinhard",[Ut]:"Cineon",[Bt]:"ACESFilmic",[jt]:"AgX",[Gt]:"Neutral",[zt]:"Custom"};function Pg(e,t){const n=Ig[t];return void 0===n?(Gr("WebGLProgram: Unsupported toneMapping:",t),"vec3 "+e+"( vec3 color ) { return LinearToneMapping( color ); }"):"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}const kg=new ss;function Dg(){fs.getLuminanceCoefficients(kg);const e=kg.x.toFixed(4),t=kg.y.toFixed(4),n=kg.z.toFixed(4);return["float luminance( const in vec3 rgb ) {","\tconst vec3 weights = vec3( ".concat(e,", ").concat(t,", ").concat(n," );"),"\treturn dot( weights, rgb );","}"].join("\n")}function Ng(e){return""!==e}function Og(e,t){const n=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function Fg(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const Ug=/^[ \t]*#include +<([\w\d./]+)>/gm;function Bg(e){return e.replace(Ug,jg)}const zg=new Map;function jg(e,t){let n=zp[t];if(void 0===n){const e=zg.get(t);if(void 0===e)throw new Error("Can not resolve #include <"+t+">");n=zp[e],Gr('WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',t,e)}return Bg(n)}const Gg=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Vg(e){return e.replace(Gg,Hg)}function Hg(e,t,n,i){let r="";for(let s=parseInt(t);s<parseInt(n);s++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return r}function Wg(e){let t="precision ".concat(e.precision," float;\n\tprecision ").concat(e.precision," int;\n\tprecision ").concat(e.precision," sampler2D;\n\tprecision ").concat(e.precision," samplerCube;\n\tprecision ").concat(e.precision," sampler3D;\n\tprecision ").concat(e.precision," sampler2DArray;\n\tprecision ").concat(e.precision," sampler2DShadow;\n\tprecision ").concat(e.precision," samplerCubeShadow;\n\tprecision ").concat(e.precision," sampler2DArrayShadow;\n\tprecision ").concat(e.precision," isampler2D;\n\tprecision ").concat(e.precision," isampler3D;\n\tprecision ").concat(e.precision," isamplerCube;\n\tprecision ").concat(e.precision," isampler2DArray;\n\tprecision ").concat(e.precision," usampler2D;\n\tprecision ").concat(e.precision," usampler3D;\n\tprecision ").concat(e.precision," usamplerCube;\n\tprecision ").concat(e.precision," usampler2DArray;\n\t");return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}const Yg={[Ye]:"SHADOWMAP_TYPE_PCF",[qe]:"SHADOWMAP_TYPE_VSM"};const Xg={[Yt]:"ENVMAP_TYPE_CUBE",[Xt]:"ENVMAP_TYPE_CUBE",[Zt]:"ENVMAP_TYPE_CUBE_UV"};const qg={[Xt]:"ENVMAP_MODE_REFRACTION"};const Kg={[Pt]:"ENVMAP_BLENDING_MULTIPLY",[kt]:"ENVMAP_BLENDING_MIX",[Dt]:"ENVMAP_BLENDING_ADD"};function Zg(e,t,n,i){const r=e.getContext(),s=n.defines;let a=n.vertexShader,o=n.fragmentShader;const l=function(e){return Yg[e.shadowMapType]||"SHADOWMAP_TYPE_BASIC"}(n),c=function(e){return!1===e.envMap?"ENVMAP_TYPE_CUBE":Xg[e.envMapMode]||"ENVMAP_TYPE_CUBE"}(n),u=function(e){return!1===e.envMap?"ENVMAP_MODE_REFLECTION":qg[e.envMapMode]||"ENVMAP_MODE_REFLECTION"}(n),h=function(e){return!1===e.envMap?"ENVMAP_BLENDING_NONE":Kg[e.combine]||"ENVMAP_BLENDING_NONE"}(n),d=function(e){const t=e.envMapCubeUVHeight;if(null===t)return null;const n=Math.log2(t)-2,i=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:i,maxMip:n}}(n),f=function(e){return[e.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",e.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(Ng).join("\n")}(n),p=function(e){const t=[];for(const n in e){const i=e[n];!1!==i&&t.push("#define "+n+" "+i)}return t.join("\n")}(s),m=r.createProgram();let g,v,y=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(g=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,p].filter(Ng).join("\n"),g.length>0&&(g+="\n"),v=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,p].filter(Ng).join("\n"),v.length>0&&(v+="\n")):(g=[Wg(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,p,n.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",n.batching?"#define USE_BATCHING":"",n.batchingColor?"#define USE_BATCHING_COLOR":"",n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.instancingMorph?"#define USE_INSTANCING_MORPH":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.displacementMap?"#define USE_DISPLACEMENTMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.mapUv?"#define MAP_UV "+n.mapUv:"",n.alphaMapUv?"#define ALPHAMAP_UV "+n.alphaMapUv:"",n.lightMapUv?"#define LIGHTMAP_UV "+n.lightMapUv:"",n.aoMapUv?"#define AOMAP_UV "+n.aoMapUv:"",n.emissiveMapUv?"#define EMISSIVEMAP_UV "+n.emissiveMapUv:"",n.bumpMapUv?"#define BUMPMAP_UV "+n.bumpMapUv:"",n.normalMapUv?"#define NORMALMAP_UV "+n.normalMapUv:"",n.displacementMapUv?"#define DISPLACEMENTMAP_UV "+n.displacementMapUv:"",n.metalnessMapUv?"#define METALNESSMAP_UV "+n.metalnessMapUv:"",n.roughnessMapUv?"#define ROUGHNESSMAP_UV "+n.roughnessMapUv:"",n.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+n.anisotropyMapUv:"",n.clearcoatMapUv?"#define CLEARCOATMAP_UV "+n.clearcoatMapUv:"",n.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+n.clearcoatNormalMapUv:"",n.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+n.clearcoatRoughnessMapUv:"",n.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+n.iridescenceMapUv:"",n.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+n.iridescenceThicknessMapUv:"",n.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+n.sheenColorMapUv:"",n.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+n.sheenRoughnessMapUv:"",n.specularMapUv?"#define SPECULARMAP_UV "+n.specularMapUv:"",n.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+n.specularColorMapUv:"",n.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+n.specularIntensityMapUv:"",n.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+n.transmissionMapUv:"",n.thicknessMapUv?"#define THICKNESSMAP_UV "+n.thicknessMapUv:"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphColors?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",n.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","\tuniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Ng).join("\n"),v=[Wg(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,p,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+c:"",n.envMap?"#define "+u:"",n.envMap?"#define "+h:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.dispersion?"#define USE_DISPERSION":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor||n.batchingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",n.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",n.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==Nt?"#define TONE_MAPPING":"",n.toneMapping!==Nt?zp.tonemapping_pars_fragment:"",n.toneMapping!==Nt?Pg("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",zp.colorspace_pars_fragment,Lg("linearToOutputTexel",n.outputColorSpace),Dg(),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(Ng).join("\n")),a=Bg(a),a=Og(a,n),a=Fg(a,n),o=Bg(o),o=Og(o,n),o=Fg(o,n),a=Vg(a),o=Vg(o),!0!==n.isRawShaderMaterial&&(y="#version 300 es\n",g=[f,"#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,v=["#define varying in",n.glslVersion===wr?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===wr?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+v);const b=y+g+a,x=y+v+o,_=Ag(r,r.VERTEX_SHADER,b),S=Ag(r,r.FRAGMENT_SHADER,x);function E(t){if(e.debug.checkShaderErrors){const n=r.getProgramInfoLog(m)||"",i=r.getShaderInfoLog(_)||"",s=r.getShaderInfoLog(S)||"",a=n.trim(),o=i.trim(),l=s.trim();let c=!0,u=!0;if(!1===r.getProgramParameter(m,r.LINK_STATUS))if(c=!1,"function"===typeof e.debug.onShaderError)e.debug.onShaderError(r,m,_,S);else{const e=Cg(r,_,"vertex"),n=Cg(r,S,"fragment");Vr("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(m,r.VALIDATE_STATUS)+"\n\nMaterial Name: "+t.name+"\nMaterial Type: "+t.type+"\n\nProgram Info Log: "+a+"\n"+e+"\n"+n)}else""!==a?Gr("WebGLProgram: Program Info Log:",a):""!==o&&""!==l||(u=!1);u&&(t.diagnostics={runnable:c,programLog:a,vertexShader:{log:o,prefix:g},fragmentShader:{log:l,prefix:v}})}r.deleteShader(_),r.deleteShader(S),T=new wg(r,m),w=function(e,t){const n={},i=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let r=0;r<i;r++){const i=e.getActiveAttrib(t,r),s=i.name;let a=1;i.type===e.FLOAT_MAT2&&(a=2),i.type===e.FLOAT_MAT3&&(a=3),i.type===e.FLOAT_MAT4&&(a=4),n[s]={type:i.type,location:e.getAttribLocation(t,s),locationSize:a}}return n}(r,m)}let T,w;r.attachShader(m,_),r.attachShader(m,S),void 0!==n.index0AttributeName?r.bindAttribLocation(m,0,n.index0AttributeName):!0===n.morphTargets&&r.bindAttribLocation(m,0,"position"),r.linkProgram(m),this.getUniforms=function(){return void 0===T&&E(this),T},this.getAttributes=function(){return void 0===w&&E(this),w};let A=!1===n.rendererExtensionParallelShaderCompile;return this.isReady=function(){return!1===A&&(A=r.getProgramParameter(m,37297)),A},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(m),this.program=void 0},this.type=n.shaderType,this.name=n.shaderName,this.id=Mg++,this.cacheKey=t,this.usedTimes=1,this.program=m,this.vertexShader=_,this.fragmentShader=S,this}let Jg=0;class Qg{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,i=this._getShaderStage(t),r=this._getShaderStage(n),s=this._getShaderCacheForMaterial(e);return!1===s.has(i)&&(s.add(i),i.usedTimes++),!1===s.has(r)&&(s.add(r),r.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const n of t)n.usedTimes--,0===n.usedTimes&&this.shaderCache.delete(n.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return void 0===n&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return void 0===n&&(n=new $g(e),t.set(e,n)),n}}class $g{constructor(e){this.id=Jg++,this.code=e,this.usedTimes=0}}function ev(e,t,n,i,r,s,a){const o=new ma,l=new Qg,c=new Set,u=[],h=new Map,d=r.logarithmicDepthBuffer;let f=r.precision;const p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distance",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function m(e){return c.add(e),0===e?"uv":"uv".concat(e)}return{getParameters:function(s,o,u,h,g){const v=h.fog,y=g.geometry,b=s.isMeshStandardMaterial?h.environment:null,x=(s.isMeshStandardMaterial?n:t).get(s.envMap||b),_=x&&x.mapping===Zt?x.image.height:null,S=p[s.type];null!==s.precision&&(f=r.getMaxPrecision(s.precision),f!==s.precision&&Gr("WebGLProgram.getParameters:",s.precision,"not supported, using",f,"instead."));const E=y.morphAttributes.position||y.morphAttributes.normal||y.morphAttributes.color,T=void 0!==E?E.length:0;let w,A,M,R,C=0;if(void 0!==y.morphAttributes.position&&(C=1),void 0!==y.morphAttributes.normal&&(C=2),void 0!==y.morphAttributes.color&&(C=3),S){const e=Gp[S];w=e.vertexShader,A=e.fragmentShader}else w=s.vertexShader,A=s.fragmentShader,l.update(s),M=l.getVertexShaderID(s),R=l.getFragmentShaderID(s);const L=e.getRenderTarget(),I=e.state.buffers.depth.getReversed(),P=!0===g.isInstancedMesh,k=!0===g.isBatchedMesh,D=!!s.map,N=!!s.matcap,O=!!x,F=!!s.aoMap,U=!!s.lightMap,B=!!s.bumpMap,z=!!s.normalMap,j=!!s.displacementMap,G=!!s.emissiveMap,V=!!s.metalnessMap,H=!!s.roughnessMap,W=s.anisotropy>0,Y=s.clearcoat>0,X=s.dispersion>0,q=s.iridescence>0,K=s.sheen>0,Z=s.transmission>0,J=W&&!!s.anisotropyMap,Q=Y&&!!s.clearcoatMap,$=Y&&!!s.clearcoatNormalMap,ee=Y&&!!s.clearcoatRoughnessMap,te=q&&!!s.iridescenceMap,ne=q&&!!s.iridescenceThicknessMap,ie=K&&!!s.sheenColorMap,re=K&&!!s.sheenRoughnessMap,se=!!s.specularMap,ae=!!s.specularColorMap,oe=!!s.specularIntensityMap,le=Z&&!!s.transmissionMap,ce=Z&&!!s.thicknessMap,ue=!!s.gradientMap,he=!!s.alphaMap,de=s.alphaTest>0,fe=!!s.alphaHash,pe=!!s.extensions;let me=Nt;s.toneMapped&&(null!==L&&!0!==L.isXRRenderTarget||(me=e.toneMapping));const ge={shaderID:S,shaderType:s.type,shaderName:s.name,vertexShader:w,fragmentShader:A,defines:s.defines,customVertexShaderID:M,customFragmentShaderID:R,isRawShaderMaterial:!0===s.isRawShaderMaterial,glslVersion:s.glslVersion,precision:f,batching:k,batchingColor:k&&null!==g._colorsTexture,instancing:P,instancingColor:P&&null!==g.instanceColor,instancingMorph:P&&null!==g.morphTexture,outputColorSpace:null===L?e.outputColorSpace:!0===L.isXRRenderTarget?L.texture.colorSpace:Bi,alphaToCoverage:!!s.alphaToCoverage,map:D,matcap:N,envMap:O,envMapMode:O&&x.mapping,envMapCubeUVHeight:_,aoMap:F,lightMap:U,bumpMap:B,normalMap:z,displacementMap:j,emissiveMap:G,normalMapObjectSpace:z&&s.normalMapType===Oi,normalMapTangentSpace:z&&s.normalMapType===Ni,metalnessMap:V,roughnessMap:H,anisotropy:W,anisotropyMap:J,clearcoat:Y,clearcoatMap:Q,clearcoatNormalMap:$,clearcoatRoughnessMap:ee,dispersion:X,iridescence:q,iridescenceMap:te,iridescenceThicknessMap:ne,sheen:K,sheenColorMap:ie,sheenRoughnessMap:re,specularMap:se,specularColorMap:ae,specularIntensityMap:oe,transmission:Z,transmissionMap:le,thicknessMap:ce,gradientMap:ue,opaque:!1===s.transparent&&s.blending===$e&&!1===s.alphaToCoverage,alphaMap:he,alphaTest:de,alphaHash:fe,combine:s.combine,mapUv:D&&m(s.map.channel),aoMapUv:F&&m(s.aoMap.channel),lightMapUv:U&&m(s.lightMap.channel),bumpMapUv:B&&m(s.bumpMap.channel),normalMapUv:z&&m(s.normalMap.channel),displacementMapUv:j&&m(s.displacementMap.channel),emissiveMapUv:G&&m(s.emissiveMap.channel),metalnessMapUv:V&&m(s.metalnessMap.channel),roughnessMapUv:H&&m(s.roughnessMap.channel),anisotropyMapUv:J&&m(s.anisotropyMap.channel),clearcoatMapUv:Q&&m(s.clearcoatMap.channel),clearcoatNormalMapUv:$&&m(s.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:ee&&m(s.clearcoatRoughnessMap.channel),iridescenceMapUv:te&&m(s.iridescenceMap.channel),iridescenceThicknessMapUv:ne&&m(s.iridescenceThicknessMap.channel),sheenColorMapUv:ie&&m(s.sheenColorMap.channel),sheenRoughnessMapUv:re&&m(s.sheenRoughnessMap.channel),specularMapUv:se&&m(s.specularMap.channel),specularColorMapUv:ae&&m(s.specularColorMap.channel),specularIntensityMapUv:oe&&m(s.specularIntensityMap.channel),transmissionMapUv:le&&m(s.transmissionMap.channel),thicknessMapUv:ce&&m(s.thicknessMap.channel),alphaMapUv:he&&m(s.alphaMap.channel),vertexTangents:!!y.attributes.tangent&&(z||W),vertexColors:s.vertexColors,vertexAlphas:!0===s.vertexColors&&!!y.attributes.color&&4===y.attributes.color.itemSize,pointsUvs:!0===g.isPoints&&!!y.attributes.uv&&(D||he),fog:!!v,useFog:!0===s.fog,fogExp2:!!v&&v.isFogExp2,flatShading:!0===s.flatShading&&!1===s.wireframe,sizeAttenuation:!0===s.sizeAttenuation,logarithmicDepthBuffer:d,reversedDepthBuffer:I,skinning:!0===g.isSkinnedMesh,morphTargets:void 0!==y.morphAttributes.position,morphNormals:void 0!==y.morphAttributes.normal,morphColors:void 0!==y.morphAttributes.color,morphTargetsCount:T,morphTextureStride:C,numDirLights:o.directional.length,numPointLights:o.point.length,numSpotLights:o.spot.length,numSpotLightMaps:o.spotLightMap.length,numRectAreaLights:o.rectArea.length,numHemiLights:o.hemi.length,numDirLightShadows:o.directionalShadowMap.length,numPointLightShadows:o.pointShadowMap.length,numSpotLightShadows:o.spotShadowMap.length,numSpotLightShadowsWithMaps:o.numSpotLightShadowsWithMaps,numLightProbes:o.numLightProbes,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:s.dithering,shadowMapEnabled:e.shadowMap.enabled&&u.length>0,shadowMapType:e.shadowMap.type,toneMapping:me,decodeVideoTexture:D&&!0===s.map.isVideoTexture&&fs.getTransfer(s.map.colorSpace)===ji,decodeVideoTextureEmissive:G&&!0===s.emissiveMap.isVideoTexture&&fs.getTransfer(s.emissiveMap.colorSpace)===ji,premultipliedAlpha:s.premultipliedAlpha,doubleSided:s.side===Je,flipSided:s.side===Ze,useDepthPacking:s.depthPacking>=0,depthPacking:s.depthPacking||0,index0AttributeName:s.index0AttributeName,extensionClipCullDistance:pe&&!0===s.extensions.clipCullDistance&&i.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(pe&&!0===s.extensions.multiDraw||k)&&i.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:i.has("KHR_parallel_shader_compile"),customProgramCacheKey:s.customProgramCacheKey()};return ge.vertexUv1s=c.has(1),ge.vertexUv2s=c.has(2),ge.vertexUv3s=c.has(3),c.clear(),ge},getProgramCacheKey:function(t){const n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.customVertexShaderID),n.push(t.customFragmentShaderID)),void 0!==t.defines)for(const e in t.defines)n.push(e),n.push(t.defines[e]);return!1===t.isRawShaderMaterial&&(!function(e,t){e.push(t.precision),e.push(t.outputColorSpace),e.push(t.envMapMode),e.push(t.envMapCubeUVHeight),e.push(t.mapUv),e.push(t.alphaMapUv),e.push(t.lightMapUv),e.push(t.aoMapUv),e.push(t.bumpMapUv),e.push(t.normalMapUv),e.push(t.displacementMapUv),e.push(t.emissiveMapUv),e.push(t.metalnessMapUv),e.push(t.roughnessMapUv),e.push(t.anisotropyMapUv),e.push(t.clearcoatMapUv),e.push(t.clearcoatNormalMapUv),e.push(t.clearcoatRoughnessMapUv),e.push(t.iridescenceMapUv),e.push(t.iridescenceThicknessMapUv),e.push(t.sheenColorMapUv),e.push(t.sheenRoughnessMapUv),e.push(t.specularMapUv),e.push(t.specularColorMapUv),e.push(t.specularIntensityMapUv),e.push(t.transmissionMapUv),e.push(t.thicknessMapUv),e.push(t.combine),e.push(t.fogExp2),e.push(t.sizeAttenuation),e.push(t.morphTargetsCount),e.push(t.morphAttributeCount),e.push(t.numDirLights),e.push(t.numPointLights),e.push(t.numSpotLights),e.push(t.numSpotLightMaps),e.push(t.numHemiLights),e.push(t.numRectAreaLights),e.push(t.numDirLightShadows),e.push(t.numPointLightShadows),e.push(t.numSpotLightShadows),e.push(t.numSpotLightShadowsWithMaps),e.push(t.numLightProbes),e.push(t.shadowMapType),e.push(t.toneMapping),e.push(t.numClippingPlanes),e.push(t.numClipIntersection),e.push(t.depthPacking)}(n,t),function(e,t){o.disableAll(),t.instancing&&o.enable(0);t.instancingColor&&o.enable(1);t.instancingMorph&&o.enable(2);t.matcap&&o.enable(3);t.envMap&&o.enable(4);t.normalMapObjectSpace&&o.enable(5);t.normalMapTangentSpace&&o.enable(6);t.clearcoat&&o.enable(7);t.iridescence&&o.enable(8);t.alphaTest&&o.enable(9);t.vertexColors&&o.enable(10);t.vertexAlphas&&o.enable(11);t.vertexUv1s&&o.enable(12);t.vertexUv2s&&o.enable(13);t.vertexUv3s&&o.enable(14);t.vertexTangents&&o.enable(15);t.anisotropy&&o.enable(16);t.alphaHash&&o.enable(17);t.batching&&o.enable(18);t.dispersion&&o.enable(19);t.batchingColor&&o.enable(20);t.gradientMap&&o.enable(21);e.push(o.mask),o.disableAll(),t.fog&&o.enable(0);t.useFog&&o.enable(1);t.flatShading&&o.enable(2);t.logarithmicDepthBuffer&&o.enable(3);t.reversedDepthBuffer&&o.enable(4);t.skinning&&o.enable(5);t.morphTargets&&o.enable(6);t.morphNormals&&o.enable(7);t.morphColors&&o.enable(8);t.premultipliedAlpha&&o.enable(9);t.shadowMapEnabled&&o.enable(10);t.doubleSided&&o.enable(11);t.flipSided&&o.enable(12);t.useDepthPacking&&o.enable(13);t.dithering&&o.enable(14);t.transmission&&o.enable(15);t.sheen&&o.enable(16);t.opaque&&o.enable(17);t.pointsUvs&&o.enable(18);t.decodeVideoTexture&&o.enable(19);t.decodeVideoTextureEmissive&&o.enable(20);t.alphaToCoverage&&o.enable(21);e.push(o.mask)}(n,t),n.push(e.outputColorSpace)),n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){const t=p[e.type];let n;if(t){const e=Gp[t];n=Wo.clone(e.uniforms)}else n=e.uniforms;return n},acquireProgram:function(t,n){let i=h.get(n);return void 0!==i?++i.usedTimes:(i=new Zg(e,n,t,s),u.push(i),h.set(n,i)),i},releaseProgram:function(e){if(0===--e.usedTimes){const t=u.indexOf(e);u[t]=u[u.length-1],u.pop(),h.delete(e.cacheKey),e.destroy()}},releaseShaderCache:function(e){l.remove(e)},programs:u,dispose:function(){l.dispose()}}}function tv(){let e=new WeakMap;return{has:function(t){return e.has(t)},get:function(t){let n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,i){e.get(t)[n]=i},dispose:function(){e=new WeakMap}}}function nv(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function iv(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function rv(){const e=[];let t=0;const n=[],i=[],r=[];function s(n,i,r,s,a,o){let l=e[t];return void 0===l?(l={id:n.id,object:n,geometry:i,material:r,groupOrder:s,renderOrder:n.renderOrder,z:a,group:o},e[t]=l):(l.id=n.id,l.object=n,l.geometry=i,l.material=r,l.groupOrder=s,l.renderOrder=n.renderOrder,l.z=a,l.group=o),t++,l}return{opaque:n,transmissive:i,transparent:r,init:function(){t=0,n.length=0,i.length=0,r.length=0},push:function(e,t,a,o,l,c){const u=s(e,t,a,o,l,c);a.transmission>0?i.push(u):!0===a.transparent?r.push(u):n.push(u)},unshift:function(e,t,a,o,l,c){const u=s(e,t,a,o,l,c);a.transmission>0?i.unshift(u):!0===a.transparent?r.unshift(u):n.unshift(u)},finish:function(){for(let n=t,i=e.length;n<i;n++){const t=e[n];if(null===t.id)break;t.id=null,t.object=null,t.geometry=null,t.material=null,t.group=null}},sort:function(e,t){n.length>1&&n.sort(e||nv),i.length>1&&i.sort(t||iv),r.length>1&&r.sort(t||iv)}}}function sv(){let e=new WeakMap;return{get:function(t,n){const i=e.get(t);let r;return void 0===i?(r=new rv,e.set(t,[r])):n>=i.length?(r=new rv,i.push(r)):r=i[n],r},dispose:function(){e=new WeakMap}}}function av(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":n={direction:new ss,color:new Za};break;case"SpotLight":n={position:new ss,direction:new ss,color:new Za,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new ss,color:new Za,distance:0,decay:0};break;case"HemisphereLight":n={direction:new ss,skyColor:new Za,groundColor:new Za};break;case"RectAreaLight":n={color:new Za,position:new ss,halfWidth:new ss,halfHeight:new ss}}return e[t.id]=n,n}}}let ov=0;function lv(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function cv(e){const t=new av,n=function(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new is};break;case"PointLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new is,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let o=0;o<9;o++)i.probe.push(new ss);const r=new ss,s=new ra,a=new ra;return{setup:function(r){let s=0,a=0,o=0;for(let e=0;e<9;e++)i.probe[e].set(0,0,0);let l=0,c=0,u=0,h=0,d=0,f=0,p=0,m=0,g=0,v=0,y=0;r.sort(lv);for(let e=0,x=r.length;e<x;e++){const b=r[e],x=b.color,_=b.intensity,S=b.distance;let E=null;if(b.shadow&&b.shadow.map&&(E=b.shadow.map.texture.format===In?b.shadow.map.texture:b.shadow.map.depthTexture||b.shadow.map.texture),b.isAmbientLight)s+=x.r*_,a+=x.g*_,o+=x.b*_;else if(b.isLightProbe){for(let e=0;e<9;e++)i.probe[e].addScaledVector(b.sh.coefficients[e],_);y++}else if(b.isDirectionalLight){const e=t.get(b);if(e.color.copy(b.color).multiplyScalar(b.intensity),b.castShadow){const e=b.shadow,t=n.get(b);t.shadowIntensity=e.intensity,t.shadowBias=e.bias,t.shadowNormalBias=e.normalBias,t.shadowRadius=e.radius,t.shadowMapSize=e.mapSize,i.directionalShadow[l]=t,i.directionalShadowMap[l]=E,i.directionalShadowMatrix[l]=b.shadow.matrix,f++}i.directional[l]=e,l++}else if(b.isSpotLight){const e=t.get(b);e.position.setFromMatrixPosition(b.matrixWorld),e.color.copy(x).multiplyScalar(_),e.distance=S,e.coneCos=Math.cos(b.angle),e.penumbraCos=Math.cos(b.angle*(1-b.penumbra)),e.decay=b.decay,i.spot[u]=e;const r=b.shadow;if(b.map&&(i.spotLightMap[g]=b.map,g++,r.updateMatrices(b),b.castShadow&&v++),i.spotLightMatrix[u]=r.matrix,b.castShadow){const e=n.get(b);e.shadowIntensity=r.intensity,e.shadowBias=r.bias,e.shadowNormalBias=r.normalBias,e.shadowRadius=r.radius,e.shadowMapSize=r.mapSize,i.spotShadow[u]=e,i.spotShadowMap[u]=E,m++}u++}else if(b.isRectAreaLight){const e=t.get(b);e.color.copy(x).multiplyScalar(_),e.halfWidth.set(.5*b.width,0,0),e.halfHeight.set(0,.5*b.height,0),i.rectArea[h]=e,h++}else if(b.isPointLight){const e=t.get(b);if(e.color.copy(b.color).multiplyScalar(b.intensity),e.distance=b.distance,e.decay=b.decay,b.castShadow){const e=b.shadow,t=n.get(b);t.shadowIntensity=e.intensity,t.shadowBias=e.bias,t.shadowNormalBias=e.normalBias,t.shadowRadius=e.radius,t.shadowMapSize=e.mapSize,t.shadowCameraNear=e.camera.near,t.shadowCameraFar=e.camera.far,i.pointShadow[c]=t,i.pointShadowMap[c]=E,i.pointShadowMatrix[c]=b.shadow.matrix,p++}i.point[c]=e,c++}else if(b.isHemisphereLight){const e=t.get(b);e.skyColor.copy(b.color).multiplyScalar(_),e.groundColor.copy(b.groundColor).multiplyScalar(_),i.hemi[d]=e,d++}}h>0&&(!0===e.has("OES_texture_float_linear")?(i.rectAreaLTC1=jp.LTC_FLOAT_1,i.rectAreaLTC2=jp.LTC_FLOAT_2):(i.rectAreaLTC1=jp.LTC_HALF_1,i.rectAreaLTC2=jp.LTC_HALF_2)),i.ambient[0]=s,i.ambient[1]=a,i.ambient[2]=o;const b=i.hash;b.directionalLength===l&&b.pointLength===c&&b.spotLength===u&&b.rectAreaLength===h&&b.hemiLength===d&&b.numDirectionalShadows===f&&b.numPointShadows===p&&b.numSpotShadows===m&&b.numSpotMaps===g&&b.numLightProbes===y||(i.directional.length=l,i.spot.length=u,i.rectArea.length=h,i.point.length=c,i.hemi.length=d,i.directionalShadow.length=f,i.directionalShadowMap.length=f,i.pointShadow.length=p,i.pointShadowMap.length=p,i.spotShadow.length=m,i.spotShadowMap.length=m,i.directionalShadowMatrix.length=f,i.pointShadowMatrix.length=p,i.spotLightMatrix.length=m+g-v,i.spotLightMap.length=g,i.numSpotLightShadowsWithMaps=v,i.numLightProbes=y,b.directionalLength=l,b.pointLength=c,b.spotLength=u,b.rectAreaLength=h,b.hemiLength=d,b.numDirectionalShadows=f,b.numPointShadows=p,b.numSpotShadows=m,b.numSpotMaps=g,b.numLightProbes=y,i.version=ov++)},setupView:function(e,t){let n=0,o=0,l=0,c=0,u=0;const h=t.matrixWorldInverse;for(let d=0,f=e.length;d<f;d++){const t=e[d];if(t.isDirectionalLight){const e=i.directional[n];e.direction.setFromMatrixPosition(t.matrixWorld),r.setFromMatrixPosition(t.target.matrixWorld),e.direction.sub(r),e.direction.transformDirection(h),n++}else if(t.isSpotLight){const e=i.spot[l];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(h),e.direction.setFromMatrixPosition(t.matrixWorld),r.setFromMatrixPosition(t.target.matrixWorld),e.direction.sub(r),e.direction.transformDirection(h),l++}else if(t.isRectAreaLight){const e=i.rectArea[c];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(h),a.identity(),s.copy(t.matrixWorld),s.premultiply(h),a.extractRotation(s),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),e.halfWidth.applyMatrix4(a),e.halfHeight.applyMatrix4(a),c++}else if(t.isPointLight){const e=i.point[o];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(h),o++}else if(t.isHemisphereLight){const e=i.hemi[u];e.direction.setFromMatrixPosition(t.matrixWorld),e.direction.transformDirection(h),u++}}},state:i}}function uv(e){const t=new cv(e),n=[],i=[];const r={lightsArray:n,shadowsArray:i,camera:null,lights:t,transmissionRenderTarget:{}};return{init:function(e){r.camera=e,n.length=0,i.length=0},state:r,setupLights:function(){t.setup(n)},setupLightsView:function(e){t.setupView(n,e)},pushLight:function(e){n.push(e)},pushShadow:function(e){i.push(e)}}}function hv(e){let t=new WeakMap;return{get:function(n){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const r=t.get(n);let s;return void 0===r?(s=new uv(e),t.set(n,[s])):i>=r.length?(s=new uv(e),r.push(s)):s=r[i],s},dispose:function(){t=new WeakMap}}}const dv=[new ss(1,0,0),new ss(-1,0,0),new ss(0,1,0),new ss(0,-1,0),new ss(0,0,1),new ss(0,0,-1)],fv=[new ss(0,-1,0),new ss(0,-1,0),new ss(0,0,1),new ss(0,0,-1),new ss(0,-1,0),new ss(0,-1,0)],pv=new ra,mv=new ss,gv=new ss;function vv(e,t,n){let i=new oc;const r=new is,s=new is,a=new Ts,o=new jh,l=new Gh,c={},u=n.maxTextureSize,h={[Ke]:Ze,[Ze]:Ke,[Je]:Je},d=new Yo({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new is},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ).rg;\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ).r;\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( max( 0.0, squared_mean - mean * mean ) );\n\tgl_FragColor = vec4( mean, std_dev, 0.0, 1.0 );\n}"}),f=d.clone();f.defines.HORIZONTAL_PASS=1;const p=new Mo;p.setAttribute("position",new co(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const m=new Bo(p,d),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=Ye;let v=this.type;function y(n,i){const s=t.update(m);d.defines.VSM_SAMPLES!==n.blurSamples&&(d.defines.VSM_SAMPLES=n.blurSamples,f.defines.VSM_SAMPLES=n.blurSamples,d.needsUpdate=!0,f.needsUpdate=!0),null===n.mapPass&&(n.mapPass=new As(r.x,r.y,{format:In,type:yn})),d.uniforms.shadow_pass.value=n.map.depthTexture,d.uniforms.resolution.value=n.mapSize,d.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(i,null,s,d,m,null),f.uniforms.shadow_pass.value=n.mapPass.texture,f.uniforms.resolution.value=n.mapSize,f.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(i,null,s,f,m,null)}function b(t,n,i,r){let s=null;const a=!0===i.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(void 0!==a)s=a;else if(s=!0===i.isPointLight?l:o,e.localClippingEnabled&&!0===n.clipShadows&&Array.isArray(n.clippingPlanes)&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0||n.map&&n.alphaTest>0||!0===n.alphaToCoverage){const e=s.uuid,t=n.uuid;let i=c[e];void 0===i&&(i={},c[e]=i);let r=i[t];void 0===r&&(r=s.clone(),i[t]=r,n.addEventListener("dispose",_)),s=r}if(s.visible=n.visible,s.wireframe=n.wireframe,s.side=r===qe?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:h[n.side],s.alphaMap=n.alphaMap,s.alphaTest=!0===n.alphaToCoverage?.5:n.alphaTest,s.map=n.map,s.clipShadows=n.clipShadows,s.clippingPlanes=n.clippingPlanes,s.clipIntersection=n.clipIntersection,s.displacementMap=n.displacementMap,s.displacementScale=n.displacementScale,s.displacementBias=n.displacementBias,s.wireframeLinewidth=n.wireframeLinewidth,s.linewidth=n.linewidth,!0===i.isPointLight&&!0===s.isMeshDistanceMaterial){e.properties.get(s).light=i}return s}function x(n,r,s,a,o){if(!1===n.visible)return;if(n.layers.test(r.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&o===qe)&&(!n.frustumCulled||i.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,n.matrixWorld);const i=t.update(n),l=n.material;if(Array.isArray(l)){const t=i.groups;for(let c=0,u=t.length;c<u;c++){const u=t[c],h=l[u.materialIndex];if(h&&h.visible){const t=b(n,h,a,o);n.onBeforeShadow(e,n,r,s,i,t,u),e.renderBufferDirect(s,null,i,t,n,u),n.onAfterShadow(e,n,r,s,i,t,u)}}}else if(l.visible){const t=b(n,l,a,o);n.onBeforeShadow(e,n,r,s,i,t,null),e.renderBufferDirect(s,null,i,t,n,null),n.onAfterShadow(e,n,r,s,i,t,null)}}const l=n.children;for(let e=0,t=l.length;e<t;e++)x(l[e],r,s,a,o)}function _(e){e.target.removeEventListener("dispose",_);for(const t in c){const n=c[t],i=e.target.uuid;if(i in n){n[i].dispose(),delete n[i]}}}this.render=function(t,n,o){if(!1===g.enabled)return;if(!1===g.autoUpdate&&!1===g.needsUpdate)return;if(0===t.length)return;t.type===Xe&&(Gr("WebGLShadowMap: PCFSoftShadowMap has been deprecated. Using PCFShadowMap instead."),t.type=Ye);const l=e.getRenderTarget(),c=e.getActiveCubeFace(),h=e.getActiveMipmapLevel(),d=e.state;d.setBlending(Qe),!0===d.buffers.depth.getReversed()?d.buffers.color.setClear(0,0,0,0):d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);const f=v!==this.type;f&&n.traverse(function(e){e.material&&(Array.isArray(e.material)?e.material.forEach(e=>e.needsUpdate=!0):e.material.needsUpdate=!0)});for(let p=0,m=t.length;p<m;p++){const l=t[p],c=l.shadow;if(void 0===c){Gr("WebGLShadowMap:",l,"has no shadow.");continue}if(!1===c.autoUpdate&&!1===c.needsUpdate)continue;r.copy(c.mapSize);const h=c.getFrameExtents();if(r.multiply(h),s.copy(c.mapSize),(r.x>u||r.y>u)&&(r.x>u&&(s.x=Math.floor(u/h.x),r.x=s.x*h.x,c.mapSize.x=s.x),r.y>u&&(s.y=Math.floor(u/h.y),r.y=s.y*h.y,c.mapSize.y=s.y)),null===c.map||!0===f){if(null!==c.map&&(null!==c.map.depthTexture&&(c.map.depthTexture.dispose(),c.map.depthTexture=null),c.map.dispose()),this.type===qe){if(l.isPointLight){Gr("WebGLShadowMap: VSM shadow maps are not supported for PointLights. Use PCF or BasicShadowMap instead.");continue}c.map=new As(r.x,r.y,{format:In,type:yn,minFilter:an,magFilter:an,generateMipmaps:!1}),c.map.texture.name=l.name+".shadowMap",c.map.depthTexture=new ru(r.x,r.y,vn),c.map.depthTexture.name=l.name+".shadowMapDepth",c.map.depthTexture.format=Mn,c.map.depthTexture.compareFunction=null,c.map.depthTexture.minFilter=en,c.map.depthTexture.magFilter=en}else{l.isPointLight?(c.map=new tl(r.x),c.map.depthTexture=new su(r.x,gn)):(c.map=new As(r.x,r.y),c.map.depthTexture=new ru(r.x,r.y,gn)),c.map.depthTexture.name=l.name+".shadowMap",c.map.depthTexture.format=Mn;const t=e.state.buffers.depth.getReversed();this.type===Ye?(c.map.depthTexture.compareFunction=t?fr:ur,c.map.depthTexture.minFilter=an,c.map.depthTexture.magFilter=an):(c.map.depthTexture.compareFunction=null,c.map.depthTexture.minFilter=en,c.map.depthTexture.magFilter=en)}c.camera.updateProjectionMatrix()}const m=c.map.isWebGLCubeRenderTarget?6:1;for(let t=0;t<m;t++){if(c.map.isWebGLCubeRenderTarget)e.setRenderTarget(c.map,t),e.clear();else{0===t&&(e.setRenderTarget(c.map),e.clear());const n=c.getViewport(t);a.set(s.x*n.x,s.y*n.y,s.x*n.z,s.y*n.w),d.viewport(a)}if(l.isPointLight){const e=c.camera,n=c.matrix,i=l.distance||e.far;i!==e.far&&(e.far=i,e.updateProjectionMatrix()),mv.setFromMatrixPosition(l.matrixWorld),e.position.copy(mv),gv.copy(e.position),gv.add(dv[t]),e.up.copy(fv[t]),e.lookAt(gv),e.updateMatrixWorld(),n.makeTranslation(-mv.x,-mv.y,-mv.z),pv.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),c._frustum.setFromProjectionMatrix(pv,e.coordinateSystem,e.reversedDepth)}else c.updateMatrices(l);i=c.getFrustum(),x(n,o,c.camera,l,this.type)}!0!==c.isPointLightShadow&&this.type===qe&&y(c,o),c.needsUpdate=!1}v=this.type,g.needsUpdate=!1,e.setRenderTarget(l,c,h)}}const yv={[Tt]:wt,[At]:Lt,[Rt]:It,[Mt]:Ct,[wt]:Tt,[Lt]:At,[It]:Rt,[Ct]:Mt};function bv(e,t){const n=new function(){let t=!1;const n=new Ts;let i=null;const r=new Ts(0,0,0,0);return{setMask:function(n){i===n||t||(e.colorMask(n,n,n,n),i=n)},setLocked:function(e){t=e},setClear:function(t,i,s,a,o){!0===o&&(t*=a,i*=a,s*=a),n.set(t,i,s,a),!1===r.equals(n)&&(e.clearColor(t,i,s,a),r.copy(n))},reset:function(){t=!1,i=null,r.set(-1,0,0,0)}}},i=new function(){let n=!1,i=!1,r=null,s=null,a=null;return{setReversed:function(e){if(i!==e){const n=t.get("EXT_clip_control");e?n.clipControlEXT(n.LOWER_LEFT_EXT,n.ZERO_TO_ONE_EXT):n.clipControlEXT(n.LOWER_LEFT_EXT,n.NEGATIVE_ONE_TO_ONE_EXT),i=e;const r=a;a=null,this.setClear(r)}},getReversed:function(){return i},setTest:function(t){t?z(e.DEPTH_TEST):j(e.DEPTH_TEST)},setMask:function(t){r===t||n||(e.depthMask(t),r=t)},setFunc:function(t){if(i&&(t=yv[t]),s!==t){switch(t){case Tt:e.depthFunc(e.NEVER);break;case wt:e.depthFunc(e.ALWAYS);break;case At:e.depthFunc(e.LESS);break;case Mt:e.depthFunc(e.LEQUAL);break;case Rt:e.depthFunc(e.EQUAL);break;case Ct:e.depthFunc(e.GEQUAL);break;case Lt:e.depthFunc(e.GREATER);break;case It:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL)}s=t}},setLocked:function(e){n=e},setClear:function(t){a!==t&&(i&&(t=1-t),e.clearDepth(t),a=t)},reset:function(){n=!1,r=null,s=null,a=null,i=!1}}},r=new function(){let t=!1,n=null,i=null,r=null,s=null,a=null,o=null,l=null,c=null;return{setTest:function(n){t||(n?z(e.STENCIL_TEST):j(e.STENCIL_TEST))},setMask:function(i){n===i||t||(e.stencilMask(i),n=i)},setFunc:function(t,n,a){i===t&&r===n&&s===a||(e.stencilFunc(t,n,a),i=t,r=n,s=a)},setOp:function(t,n,i){a===t&&o===n&&l===i||(e.stencilOp(t,n,i),a=t,o=n,l=i)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,n=null,i=null,r=null,s=null,a=null,o=null,l=null,c=null}}},s=new WeakMap,a=new WeakMap;let o={},l={},c=new WeakMap,u=[],h=null,d=!1,f=null,p=null,m=null,g=null,v=null,y=null,b=null,x=new Za(0,0,0),_=0,S=!1,E=null,T=null,w=null,A=null,M=null;const R=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let C=!1,L=0;const I=e.getParameter(e.VERSION);-1!==I.indexOf("WebGL")?(L=parseFloat(/^WebGL (\d)/.exec(I)[1]),C=L>=1):-1!==I.indexOf("OpenGL ES")&&(L=parseFloat(/^OpenGL ES (\d)/.exec(I)[1]),C=L>=2);let P=null,k={};const D=e.getParameter(e.SCISSOR_BOX),N=e.getParameter(e.VIEWPORT),O=(new Ts).fromArray(D),F=(new Ts).fromArray(N);function U(t,n,i,r){const s=new Uint8Array(4),a=e.createTexture();e.bindTexture(t,a),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(let o=0;o<i;o++)t===e.TEXTURE_3D||t===e.TEXTURE_2D_ARRAY?e.texImage3D(n,0,e.RGBA,1,1,r,0,e.RGBA,e.UNSIGNED_BYTE,s):e.texImage2D(n+o,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,s);return a}const B={};function z(t){!0!==o[t]&&(e.enable(t),o[t]=!0)}function j(t){!1!==o[t]&&(e.disable(t),o[t]=!1)}B[e.TEXTURE_2D]=U(e.TEXTURE_2D,e.TEXTURE_2D,1),B[e.TEXTURE_CUBE_MAP]=U(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),B[e.TEXTURE_2D_ARRAY]=U(e.TEXTURE_2D_ARRAY,e.TEXTURE_2D_ARRAY,1,1),B[e.TEXTURE_3D]=U(e.TEXTURE_3D,e.TEXTURE_3D,1,1),n.setClear(0,0,0,1),i.setClear(1),r.setClear(0),z(e.DEPTH_TEST),i.setFunc(Mt),W(!1),Y(Ge),z(e.CULL_FACE),H(Qe);const G={[rt]:e.FUNC_ADD,[st]:e.FUNC_SUBTRACT,[at]:e.FUNC_REVERSE_SUBTRACT};G[ot]=e.MIN,G[lt]=e.MAX;const V={[ct]:e.ZERO,[ut]:e.ONE,[ht]:e.SRC_COLOR,[ft]:e.SRC_ALPHA,[bt]:e.SRC_ALPHA_SATURATE,[vt]:e.DST_COLOR,[mt]:e.DST_ALPHA,[dt]:e.ONE_MINUS_SRC_COLOR,[pt]:e.ONE_MINUS_SRC_ALPHA,[yt]:e.ONE_MINUS_DST_COLOR,[gt]:e.ONE_MINUS_DST_ALPHA,[xt]:e.CONSTANT_COLOR,[_t]:e.ONE_MINUS_CONSTANT_COLOR,[St]:e.CONSTANT_ALPHA,[Et]:e.ONE_MINUS_CONSTANT_ALPHA};function H(t,n,i,r,s,a,o,l,c,u){if(t!==Qe){if(!1===d&&(z(e.BLEND),d=!0),t===it)s=s||n,a=a||i,o=o||r,n===p&&s===v||(e.blendEquationSeparate(G[n],G[s]),p=n,v=s),i===m&&r===g&&a===y&&o===b||(e.blendFuncSeparate(V[i],V[r],V[a],V[o]),m=i,g=r,y=a,b=o),!1!==l.equals(x)&&c===_||(e.blendColor(l.r,l.g,l.b,c),x.copy(l),_=c),f=t,S=!1;else if(t!==f||u!==S){if(p===rt&&v===rt||(e.blendEquation(e.FUNC_ADD),p=rt,v=rt),u)switch(t){case $e:e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case et:e.blendFunc(e.ONE,e.ONE);break;case tt:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case nt:e.blendFuncSeparate(e.DST_COLOR,e.ONE_MINUS_SRC_ALPHA,e.ZERO,e.ONE);break;default:Vr("WebGLState: Invalid blending: ",t)}else switch(t){case $e:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case et:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE,e.ONE,e.ONE);break;case tt:Vr("WebGLState: SubtractiveBlending requires material.premultipliedAlpha = true");break;case nt:Vr("WebGLState: MultiplyBlending requires material.premultipliedAlpha = true");break;default:Vr("WebGLState: Invalid blending: ",t)}m=null,g=null,y=null,b=null,x.set(0,0,0),_=0,f=t,S=u}}else!0===d&&(j(e.BLEND),d=!1)}function W(t){E!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),E=t)}function Y(t){t!==je?(z(e.CULL_FACE),t!==T&&(t===Ge?e.cullFace(e.BACK):t===Ve?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):j(e.CULL_FACE),T=t}function X(t,n,i){t?(z(e.POLYGON_OFFSET_FILL),A===n&&M===i||(e.polygonOffset(n,i),A=n,M=i)):j(e.POLYGON_OFFSET_FILL)}return{buffers:{color:n,depth:i,stencil:r},enable:z,disable:j,bindFramebuffer:function(t,n){return l[t]!==n&&(e.bindFramebuffer(t,n),l[t]=n,t===e.DRAW_FRAMEBUFFER&&(l[e.FRAMEBUFFER]=n),t===e.FRAMEBUFFER&&(l[e.DRAW_FRAMEBUFFER]=n),!0)},drawBuffers:function(t,n){let i=u,r=!1;if(t){i=c.get(n),void 0===i&&(i=[],c.set(n,i));const s=t.textures;if(i.length!==s.length||i[0]!==e.COLOR_ATTACHMENT0){for(let t=0,n=s.length;t<n;t++)i[t]=e.COLOR_ATTACHMENT0+t;i.length=s.length,r=!0}}else i[0]!==e.BACK&&(i[0]=e.BACK,r=!0);r&&e.drawBuffers(i)},useProgram:function(t){return h!==t&&(e.useProgram(t),h=t,!0)},setBlending:H,setMaterial:function(t,s){t.side===Je?j(e.CULL_FACE):z(e.CULL_FACE);let a=t.side===Ze;s&&(a=!a),W(a),t.blending===$e&&!1===t.transparent?H(Qe):H(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.blendColor,t.blendAlpha,t.premultipliedAlpha),i.setFunc(t.depthFunc),i.setTest(t.depthTest),i.setMask(t.depthWrite),n.setMask(t.colorWrite);const o=t.stencilWrite;r.setTest(o),o&&(r.setMask(t.stencilWriteMask),r.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),r.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),X(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage?z(e.SAMPLE_ALPHA_TO_COVERAGE):j(e.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:W,setCullFace:Y,setLineWidth:function(t){t!==w&&(C&&e.lineWidth(t),w=t)},setPolygonOffset:X,setScissorTest:function(t){t?z(e.SCISSOR_TEST):j(e.SCISSOR_TEST)},activeTexture:function(t){void 0===t&&(t=e.TEXTURE0+R-1),P!==t&&(e.activeTexture(t),P=t)},bindTexture:function(t,n,i){void 0===i&&(i=null===P?e.TEXTURE0+R-1:P);let r=k[i];void 0===r&&(r={type:void 0,texture:void 0},k[i]=r),r.type===t&&r.texture===n||(P!==i&&(e.activeTexture(i),P=i),e.bindTexture(t,n||B[t]),r.type=t,r.texture=n)},unbindTexture:function(){const t=k[P];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D(...arguments)}catch(Px){Vr("WebGLState:",Px)}},compressedTexImage3D:function(){try{e.compressedTexImage3D(...arguments)}catch(Px){Vr("WebGLState:",Px)}},texImage2D:function(){try{e.texImage2D(...arguments)}catch(Px){Vr("WebGLState:",Px)}},texImage3D:function(){try{e.texImage3D(...arguments)}catch(Px){Vr("WebGLState:",Px)}},updateUBOMapping:function(t,n){let i=a.get(n);void 0===i&&(i=new WeakMap,a.set(n,i));let r=i.get(t);void 0===r&&(r=e.getUniformBlockIndex(n,t.name),i.set(t,r))},uniformBlockBinding:function(t,n){const i=a.get(n).get(t);s.get(n)!==i&&(e.uniformBlockBinding(n,i,t.__bindingPointIndex),s.set(n,i))},texStorage2D:function(){try{e.texStorage2D(...arguments)}catch(Px){Vr("WebGLState:",Px)}},texStorage3D:function(){try{e.texStorage3D(...arguments)}catch(Px){Vr("WebGLState:",Px)}},texSubImage2D:function(){try{e.texSubImage2D(...arguments)}catch(Px){Vr("WebGLState:",Px)}},texSubImage3D:function(){try{e.texSubImage3D(...arguments)}catch(Px){Vr("WebGLState:",Px)}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D(...arguments)}catch(Px){Vr("WebGLState:",Px)}},compressedTexSubImage3D:function(){try{e.compressedTexSubImage3D(...arguments)}catch(Px){Vr("WebGLState:",Px)}},scissor:function(t){!1===O.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),O.copy(t))},viewport:function(t){!1===F.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),F.copy(t))},reset:function(){e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.disable(e.SAMPLE_ALPHA_TO_COVERAGE),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.blendFuncSeparate(e.ONE,e.ZERO,e.ONE,e.ZERO),e.blendColor(0,0,0,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(e.LESS),i.setReversed(!1),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.clearStencil(0),e.cullFace(e.BACK),e.frontFace(e.CCW),e.polygonOffset(0,0),e.activeTexture(e.TEXTURE0),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),e.bindFramebuffer(e.READ_FRAMEBUFFER,null),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),o={},P=null,k={},l={},c=new WeakMap,u=[],h=null,d=!1,f=null,p=null,m=null,g=null,v=null,y=null,b=null,x=new Za(0,0,0),_=0,S=!1,E=null,T=null,w=null,A=null,M=null,O.set(0,0,e.canvas.width,e.canvas.height),F.set(0,0,e.canvas.width,e.canvas.height),n.reset(),i.reset(),r.reset()}}}function xv(e,t,n,i,r,s,a){const o=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,l="undefined"!==typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),c=new is,u=new WeakMap;let h;const d=new WeakMap;let f=!1;try{f="undefined"!==typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(H){}function p(e,t){return f?new OffscreenCanvas(e,t):Nr("canvas")}function m(e,t,n){let i=1;const r=V(e);if((r.width>n||r.height>n)&&(i=n/Math.max(r.width,r.height)),i<1){if("undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!==typeof VideoFrame&&e instanceof VideoFrame){const n=Math.floor(i*r.width),s=Math.floor(i*r.height);void 0===h&&(h=p(n,s));const a=t?p(n,s):h;a.width=n,a.height=s;return a.getContext("2d").drawImage(e,0,0,n,s),Gr("WebGLRenderer: Texture has been resized from ("+r.width+"x"+r.height+") to ("+n+"x"+s+")."),a}return"data"in e&&Gr("WebGLRenderer: Image in DataTexture is too big ("+r.width+"x"+r.height+")."),e}return e}function g(e){return e.generateMipmaps}function v(t){e.generateMipmap(t)}function y(t){return t.isWebGLCubeRenderTarget?e.TEXTURE_CUBE_MAP:t.isWebGL3DRenderTarget?e.TEXTURE_3D:t.isWebGLArrayRenderTarget||t.isCompressedArrayTexture?e.TEXTURE_2D_ARRAY:e.TEXTURE_2D}function b(n,i,r,s){let a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(null!==n){if(void 0!==e[n])return e[n];Gr("WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let o=i;if(i===e.RED&&(r===e.FLOAT&&(o=e.R32F),r===e.HALF_FLOAT&&(o=e.R16F),r===e.UNSIGNED_BYTE&&(o=e.R8)),i===e.RED_INTEGER&&(r===e.UNSIGNED_BYTE&&(o=e.R8UI),r===e.UNSIGNED_SHORT&&(o=e.R16UI),r===e.UNSIGNED_INT&&(o=e.R32UI),r===e.BYTE&&(o=e.R8I),r===e.SHORT&&(o=e.R16I),r===e.INT&&(o=e.R32I)),i===e.RG&&(r===e.FLOAT&&(o=e.RG32F),r===e.HALF_FLOAT&&(o=e.RG16F),r===e.UNSIGNED_BYTE&&(o=e.RG8)),i===e.RG_INTEGER&&(r===e.UNSIGNED_BYTE&&(o=e.RG8UI),r===e.UNSIGNED_SHORT&&(o=e.RG16UI),r===e.UNSIGNED_INT&&(o=e.RG32UI),r===e.BYTE&&(o=e.RG8I),r===e.SHORT&&(o=e.RG16I),r===e.INT&&(o=e.RG32I)),i===e.RGB_INTEGER&&(r===e.UNSIGNED_BYTE&&(o=e.RGB8UI),r===e.UNSIGNED_SHORT&&(o=e.RGB16UI),r===e.UNSIGNED_INT&&(o=e.RGB32UI),r===e.BYTE&&(o=e.RGB8I),r===e.SHORT&&(o=e.RGB16I),r===e.INT&&(o=e.RGB32I)),i===e.RGBA_INTEGER&&(r===e.UNSIGNED_BYTE&&(o=e.RGBA8UI),r===e.UNSIGNED_SHORT&&(o=e.RGBA16UI),r===e.UNSIGNED_INT&&(o=e.RGBA32UI),r===e.BYTE&&(o=e.RGBA8I),r===e.SHORT&&(o=e.RGBA16I),r===e.INT&&(o=e.RGBA32I)),i===e.RGB&&(r===e.UNSIGNED_INT_5_9_9_9_REV&&(o=e.RGB9_E5),r===e.UNSIGNED_INT_10F_11F_11F_REV&&(o=e.R11F_G11F_B10F)),i===e.RGBA){const t=a?zi:fs.getTransfer(s);r===e.FLOAT&&(o=e.RGBA32F),r===e.HALF_FLOAT&&(o=e.RGBA16F),r===e.UNSIGNED_BYTE&&(o=t===ji?e.SRGB8_ALPHA8:e.RGBA8),r===e.UNSIGNED_SHORT_4_4_4_4&&(o=e.RGBA4),r===e.UNSIGNED_SHORT_5_5_5_1&&(o=e.RGB5_A1)}return o!==e.R16F&&o!==e.R32F&&o!==e.RG16F&&o!==e.RG32F&&o!==e.RGBA16F&&o!==e.RGBA32F||t.get("EXT_color_buffer_float"),o}function x(t,n){let i;return t?null===n||n===gn||n===_n?i=e.DEPTH24_STENCIL8:n===vn?i=e.DEPTH32F_STENCIL8:n===pn&&(i=e.DEPTH24_STENCIL8,Gr("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):null===n||n===gn||n===_n?i=e.DEPTH_COMPONENT24:n===vn?i=e.DEPTH_COMPONENT32F:n===pn&&(i=e.DEPTH_COMPONENT16),i}function _(e,t){return!0===g(e)||e.isFramebufferTexture&&e.minFilter!==en&&e.minFilter!==an?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}function S(e){const t=e.target;t.removeEventListener("dispose",S),function(e){const t=i.get(e);if(void 0===t.__webglInit)return;const n=e.source,r=d.get(n);if(r){const i=r[t.__cacheKey];i.usedTimes--,0===i.usedTimes&&T(e),0===Object.keys(r).length&&d.delete(n)}i.remove(e)}(t),t.isVideoTexture&&u.delete(t)}function E(t){const n=t.target;n.removeEventListener("dispose",E),function(t){const n=i.get(t);t.depthTexture&&(t.depthTexture.dispose(),i.remove(t.depthTexture));if(t.isWebGLCubeRenderTarget)for(let i=0;i<6;i++){if(Array.isArray(n.__webglFramebuffer[i]))for(let t=0;t<n.__webglFramebuffer[i].length;t++)e.deleteFramebuffer(n.__webglFramebuffer[i][t]);else e.deleteFramebuffer(n.__webglFramebuffer[i]);n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer[i])}else{if(Array.isArray(n.__webglFramebuffer))for(let t=0;t<n.__webglFramebuffer.length;t++)e.deleteFramebuffer(n.__webglFramebuffer[t]);else e.deleteFramebuffer(n.__webglFramebuffer);if(n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer),n.__webglMultisampledFramebuffer&&e.deleteFramebuffer(n.__webglMultisampledFramebuffer),n.__webglColorRenderbuffer)for(let t=0;t<n.__webglColorRenderbuffer.length;t++)n.__webglColorRenderbuffer[t]&&e.deleteRenderbuffer(n.__webglColorRenderbuffer[t]);n.__webglDepthRenderbuffer&&e.deleteRenderbuffer(n.__webglDepthRenderbuffer)}const r=t.textures;for(let s=0,o=r.length;s<o;s++){const t=i.get(r[s]);t.__webglTexture&&(e.deleteTexture(t.__webglTexture),a.memory.textures--),i.remove(r[s])}i.remove(t)}(n)}function T(t){const n=i.get(t);e.deleteTexture(n.__webglTexture);const r=t.source;delete d.get(r)[n.__cacheKey],a.memory.textures--}let w=0;function A(t,r){const s=i.get(t);if(t.isVideoTexture&&function(e){const t=a.render.frame;u.get(e)!==t&&(u.set(e,t),e.update())}(t),!1===t.isRenderTargetTexture&&!0!==t.isExternalTexture&&t.version>0&&s.__version!==t.version){const e=t.image;if(null===e)Gr("WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==e.complete)return void k(s,t,r);Gr("WebGLRenderer: Texture marked for update but image is incomplete")}}else t.isExternalTexture&&(s.__webglTexture=t.sourceTexture?t.sourceTexture:null);n.bindTexture(e.TEXTURE_2D,s.__webglTexture,e.TEXTURE0+r)}const M={[Jt]:e.REPEAT,[Qt]:e.CLAMP_TO_EDGE,[$t]:e.MIRRORED_REPEAT},R={[en]:e.NEAREST,[tn]:e.NEAREST_MIPMAP_NEAREST,[rn]:e.NEAREST_MIPMAP_LINEAR,[an]:e.LINEAR,[on]:e.LINEAR_MIPMAP_NEAREST,[cn]:e.LINEAR_MIPMAP_LINEAR},C={[or]:e.NEVER,[pr]:e.ALWAYS,[lr]:e.LESS,[ur]:e.LEQUAL,[cr]:e.EQUAL,[fr]:e.GEQUAL,[hr]:e.GREATER,[dr]:e.NOTEQUAL};function L(n,s){if(s.type!==vn||!1!==t.has("OES_texture_float_linear")||s.magFilter!==an&&s.magFilter!==on&&s.magFilter!==rn&&s.magFilter!==cn&&s.minFilter!==an&&s.minFilter!==on&&s.minFilter!==rn&&s.minFilter!==cn||Gr("WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),e.texParameteri(n,e.TEXTURE_WRAP_S,M[s.wrapS]),e.texParameteri(n,e.TEXTURE_WRAP_T,M[s.wrapT]),n!==e.TEXTURE_3D&&n!==e.TEXTURE_2D_ARRAY||e.texParameteri(n,e.TEXTURE_WRAP_R,M[s.wrapR]),e.texParameteri(n,e.TEXTURE_MAG_FILTER,R[s.magFilter]),e.texParameteri(n,e.TEXTURE_MIN_FILTER,R[s.minFilter]),s.compareFunction&&(e.texParameteri(n,e.TEXTURE_COMPARE_MODE,e.COMPARE_REF_TO_TEXTURE),e.texParameteri(n,e.TEXTURE_COMPARE_FUNC,C[s.compareFunction])),!0===t.has("EXT_texture_filter_anisotropic")){if(s.magFilter===en)return;if(s.minFilter!==rn&&s.minFilter!==cn)return;if(s.type===vn&&!1===t.has("OES_texture_float_linear"))return;if(s.anisotropy>1||i.get(s).__currentAnisotropy){const a=t.get("EXT_texture_filter_anisotropic");e.texParameterf(n,a.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,r.getMaxAnisotropy())),i.get(s).__currentAnisotropy=s.anisotropy}}}function I(t,n){let i=!1;void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",S));const r=n.source;let s=d.get(r);void 0===s&&(s={},d.set(r,s));const o=function(e){const t=[];return t.push(e.wrapS),t.push(e.wrapT),t.push(e.wrapR||0),t.push(e.magFilter),t.push(e.minFilter),t.push(e.anisotropy),t.push(e.internalFormat),t.push(e.format),t.push(e.type),t.push(e.generateMipmaps),t.push(e.premultiplyAlpha),t.push(e.flipY),t.push(e.unpackAlignment),t.push(e.colorSpace),t.join()}(n);if(o!==t.__cacheKey){void 0===s[o]&&(s[o]={texture:e.createTexture(),usedTimes:0},a.memory.textures++,i=!0),s[o].usedTimes++;const r=s[t.__cacheKey];void 0!==r&&(s[t.__cacheKey].usedTimes--,0===r.usedTimes&&T(n)),t.__cacheKey=o,t.__webglTexture=s[o].texture}return i}function P(e,t,n){return Math.floor(Math.floor(e/n)/t)}function k(t,a,o){let l=e.TEXTURE_2D;(a.isDataArrayTexture||a.isCompressedArrayTexture)&&(l=e.TEXTURE_2D_ARRAY),a.isData3DTexture&&(l=e.TEXTURE_3D);const c=I(t,a),u=a.source;n.bindTexture(l,t.__webglTexture,e.TEXTURE0+o);const h=i.get(u);if(u.version!==h.__version||!0===c){n.activeTexture(e.TEXTURE0+o);const t=fs.getPrimaries(fs.workingColorSpace),i=a.colorSpace===Fi?null:fs.getPrimaries(a.colorSpace),d=a.colorSpace===Fi||t===i?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,a.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,a.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,d);let f=m(a.image,!1,r.maxTextureSize);f=G(a,f);const p=s.convert(a.format,a.colorSpace),y=s.convert(a.type);let S,E=b(a.internalFormat,p,y,a.colorSpace,a.isVideoTexture);L(l,a);const T=a.mipmaps,w=!0!==a.isVideoTexture,A=void 0===h.__version||!0===c,M=u.dataReady,R=_(a,f);if(a.isDepthTexture)E=x(a.format===Rn,a.type),A&&(w?n.texStorage2D(e.TEXTURE_2D,1,E,f.width,f.height):n.texImage2D(e.TEXTURE_2D,0,E,f.width,f.height,0,p,y,null));else if(a.isDataTexture)if(T.length>0){w&&A&&n.texStorage2D(e.TEXTURE_2D,R,E,T[0].width,T[0].height);for(let t=0,i=T.length;t<i;t++)S=T[t],w?M&&n.texSubImage2D(e.TEXTURE_2D,t,0,0,S.width,S.height,p,y,S.data):n.texImage2D(e.TEXTURE_2D,t,E,S.width,S.height,0,p,y,S.data);a.generateMipmaps=!1}else w?(A&&n.texStorage2D(e.TEXTURE_2D,R,E,f.width,f.height),M&&function(t,i,r,s){const a=t.updateRanges;if(0===a.length)n.texSubImage2D(e.TEXTURE_2D,0,0,0,i.width,i.height,r,s,i.data);else{a.sort((e,t)=>e.start-t.start);let o=0;for(let e=1;e<a.length;e++){const t=a[o],n=a[e],r=t.start+t.count,s=P(n.start,i.width,4),l=P(t.start,i.width,4);n.start<=r+1&&s===l&&P(n.start+n.count-1,i.width,4)===s?t.count=Math.max(t.count,n.start+n.count-t.start):(++o,a[o]=n)}a.length=o+1;const l=e.getParameter(e.UNPACK_ROW_LENGTH),c=e.getParameter(e.UNPACK_SKIP_PIXELS),u=e.getParameter(e.UNPACK_SKIP_ROWS);e.pixelStorei(e.UNPACK_ROW_LENGTH,i.width);for(let t=0,h=a.length;t<h;t++){const o=a[t],l=Math.floor(o.start/4),c=Math.ceil(o.count/4),u=l%i.width,h=Math.floor(l/i.width),d=c,f=1;e.pixelStorei(e.UNPACK_SKIP_PIXELS,u),e.pixelStorei(e.UNPACK_SKIP_ROWS,h),n.texSubImage2D(e.TEXTURE_2D,0,u,h,d,f,r,s,i.data)}t.clearUpdateRanges(),e.pixelStorei(e.UNPACK_ROW_LENGTH,l),e.pixelStorei(e.UNPACK_SKIP_PIXELS,c),e.pixelStorei(e.UNPACK_SKIP_ROWS,u)}}(a,f,p,y)):n.texImage2D(e.TEXTURE_2D,0,E,f.width,f.height,0,p,y,f.data);else if(a.isCompressedTexture)if(a.isCompressedArrayTexture){w&&A&&n.texStorage3D(e.TEXTURE_2D_ARRAY,R,E,T[0].width,T[0].height,f.depth);for(let t=0,i=T.length;t<i;t++)if(S=T[t],a.format!==An)if(null!==p)if(w){if(M)if(a.layerUpdates.size>0){const i=Op(S.width,S.height,a.format,a.type);for(const r of a.layerUpdates){const s=S.data.subarray(r*i/S.data.BYTES_PER_ELEMENT,(r+1)*i/S.data.BYTES_PER_ELEMENT);n.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,r,S.width,S.height,1,p,s)}a.clearLayerUpdates()}else n.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,S.width,S.height,f.depth,p,S.data)}else n.compressedTexImage3D(e.TEXTURE_2D_ARRAY,t,E,S.width,S.height,f.depth,0,S.data,0,0);else Gr("WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else w?M&&n.texSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,S.width,S.height,f.depth,p,y,S.data):n.texImage3D(e.TEXTURE_2D_ARRAY,t,E,S.width,S.height,f.depth,0,p,y,S.data)}else{w&&A&&n.texStorage2D(e.TEXTURE_2D,R,E,T[0].width,T[0].height);for(let t=0,i=T.length;t<i;t++)S=T[t],a.format!==An?null!==p?w?M&&n.compressedTexSubImage2D(e.TEXTURE_2D,t,0,0,S.width,S.height,p,S.data):n.compressedTexImage2D(e.TEXTURE_2D,t,E,S.width,S.height,0,S.data):Gr("WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):w?M&&n.texSubImage2D(e.TEXTURE_2D,t,0,0,S.width,S.height,p,y,S.data):n.texImage2D(e.TEXTURE_2D,t,E,S.width,S.height,0,p,y,S.data)}else if(a.isDataArrayTexture)if(w){if(A&&n.texStorage3D(e.TEXTURE_2D_ARRAY,R,E,f.width,f.height,f.depth),M)if(a.layerUpdates.size>0){const t=Op(f.width,f.height,a.format,a.type);for(const i of a.layerUpdates){const r=f.data.subarray(i*t/f.data.BYTES_PER_ELEMENT,(i+1)*t/f.data.BYTES_PER_ELEMENT);n.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,i,f.width,f.height,1,p,y,r)}a.clearLayerUpdates()}else n.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,0,f.width,f.height,f.depth,p,y,f.data)}else n.texImage3D(e.TEXTURE_2D_ARRAY,0,E,f.width,f.height,f.depth,0,p,y,f.data);else if(a.isData3DTexture)w?(A&&n.texStorage3D(e.TEXTURE_3D,R,E,f.width,f.height,f.depth),M&&n.texSubImage3D(e.TEXTURE_3D,0,0,0,0,f.width,f.height,f.depth,p,y,f.data)):n.texImage3D(e.TEXTURE_3D,0,E,f.width,f.height,f.depth,0,p,y,f.data);else if(a.isFramebufferTexture){if(A)if(w)n.texStorage2D(e.TEXTURE_2D,R,E,f.width,f.height);else{let t=f.width,i=f.height;for(let r=0;r<R;r++)n.texImage2D(e.TEXTURE_2D,r,E,t,i,0,p,y,null),t>>=1,i>>=1}}else if(T.length>0){if(w&&A){const t=V(T[0]);n.texStorage2D(e.TEXTURE_2D,R,E,t.width,t.height)}for(let t=0,i=T.length;t<i;t++)S=T[t],w?M&&n.texSubImage2D(e.TEXTURE_2D,t,0,0,p,y,S):n.texImage2D(e.TEXTURE_2D,t,E,p,y,S);a.generateMipmaps=!1}else if(w){if(A){const t=V(f);n.texStorage2D(e.TEXTURE_2D,R,E,t.width,t.height)}M&&n.texSubImage2D(e.TEXTURE_2D,0,0,0,p,y,f)}else n.texImage2D(e.TEXTURE_2D,0,E,p,y,f);g(a)&&v(l),h.__version=u.version,a.onUpdate&&a.onUpdate(a)}t.__version=a.version}function D(t,r,a,l,c,u){const h=s.convert(a.format,a.colorSpace),d=s.convert(a.type),f=b(a.internalFormat,h,d,a.colorSpace),p=i.get(r),m=i.get(a);if(m.__renderTarget=r,!p.__hasExternalTextures){const t=Math.max(1,r.width>>u),i=Math.max(1,r.height>>u);c===e.TEXTURE_3D||c===e.TEXTURE_2D_ARRAY?n.texImage3D(c,u,f,t,i,r.depth,0,h,d,null):n.texImage2D(c,u,f,t,i,0,h,d,null)}n.bindFramebuffer(e.FRAMEBUFFER,t),j(r)?o.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,l,c,m.__webglTexture,0,z(r)):(c===e.TEXTURE_2D||c>=e.TEXTURE_CUBE_MAP_POSITIVE_X&&c<=e.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&e.framebufferTexture2D(e.FRAMEBUFFER,l,c,m.__webglTexture,u),n.bindFramebuffer(e.FRAMEBUFFER,null)}function N(t,n,i){if(e.bindRenderbuffer(e.RENDERBUFFER,t),n.depthBuffer){const r=n.depthTexture,s=r&&r.isDepthTexture?r.type:null,a=x(n.stencilBuffer,s),l=n.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT;j(n)?o.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,z(n),a,n.width,n.height):i?e.renderbufferStorageMultisample(e.RENDERBUFFER,z(n),a,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,a,n.width,n.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,l,e.RENDERBUFFER,t)}else{const t=n.textures;for(let r=0;r<t.length;r++){const a=t[r],l=s.convert(a.format,a.colorSpace),c=s.convert(a.type),u=b(a.internalFormat,l,c,a.colorSpace);j(n)?o.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,z(n),u,n.width,n.height):i?e.renderbufferStorageMultisample(e.RENDERBUFFER,z(n),u,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,u,n.width,n.height)}}e.bindRenderbuffer(e.RENDERBUFFER,null)}function O(t,r,a){const l=!0===r.isWebGLCubeRenderTarget;if(n.bindFramebuffer(e.FRAMEBUFFER,t),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const c=i.get(r.depthTexture);if(c.__renderTarget=r,c.__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),l){if(void 0===c.__webglInit&&(c.__webglInit=!0,r.depthTexture.addEventListener("dispose",S)),void 0===c.__webglTexture){c.__webglTexture=e.createTexture(),n.bindTexture(e.TEXTURE_CUBE_MAP,c.__webglTexture),L(e.TEXTURE_CUBE_MAP,r.depthTexture);const t=s.convert(r.depthTexture.format),i=s.convert(r.depthTexture.type);let a;r.depthTexture.format===Mn?a=e.DEPTH_COMPONENT24:r.depthTexture.format===Rn&&(a=e.DEPTH24_STENCIL8);for(let n=0;n<6;n++)e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,a,r.width,r.height,0,t,i,null)}}else A(r.depthTexture,0);const u=c.__webglTexture,h=z(r),d=l?e.TEXTURE_CUBE_MAP_POSITIVE_X+a:e.TEXTURE_2D,f=r.depthTexture.format===Rn?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT;if(r.depthTexture.format===Mn)j(r)?o.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,f,d,u,0,h):e.framebufferTexture2D(e.FRAMEBUFFER,f,d,u,0);else{if(r.depthTexture.format!==Rn)throw new Error("Unknown depthTexture format");j(r)?o.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,f,d,u,0,h):e.framebufferTexture2D(e.FRAMEBUFFER,f,d,u,0)}}function F(t){const r=i.get(t),s=!0===t.isWebGLCubeRenderTarget;if(r.__boundDepthTexture!==t.depthTexture){const e=t.depthTexture;if(r.__depthDisposeCallback&&r.__depthDisposeCallback(),e){const t=()=>{delete r.__boundDepthTexture,delete r.__depthDisposeCallback,e.removeEventListener("dispose",t)};e.addEventListener("dispose",t),r.__depthDisposeCallback=t}r.__boundDepthTexture=e}if(t.depthTexture&&!r.__autoAllocateDepthBuffer)if(s)for(let e=0;e<6;e++)O(r.__webglFramebuffer[e],t,e);else{const e=t.texture.mipmaps;e&&e.length>0?O(r.__webglFramebuffer[0],t,0):O(r.__webglFramebuffer,t,0)}else if(s){r.__webglDepthbuffer=[];for(let i=0;i<6;i++)if(n.bindFramebuffer(e.FRAMEBUFFER,r.__webglFramebuffer[i]),void 0===r.__webglDepthbuffer[i])r.__webglDepthbuffer[i]=e.createRenderbuffer(),N(r.__webglDepthbuffer[i],t,!1);else{const n=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,s=r.__webglDepthbuffer[i];e.bindRenderbuffer(e.RENDERBUFFER,s),e.framebufferRenderbuffer(e.FRAMEBUFFER,n,e.RENDERBUFFER,s)}}else{const i=t.texture.mipmaps;if(i&&i.length>0?n.bindFramebuffer(e.FRAMEBUFFER,r.__webglFramebuffer[0]):n.bindFramebuffer(e.FRAMEBUFFER,r.__webglFramebuffer),void 0===r.__webglDepthbuffer)r.__webglDepthbuffer=e.createRenderbuffer(),N(r.__webglDepthbuffer,t,!1);else{const n=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,i=r.__webglDepthbuffer;e.bindRenderbuffer(e.RENDERBUFFER,i),e.framebufferRenderbuffer(e.FRAMEBUFFER,n,e.RENDERBUFFER,i)}}n.bindFramebuffer(e.FRAMEBUFFER,null)}const U=[],B=[];function z(e){return Math.min(r.maxSamples,e.samples)}function j(e){const n=i.get(e);return e.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture}function G(e,t){const n=e.colorSpace,i=e.format,r=e.type;return!0===e.isCompressedTexture||!0===e.isVideoTexture||n!==Bi&&n!==Fi&&(fs.getTransfer(n)===ji?i===An&&r===hn||Gr("WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):Vr("WebGLTextures: Unsupported texture color space:",n)),t}function V(e){return"undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement?(c.width=e.naturalWidth||e.width,c.height=e.naturalHeight||e.height):"undefined"!==typeof VideoFrame&&e instanceof VideoFrame?(c.width=e.displayWidth,c.height=e.displayHeight):(c.width=e.width,c.height=e.height),c}this.allocateTextureUnit=function(){const e=w;return e>=r.maxTextures&&Gr("WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+r.maxTextures),w+=1,e},this.resetTextureUnits=function(){w=0},this.setTexture2D=A,this.setTexture2DArray=function(t,r){const s=i.get(t);!1===t.isRenderTargetTexture&&t.version>0&&s.__version!==t.version?k(s,t,r):(t.isExternalTexture&&(s.__webglTexture=t.sourceTexture?t.sourceTexture:null),n.bindTexture(e.TEXTURE_2D_ARRAY,s.__webglTexture,e.TEXTURE0+r))},this.setTexture3D=function(t,r){const s=i.get(t);!1===t.isRenderTargetTexture&&t.version>0&&s.__version!==t.version?k(s,t,r):n.bindTexture(e.TEXTURE_3D,s.__webglTexture,e.TEXTURE0+r)},this.setTextureCube=function(t,a){const o=i.get(t);!0!==t.isCubeDepthTexture&&t.version>0&&o.__version!==t.version?function(t,a,o){if(6!==a.image.length)return;const l=I(t,a),c=a.source;n.bindTexture(e.TEXTURE_CUBE_MAP,t.__webglTexture,e.TEXTURE0+o);const u=i.get(c);if(c.version!==u.__version||!0===l){n.activeTexture(e.TEXTURE0+o);const t=fs.getPrimaries(fs.workingColorSpace),i=a.colorSpace===Fi?null:fs.getPrimaries(a.colorSpace),h=a.colorSpace===Fi||t===i?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,a.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,a.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,h);const d=a.isCompressedTexture||a.image[0].isCompressedTexture,f=a.image[0]&&a.image[0].isDataTexture,p=[];for(let e=0;e<6;e++)p[e]=d||f?f?a.image[e].image:a.image[e]:m(a.image[e],!0,r.maxCubemapSize),p[e]=G(a,p[e]);const y=p[0],x=s.convert(a.format,a.colorSpace),S=s.convert(a.type),E=b(a.internalFormat,x,S,a.colorSpace),T=!0!==a.isVideoTexture,w=void 0===u.__version||!0===l,A=c.dataReady;let M,R=_(a,y);if(L(e.TEXTURE_CUBE_MAP,a),d){T&&w&&n.texStorage2D(e.TEXTURE_CUBE_MAP,R,E,y.width,y.height);for(let t=0;t<6;t++){M=p[t].mipmaps;for(let i=0;i<M.length;i++){const r=M[i];a.format!==An?null!==x?T?A&&n.compressedTexSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,0,0,r.width,r.height,x,r.data):n.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,E,r.width,r.height,0,r.data):Gr("WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):T?A&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,0,0,r.width,r.height,x,S,r.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,E,r.width,r.height,0,x,S,r.data)}}}else{if(M=a.mipmaps,T&&w){M.length>0&&R++;const t=V(p[0]);n.texStorage2D(e.TEXTURE_CUBE_MAP,R,E,t.width,t.height)}for(let t=0;t<6;t++)if(f){T?A&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,p[t].width,p[t].height,x,S,p[t].data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,E,p[t].width,p[t].height,0,x,S,p[t].data);for(let i=0;i<M.length;i++){const r=M[i].image[t].image;T?A&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i+1,0,0,r.width,r.height,x,S,r.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i+1,E,r.width,r.height,0,x,S,r.data)}}else{T?A&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,x,S,p[t]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,E,x,S,p[t]);for(let i=0;i<M.length;i++){const r=M[i];T?A&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i+1,0,0,x,S,r.image[t]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i+1,E,x,S,r.image[t])}}}g(a)&&v(e.TEXTURE_CUBE_MAP),u.__version=c.version,a.onUpdate&&a.onUpdate(a)}t.__version=a.version}(o,t,a):n.bindTexture(e.TEXTURE_CUBE_MAP,o.__webglTexture,e.TEXTURE0+a)},this.rebindTextures=function(t,n,r){const s=i.get(t);void 0!==n&&D(s.__webglFramebuffer,t,t.texture,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,0),void 0!==r&&F(t)},this.setupRenderTarget=function(t){const r=t.texture,o=i.get(t),l=i.get(r);t.addEventListener("dispose",E);const c=t.textures,u=!0===t.isWebGLCubeRenderTarget,h=c.length>1;if(h||(void 0===l.__webglTexture&&(l.__webglTexture=e.createTexture()),l.__version=r.version,a.memory.textures++),u){o.__webglFramebuffer=[];for(let t=0;t<6;t++)if(r.mipmaps&&r.mipmaps.length>0){o.__webglFramebuffer[t]=[];for(let n=0;n<r.mipmaps.length;n++)o.__webglFramebuffer[t][n]=e.createFramebuffer()}else o.__webglFramebuffer[t]=e.createFramebuffer()}else{if(r.mipmaps&&r.mipmaps.length>0){o.__webglFramebuffer=[];for(let t=0;t<r.mipmaps.length;t++)o.__webglFramebuffer[t]=e.createFramebuffer()}else o.__webglFramebuffer=e.createFramebuffer();if(h)for(let t=0,n=c.length;t<n;t++){const n=i.get(c[t]);void 0===n.__webglTexture&&(n.__webglTexture=e.createTexture(),a.memory.textures++)}if(t.samples>0&&!1===j(t)){o.__webglMultisampledFramebuffer=e.createFramebuffer(),o.__webglColorRenderbuffer=[],n.bindFramebuffer(e.FRAMEBUFFER,o.__webglMultisampledFramebuffer);for(let n=0;n<c.length;n++){const i=c[n];o.__webglColorRenderbuffer[n]=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,o.__webglColorRenderbuffer[n]);const r=s.convert(i.format,i.colorSpace),a=s.convert(i.type),l=b(i.internalFormat,r,a,i.colorSpace,!0===t.isXRRenderTarget),u=z(t);e.renderbufferStorageMultisample(e.RENDERBUFFER,u,l,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+n,e.RENDERBUFFER,o.__webglColorRenderbuffer[n])}e.bindRenderbuffer(e.RENDERBUFFER,null),t.depthBuffer&&(o.__webglDepthRenderbuffer=e.createRenderbuffer(),N(o.__webglDepthRenderbuffer,t,!0)),n.bindFramebuffer(e.FRAMEBUFFER,null)}}if(u){n.bindTexture(e.TEXTURE_CUBE_MAP,l.__webglTexture),L(e.TEXTURE_CUBE_MAP,r);for(let n=0;n<6;n++)if(r.mipmaps&&r.mipmaps.length>0)for(let i=0;i<r.mipmaps.length;i++)D(o.__webglFramebuffer[n][i],t,r,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n,i);else D(o.__webglFramebuffer[n],t,r,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n,0);g(r)&&v(e.TEXTURE_CUBE_MAP),n.unbindTexture()}else if(h){for(let r=0,s=c.length;r<s;r++){const s=c[r],a=i.get(s);let l=e.TEXTURE_2D;(t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(l=t.isWebGL3DRenderTarget?e.TEXTURE_3D:e.TEXTURE_2D_ARRAY),n.bindTexture(l,a.__webglTexture),L(l,s),D(o.__webglFramebuffer,t,s,e.COLOR_ATTACHMENT0+r,l,0),g(s)&&v(l)}n.unbindTexture()}else{let i=e.TEXTURE_2D;if((t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(i=t.isWebGL3DRenderTarget?e.TEXTURE_3D:e.TEXTURE_2D_ARRAY),n.bindTexture(i,l.__webglTexture),L(i,r),r.mipmaps&&r.mipmaps.length>0)for(let n=0;n<r.mipmaps.length;n++)D(o.__webglFramebuffer[n],t,r,e.COLOR_ATTACHMENT0,i,n);else D(o.__webglFramebuffer,t,r,e.COLOR_ATTACHMENT0,i,0);g(r)&&v(i),n.unbindTexture()}t.depthBuffer&&F(t)},this.updateRenderTargetMipmap=function(e){const t=e.textures;for(let r=0,s=t.length;r<s;r++){const s=t[r];if(g(s)){const t=y(e),r=i.get(s).__webglTexture;n.bindTexture(t,r),v(t),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(t.samples>0)if(!1===j(t)){const r=t.textures,s=t.width,a=t.height;let o=e.COLOR_BUFFER_BIT;const c=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,u=i.get(t),h=r.length>1;if(h)for(let t=0;t<r.length;t++)n.bindFramebuffer(e.FRAMEBUFFER,u.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,null),n.bindFramebuffer(e.FRAMEBUFFER,u.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,null,0);n.bindFramebuffer(e.READ_FRAMEBUFFER,u.__webglMultisampledFramebuffer);const d=t.texture.mipmaps;d&&d.length>0?n.bindFramebuffer(e.DRAW_FRAMEBUFFER,u.__webglFramebuffer[0]):n.bindFramebuffer(e.DRAW_FRAMEBUFFER,u.__webglFramebuffer);for(let n=0;n<r.length;n++){if(t.resolveDepthBuffer&&(t.depthBuffer&&(o|=e.DEPTH_BUFFER_BIT),t.stencilBuffer&&t.resolveStencilBuffer&&(o|=e.STENCIL_BUFFER_BIT)),h){e.framebufferRenderbuffer(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,u.__webglColorRenderbuffer[n]);const t=i.get(r[n]).__webglTexture;e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)}e.blitFramebuffer(0,0,s,a,0,0,s,a,o,e.NEAREST),!0===l&&(U.length=0,B.length=0,U.push(e.COLOR_ATTACHMENT0+n),t.depthBuffer&&!1===t.resolveDepthBuffer&&(U.push(c),B.push(c),e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,B)),e.invalidateFramebuffer(e.READ_FRAMEBUFFER,U))}if(n.bindFramebuffer(e.READ_FRAMEBUFFER,null),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),h)for(let t=0;t<r.length;t++){n.bindFramebuffer(e.FRAMEBUFFER,u.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,u.__webglColorRenderbuffer[t]);const s=i.get(r[t]).__webglTexture;n.bindFramebuffer(e.FRAMEBUFFER,u.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,s,0)}n.bindFramebuffer(e.DRAW_FRAMEBUFFER,u.__webglMultisampledFramebuffer)}else if(t.depthBuffer&&!1===t.resolveDepthBuffer&&l){const n=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT;e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,[n])}},this.setupDepthRenderbuffer=F,this.setupFrameBufferTexture=D,this.useMultisampledRTT=j,this.isReversedDepthBuffer=function(){return n.buffers.depth.getReversed()}}function _v(e,t){return{convert:function(n){let i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Fi;const s=fs.getTransfer(r);if(n===hn)return e.UNSIGNED_BYTE;if(n===bn)return e.UNSIGNED_SHORT_4_4_4_4;if(n===xn)return e.UNSIGNED_SHORT_5_5_5_1;if(n===Sn)return e.UNSIGNED_INT_5_9_9_9_REV;if(n===En)return e.UNSIGNED_INT_10F_11F_11F_REV;if(n===dn)return e.BYTE;if(n===fn)return e.SHORT;if(n===pn)return e.UNSIGNED_SHORT;if(n===mn)return e.INT;if(n===gn)return e.UNSIGNED_INT;if(n===vn)return e.FLOAT;if(n===yn)return e.HALF_FLOAT;if(n===Tn)return e.ALPHA;if(n===wn)return e.RGB;if(n===An)return e.RGBA;if(n===Mn)return e.DEPTH_COMPONENT;if(n===Rn)return e.DEPTH_STENCIL;if(n===Cn)return e.RED;if(n===Ln)return e.RED_INTEGER;if(n===In)return e.RG;if(n===Pn)return e.RG_INTEGER;if(n===Dn)return e.RGBA_INTEGER;if(n===Nn||n===On||n===Fn||n===Un)if(s===ji){if(i=t.get("WEBGL_compressed_texture_s3tc_srgb"),null===i)return null;if(n===Nn)return i.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===On)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===Fn)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===Un)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(i=t.get("WEBGL_compressed_texture_s3tc"),null===i)return null;if(n===Nn)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===On)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===Fn)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===Un)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(n===Bn||n===zn||n===jn||n===Gn){if(i=t.get("WEBGL_compressed_texture_pvrtc"),null===i)return null;if(n===Bn)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===zn)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===jn)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===Gn)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(n===Vn||n===Hn||n===Wn||n===Yn||n===Xn||n===qn||n===Kn){if(i=t.get("WEBGL_compressed_texture_etc"),null===i)return null;if(n===Vn||n===Hn)return s===ji?i.COMPRESSED_SRGB8_ETC2:i.COMPRESSED_RGB8_ETC2;if(n===Wn)return s===ji?i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC;if(n===Yn)return i.COMPRESSED_R11_EAC;if(n===Xn)return i.COMPRESSED_SIGNED_R11_EAC;if(n===qn)return i.COMPRESSED_RG11_EAC;if(n===Kn)return i.COMPRESSED_SIGNED_RG11_EAC}if(n===Zn||n===Jn||n===Qn||n===$n||n===ei||n===ti||n===ni||n===ii||n===ri||n===si||n===ai||n===oi||n===li||n===ci){if(i=t.get("WEBGL_compressed_texture_astc"),null===i)return null;if(n===Zn)return s===ji?i.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:i.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===Jn)return s===ji?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:i.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===Qn)return s===ji?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:i.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===$n)return s===ji?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:i.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===ei)return s===ji?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:i.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===ti)return s===ji?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:i.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===ni)return s===ji?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:i.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===ii)return s===ji?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:i.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===ri)return s===ji?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:i.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===si)return s===ji?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:i.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===ai)return s===ji?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:i.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===oi)return s===ji?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:i.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===li)return s===ji?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:i.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===ci)return s===ji?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:i.COMPRESSED_RGBA_ASTC_12x12_KHR}if(n===ui||n===hi||n===di){if(i=t.get("EXT_texture_compression_bptc"),null===i)return null;if(n===ui)return s===ji?i.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:i.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(n===hi)return i.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(n===di)return i.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(n===fi||n===pi||n===mi||n===gi){if(i=t.get("EXT_texture_compression_rgtc"),null===i)return null;if(n===fi)return i.COMPRESSED_RED_RGTC1_EXT;if(n===pi)return i.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===mi)return i.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===gi)return i.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return n===_n?e.UNSIGNED_INT_24_8:void 0!==e[n]?e[n]:null}}}class Sv{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t){if(null===this.texture){const n=new au(e.texture);e.depthNear===t.depthNear&&e.depthFar===t.depthFar||(this.depthNear=e.depthNear,this.depthFar=e.depthFar),this.texture=n}}getMesh(e){if(null!==this.texture&&null===this.mesh){const t=e.cameras[0].viewport,n=new Yo({vertexShader:"\nvoid main() {\n\n\tgl_Position = vec4( position, 1.0 );\n\n}",fragmentShader:"\nuniform sampler2DArray depthColor;\nuniform float depthWidth;\nuniform float depthHeight;\n\nvoid main() {\n\n\tvec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );\n\n\tif ( coord.x >= 1.0 ) {\n\n\t\tgl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;\n\n\t} else {\n\n\t\tgl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;\n\n\t}\n\n}",uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new Bo(new Sh(20,20),n)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class Ev extends Wr{constructor(e,t){super();const n=this;let i=null,r=1,s=null,a="local-floor",o=1,l=null,c=null,u=null,h=null,d=null,f=null;const p="undefined"!==typeof XRWebGLBinding,m=new Sv,g={},v=t.getContextAttributes();let y=null,b=null;const x=[],_=[],S=new is;let E=null;const T=new Jo;T.viewport=new Ts;const w=new Jo;w.viewport=new Ts;const A=[T,w],M=new sf;let R=null,C=null;function L(e){const t=_.indexOf(e.inputSource);if(-1===t)return;const n=x[t];void 0!==n&&(n.update(e.inputSource,e.frame,l||s),n.dispatchEvent({type:e.type,data:e.inputSource}))}function I(){i.removeEventListener("select",L),i.removeEventListener("selectstart",L),i.removeEventListener("selectend",L),i.removeEventListener("squeeze",L),i.removeEventListener("squeezestart",L),i.removeEventListener("squeezeend",L),i.removeEventListener("end",I),i.removeEventListener("inputsourceschange",P);for(let e=0;e<x.length;e++){const t=_[e];null!==t&&(_[e]=null,x[e].disconnect(t))}R=null,C=null,m.reset();for(const e in g)delete g[e];e.setRenderTarget(y),d=null,h=null,u=null,i=null,b=null,F.stop(),n.isPresenting=!1,e.setPixelRatio(E),e.setSize(S.width,S.height,!1),n.dispatchEvent({type:"sessionend"})}function P(e){for(let t=0;t<e.removed.length;t++){const n=e.removed[t],i=_.indexOf(n);i>=0&&(_[i]=null,x[i].disconnect(n))}for(let t=0;t<e.added.length;t++){const n=e.added[t];let i=_.indexOf(n);if(-1===i){for(let e=0;e<x.length;e++){if(e>=_.length){_.push(n),i=e;break}if(null===_[e]){_[e]=n,i=e;break}}if(-1===i)break}const r=x[i];r&&r.connect(n)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=x[e];return void 0===t&&(t=new rl,x[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=x[e];return void 0===t&&(t=new rl,x[e]=t),t.getGripSpace()},this.getHand=function(e){let t=x[e];return void 0===t&&(t=new rl,x[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){r=e,!0===n.isPresenting&&Gr("WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){a=e,!0===n.isPresenting&&Gr("WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||s},this.setReferenceSpace=function(e){l=e},this.getBaseLayer=function(){return null!==h?h:d},this.getBinding=function(){return null===u&&p&&(u=new XRWebGLBinding(i,t)),u},this.getFrame=function(){return f},this.getSession=function(){return i},this.setSession=async function(c){if(i=c,null!==i){y=e.getRenderTarget(),i.addEventListener("select",L),i.addEventListener("selectstart",L),i.addEventListener("selectend",L),i.addEventListener("squeeze",L),i.addEventListener("squeezestart",L),i.addEventListener("squeezeend",L),i.addEventListener("end",I),i.addEventListener("inputsourceschange",P),!0!==v.xrCompatible&&await t.makeXRCompatible(),E=e.getPixelRatio(),e.getSize(S);if(p&&"createProjectionLayer"in XRWebGLBinding.prototype){let n=null,s=null,a=null;v.depth&&(a=v.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,n=v.stencil?Rn:Mn,s=v.stencil?_n:gn);const o={colorFormat:t.RGBA8,depthFormat:a,scaleFactor:r};u=this.getBinding(),h=u.createProjectionLayer(o),i.updateRenderState({layers:[h]}),e.setPixelRatio(1),e.setSize(h.textureWidth,h.textureHeight,!1),b=new As(h.textureWidth,h.textureHeight,{format:An,type:hn,depthTexture:new ru(h.textureWidth,h.textureHeight,s,void 0,void 0,void 0,void 0,void 0,void 0,n),stencilBuffer:v.stencil,colorSpace:e.outputColorSpace,samples:v.antialias?4:0,resolveDepthBuffer:!1===h.ignoreDepthValues,resolveStencilBuffer:!1===h.ignoreDepthValues})}else{const n={antialias:v.antialias,alpha:!0,depth:v.depth,stencil:v.stencil,framebufferScaleFactor:r};d=new XRWebGLLayer(i,t,n),i.updateRenderState({baseLayer:d}),e.setPixelRatio(1),e.setSize(d.framebufferWidth,d.framebufferHeight,!1),b=new As(d.framebufferWidth,d.framebufferHeight,{format:An,type:hn,colorSpace:e.outputColorSpace,stencilBuffer:v.stencil,resolveDepthBuffer:!1===d.ignoreDepthValues,resolveStencilBuffer:!1===d.ignoreDepthValues})}b.isXRRenderTarget=!0,this.setFoveation(o),l=null,s=await i.requestReferenceSpace(a),F.setContext(i),F.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(null!==i)return i.environmentBlendMode},this.getDepthTexture=function(){return m.getDepthTexture()};const k=new ss,D=new ss;function N(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){if(null===i)return;let t=e.near,n=e.far;null!==m.texture&&(m.depthNear>0&&(t=m.depthNear),m.depthFar>0&&(n=m.depthFar)),M.near=w.near=T.near=t,M.far=w.far=T.far=n,R===M.near&&C===M.far||(i.updateRenderState({depthNear:M.near,depthFar:M.far}),R=M.near,C=M.far),M.layers.mask=6|e.layers.mask,T.layers.mask=3&M.layers.mask,w.layers.mask=5&M.layers.mask;const r=e.parent,s=M.cameras;N(M,r);for(let i=0;i<s.length;i++)N(s[i],r);2===s.length?function(e,t,n){k.setFromMatrixPosition(t.matrixWorld),D.setFromMatrixPosition(n.matrixWorld);const i=k.distanceTo(D),r=t.projectionMatrix.elements,s=n.projectionMatrix.elements,a=r[14]/(r[10]-1),o=r[14]/(r[10]+1),l=(r[9]+1)/r[5],c=(r[9]-1)/r[5],u=(r[8]-1)/r[0],h=(s[8]+1)/s[0],d=a*u,f=a*h,p=i/(-u+h),m=p*-u;if(t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(p),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert(),-1===r[10])e.projectionMatrix.copy(t.projectionMatrix),e.projectionMatrixInverse.copy(t.projectionMatrixInverse);else{const t=a+p,n=o+p,r=d-m,s=f+(i-m),u=l*o/n*t,h=c*o/n*t;e.projectionMatrix.makePerspective(r,s,u,h,t,n),e.projectionMatrixInverse.copy(e.projectionMatrix).invert()}}(M,T,w):M.projectionMatrix.copy(T.projectionMatrix),function(e,t,n){null===n?e.matrix.copy(t.matrixWorld):(e.matrix.copy(n.matrixWorld),e.matrix.invert(),e.matrix.multiply(t.matrixWorld));e.matrix.decompose(e.position,e.quaternion,e.scale),e.updateMatrixWorld(!0),e.projectionMatrix.copy(t.projectionMatrix),e.projectionMatrixInverse.copy(t.projectionMatrixInverse),e.isPerspectiveCamera&&(e.fov=2*Kr*Math.atan(1/e.projectionMatrix.elements[5]),e.zoom=1)}(e,M,r)},this.getCamera=function(){return M},this.getFoveation=function(){if(null!==h||null!==d)return o},this.setFoveation=function(e){o=e,null!==h&&(h.fixedFoveation=e),null!==d&&void 0!==d.fixedFoveation&&(d.fixedFoveation=e)},this.hasDepthSensing=function(){return null!==m.texture},this.getDepthSensingMesh=function(){return m.getMesh(M)},this.getCameraTexture=function(e){return g[e]};let O=null;const F=new Up;F.setAnimationLoop(function(t,r){if(c=r.getViewerPose(l||s),f=r,null!==c){const t=c.views;null!==d&&(e.setRenderTargetFramebuffer(b,d.framebuffer),e.setRenderTarget(b));let r=!1;t.length!==M.cameras.length&&(M.cameras.length=0,r=!0);for(let n=0;n<t.length;n++){const i=t[n];let s=null;if(null!==d)s=d.getViewport(i);else{const t=u.getViewSubImage(h,i);s=t.viewport,0===n&&(e.setRenderTargetTextures(b,t.colorTexture,t.depthStencilTexture),e.setRenderTarget(b))}let a=A[n];void 0===a&&(a=new Jo,a.layers.enable(n),a.viewport=new Ts,A[n]=a),a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.quaternion,a.scale),a.projectionMatrix.fromArray(i.projectionMatrix),a.projectionMatrixInverse.copy(a.projectionMatrix).invert(),a.viewport.set(s.x,s.y,s.width,s.height),0===n&&(M.matrix.copy(a.matrix),M.matrix.decompose(M.position,M.quaternion,M.scale)),!0===r&&M.cameras.push(a)}const s=i.enabledFeatures;if(s&&s.includes("depth-sensing")&&"gpu-optimized"==i.depthUsage&&p){u=n.getBinding();const e=u.getDepthInformation(t[0]);e&&e.isValid&&e.texture&&m.init(e,i.renderState)}if(s&&s.includes("camera-access")&&p){e.state.unbindTexture(),u=n.getBinding();for(let e=0;e<t.length;e++){const n=t[e].camera;if(n){let e=g[n];e||(e=new au,g[n]=e);const t=u.getCameraImage(n);e.sourceTexture=t}}}}for(let e=0;e<x.length;e++){const t=_[e],n=x[e];null!==t&&void 0!==n&&n.update(t,r,l||s)}O&&O(t,r),r.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:r}),f=null}),this.setAnimationLoop=function(e){O=e},this.dispose=function(){}}}const Tv=new pa,wv=new ra;function Av(e,t){function n(e,t){!0===e.matrixAutoUpdate&&e.updateMatrix(),t.value.copy(e.matrix)}function i(e,i){e.opacity.value=i.opacity,i.color&&e.diffuse.value.copy(i.color),i.emissive&&e.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),i.map&&(e.map.value=i.map,n(i.map,e.mapTransform)),i.alphaMap&&(e.alphaMap.value=i.alphaMap,n(i.alphaMap,e.alphaMapTransform)),i.bumpMap&&(e.bumpMap.value=i.bumpMap,n(i.bumpMap,e.bumpMapTransform),e.bumpScale.value=i.bumpScale,i.side===Ze&&(e.bumpScale.value*=-1)),i.normalMap&&(e.normalMap.value=i.normalMap,n(i.normalMap,e.normalMapTransform),e.normalScale.value.copy(i.normalScale),i.side===Ze&&e.normalScale.value.negate()),i.displacementMap&&(e.displacementMap.value=i.displacementMap,n(i.displacementMap,e.displacementMapTransform),e.displacementScale.value=i.displacementScale,e.displacementBias.value=i.displacementBias),i.emissiveMap&&(e.emissiveMap.value=i.emissiveMap,n(i.emissiveMap,e.emissiveMapTransform)),i.specularMap&&(e.specularMap.value=i.specularMap,n(i.specularMap,e.specularMapTransform)),i.alphaTest>0&&(e.alphaTest.value=i.alphaTest);const r=t.get(i),s=r.envMap,a=r.envMapRotation;s&&(e.envMap.value=s,Tv.copy(a),Tv.x*=-1,Tv.y*=-1,Tv.z*=-1,s.isCubeTexture&&!1===s.isRenderTargetTexture&&(Tv.y*=-1,Tv.z*=-1),e.envMapRotation.value.setFromMatrix4(wv.makeRotationFromEuler(Tv)),e.flipEnvMap.value=s.isCubeTexture&&!1===s.isRenderTargetTexture?-1:1,e.reflectivity.value=i.reflectivity,e.ior.value=i.ior,e.refractionRatio.value=i.refractionRatio),i.lightMap&&(e.lightMap.value=i.lightMap,e.lightMapIntensity.value=i.lightMapIntensity,n(i.lightMap,e.lightMapTransform)),i.aoMap&&(e.aoMap.value=i.aoMap,e.aoMapIntensity.value=i.aoMapIntensity,n(i.aoMap,e.aoMapTransform))}return{refreshFogUniforms:function(t,n){n.color.getRGB(t.fogColor.value,Ho(e)),n.isFog?(t.fogNear.value=n.near,t.fogFar.value=n.far):n.isFogExp2&&(t.fogDensity.value=n.density)},refreshMaterialUniforms:function(e,r,s,a,o){r.isMeshBasicMaterial||r.isMeshLambertMaterial?i(e,r):r.isMeshToonMaterial?(i(e,r),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(e,r)):r.isMeshPhongMaterial?(i(e,r),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4)}(e,r)):r.isMeshStandardMaterial?(i(e,r),function(e,t){e.metalness.value=t.metalness,t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap,n(t.metalnessMap,e.metalnessMapTransform));e.roughness.value=t.roughness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap,n(t.roughnessMap,e.roughnessMapTransform));t.envMap&&(e.envMapIntensity.value=t.envMapIntensity)}(e,r),r.isMeshPhysicalMaterial&&function(e,t,i){e.ior.value=t.ior,t.sheen>0&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap,n(t.sheenColorMap,e.sheenColorMapTransform)),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap,n(t.sheenRoughnessMap,e.sheenRoughnessMapTransform)));t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap,n(t.clearcoatMap,e.clearcoatMapTransform)),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap,n(t.clearcoatRoughnessMap,e.clearcoatRoughnessMapTransform)),t.clearcoatNormalMap&&(e.clearcoatNormalMap.value=t.clearcoatNormalMap,n(t.clearcoatNormalMap,e.clearcoatNormalMapTransform),e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),t.side===Ze&&e.clearcoatNormalScale.value.negate()));t.dispersion>0&&(e.dispersion.value=t.dispersion);t.iridescence>0&&(e.iridescence.value=t.iridescence,e.iridescenceIOR.value=t.iridescenceIOR,e.iridescenceThicknessMinimum.value=t.iridescenceThicknessRange[0],e.iridescenceThicknessMaximum.value=t.iridescenceThicknessRange[1],t.iridescenceMap&&(e.iridescenceMap.value=t.iridescenceMap,n(t.iridescenceMap,e.iridescenceMapTransform)),t.iridescenceThicknessMap&&(e.iridescenceThicknessMap.value=t.iridescenceThicknessMap,n(t.iridescenceThicknessMap,e.iridescenceThicknessMapTransform)));t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=i.texture,e.transmissionSamplerSize.value.set(i.width,i.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap,n(t.transmissionMap,e.transmissionMapTransform)),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap,n(t.thicknessMap,e.thicknessMapTransform)),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor));t.anisotropy>0&&(e.anisotropyVector.value.set(t.anisotropy*Math.cos(t.anisotropyRotation),t.anisotropy*Math.sin(t.anisotropyRotation)),t.anisotropyMap&&(e.anisotropyMap.value=t.anisotropyMap,n(t.anisotropyMap,e.anisotropyMapTransform)));e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap,n(t.specularColorMap,e.specularColorMapTransform));t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap,n(t.specularIntensityMap,e.specularIntensityMapTransform))}(e,r,o)):r.isMeshMatcapMaterial?(i(e,r),function(e,t){t.matcap&&(e.matcap.value=t.matcap)}(e,r)):r.isMeshDepthMaterial?i(e,r):r.isMeshDistanceMaterial?(i(e,r),function(e,n){const i=t.get(n).light;e.referencePosition.value.setFromMatrixPosition(i.matrixWorld),e.nearDistance.value=i.shadow.camera.near,e.farDistance.value=i.shadow.camera.far}(e,r)):r.isMeshNormalMaterial?i(e,r):r.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform))}(e,r),r.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,r)):r.isPointsMaterial?function(e,t,i,r){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*i,e.scale.value=.5*r,t.map&&(e.map.value=t.map,n(t.map,e.uvTransform));t.alphaMap&&(e.alphaMap.value=t.alphaMap,n(t.alphaMap,e.alphaMapTransform));t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,r,s,a):r.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform));t.alphaMap&&(e.alphaMap.value=t.alphaMap,n(t.alphaMap,e.alphaMapTransform));t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,r):r.isShadowMaterial?(e.color.value.copy(r.color),e.opacity.value=r.opacity):r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)}}}function Mv(e,t,n,i){let r={},s={},a=[];const o=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS);function l(e,t,n,i){const r=e.value,s=t+"_"+n;if(void 0===i[s])return i[s]="number"===typeof r||"boolean"===typeof r?r:r.clone(),!0;{const e=i[s];if("number"===typeof r||"boolean"===typeof r){if(e!==r)return i[s]=r,!0}else if(!1===e.equals(r))return e.copy(r),!0}return!1}function c(e){const t={boundary:0,storage:0};return"number"===typeof e||"boolean"===typeof e?(t.boundary=4,t.storage=4):e.isVector2?(t.boundary=8,t.storage=8):e.isVector3||e.isColor?(t.boundary=16,t.storage=12):e.isVector4?(t.boundary=16,t.storage=16):e.isMatrix3?(t.boundary=48,t.storage=48):e.isMatrix4?(t.boundary=64,t.storage=64):e.isTexture?Gr("WebGLRenderer: Texture samplers can not be part of an uniforms group."):Gr("WebGLRenderer: Unsupported uniform value type.",e),t}function u(t){const n=t.target;n.removeEventListener("dispose",u);const i=a.indexOf(n.__bindingPointIndex);a.splice(i,1),e.deleteBuffer(r[n.id]),delete r[n.id],delete s[n.id]}return{bind:function(e,t){const n=t.program;i.uniformBlockBinding(e,n)},update:function(n,h){let d=r[n.id];void 0===d&&(!function(e){const t=e.uniforms;let n=0;const i=16;for(let s=0,a=t.length;s<a;s++){const e=Array.isArray(t[s])?t[s]:[t[s]];for(let t=0,r=e.length;t<r;t++){const r=e[t],s=Array.isArray(r.value)?r.value:[r.value];for(let e=0,t=s.length;e<t;e++){const t=c(s[e]),a=n%i,o=a%t.boundary,l=a+o;n+=o,0!==l&&i-l<t.storage&&(n+=i-l),r.__data=new Float32Array(t.storage/Float32Array.BYTES_PER_ELEMENT),r.__offset=n,n+=t.storage}}}const r=n%i;r>0&&(n+=i-r);e.__size=n,e.__cache={}}(n),d=function(t){const n=function(){for(let e=0;e<o;e++)if(-1===a.indexOf(e))return a.push(e),e;return Vr("WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();t.__bindingPointIndex=n;const i=e.createBuffer(),r=t.__size,s=t.usage;return e.bindBuffer(e.UNIFORM_BUFFER,i),e.bufferData(e.UNIFORM_BUFFER,r,s),e.bindBuffer(e.UNIFORM_BUFFER,null),e.bindBufferBase(e.UNIFORM_BUFFER,n,i),i}(n),r[n.id]=d,n.addEventListener("dispose",u));const f=h.program;i.updateUBOMapping(n,f);const p=t.render.frame;s[n.id]!==p&&(!function(t){const n=r[t.id],i=t.uniforms,s=t.__cache;e.bindBuffer(e.UNIFORM_BUFFER,n);for(let r=0,a=i.length;r<a;r++){const t=Array.isArray(i[r])?i[r]:[i[r]];for(let n=0,i=t.length;n<i;n++){const i=t[n];if(!0===l(i,r,n,s)){const t=i.__offset,n=Array.isArray(i.value)?i.value:[i.value];let r=0;for(let s=0;s<n.length;s++){const a=n[s],o=c(a);"number"===typeof a||"boolean"===typeof a?(i.__data[0]=a,e.bufferSubData(e.UNIFORM_BUFFER,t+r,i.__data)):a.isMatrix3?(i.__data[0]=a.elements[0],i.__data[1]=a.elements[1],i.__data[2]=a.elements[2],i.__data[3]=0,i.__data[4]=a.elements[3],i.__data[5]=a.elements[4],i.__data[6]=a.elements[5],i.__data[7]=0,i.__data[8]=a.elements[6],i.__data[9]=a.elements[7],i.__data[10]=a.elements[8],i.__data[11]=0):(a.toArray(i.__data,r),r+=o.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(e.UNIFORM_BUFFER,t,i.__data)}}}e.bindBuffer(e.UNIFORM_BUFFER,null)}(n),s[n.id]=p)},dispose:function(){for(const t in r)e.deleteBuffer(r[t]);a=[],r={},s={}}}}const Rv=new Uint16Array([12469,15057,12620,14925,13266,14620,13807,14376,14323,13990,14545,13625,14713,13328,14840,12882,14931,12528,14996,12233,15039,11829,15066,11525,15080,11295,15085,10976,15082,10705,15073,10495,13880,14564,13898,14542,13977,14430,14158,14124,14393,13732,14556,13410,14702,12996,14814,12596,14891,12291,14937,11834,14957,11489,14958,11194,14943,10803,14921,10506,14893,10278,14858,9960,14484,14039,14487,14025,14499,13941,14524,13740,14574,13468,14654,13106,14743,12678,14818,12344,14867,11893,14889,11509,14893,11180,14881,10751,14852,10428,14812,10128,14765,9754,14712,9466,14764,13480,14764,13475,14766,13440,14766,13347,14769,13070,14786,12713,14816,12387,14844,11957,14860,11549,14868,11215,14855,10751,14825,10403,14782,10044,14729,9651,14666,9352,14599,9029,14967,12835,14966,12831,14963,12804,14954,12723,14936,12564,14917,12347,14900,11958,14886,11569,14878,11247,14859,10765,14828,10401,14784,10011,14727,9600,14660,9289,14586,8893,14508,8533,15111,12234,15110,12234,15104,12216,15092,12156,15067,12010,15028,11776,14981,11500,14942,11205,14902,10752,14861,10393,14812,9991,14752,9570,14682,9252,14603,8808,14519,8445,14431,8145,15209,11449,15208,11451,15202,11451,15190,11438,15163,11384,15117,11274,15055,10979,14994,10648,14932,10343,14871,9936,14803,9532,14729,9218,14645,8742,14556,8381,14461,8020,14365,7603,15273,10603,15272,10607,15267,10619,15256,10631,15231,10614,15182,10535,15118,10389,15042,10167,14963,9787,14883,9447,14800,9115,14710,8665,14615,8318,14514,7911,14411,7507,14279,7198,15314,9675,15313,9683,15309,9712,15298,9759,15277,9797,15229,9773,15166,9668,15084,9487,14995,9274,14898,8910,14800,8539,14697,8234,14590,7790,14479,7409,14367,7067,14178,6621,15337,8619,15337,8631,15333,8677,15325,8769,15305,8871,15264,8940,15202,8909,15119,8775,15022,8565,14916,8328,14804,8009,14688,7614,14569,7287,14448,6888,14321,6483,14088,6171,15350,7402,15350,7419,15347,7480,15340,7613,15322,7804,15287,7973,15229,8057,15148,8012,15046,7846,14933,7611,14810,7357,14682,7069,14552,6656,14421,6316,14251,5948,14007,5528,15356,5942,15356,5977,15353,6119,15348,6294,15332,6551,15302,6824,15249,7044,15171,7122,15070,7050,14949,6861,14818,6611,14679,6349,14538,6067,14398,5651,14189,5311,13935,4958,15359,4123,15359,4153,15356,4296,15353,4646,15338,5160,15311,5508,15263,5829,15188,6042,15088,6094,14966,6001,14826,5796,14678,5543,14527,5287,14377,4985,14133,4586,13869,4257,15360,1563,15360,1642,15358,2076,15354,2636,15341,3350,15317,4019,15273,4429,15203,4732,15105,4911,14981,4932,14836,4818,14679,4621,14517,4386,14359,4156,14083,3795,13808,3437,15360,122,15360,137,15358,285,15355,636,15344,1274,15322,2177,15281,2765,15215,3223,15120,3451,14995,3569,14846,3567,14681,3466,14511,3305,14344,3121,14037,2800,13753,2467,15360,0,15360,1,15359,21,15355,89,15346,253,15325,479,15287,796,15225,1148,15133,1492,15008,1749,14856,1882,14685,1886,14506,1783,14324,1608,13996,1398,13702,1183]);let Cv=null;class Lv{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{canvas:t=Or(),context:n=null,depth:i=!0,stencil:r=!1,alpha:s=!1,antialias:a=!1,premultipliedAlpha:o=!0,preserveDrawingBuffer:l=!1,powerPreference:c="default",failIfMajorPerformanceCaveat:u=!1,reversedDepthBuffer:h=!1,outputBufferType:d=hn}=e;let f;if(this.isWebGLRenderer=!0,null!==n){if("undefined"!==typeof WebGLRenderingContext&&n instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");f=n.getContextAttributes().alpha}else f=s;const p=d,m=new Set([Dn,Pn,Ln]),g=new Set([hn,gn,pn,_n,bn,xn]),v=new Uint32Array(4),y=new Int32Array(4);let b=null,x=null;const _=[],S=[];let E=null;this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.toneMapping=Nt,this.toneMappingExposure=1,this.transmissionResolutionScale=1;const T=this;let w=!1;this._outputColorSpace=Ui;let A=0,M=0,R=null,C=-1,L=null;const I=new Ts,P=new Ts;let k=null;const D=new Za(0);let N=0,O=t.width,F=t.height,U=1,B=null,z=null;const j=new Ts(0,0,O,F),G=new Ts(0,0,O,F);let V=!1;const H=new oc;let W=!1,Y=!1;const X=new ra,q=new ss,K=new Ts,Z={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let J=!1;function Q(){return null===R?U:1}let $,ee,te,ne,ie,re,se,ae,oe,le,ce,ue,he,de,fe,pe,me,ge,ve,ye,be,xe,_e,Se,Ee=n;function Te(e,n){return t.getContext(e,n)}try{const e={alpha:!0,depth:i,stencil:r,antialias:a,premultipliedAlpha:o,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:u};if("setAttribute"in t&&t.setAttribute("data-engine","three.js r".concat(Ue)),t.addEventListener("webglcontextlost",Me,!1),t.addEventListener("webglcontextrestored",Re,!1),t.addEventListener("webglcontextcreationerror",Ce,!1),null===Ee){const t="webgl2";if(Ee=Te(t,e),null===Ee)throw Te(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(Px){throw Vr("WebGLRenderer: "+Px.message),Px}function we(){$=new fm(Ee),$.init(),xe=new _v(Ee,$),ee=new Kp(Ee,$,e,xe),te=new bv(Ee,$),ee.reversedDepthBuffer&&h&&te.buffers.depth.setReversed(!0),ne=new gm(Ee),ie=new tv,re=new xv(Ee,$,te,ie,ee,xe,ne),se=new Jp(T),ae=new dm(T),oe=new Bp(Ee),_e=new Xp(Ee,oe),le=new pm(Ee,oe,ne,_e),ce=new ym(Ee,le,oe,ne),ve=new vm(Ee,ee,re),pe=new Zp(ie),ue=new ev(T,se,ae,$,ee,_e,pe),he=new Av(T,ie),de=new sv,fe=new hv($),ge=new Yp(T,se,ae,te,ce,f,o),me=new vv(T,ce,ee),Se=new Mv(Ee,ne,ee,te),ye=new qp(Ee,$,ne),be=new mm(Ee,$,ne),ne.programs=ue.programs,T.capabilities=ee,T.extensions=$,T.properties=ie,T.renderLists=de,T.shadowMap=me,T.state=te,T.info=ne}we(),p!==hn&&(E=new xm(p,t.width,t.height,i,r));const Ae=new Ev(T,Ee);function Me(e){e.preventDefault(),jr("WebGLRenderer: Context Lost."),w=!0}function Re(){jr("WebGLRenderer: Context Restored."),w=!1;const e=ne.autoReset,t=me.enabled,n=me.autoUpdate,i=me.needsUpdate,r=me.type;we(),ne.autoReset=e,me.enabled=t,me.autoUpdate=n,me.needsUpdate=i,me.type=r}function Ce(e){Vr("WebGLRenderer: A WebGL context could not be created. Reason: ",e.statusMessage)}function Le(e){const t=e.target;t.removeEventListener("dispose",Le),function(e){(function(e){const t=ie.get(e).programs;void 0!==t&&(t.forEach(function(e){ue.releaseProgram(e)}),e.isShaderMaterial&&ue.releaseShaderCache(e))})(e),ie.remove(e)}(t)}function Ie(e,t,n){!0===e.transparent&&e.side===Je&&!1===e.forceSinglePass?(e.side=Ze,e.needsUpdate=!0,Ge(e,t,n),e.side=Ke,e.needsUpdate=!0,Ge(e,t,n),e.side=Je):Ge(e,t,n)}this.xr=Ae,this.getContext=function(){return Ee},this.getContextAttributes=function(){return Ee.getContextAttributes()},this.forceContextLoss=function(){const e=$.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=$.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return U},this.setPixelRatio=function(e){void 0!==e&&(U=e,this.setSize(O,F,!1))},this.getSize=function(e){return e.set(O,F)},this.setSize=function(e,n){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];Ae.isPresenting?Gr("WebGLRenderer: Can't change size while VR device is presenting."):(O=e,F=n,t.width=Math.floor(e*U),t.height=Math.floor(n*U),!0===i&&(t.style.width=e+"px",t.style.height=n+"px"),null!==E&&E.setSize(t.width,t.height),this.setViewport(0,0,e,n))},this.getDrawingBufferSize=function(e){return e.set(O*U,F*U).floor()},this.setDrawingBufferSize=function(e,n,i){O=e,F=n,U=i,t.width=Math.floor(e*i),t.height=Math.floor(n*i),this.setViewport(0,0,e,n)},this.setEffects=function(e){if(p!==hn){if(e)for(let t=0;t<e.length;t++)if(!0===e[t].isOutputPass){console.warn("THREE.WebGLRenderer: OutputPass is not needed in setEffects(). Tone mapping and color space conversion are applied automatically.");break}E.setEffects(e||[])}else console.error("THREE.WebGLRenderer: setEffects() requires outputBufferType set to HalfFloatType or FloatType.")},this.getCurrentViewport=function(e){return e.copy(I)},this.getViewport=function(e){return e.copy(j)},this.setViewport=function(e,t,n,i){e.isVector4?j.set(e.x,e.y,e.z,e.w):j.set(e,t,n,i),te.viewport(I.copy(j).multiplyScalar(U).round())},this.getScissor=function(e){return e.copy(G)},this.setScissor=function(e,t,n,i){e.isVector4?G.set(e.x,e.y,e.z,e.w):G.set(e,t,n,i),te.scissor(P.copy(G).multiplyScalar(U).round())},this.getScissorTest=function(){return V},this.setScissorTest=function(e){te.setScissorTest(V=e)},this.setOpaqueSort=function(e){B=e},this.setTransparentSort=function(e){z=e},this.getClearColor=function(e){return e.copy(ge.getClearColor())},this.setClearColor=function(){ge.setClearColor(...arguments)},this.getClearAlpha=function(){return ge.getClearAlpha()},this.setClearAlpha=function(){ge.setClearAlpha(...arguments)},this.clear=function(){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],t=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=0;if(!(arguments.length>0&&void 0!==arguments[0])||arguments[0]){let e=!1;if(null!==R){const t=R.texture.format;e=m.has(t)}if(e){const e=R.texture.type,t=g.has(e),n=ge.getClearColor(),i=ge.getClearAlpha(),r=n.r,s=n.g,a=n.b;t?(v[0]=r,v[1]=s,v[2]=a,v[3]=i,Ee.clearBufferuiv(Ee.COLOR,0,v)):(y[0]=r,y[1]=s,y[2]=a,y[3]=i,Ee.clearBufferiv(Ee.COLOR,0,y))}else n|=Ee.COLOR_BUFFER_BIT}e&&(n|=Ee.DEPTH_BUFFER_BIT),t&&(n|=Ee.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),Ee.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Me,!1),t.removeEventListener("webglcontextrestored",Re,!1),t.removeEventListener("webglcontextcreationerror",Ce,!1),ge.dispose(),de.dispose(),fe.dispose(),ie.dispose(),se.dispose(),ae.dispose(),ce.dispose(),_e.dispose(),Se.dispose(),ue.dispose(),Ae.dispose(),Ae.removeEventListener("sessionstart",ke),Ae.removeEventListener("sessionend",De),Ne.stop()},this.renderBufferDirect=function(e,t,n,i,r,s){null===t&&(t=Z);const a=r.isMesh&&r.matrixWorld.determinant()<0,o=function(e,t,n,i,r){!0!==t.isScene&&(t=Z);re.resetTextureUnits();const s=t.fog,a=i.isMeshStandardMaterial?t.environment:null,o=null===R?T.outputColorSpace:!0===R.isXRRenderTarget?R.texture.colorSpace:Bi,l=(i.isMeshStandardMaterial?ae:se).get(i.envMap||a),c=!0===i.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,u=!!n.attributes.tangent&&(!!i.normalMap||i.anisotropy>0),h=!!n.morphAttributes.position,d=!!n.morphAttributes.normal,f=!!n.morphAttributes.color;let p=Nt;i.toneMapped&&(null!==R&&!0!==R.isXRRenderTarget||(p=T.toneMapping));const m=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,g=void 0!==m?m.length:0,v=ie.get(i),y=x.state.lights;if(!0===W&&(!0===Y||e!==L)){const t=e===L&&i.id===C;pe.setState(i,e,t)}let b=!1;i.version===v.__version?v.needsLights&&v.lightsStateVersion!==y.state.version||v.outputColorSpace!==o||r.isBatchedMesh&&!1===v.batching?b=!0:r.isBatchedMesh||!0!==v.batching?r.isBatchedMesh&&!0===v.batchingColor&&null===r.colorTexture||r.isBatchedMesh&&!1===v.batchingColor&&null!==r.colorTexture||r.isInstancedMesh&&!1===v.instancing?b=!0:r.isInstancedMesh||!0!==v.instancing?r.isSkinnedMesh&&!1===v.skinning?b=!0:r.isSkinnedMesh||!0!==v.skinning?r.isInstancedMesh&&!0===v.instancingColor&&null===r.instanceColor||r.isInstancedMesh&&!1===v.instancingColor&&null!==r.instanceColor||r.isInstancedMesh&&!0===v.instancingMorph&&null===r.morphTexture||r.isInstancedMesh&&!1===v.instancingMorph&&null!==r.morphTexture||v.envMap!==l||!0===i.fog&&v.fog!==s?b=!0:void 0===v.numClippingPlanes||v.numClippingPlanes===pe.numPlanes&&v.numIntersection===pe.numIntersection?(v.vertexAlphas!==c||v.vertexTangents!==u||v.morphTargets!==h||v.morphNormals!==d||v.morphColors!==f||v.toneMapping!==p||v.morphTargetsCount!==g)&&(b=!0):b=!0:b=!0:b=!0:b=!0:(b=!0,v.__version=i.version);let _=v.currentProgram;!0===b&&(_=Ge(i,t,r));let S=!1,E=!1,w=!1;const A=_.getUniforms(),M=v.uniforms;te.useProgram(_.program)&&(S=!0,E=!0,w=!0);i.id!==C&&(C=i.id,E=!0);if(S||L!==e){te.buffers.depth.getReversed()&&!0!==e.reversedDepth&&(e._reversedDepth=!0,e.updateProjectionMatrix()),A.setValue(Ee,"projectionMatrix",e.projectionMatrix),A.setValue(Ee,"viewMatrix",e.matrixWorldInverse);const t=A.map.cameraPosition;void 0!==t&&t.setValue(Ee,q.setFromMatrixPosition(e.matrixWorld)),ee.logarithmicDepthBuffer&&A.setValue(Ee,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&A.setValue(Ee,"isOrthographic",!0===e.isOrthographicCamera),L!==e&&(L=e,E=!0,w=!0)}v.needsLights&&(y.state.directionalShadowMap.length>0&&A.setValue(Ee,"directionalShadowMap",y.state.directionalShadowMap,re),y.state.spotShadowMap.length>0&&A.setValue(Ee,"spotShadowMap",y.state.spotShadowMap,re),y.state.pointShadowMap.length>0&&A.setValue(Ee,"pointShadowMap",y.state.pointShadowMap,re));if(r.isSkinnedMesh){A.setOptional(Ee,r,"bindMatrix"),A.setOptional(Ee,r,"bindMatrixInverse");const e=r.skeleton;e&&(null===e.boneTexture&&e.computeBoneTexture(),A.setValue(Ee,"boneTexture",e.boneTexture,re))}r.isBatchedMesh&&(A.setOptional(Ee,r,"batchingTexture"),A.setValue(Ee,"batchingTexture",r._matricesTexture,re),A.setOptional(Ee,r,"batchingIdTexture"),A.setValue(Ee,"batchingIdTexture",r._indirectTexture,re),A.setOptional(Ee,r,"batchingColorTexture"),null!==r._colorsTexture&&A.setValue(Ee,"batchingColorTexture",r._colorsTexture,re));const I=n.morphAttributes;void 0===I.position&&void 0===I.normal&&void 0===I.color||ve.update(r,n,_);(E||v.receiveShadow!==r.receiveShadow)&&(v.receiveShadow=r.receiveShadow,A.setValue(Ee,"receiveShadow",r.receiveShadow));i.isMeshGouraudMaterial&&null!==i.envMap&&(M.envMap.value=l,M.flipEnvMap.value=l.isCubeTexture&&!1===l.isRenderTargetTexture?-1:1);i.isMeshStandardMaterial&&null===i.envMap&&null!==t.environment&&(M.envMapIntensity.value=t.environmentIntensity);void 0!==M.dfgLUT&&(M.dfgLUT.value=(null===Cv&&(Cv=new jl(Rv,16,16,In,yn),Cv.name="DFG_LUT",Cv.minFilter=an,Cv.magFilter=an,Cv.wrapS=Qt,Cv.wrapT=Qt,Cv.generateMipmaps=!1,Cv.needsUpdate=!0),Cv));E&&(A.setValue(Ee,"toneMappingExposure",T.toneMappingExposure),v.needsLights&&(k=w,(P=M).ambientLightColor.needsUpdate=k,P.lightProbe.needsUpdate=k,P.directionalLights.needsUpdate=k,P.directionalLightShadows.needsUpdate=k,P.pointLights.needsUpdate=k,P.pointLightShadows.needsUpdate=k,P.spotLights.needsUpdate=k,P.spotLightShadows.needsUpdate=k,P.rectAreaLights.needsUpdate=k,P.hemisphereLights.needsUpdate=k),s&&!0===i.fog&&he.refreshFogUniforms(M,s),he.refreshMaterialUniforms(M,i,U,F,x.state.transmissionRenderTarget[e.id]),wg.upload(Ee,Ve(v),M,re));var P,k;i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(wg.upload(Ee,Ve(v),M,re),i.uniformsNeedUpdate=!1);i.isSpriteMaterial&&A.setValue(Ee,"center",r.center);if(A.setValue(Ee,"modelViewMatrix",r.modelViewMatrix),A.setValue(Ee,"normalMatrix",r.normalMatrix),A.setValue(Ee,"modelMatrix",r.matrixWorld),i.isShaderMaterial||i.isRawShaderMaterial){const e=i.uniformsGroups;for(let t=0,n=e.length;t<n;t++){const n=e[t];Se.update(n,_),Se.bind(n,_)}}return _}(e,t,n,i,r);te.setMaterial(i,a);let l=n.index,c=1;if(!0===i.wireframe){if(l=le.getWireframeAttribute(n),void 0===l)return;c=2}const u=n.drawRange,h=n.attributes.position;let d=u.start*c,f=(u.start+u.count)*c;null!==s&&(d=Math.max(d,s.start*c),f=Math.min(f,(s.start+s.count)*c)),null!==l?(d=Math.max(d,0),f=Math.min(f,l.count)):void 0!==h&&null!==h&&(d=Math.max(d,0),f=Math.min(f,h.count));const p=f-d;if(p<0||p===1/0)return;let m;_e.setup(r,i,o,n,l);let g=ye;if(null!==l&&(m=oe.get(l),g=be,g.setIndex(m)),r.isMesh)!0===i.wireframe?(te.setLineWidth(i.wireframeLinewidth*Q()),g.setMode(Ee.LINES)):g.setMode(Ee.TRIANGLES);else if(r.isLine){let e=i.linewidth;void 0===e&&(e=1),te.setLineWidth(e*Q()),r.isLineSegments?g.setMode(Ee.LINES):r.isLineLoop?g.setMode(Ee.LINE_LOOP):g.setMode(Ee.LINE_STRIP)}else r.isPoints?g.setMode(Ee.POINTS):r.isSprite&&g.setMode(Ee.TRIANGLES);if(r.isBatchedMesh)if(null!==r._multiDrawInstances)Hr("WebGLRenderer: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),g.renderMultiDrawInstances(r._multiDrawStarts,r._multiDrawCounts,r._multiDrawCount,r._multiDrawInstances);else if($.get("WEBGL_multi_draw"))g.renderMultiDraw(r._multiDrawStarts,r._multiDrawCounts,r._multiDrawCount);else{const e=r._multiDrawStarts,t=r._multiDrawCounts,n=r._multiDrawCount,s=l?oe.get(l).bytesPerElement:1,a=ie.get(i).currentProgram.getUniforms();for(let i=0;i<n;i++)a.setValue(Ee,"_gl_DrawID",i),g.render(e[i]/s,t[i])}else if(r.isInstancedMesh)g.renderInstances(d,p,r.count);else if(n.isInstancedBufferGeometry){const e=void 0!==n._maxInstanceCount?n._maxInstanceCount:1/0,t=Math.min(n.instanceCount,e);g.renderInstances(d,p,t)}else g.render(d,p)},this.compile=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null===n&&(n=e),x=fe.get(n),x.init(t),S.push(x),n.traverseVisible(function(e){e.isLight&&e.layers.test(t.layers)&&(x.pushLight(e),e.castShadow&&x.pushShadow(e))}),e!==n&&e.traverseVisible(function(e){e.isLight&&e.layers.test(t.layers)&&(x.pushLight(e),e.castShadow&&x.pushShadow(e))}),x.setupLights();const i=new Set;return e.traverse(function(e){if(!(e.isMesh||e.isPoints||e.isLine||e.isSprite))return;const t=e.material;if(t)if(Array.isArray(t))for(let r=0;r<t.length;r++){const s=t[r];Ie(s,n,e),i.add(s)}else Ie(t,n,e),i.add(t)}),x=S.pop(),i},this.compileAsync=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const i=this.compile(e,t,n);return new Promise(t=>{function n(){i.forEach(function(e){ie.get(e).currentProgram.isReady()&&i.delete(e)}),0!==i.size?setTimeout(n,10):t(e)}null!==$.get("KHR_parallel_shader_compile")?n():setTimeout(n,10)})};let Pe=null;function ke(){Ne.stop()}function De(){Ne.start()}const Ne=new Up;function Oe(e,t,n,i){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)x.pushLight(e),e.castShadow&&x.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||H.intersectsSprite(e)){i&&K.setFromMatrixPosition(e.matrixWorld).applyMatrix4(X);const t=ce.update(e),r=e.material;r.visible&&b.push(e,t,r,n,K.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(!e.frustumCulled||H.intersectsObject(e))){const t=ce.update(e),r=e.material;if(i&&(void 0!==e.boundingSphere?(null===e.boundingSphere&&e.computeBoundingSphere(),K.copy(e.boundingSphere.center)):(null===t.boundingSphere&&t.computeBoundingSphere(),K.copy(t.boundingSphere.center)),K.applyMatrix4(e.matrixWorld).applyMatrix4(X)),Array.isArray(r)){const i=t.groups;for(let s=0,a=i.length;s<a;s++){const a=i[s],o=r[a.materialIndex];o&&o.visible&&b.push(e,t,o,n,K.z,a)}}else r.visible&&b.push(e,t,r,n,K.z,null)}const r=e.children;for(let s=0,a=r.length;s<a;s++)Oe(r[s],t,n,i)}function Fe(e,t,n,i){const{opaque:r,transmissive:s,transparent:a}=e;x.setupLightsView(n),!0===W&&pe.setGlobalState(T.clippingPlanes,n),i&&te.viewport(I.copy(i)),r.length>0&&ze(r,t,n),s.length>0&&ze(s,t,n),a.length>0&&ze(a,t,n),te.buffers.depth.setTest(!0),te.buffers.depth.setMask(!0),te.buffers.color.setMask(!0),te.setPolygonOffset(!1)}function Be(e,t,n,i){if(null!==(!0===n.isScene?n.overrideMaterial:null))return;if(void 0===x.state.transmissionRenderTarget[i.id]){const e=$.has("EXT_color_buffer_half_float")||$.has("EXT_color_buffer_float");x.state.transmissionRenderTarget[i.id]=new As(1,1,{generateMipmaps:!0,type:e?yn:hn,minFilter:cn,samples:ee.samples,stencilBuffer:r,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:fs.workingColorSpace})}const s=x.state.transmissionRenderTarget[i.id],a=i.viewport||I;s.setSize(a.z*T.transmissionResolutionScale,a.w*T.transmissionResolutionScale);const o=T.getRenderTarget(),l=T.getActiveCubeFace(),c=T.getActiveMipmapLevel();T.setRenderTarget(s),T.getClearColor(D),N=T.getClearAlpha(),N<1&&T.setClearColor(16777215,.5),T.clear(),J&&ge.render(n);const u=T.toneMapping;T.toneMapping=Nt;const h=i.viewport;if(void 0!==i.viewport&&(i.viewport=void 0),x.setupLightsView(i),!0===W&&pe.setGlobalState(T.clippingPlanes,i),ze(e,n,i),re.updateMultisampleRenderTarget(s),re.updateRenderTargetMipmap(s),!1===$.has("WEBGL_multisampled_render_to_texture")){let e=!1;for(let r=0,s=t.length;r<s;r++){const s=t[r],{object:a,geometry:o,material:l,group:c}=s;if(l.side===Je&&a.layers.test(i.layers)){const t=l.side;l.side=Ze,l.needsUpdate=!0,je(a,n,i,o,l,c),l.side=t,l.needsUpdate=!0,e=!0}}!0===e&&(re.updateMultisampleRenderTarget(s),re.updateRenderTargetMipmap(s))}T.setRenderTarget(o,l,c),T.setClearColor(D,N),void 0!==h&&(i.viewport=h),T.toneMapping=u}function ze(e,t,n){const i=!0===t.isScene?t.overrideMaterial:null;for(let r=0,s=e.length;r<s;r++){const s=e[r],{object:a,geometry:o,group:l}=s;let c=s.material;!0===c.allowOverride&&null!==i&&(c=i),a.layers.test(n.layers)&&je(a,t,n,o,c,l)}}function je(e,t,n,i,r,s){e.onBeforeRender(T,t,n,i,r,s),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),r.onBeforeRender(T,t,n,i,e,s),!0===r.transparent&&r.side===Je&&!1===r.forceSinglePass?(r.side=Ze,r.needsUpdate=!0,T.renderBufferDirect(n,t,i,r,e,s),r.side=Ke,r.needsUpdate=!0,T.renderBufferDirect(n,t,i,r,e,s),r.side=Je):T.renderBufferDirect(n,t,i,r,e,s),e.onAfterRender(T,t,n,i,r,s)}function Ge(e,t,n){!0!==t.isScene&&(t=Z);const i=ie.get(e),r=x.state.lights,s=x.state.shadowsArray,a=r.state.version,o=ue.getParameters(e,r.state,s,t,n),l=ue.getProgramCacheKey(o);let c=i.programs;i.environment=e.isMeshStandardMaterial?t.environment:null,i.fog=t.fog,i.envMap=(e.isMeshStandardMaterial?ae:se).get(e.envMap||i.environment),i.envMapRotation=null!==i.environment&&null===e.envMap?t.environmentRotation:e.envMapRotation,void 0===c&&(e.addEventListener("dispose",Le),c=new Map,i.programs=c);let u=c.get(l);if(void 0!==u){if(i.currentProgram===u&&i.lightsStateVersion===a)return He(e,o),u}else o.uniforms=ue.getUniforms(e),e.onBeforeCompile(o,T),u=ue.acquireProgram(o,l),c.set(l,u),i.uniforms=o.uniforms;const h=i.uniforms;return(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(h.clippingPlanes=pe.uniform),He(e,o),i.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),i.lightsStateVersion=a,i.needsLights&&(h.ambientLightColor.value=r.state.ambient,h.lightProbe.value=r.state.probe,h.directionalLights.value=r.state.directional,h.directionalLightShadows.value=r.state.directionalShadow,h.spotLights.value=r.state.spot,h.spotLightShadows.value=r.state.spotShadow,h.rectAreaLights.value=r.state.rectArea,h.ltc_1.value=r.state.rectAreaLTC1,h.ltc_2.value=r.state.rectAreaLTC2,h.pointLights.value=r.state.point,h.pointLightShadows.value=r.state.pointShadow,h.hemisphereLights.value=r.state.hemi,h.directionalShadowMap.value=r.state.directionalShadowMap,h.directionalShadowMatrix.value=r.state.directionalShadowMatrix,h.spotShadowMap.value=r.state.spotShadowMap,h.spotLightMatrix.value=r.state.spotLightMatrix,h.spotLightMap.value=r.state.spotLightMap,h.pointShadowMap.value=r.state.pointShadowMap,h.pointShadowMatrix.value=r.state.pointShadowMatrix),i.currentProgram=u,i.uniformsList=null,u}function Ve(e){if(null===e.uniformsList){const t=e.currentProgram.getUniforms();e.uniformsList=wg.seqWithValue(t.seq,e.uniforms)}return e.uniformsList}function He(e,t){const n=ie.get(e);n.outputColorSpace=t.outputColorSpace,n.batching=t.batching,n.batchingColor=t.batchingColor,n.instancing=t.instancing,n.instancingColor=t.instancingColor,n.instancingMorph=t.instancingMorph,n.skinning=t.skinning,n.morphTargets=t.morphTargets,n.morphNormals=t.morphNormals,n.morphColors=t.morphColors,n.morphTargetsCount=t.morphTargetsCount,n.numClippingPlanes=t.numClippingPlanes,n.numIntersection=t.numClipIntersection,n.vertexAlphas=t.vertexAlphas,n.vertexTangents=t.vertexTangents,n.toneMapping=t.toneMapping}Ne.setAnimationLoop(function(e){Pe&&Pe(e)}),"undefined"!==typeof self&&Ne.setContext(self),this.setAnimationLoop=function(e){Pe=e,Ae.setAnimationLoop(e),null===e?Ne.stop():Ne.start()},Ae.addEventListener("sessionstart",ke),Ae.addEventListener("sessionend",De),this.render=function(e,t){if(void 0!==t&&!0!==t.isCamera)return void Vr("WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===w)return;const n=!0===Ae.enabled&&!0===Ae.isPresenting,i=null!==E&&(null===R||n)&&E.begin(T,R);if(!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),!0!==Ae.enabled||!0!==Ae.isPresenting||null!==E&&!1!==E.isCompositing()||(!0===Ae.cameraAutoUpdate&&Ae.updateCamera(t),t=Ae.getCamera()),!0===e.isScene&&e.onBeforeRender(T,e,t,R),x=fe.get(e,S.length),x.init(t),S.push(x),X.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),H.setFromProjectionMatrix(X,Ar,t.reversedDepth),Y=this.localClippingEnabled,W=pe.init(this.clippingPlanes,Y),b=de.get(e,_.length),b.init(),_.push(b),!0===Ae.enabled&&!0===Ae.isPresenting){const e=T.xr.getDepthSensingMesh();null!==e&&Oe(e,t,-1/0,T.sortObjects)}Oe(e,t,0,T.sortObjects),b.finish(),!0===T.sortObjects&&b.sort(B,z),J=!1===Ae.enabled||!1===Ae.isPresenting||!1===Ae.hasDepthSensing(),J&&ge.addToRenderList(b,e),this.info.render.frame++,!0===W&&pe.beginShadows();const r=x.state.shadowsArray;me.render(r,e,t),!0===W&&pe.endShadows(),!0===this.info.autoReset&&this.info.reset();if(!1===(i&&E.hasRenderPass())){const n=b.opaque,i=b.transmissive;if(x.setupLights(),t.isArrayCamera){const r=t.cameras;if(i.length>0)for(let t=0,s=r.length;t<s;t++){Be(n,i,e,r[t])}J&&ge.render(e);for(let t=0,n=r.length;t<n;t++){const n=r[t];Fe(b,e,n,n.viewport)}}else i.length>0&&Be(n,i,e,t),J&&ge.render(e),Fe(b,e,t)}null!==R&&0===M&&(re.updateMultisampleRenderTarget(R),re.updateRenderTargetMipmap(R)),i&&E.end(T),!0===e.isScene&&e.onAfterRender(T,e,t),_e.resetDefaultState(),C=-1,L=null,S.pop(),S.length>0?(x=S[S.length-1],!0===W&&pe.setGlobalState(T.clippingPlanes,x.state.camera)):x=null,_.pop(),b=_.length>0?_[_.length-1]:null},this.getActiveCubeFace=function(){return A},this.getActiveMipmapLevel=function(){return M},this.getRenderTarget=function(){return R},this.setRenderTargetTextures=function(e,t,n){const i=ie.get(e);i.__autoAllocateDepthBuffer=!1===e.resolveDepthBuffer,!1===i.__autoAllocateDepthBuffer&&(i.__useRenderToTexture=!1),ie.get(e.texture).__webglTexture=t,ie.get(e.depthTexture).__webglTexture=i.__autoAllocateDepthBuffer?void 0:n,i.__hasExternalTextures=!0},this.setRenderTargetFramebuffer=function(e,t){const n=ie.get(e);n.__webglFramebuffer=t,n.__useDefaultFramebuffer=void 0===t};const We=Ee.createFramebuffer();this.setRenderTarget=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;R=e,A=t,M=n;let i=null,r=!1,s=!1;if(e){const a=ie.get(e);if(void 0!==a.__useDefaultFramebuffer)return te.bindFramebuffer(Ee.FRAMEBUFFER,a.__webglFramebuffer),I.copy(e.viewport),P.copy(e.scissor),k=e.scissorTest,te.viewport(I),te.scissor(P),te.setScissorTest(k),void(C=-1);if(void 0===a.__webglFramebuffer)re.setupRenderTarget(e);else if(a.__hasExternalTextures)re.rebindTextures(e,ie.get(e.texture).__webglTexture,ie.get(e.depthTexture).__webglTexture);else if(e.depthBuffer){const t=e.depthTexture;if(a.__boundDepthTexture!==t){if(null!==t&&ie.has(t)&&(e.width!==t.image.width||e.height!==t.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");re.setupDepthRenderbuffer(e)}}const o=e.texture;(o.isData3DTexture||o.isDataArrayTexture||o.isCompressedArrayTexture)&&(s=!0);const l=ie.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(i=Array.isArray(l[t])?l[t][n]:l[t],r=!0):i=e.samples>0&&!1===re.useMultisampledRTT(e)?ie.get(e).__webglMultisampledFramebuffer:Array.isArray(l)?l[n]:l,I.copy(e.viewport),P.copy(e.scissor),k=e.scissorTest}else I.copy(j).multiplyScalar(U).floor(),P.copy(G).multiplyScalar(U).floor(),k=V;0!==n&&(i=We);if(te.bindFramebuffer(Ee.FRAMEBUFFER,i)&&te.drawBuffers(e,i),te.viewport(I),te.scissor(P),te.setScissorTest(k),r){const i=ie.get(e.texture);Ee.framebufferTexture2D(Ee.FRAMEBUFFER,Ee.COLOR_ATTACHMENT0,Ee.TEXTURE_CUBE_MAP_POSITIVE_X+t,i.__webglTexture,n)}else if(s){const i=t;for(let t=0;t<e.textures.length;t++){const r=ie.get(e.textures[t]);Ee.framebufferTextureLayer(Ee.FRAMEBUFFER,Ee.COLOR_ATTACHMENT0+t,r.__webglTexture,n,i)}}else if(null!==e&&0!==n){const t=ie.get(e.texture);Ee.framebufferTexture2D(Ee.FRAMEBUFFER,Ee.COLOR_ATTACHMENT0,Ee.TEXTURE_2D,t.__webglTexture,n)}C=-1},this.readRenderTargetPixels=function(e,t,n,i,r,s,a){let o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;if(!e||!e.isWebGLRenderTarget)return void Vr("WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let l=ie.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==a&&(l=l[a]),l){te.bindFramebuffer(Ee.FRAMEBUFFER,l);try{const a=e.textures[o],l=a.format,c=a.type;if(!ee.textureFormatReadable(l))return void Vr("WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!ee.textureTypeReadable(c))return void Vr("WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");t>=0&&t<=e.width-i&&n>=0&&n<=e.height-r&&(e.textures.length>1&&Ee.readBuffer(Ee.COLOR_ATTACHMENT0+o),Ee.readPixels(t,n,i,r,xe.convert(l),xe.convert(c),s))}finally{const e=null!==R?ie.get(R).__webglFramebuffer:null;te.bindFramebuffer(Ee.FRAMEBUFFER,e)}}},this.readRenderTargetPixelsAsync=async function(e,t,n,i,r,s,a){let o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;if(!e||!e.isWebGLRenderTarget)throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let l=ie.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==a&&(l=l[a]),l){if(t>=0&&t<=e.width-i&&n>=0&&n<=e.height-r){te.bindFramebuffer(Ee.FRAMEBUFFER,l);const a=e.textures[o],c=a.format,u=a.type;if(!ee.textureFormatReadable(c))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!ee.textureTypeReadable(u))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");const h=Ee.createBuffer();Ee.bindBuffer(Ee.PIXEL_PACK_BUFFER,h),Ee.bufferData(Ee.PIXEL_PACK_BUFFER,s.byteLength,Ee.STREAM_READ),e.textures.length>1&&Ee.readBuffer(Ee.COLOR_ATTACHMENT0+o),Ee.readPixels(t,n,i,r,xe.convert(c),xe.convert(u),0);const d=null!==R?ie.get(R).__webglFramebuffer:null;te.bindFramebuffer(Ee.FRAMEBUFFER,d);const f=Ee.fenceSync(Ee.SYNC_GPU_COMMANDS_COMPLETE,0);return Ee.flush(),await function(e,t,n){return new Promise(function(i,r){setTimeout(function s(){switch(e.clientWaitSync(t,e.SYNC_FLUSH_COMMANDS_BIT,0)){case e.WAIT_FAILED:r();break;case e.TIMEOUT_EXPIRED:setTimeout(s,n);break;default:i()}},n)})}(Ee,f,4),Ee.bindBuffer(Ee.PIXEL_PACK_BUFFER,h),Ee.getBufferSubData(Ee.PIXEL_PACK_BUFFER,0,s),Ee.deleteBuffer(h),Ee.deleteSync(f),s}throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const i=Math.pow(2,-n),r=Math.floor(e.image.width*i),s=Math.floor(e.image.height*i),a=null!==t?t.x:0,o=null!==t?t.y:0;re.setTexture2D(e,0),Ee.copyTexSubImage2D(Ee.TEXTURE_2D,n,0,0,a,o,r,s),te.unbindTexture()};const Ye=Ee.createFramebuffer(),Xe=Ee.createFramebuffer();this.copyTextureToTexture=function(e,t){let n,i,r,s,a,o,l,c,u,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,f=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;null===p&&(0!==f?(Hr("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),p=f,f=0):p=0);const m=e.isCompressedTexture?e.mipmaps[p]:e.image;if(null!==h)n=h.max.x-h.min.x,i=h.max.y-h.min.y,r=h.isBox3?h.max.z-h.min.z:1,s=h.min.x,a=h.min.y,o=h.isBox3?h.min.z:0;else{const t=Math.pow(2,-f);n=Math.floor(m.width*t),i=Math.floor(m.height*t),r=e.isDataArrayTexture?m.depth:e.isData3DTexture?Math.floor(m.depth*t):1,s=0,a=0,o=0}null!==d?(l=d.x,c=d.y,u=d.z):(l=0,c=0,u=0);const g=xe.convert(t.format),v=xe.convert(t.type);let y;t.isData3DTexture?(re.setTexture3D(t,0),y=Ee.TEXTURE_3D):t.isDataArrayTexture||t.isCompressedArrayTexture?(re.setTexture2DArray(t,0),y=Ee.TEXTURE_2D_ARRAY):(re.setTexture2D(t,0),y=Ee.TEXTURE_2D),Ee.pixelStorei(Ee.UNPACK_FLIP_Y_WEBGL,t.flipY),Ee.pixelStorei(Ee.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),Ee.pixelStorei(Ee.UNPACK_ALIGNMENT,t.unpackAlignment);const b=Ee.getParameter(Ee.UNPACK_ROW_LENGTH),x=Ee.getParameter(Ee.UNPACK_IMAGE_HEIGHT),_=Ee.getParameter(Ee.UNPACK_SKIP_PIXELS),S=Ee.getParameter(Ee.UNPACK_SKIP_ROWS),E=Ee.getParameter(Ee.UNPACK_SKIP_IMAGES);Ee.pixelStorei(Ee.UNPACK_ROW_LENGTH,m.width),Ee.pixelStorei(Ee.UNPACK_IMAGE_HEIGHT,m.height),Ee.pixelStorei(Ee.UNPACK_SKIP_PIXELS,s),Ee.pixelStorei(Ee.UNPACK_SKIP_ROWS,a),Ee.pixelStorei(Ee.UNPACK_SKIP_IMAGES,o);const T=e.isDataArrayTexture||e.isData3DTexture,w=t.isDataArrayTexture||t.isData3DTexture;if(e.isDepthTexture){const h=ie.get(e),d=ie.get(t),m=ie.get(h.__renderTarget),g=ie.get(d.__renderTarget);te.bindFramebuffer(Ee.READ_FRAMEBUFFER,m.__webglFramebuffer),te.bindFramebuffer(Ee.DRAW_FRAMEBUFFER,g.__webglFramebuffer);for(let v=0;v<r;v++)T&&(Ee.framebufferTextureLayer(Ee.READ_FRAMEBUFFER,Ee.COLOR_ATTACHMENT0,ie.get(e).__webglTexture,f,o+v),Ee.framebufferTextureLayer(Ee.DRAW_FRAMEBUFFER,Ee.COLOR_ATTACHMENT0,ie.get(t).__webglTexture,p,u+v)),Ee.blitFramebuffer(s,a,n,i,l,c,n,i,Ee.DEPTH_BUFFER_BIT,Ee.NEAREST);te.bindFramebuffer(Ee.READ_FRAMEBUFFER,null),te.bindFramebuffer(Ee.DRAW_FRAMEBUFFER,null)}else if(0!==f||e.isRenderTargetTexture||ie.has(e)){const h=ie.get(e),d=ie.get(t);te.bindFramebuffer(Ee.READ_FRAMEBUFFER,Ye),te.bindFramebuffer(Ee.DRAW_FRAMEBUFFER,Xe);for(let e=0;e<r;e++)T?Ee.framebufferTextureLayer(Ee.READ_FRAMEBUFFER,Ee.COLOR_ATTACHMENT0,h.__webglTexture,f,o+e):Ee.framebufferTexture2D(Ee.READ_FRAMEBUFFER,Ee.COLOR_ATTACHMENT0,Ee.TEXTURE_2D,h.__webglTexture,f),w?Ee.framebufferTextureLayer(Ee.DRAW_FRAMEBUFFER,Ee.COLOR_ATTACHMENT0,d.__webglTexture,p,u+e):Ee.framebufferTexture2D(Ee.DRAW_FRAMEBUFFER,Ee.COLOR_ATTACHMENT0,Ee.TEXTURE_2D,d.__webglTexture,p),0!==f?Ee.blitFramebuffer(s,a,n,i,l,c,n,i,Ee.COLOR_BUFFER_BIT,Ee.NEAREST):w?Ee.copyTexSubImage3D(y,p,l,c,u+e,s,a,n,i):Ee.copyTexSubImage2D(y,p,l,c,s,a,n,i);te.bindFramebuffer(Ee.READ_FRAMEBUFFER,null),te.bindFramebuffer(Ee.DRAW_FRAMEBUFFER,null)}else w?e.isDataTexture||e.isData3DTexture?Ee.texSubImage3D(y,p,l,c,u,n,i,r,g,v,m.data):t.isCompressedArrayTexture?Ee.compressedTexSubImage3D(y,p,l,c,u,n,i,r,g,m.data):Ee.texSubImage3D(y,p,l,c,u,n,i,r,g,v,m):e.isDataTexture?Ee.texSubImage2D(Ee.TEXTURE_2D,p,l,c,n,i,g,v,m.data):e.isCompressedTexture?Ee.compressedTexSubImage2D(Ee.TEXTURE_2D,p,l,c,m.width,m.height,g,m.data):Ee.texSubImage2D(Ee.TEXTURE_2D,p,l,c,n,i,g,v,m);Ee.pixelStorei(Ee.UNPACK_ROW_LENGTH,b),Ee.pixelStorei(Ee.UNPACK_IMAGE_HEIGHT,x),Ee.pixelStorei(Ee.UNPACK_SKIP_PIXELS,_),Ee.pixelStorei(Ee.UNPACK_SKIP_ROWS,S),Ee.pixelStorei(Ee.UNPACK_SKIP_IMAGES,E),0===p&&t.generateMipmaps&&Ee.generateMipmap(y),te.unbindTexture()},this.initRenderTarget=function(e){void 0===ie.get(e).__webglFramebuffer&&re.setupRenderTarget(e)},this.initTexture=function(e){e.isCubeTexture?re.setTextureCube(e,0):e.isData3DTexture?re.setTexture3D(e,0):e.isDataArrayTexture||e.isCompressedArrayTexture?re.setTexture2DArray(e,0):re.setTexture2D(e,0),te.unbindTexture()},this.resetState=function(){A=0,M=0,R=null,te.reset(),_e.reset()},"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Ar}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=fs._getDrawingBufferColorSpace(e),t.unpackColorSpace=fs._getUnpackColorSpace()}}var Iv=n(205);function Pv(e){let t;const n=new Set,i=(e,i)=>{const r="function"===typeof e?e(t):e;if(r!==t){const e=t;t=i?r:Object.assign({},t,r),n.forEach(n=>n(t,e))}},r=()=>t,s={setState:i,getState:r,subscribe:(e,i,s)=>i||s?function(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Object.is;console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let a=i(t);function o(){const n=i(t);if(!s(a,n)){const t=a;e(a=n,t)}}return n.add(o),()=>n.delete(o)}(e,i,s):(n.add(e),()=>n.delete(e)),destroy:()=>n.clear()};return t=e(i,r,s),s}const kv="undefined"===typeof window||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent)?i.useEffect:i.useLayoutEffect;const Dv=[];function Nv(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(e,t)=>e===t;if(e===t)return!0;if(!e||!t)return!1;const i=e.length;if(t.length!==i)return!1;for(let r=0;r<i;r++)if(!n(e[r],t[r]))return!1;return!0}function Ov(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};null===t&&(t=[e]);for(const a of Dv)if(Nv(t,a.keys,a.equal)){if(n)return;if(Object.prototype.hasOwnProperty.call(a,"error"))throw a.error;if(Object.prototype.hasOwnProperty.call(a,"response"))return i.lifespan&&i.lifespan>0&&(a.timeout&&clearTimeout(a.timeout),a.timeout=setTimeout(a.remove,i.lifespan)),a.response;if(!n)throw a.promise}const r={keys:t,equal:i.equal,remove:()=>{const e=Dv.indexOf(r);-1!==e&&Dv.splice(e,1)},promise:(s=e,"object"===typeof s&&"function"===typeof s.then?e:e(...t)).then(e=>{r.response=e,i.lifespan&&i.lifespan>0&&(r.timeout=setTimeout(r.remove,i.lifespan))}).catch(e=>r.error=e)};var s;if(Dv.push(r),!n)throw r.promise}const Fv=(e,t,n)=>Ov(e,t,!1,n);var Uv=n(16),Bv=n.n(Uv),zv=n(784);const jv=["args","attach"],Gv=["args","children"],Vv=["args","children"],Hv=["children","key","ref"],Wv=["children","key","ref"],Yv=["params"];const Xv={};var qv,Kv;const Zv=e=>"colorSpace"in e||"outputColorSpace"in e,Jv=()=>{var e;return null!=(e=Xv.ColorManagement)?e:null},Qv=e=>e&&e.isOrthographicCamera,$v="undefined"!==typeof window&&(null!=(qv=window.document)&&qv.createElement||"ReactNative"===(null==(Kv=window.navigator)?void 0:Kv.product))?i.useLayoutEffect:i.useEffect;function ey(e){const t=i.useRef(e);return $v(()=>{t.current=e},[e]),t}function ty(e){let{set:t}=e;return $v(()=>(t(new Promise(()=>null)),()=>t(!1)),[t]),null}class ny extends i.Component{constructor(){super(...arguments),this.state={error:!1}}componentDidCatch(e){this.props.set(e)}render(){return this.state.error?null:this.props.children}}ny.getDerivedStateFromError=()=>({error:!0});const iy="__default",ry=new Map,sy=e=>e&&!!e.memoized&&!!e.changes;function ay(e){var t;const n="undefined"!==typeof window?null!=(t=window.devicePixelRatio)?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],n),e[1]):e}const oy=e=>{var t;return null==(t=e.__r3f)?void 0:t.root.getState()};function ly(e){let t=e.__r3f.root;for(;t.getState().previousRoot;)t=t.getState().previousRoot;return t}const cy={obj:e=>e===Object(e)&&!cy.arr(e)&&"function"!==typeof e,fun:e=>"function"===typeof e,str:e=>"string"===typeof e,num:e=>"number"===typeof e,boo:e=>"boolean"===typeof e,und:e=>void 0===e,arr:e=>Array.isArray(e),equ(e,t){let{arrays:n="shallow",objects:i="reference",strict:r=!0}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(typeof e!==typeof t||!!e!==!!t)return!1;if(cy.str(e)||cy.num(e)||cy.boo(e))return e===t;const s=cy.obj(e);if(s&&"reference"===i)return e===t;const a=cy.arr(e);if(a&&"reference"===n)return e===t;if((a||s)&&e===t)return!0;let o;for(o in e)if(!(o in t))return!1;if(s&&"shallow"===n&&"shallow"===i){for(o in r?t:e)if(!cy.equ(e[o],t[o],{strict:r,objects:"reference"}))return!1}else for(o in r?t:e)if(e[o]!==t[o])return!1;if(cy.und(o)){if(a&&0===e.length&&0===t.length)return!0;if(s&&0===Object.keys(e).length&&0===Object.keys(t).length)return!0;if(e!==t)return!1}return!0}};function uy(e){const t={nodes:{},materials:{}};return e&&e.traverse(e=>{e.name&&(t.nodes[e.name]=e),e.material&&!t.materials[e.material.name]&&(t.materials[e.material.name]=e.material)}),t}function hy(e,t){return e.__r3f=(0,Oe.A)({type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null},t),e}function dy(e,t){let n=e;if(t.includes("-")){const i=t.split("-"),r=i.pop();return n=i.reduce((e,t)=>e[t],e),{target:n,key:r}}return{target:n,key:t}}const fy=/-\d+$/;function py(e,t,n){if(cy.str(n)){if(fy.test(n)){const t=n.replace(fy,""),{target:i,key:r}=dy(e,t);Array.isArray(i[r])||(i[r]=[])}const{target:i,key:r}=dy(e,n);t.__r3f.previousAttach=i[r],i[r]=t}else t.__r3f.previousAttach=n(e,t)}function my(e,t,n){var i,r;if(cy.str(n)){const{target:i,key:r}=dy(e,n),s=t.__r3f.previousAttach;void 0===s?delete i[r]:i[r]=s}else null==(i=t.__r3f)||null==i.previousAttach||i.previousAttach(e,t);null==(r=t.__r3f)||delete r.previousAttach}function gy(e,t){let{children:n,key:i,ref:r}=t,s=Fe(t,Hv),a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{children:o,key:l,ref:c}=a,u=Fe(a,Wv),h=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const d=e.__r3f,f=Object.entries(s),p=[];if(h){const e=Object.keys(u);for(let t=0;t<e.length;t++)s.hasOwnProperty(e[t])||f.unshift([e[t],iy+"remove"])}f.forEach(t=>{let[n,i]=t;var r;if(null!=(r=e.__r3f)&&r.primitive&&"object"===n)return;if(cy.equ(i,u[n]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(n))return p.push([n,i,!0,[]]);let a=[];n.includes("-")&&(a=n.split("-")),p.push([n,i,!1,a]);for(const e in s){const t=s[e];e.startsWith("".concat(n,"-"))&&p.push([e,t,!1,e.split("-")])}});const m=(0,Oe.A)({},s);return null!=d&&d.memoizedProps&&null!=d&&d.memoizedProps.args&&(m.args=d.memoizedProps.args),null!=d&&d.memoizedProps&&null!=d&&d.memoizedProps.attach&&(m.attach=d.memoizedProps.attach),{memoized:m,changes:p}}const vy="undefined"!==typeof process&&!1;function yy(e,t){var n;const i=e.__r3f,r=null==i?void 0:i.root,s=null==r||null==r.getState?void 0:r.getState(),{memoized:a,changes:o}=sy(t)?t:gy(e,t),l=null==i?void 0:i.eventCount;e.__r3f&&(e.__r3f.memoizedProps=a);for(let h=0;h<o.length;h++){let[t,n,r,a]=o[h];if(Zv(e)){const e=3001,i="srgb",r="srgb-linear";"encoding"===t?(t="colorSpace",n=n===e?i:r):"outputEncoding"===t&&(t="outputColorSpace",n=n===e?i:r)}let l=e,d=l[t];if(a.length&&(d=a.reduce((e,t)=>e[t],e),!d||!d.set)){const[n,...i]=a.reverse();l=i.reverse().reduce((e,t)=>e[t],e),t=n}if(n===iy+"remove")if(l.constructor){let e=ry.get(l.constructor);e||(e=new l.constructor,ry.set(l.constructor,e)),n=e[t]}else n=0;if(r&&i)n?i.handlers[t]=n:delete i.handlers[t],i.eventCount=Object.keys(i.handlers).length;else if(d&&d.set&&(d.copy||d instanceof ma)){if(Array.isArray(n))d.fromArray?d.fromArray(n):d.set(...n);else if(d.copy&&n&&n.constructor&&(vy?d.constructor.name===n.constructor.name:d.constructor===n.constructor))d.copy(n);else if(void 0!==n){var c;const e=null==(c=d)?void 0:c.isColor;!e&&d.setScalar?d.setScalar(n):d instanceof ma&&n instanceof ma?d.mask=n.mask:d.set(n),!Jv()&&s&&!s.linear&&e&&d.convertSRGBToLinear()}}else{var u;if(l[t]=n,null!=(u=l[t])&&u.isTexture&&l[t].format===An&&l[t].type===hn&&s){const e=l[t];Zv(e)&&Zv(s.gl)?e.colorSpace=s.gl.outputColorSpace:e.encoding=s.gl.outputEncoding}}by(e)}if(i&&i.parent&&e.raycast&&l!==i.eventCount){const t=ly(e).getState().internal,n=t.interaction.indexOf(e);n>-1&&t.interaction.splice(n,1),i.eventCount&&t.interaction.push(e)}return!(1===o.length&&"onUpdate"===o[0][0])&&o.length&&null!=(n=e.__r3f)&&n.parent&&xy(e),e}function by(e){var t,n;const i=null==(t=e.__r3f)||null==(n=t.root)||null==n.getState?void 0:n.getState();i&&0===i.internal.frames&&i.invalidate()}function xy(e){null==e.onUpdate||e.onUpdate(e)}function _y(e,t){e.manual||(Qv(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function Sy(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function Ey(e,t,n,i){const r=n.get(t);r&&(n.delete(t),0===n.size&&(e.delete(i),r.target.releasePointerCapture(i)))}function Ty(e){function t(e){return e.filter(e=>["Move","Over","Enter","Out","Leave"].some(t=>{var n;return null==(n=e.__r3f)?void 0:n.handlers["onPointer"+t]}))}function n(t){const{internal:n}=e.getState();for(const e of n.hovered.values())if(!t.length||!t.find(t=>t.object===e.object&&t.index===e.index&&t.instanceId===e.instanceId)){const i=e.eventObject.__r3f,r=null==i?void 0:i.handlers;if(n.hovered.delete(Sy(e)),null!=i&&i.eventCount){const n=(0,Oe.A)((0,Oe.A)({},e),{},{intersections:t});null==r.onPointerOut||r.onPointerOut(n),null==r.onPointerLeave||r.onPointerLeave(n)}}}function i(e,t){for(let n=0;n<t.length;n++){const i=t[n].__r3f;null==i||null==i.handlers.onPointerMissed||i.handlers.onPointerMissed(e)}}return{handlePointer:function(r){switch(r){case"onPointerLeave":case"onPointerCancel":return()=>n([]);case"onLostPointerCapture":return t=>{const{internal:i}=e.getState();"pointerId"in t&&i.capturedMap.has(t.pointerId)&&requestAnimationFrame(()=>{i.capturedMap.has(t.pointerId)&&(i.capturedMap.delete(t.pointerId),n([]))})}}return function(s){const{onPointerMissed:a,internal:o}=e.getState();o.lastEvent.current=s;const l="onPointerMove"===r,c="onClick"===r||"onContextMenu"===r||"onDoubleClick"===r,u=function(t,n){const i=e.getState(),r=new Set,s=[],a=n?n(i.internal.interaction):i.internal.interaction;for(let e=0;e<a.length;e++){const t=oy(a[e]);t&&(t.raycaster.camera=void 0)}i.previousRoot||null==i.events.compute||i.events.compute(t,i);let o=a.flatMap(function(e){const n=oy(e);return n&&n.events.enabled&&null!==n.raycaster.camera?(void 0===n.raycaster.camera&&(null==n.events.compute||n.events.compute(t,n,null==(i=n.previousRoot)?void 0:i.getState()),void 0===n.raycaster.camera&&(n.raycaster.camera=null)),n.raycaster.camera?n.raycaster.intersectObject(e,!0):[]):[];var i}).sort((e,t)=>{const n=oy(e.object),i=oy(t.object);return n&&i&&i.events.priority-n.events.priority||e.distance-t.distance}).filter(e=>{const t=Sy(e);return!r.has(t)&&(r.add(t),!0)});i.events.filter&&(o=i.events.filter(o,i));for(const e of o){let t=e.object;for(;t;){var l;null!=(l=t.__r3f)&&l.eventCount&&s.push((0,Oe.A)((0,Oe.A)({},e),{},{eventObject:t})),t=t.parent}}if("pointerId"in t&&i.internal.capturedMap.has(t.pointerId))for(let e of i.internal.capturedMap.get(t.pointerId).values())r.has(Sy(e.intersection))||s.push(e.intersection);return s}(s,l?t:void 0),h=c?function(t){const{internal:n}=e.getState(),i=t.offsetX-n.initialClick[0],r=t.offsetY-n.initialClick[1];return Math.round(Math.sqrt(i*i+r*r))}(s):0;"onPointerDown"===r&&(o.initialClick=[s.offsetX,s.offsetY],o.initialHits=u.map(e=>e.eventObject)),c&&!u.length&&h<=2&&(i(s,o.interaction),a&&a(s)),l&&n(u),function(t,i,r,s){const a=e.getState();if(t.length){const e={stopped:!1};for(const o of t){const l=oy(o.object)||a,{raycaster:c,pointer:u,camera:h,internal:d}=l,f=new ss(u.x,u.y,0).unproject(h),p=e=>{var t,n;return null!=(t=null==(n=d.capturedMap.get(e))?void 0:n.has(o.eventObject))&&t},m=e=>{const t={intersection:o,target:i.target};d.capturedMap.has(e)?d.capturedMap.get(e).set(o.eventObject,t):d.capturedMap.set(e,new Map([[o.eventObject,t]])),i.target.setPointerCapture(e)},g=e=>{const t=d.capturedMap.get(e);t&&Ey(d.capturedMap,o.eventObject,t,e)};let v={};for(let e in i){let t=i[e];"function"!==typeof t&&(v[e]=t)}let y=(0,Oe.A)((0,Oe.A)((0,Oe.A)({},o),v),{},{pointer:u,intersections:t,stopped:e.stopped,delta:r,unprojectedPoint:f,ray:c.ray,camera:h,stopPropagation(){const r="pointerId"in i&&d.capturedMap.get(i.pointerId);(!r||r.has(o.eventObject))&&(y.stopped=e.stopped=!0,d.hovered.size&&Array.from(d.hovered.values()).find(e=>e.eventObject===o.eventObject))&&n([...t.slice(0,t.indexOf(o)),o])},target:{hasPointerCapture:p,setPointerCapture:m,releasePointerCapture:g},currentTarget:{hasPointerCapture:p,setPointerCapture:m,releasePointerCapture:g},nativeEvent:i});if(s(y),!0===e.stopped)break}}}(u,s,h,function(e){const t=e.eventObject,n=t.__r3f,a=null==n?void 0:n.handlers;if(null!=n&&n.eventCount)if(l){if(a.onPointerOver||a.onPointerEnter||a.onPointerOut||a.onPointerLeave){const t=Sy(e),n=o.hovered.get(t);n?n.stopped&&e.stopPropagation():(o.hovered.set(t,e),null==a.onPointerOver||a.onPointerOver(e),null==a.onPointerEnter||a.onPointerEnter(e))}null==a.onPointerMove||a.onPointerMove(e)}else{const n=a[r];n?c&&!o.initialHits.includes(t)||(i(s,o.interaction.filter(e=>!o.initialHits.includes(e))),n(e)):c&&o.initialHits.includes(t)&&i(s,o.interaction.filter(e=>!o.initialHits.includes(e)))}})}}}}const wy=e=>!(null==e||!e.render),Ay=i.createContext(null),My=(e,t)=>{const n=function(e){const t="function"===typeof e?Pv(e):e,n=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.getState,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object.is;const[,r]=(0,i.useReducer)(e=>e+1,0),s=t.getState(),a=(0,i.useRef)(s),o=(0,i.useRef)(e),l=(0,i.useRef)(n),c=(0,i.useRef)(!1),u=(0,i.useRef)();let h;void 0===u.current&&(u.current=e(s));let d=!1;(a.current!==s||o.current!==e||l.current!==n||c.current)&&(h=e(s),d=!n(u.current,h)),kv(()=>{d&&(u.current=h),a.current=s,o.current=e,l.current=n,c.current=!1});const f=(0,i.useRef)(s);kv(()=>{const e=()=>{try{const e=t.getState(),n=o.current(e);l.current(u.current,n)||(a.current=e,u.current=n,r())}catch(Vr){c.current=!0,r()}},n=t.subscribe(e);return t.getState()!==f.current&&e(),n},[]);const p=d?h:u.current;return(0,i.useDebugValue)(p),p};return Object.assign(n,t),n[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const e=[n,t];return{next(){const t=e.length<=0;return{value:e.shift(),done:t}}}},n}((n,r)=>{const s=new ss,a=new ss,o=new ss;function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r().camera,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r().size;const{width:i,height:l,top:c,left:u}=n,h=i/l;t.isVector3?o.copy(t):o.set(...t);const d=e.getWorldPosition(s).distanceTo(o);if(Qv(e))return{width:i/e.zoom,height:l/e.zoom,top:c,left:u,factor:1,distance:d,aspect:h};{const t=e.fov*Math.PI/180,n=2*Math.tan(t/2)*d,r=n*(i/l);return{width:r,height:n,top:c,left:u,factor:i/r,distance:d,aspect:h}}}let c;const u=e=>n(t=>({performance:(0,Oe.A)((0,Oe.A)({},t.performance),{},{current:e})})),h=new is,d={set:n,get:r,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return e(r(),t)},advance:(e,n)=>t(e,n,r()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new af,pointer:h,mouse:h,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const e=r();c&&clearTimeout(c),e.performance.current!==e.performance.min&&u(e.performance.min),c=setTimeout(()=>u(r().performance.max),e.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:l},setEvents:e=>n(t=>(0,Oe.A)((0,Oe.A)({},t),{},{events:(0,Oe.A)((0,Oe.A)({},t.events),e)})),setSize:(e,t,i,s,o)=>{const c=r().camera,u={width:e,height:t,top:s||0,left:o||0,updateStyle:i};n(e=>({size:u,viewport:(0,Oe.A)((0,Oe.A)({},e.viewport),l(c,a,u))}))},setDpr:e=>n(t=>{const n=ay(e);return{viewport:(0,Oe.A)((0,Oe.A)({},t.viewport),{},{dpr:n,initialDpr:t.viewport.initialDpr||n})}}),setFrameloop:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"always";const t=r().clock;t.stop(),t.elapsedTime=0,"never"!==e&&(t.start(),t.elapsedTime=0),n(()=>({frameloop:e}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:i.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(e,t,n)=>{const i=r().internal;return i.priority=i.priority+(t>0?1:0),i.subscribers.push({ref:e,priority:t,store:n}),i.subscribers=i.subscribers.sort((e,t)=>e.priority-t.priority),()=>{const n=r().internal;null!=n&&n.subscribers&&(n.priority=n.priority-(t>0?1:0),n.subscribers=n.subscribers.filter(t=>t.ref!==e))}}}};return d}),r=n.getState();let s=r.size,a=r.viewport.dpr,o=r.camera;return n.subscribe(()=>{const{camera:e,size:t,viewport:i,gl:r,set:l}=n.getState();if(t.width!==s.width||t.height!==s.height||i.dpr!==a){var c;s=t,a=i.dpr,_y(e,t),r.setPixelRatio(i.dpr);const n=null!=(c=t.updateStyle)?c:"undefined"!==typeof HTMLCanvasElement&&r.domElement instanceof HTMLCanvasElement;r.setSize(t.width,t.height,n)}e!==o&&(o=e,l(t=>({viewport:(0,Oe.A)((0,Oe.A)({},t.viewport),t.viewport.getCurrentViewport(e))})))}),n.subscribe(t=>e(t)),n};let Ry,Cy=new Set,Ly=new Set,Iy=new Set;function Py(e,t){if(e.size)for(const{callback:n}of e.values())n(t)}function ky(e,t){switch(e){case"before":return Py(Cy,t);case"after":return Py(Ly,t);case"tail":return Py(Iy,t)}}let Dy,Ny;function Oy(e,t,n){let i=t.clock.getDelta();for("never"===t.frameloop&&"number"===typeof e&&(i=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),Dy=t.internal.subscribers,Ry=0;Ry<Dy.length;Ry++)Ny=Dy[Ry],Ny.ref.current(Ny.store.getState(),i,n);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),"always"===t.frameloop?1:t.internal.frames}function Fy(){const e=i.useContext(Ay);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function Uy(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e=>e,t=arguments.length>1?arguments[1]:void 0;return Fy()(e,t)}function By(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=Fy(),i=n.getState().internal.subscribe,r=ey(e);return $v(()=>i(r,t,n),[t,i,n]),null}const zy=new WeakMap;function jy(e,t){return function(n){let i=zy.get(n);i||(i=new n,zy.set(n,i)),e&&e(i);for(var r=arguments.length,s=new Array(r>1?r-1:0),a=1;a<r;a++)s[a-1]=arguments[a];return Promise.all(s.map(e=>new Promise((n,r)=>i.load(e,e=>{e.scene&&Object.assign(e,uy(e.scene)),n(e)},t,t=>r(new Error("Could not load ".concat(e,": ").concat(null==t?void 0:t.message)))))))}}function Gy(e,t,n,i){const r=Array.isArray(t)?t:[t],s=Fv(jy(n,i),[e,...r],{equal:cy.equ});return Array.isArray(t)?s:s[0]}Gy.preload=function(e,t,n){const i=Array.isArray(t)?t:[t];return((e,t,n)=>{Ov(e,t,!0,n)})(jy(n),[e,...i])},Gy.clear=function(e,t){return(e=>{if(void 0===e||0===e.length)Dv.splice(0,Dv.length);else{const t=Dv.find(t=>Nv(e,t.keys,t.equal));t&&t.remove()}})([e,...Array.isArray(t)?t:[t]])};const Vy=new Map,{invalidate:Hy,advance:Wy}=function(e){let t,n,i,r=!1,s=!1;function a(o){n=requestAnimationFrame(a),r=!0,t=0,ky("before",o),s=!0;for(const n of e.values()){var l;i=n.store.getState(),!i.internal.active||!("always"===i.frameloop||i.internal.frames>0)||null!=(l=i.gl.xr)&&l.isPresenting||(t+=Oy(o,i))}if(s=!1,ky("after",o),0===t)return ky("tail",o),r=!1,cancelAnimationFrame(n)}return{loop:a,invalidate:function t(n){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;var o;if(!n)return e.forEach(e=>t(e.store.getState(),i));null!=(o=n.gl.xr)&&o.isPresenting||!n.internal.active||"never"===n.frameloop||(n.internal.frames=i>1?Math.min(60,n.internal.frames+i):s?2:1,r||(r=!0,requestAnimationFrame(a)))},advance:function(t){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(n&&ky("before",t),i)Oy(t,i,r);else for(const s of e.values())Oy(t,s.store.getState());n&&ky("after",t)}}}(Vy),{reconciler:Yy,applyProps:Xy}=function(e,t){function n(e,t,n){let i,{args:r=[],attach:s}=t,a=Fe(t,jv),o="".concat(e[0].toUpperCase()).concat(e.slice(1));if("primitive"===e){if(void 0===a.object)throw new Error("R3F: Primitives without 'object' are invalid!");i=hy(a.object,{type:e,root:n,attach:s,primitive:!0})}else{const t=Xv[o];if(!t)throw new Error("R3F: ".concat(o," is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively"));if(!Array.isArray(r))throw new Error("R3F: The args prop must be an array!");i=hy(new t(...r),{type:e,root:n,attach:s,memoizedProps:{args:r}})}return void 0===i.__r3f.attach&&(i.isBufferGeometry?i.__r3f.attach="geometry":i.isMaterial&&(i.__r3f.attach="material")),"inject"!==o&&yy(i,a),i}function i(e,t){let n=!1;var i,r;t&&(null!=(i=t.__r3f)&&i.attach?py(e,t,t.__r3f.attach):t.isObject3D&&e.isObject3D&&(e.add(t),n=!0),n||null==(r=e.__r3f)||r.objects.push(t),t.__r3f||hy(t,{}),t.__r3f.parent=e,xy(t),by(t))}function r(e,t,n){let i=!1;if(t){var r,s;if(null!=(r=t.__r3f)&&r.attach)py(e,t,t.__r3f.attach);else if(t.isObject3D&&e.isObject3D){t.parent=e,t.dispatchEvent({type:"added"}),e.dispatchEvent({type:"childadded",child:t});const r=e.children.filter(e=>e!==t),s=r.indexOf(n);e.children=[...r.slice(0,s),t,...r.slice(s)],i=!0}i||null==(s=e.__r3f)||s.objects.push(t),t.__r3f||hy(t,{}),t.__r3f.parent=e,xy(t),by(t)}}function s(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e&&[...e].forEach(e=>a(t,e,n))}function a(e,t,n){if(t){var i,r,a;if(t.__r3f&&(t.__r3f.parent=null),null!=(i=e.__r3f)&&i.objects&&(e.__r3f.objects=e.__r3f.objects.filter(e=>e!==t)),null!=(r=t.__r3f)&&r.attach)my(e,t,t.__r3f.attach);else if(t.isObject3D&&e.isObject3D){var o;e.remove(t),null!=(o=t.__r3f)&&o.root&&function(e,t){const{internal:n}=e.getState();n.interaction=n.interaction.filter(e=>e!==t),n.initialHits=n.initialHits.filter(e=>e!==t),n.hovered.forEach((e,i)=>{e.eventObject!==t&&e.object!==t||n.hovered.delete(i)}),n.capturedMap.forEach((e,i)=>{Ey(n.capturedMap,t,e,i)})}(ly(t),t)}const c=null==(a=t.__r3f)?void 0:a.primitive,u=!c&&(void 0===n?null!==t.dispose:n);var l;if(!c)s(null==(l=t.__r3f)?void 0:l.objects,t,u),s(t.children,t,u);if(delete t.__r3f,u&&t.dispose&&"Scene"!==t.type){const e=()=>{try{t.dispose()}catch(Px){}};"undefined"===typeof IS_REACT_ACT_ENVIRONMENT?(0,zv.unstable_scheduleCallback)(zv.unstable_IdlePriority,e):e()}by(e)}}const o=()=>{};return{reconciler:Bv()({createInstance:n,removeChild:a,appendChild:i,appendInitialChild:i,insertBefore:r,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(e,t)=>{if(!t)return;const n=e.getState().scene;n.__r3f&&(n.__r3f.root=e,i(n,t))},removeChildFromContainer:(e,t)=>{t&&a(e.getState().scene,t)},insertInContainerBefore:(e,t,n)=>{if(!t||!n)return;const i=e.getState().scene;i.__r3f&&r(i,t,n)},getRootHostContext:()=>null,getChildHostContext:e=>e,finalizeInitialChildren(e){var t;const n=null!=(t=null==e?void 0:e.__r3f)?t:{};return Boolean(n.handlers)},prepareUpdate(e,t,n,i){var r;if((null!=(r=null==e?void 0:e.__r3f)?r:{}).primitive&&i.object&&i.object!==e)return[!0];{const{args:t=[],children:r}=i,s=Fe(i,Gv),{args:a=[],children:o}=n,l=Fe(n,Vv);if(!Array.isArray(t))throw new Error("R3F: the args prop must be an array!");if(t.some((e,t)=>e!==a[t]))return[!0];const c=gy(e,s,l,!0);return c.changes.length?[!1,c]:null}},commitUpdate(e,t,r,s,o,l){let[c,u]=t;c?function(e,t,r,s){var o;const l=null==(o=e.__r3f)?void 0:o.parent;if(!l)return;const c=n(t,r,e.__r3f.root);if(e.children){for(const t of e.children)t.__r3f&&i(c,t);e.children=e.children.filter(e=>!e.__r3f)}e.__r3f.objects.forEach(e=>i(c,e)),e.__r3f.objects=[],e.__r3f.autoRemovedBeforeAppend||a(l,e),c.parent&&(c.__r3f.autoRemovedBeforeAppend=!0),i(l,c),c.raycast&&c.__r3f.eventCount&&ly(c).getState().internal.interaction.push(c);[s,s.alternate].forEach(e=>{null!==e&&(e.stateNode=c,e.ref&&("function"===typeof e.ref?e.ref(c):e.ref.current=c))})}(e,r,o,l):yy(e,u)},commitMount(e,t,n,i){var r;const s=null!=(r=e.__r3f)?r:{};e.raycast&&s.handlers&&s.eventCount&&ly(e).getState().internal.interaction.push(e)},getPublicInstance:e=>e,prepareForCommit:()=>null,preparePortalMount:e=>hy(e.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(e){var t;const{attach:n,parent:i}=null!=(t=e.__r3f)?t:{};n&&i&&my(i,e,n),e.isObject3D&&(e.visible=!1),by(e)},unhideInstance(e,t){var n;const{attach:i,parent:r}=null!=(n=e.__r3f)?n:{};i&&r&&py(r,e,i),(e.isObject3D&&null==t.visible||t.visible)&&(e.visible=!0),by(e)},createTextInstance:o,hideTextInstance:o,unhideTextInstance:o,getCurrentEventPriority:()=>t?t():Iv.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:"undefined"!==typeof performance&&cy.fun(performance.now)?performance.now:cy.fun(Date.now)?Date.now:()=>0,scheduleTimeout:cy.fun(setTimeout)?setTimeout:void 0,cancelTimeout:cy.fun(clearTimeout)?clearTimeout:void 0}),applyProps:yy}}(0,function(){var e;const t="undefined"!==typeof self&&self||"undefined"!==typeof window&&window;if(!t)return Iv.DefaultEventPriority;switch(null==(e=t.event)?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return Iv.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return Iv.ContinuousEventPriority;default:return Iv.DefaultEventPriority}}),qy={objects:"shallow",strict:!1},Ky=(e,t)=>{const n="function"===typeof e?e(t):e;return wy(n)?n:new Lv((0,Oe.A)({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0},e))};function Zy(e){const t=Vy.get(e),n=null==t?void 0:t.fiber,i=null==t?void 0:t.store;t&&console.warn("R3F.createRoot should only be called once!");const r="function"===typeof reportError?reportError:console.error,s=i||My(Hy,Wy),a=n||Yy.createContainer(s,Iv.ConcurrentRoot,null,!1,null,"",r,null);let o;t||Vy.set(e,{fiber:a,store:s});let l,c=!1;return{configure(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{gl:n,size:i,scene:r,events:a,onCreated:u,shadows:h=!1,linear:d=!1,flat:f=!1,legacy:p=!1,orthographic:m=!1,frameloop:g="always",dpr:v=[1,2],performance:y,raycaster:b,camera:x,onPointerMissed:_}=t,S=s.getState(),E=S.gl;S.gl||S.set({gl:E=Ky(n,e)});let T=S.raycaster;T||S.set({raycaster:T=new Bf});const w=b||{},{params:A}=w,M=Fe(w,Yv);if(cy.equ(M,T,qy)||Xy(T,(0,Oe.A)({},M)),cy.equ(A,T.params,qy)||Xy(T,{params:(0,Oe.A)((0,Oe.A)({},T.params),A)}),!S.camera||S.camera===l&&!cy.equ(l,x,qy)){l=x;const e=x instanceof Xo,t=e?x:m?new Dd(0,0,0,0,.1,1e3):new Jo(75,0,.1,1e3);e||(t.position.z=5,x&&(Xy(t,x),("aspect"in x||"left"in x||"right"in x||"bottom"in x||"top"in x)&&(t.manual=!0,t.updateProjectionMatrix())),S.camera||null!=x&&x.rotation||t.lookAt(0,0,0)),S.set({camera:t}),T.camera=t}if(!S.scene){let e;null!=r&&r.isScene?e=r:(e=new ol,r&&Xy(e,r)),S.set({scene:hy(e)})}if(!S.xr){var R;const e=(e,t)=>{const n=s.getState();"never"!==n.frameloop&&Wy(e,!0,n,t)},t=()=>{const t=s.getState();t.gl.xr.enabled=t.gl.xr.isPresenting,t.gl.xr.setAnimationLoop(t.gl.xr.isPresenting?e:null),t.gl.xr.isPresenting||Hy(t)},n={connect(){const e=s.getState().gl;e.xr.addEventListener("sessionstart",t),e.xr.addEventListener("sessionend",t)},disconnect(){const e=s.getState().gl;e.xr.removeEventListener("sessionstart",t),e.xr.removeEventListener("sessionend",t)}};"function"===typeof(null==(R=E.xr)?void 0:R.addEventListener)&&n.connect(),S.set({xr:n})}if(E.shadowMap){const e=E.shadowMap.enabled,t=E.shadowMap.type;if(E.shadowMap.enabled=!!h,cy.boo(h))E.shadowMap.type=Xe;else if(cy.str(h)){var C;const e={basic:We,percentage:Ye,soft:Xe,variance:qe};E.shadowMap.type=null!=(C=e[h])?C:Xe}else cy.obj(h)&&Object.assign(E.shadowMap,h);e===E.shadowMap.enabled&&t===E.shadowMap.type||(E.shadowMap.needsUpdate=!0)}const L=Jv();if(L&&("enabled"in L?L.enabled=!p:"legacyMode"in L&&(L.legacyMode=p)),!c){Xy(E,{outputEncoding:d?3e3:3001,toneMapping:f?Nt:Bt})}S.legacy!==p&&S.set(()=>({legacy:p})),S.linear!==d&&S.set(()=>({linear:d})),S.flat!==f&&S.set(()=>({flat:f})),!n||cy.fun(n)||wy(n)||cy.equ(n,E,qy)||Xy(E,n),a&&!S.events.handlers&&S.set({events:a(s)});const I=function(e,t){const n="undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement;if(t){const{width:e,height:i,top:r,left:s,updateStyle:a=n}=t;return{width:e,height:i,top:r,left:s,updateStyle:a}}if("undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:t,height:i,top:r,left:s}=e.parentElement.getBoundingClientRect();return{width:t,height:i,top:r,left:s,updateStyle:n}}return"undefined"!==typeof OffscreenCanvas&&e instanceof OffscreenCanvas?{width:e.width,height:e.height,top:0,left:0,updateStyle:n}:{width:0,height:0,top:0,left:0}}(e,i);return cy.equ(I,S.size,qy)||S.setSize(I.width,I.height,I.updateStyle,I.top,I.left),v&&S.viewport.dpr!==ay(v)&&S.setDpr(v),S.frameloop!==g&&S.setFrameloop(g),S.onPointerMissed||S.set({onPointerMissed:_}),y&&!cy.equ(y,S.performance,qy)&&S.set(e=>({performance:(0,Oe.A)((0,Oe.A)({},e.performance),y)})),o=u,c=!0,this},render(t){return c||this.configure(),Yy.updateContainer((0,ke.jsx)(Jy,{store:s,children:t,onCreated:o,rootElement:e}),a,null,()=>{}),s},unmount(){Qy(e)}}}function Jy(e){let{store:t,children:n,onCreated:i,rootElement:r}=e;return $v(()=>{const e=t.getState();e.set(e=>({internal:(0,Oe.A)((0,Oe.A)({},e.internal),{},{active:!0})})),i&&i(e),t.getState().events.connected||null==e.events.connect||e.events.connect(r)},[]),(0,ke.jsx)(Ay.Provider,{value:t,children:n})}function Qy(e,t){const n=Vy.get(e),i=null==n?void 0:n.fiber;if(i){const r=null==n?void 0:n.store.getState();r&&(r.internal.active=!1),Yy.updateContainer(null,i,null,()=>{r&&setTimeout(()=>{try{var n,i,s,a;null==r.events.disconnect||r.events.disconnect(),null==(n=r.gl)||null==(i=n.renderLists)||null==i.dispose||i.dispose(),null==(s=r.gl)||null==s.forceContextLoss||s.forceContextLoss(),null!=(a=r.gl)&&a.xr&&r.xr.disconnect(),function(e){e.dispose&&"Scene"!==e.type&&e.dispose();for(const t in e)null==t.dispose||t.dispose(),delete e[t]}(r),Vy.delete(e),t&&t(e)}catch(Px){}},500)})}}Yy.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:i.version});i.unstable_act;const $y={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function eb(e){const{handlePointer:t}=Ty(e);return{priority:1,enabled:!0,compute(e,t,n){t.pointer.set(e.offsetX/t.size.width*2-1,-e.offsetY/t.size.height*2+1),t.raycaster.setFromCamera(t.pointer,t.camera)},connected:void 0,handlers:Object.keys($y).reduce((e,n)=>(0,Oe.A)((0,Oe.A)({},e),{},{[n]:t(n)}),{}),update:()=>{var t;const{events:n,internal:i}=e.getState();null!=(t=i.lastEvent)&&t.current&&n.handlers&&n.handlers.onPointerMove(i.lastEvent.current)},connect:t=>{var n;const{set:i,events:r}=e.getState();null==r.disconnect||r.disconnect(),i(e=>({events:(0,Oe.A)((0,Oe.A)({},e.events),{},{connected:t})})),Object.entries(null!=(n=r.handlers)?n:[]).forEach(e=>{let[n,i]=e;const[r,s]=$y[n];t.addEventListener(r,i,{passive:s})})},disconnect:()=>{const{set:t,events:n}=e.getState();var i;n.connected&&(Object.entries(null!=(i=n.handlers)?i:[]).forEach(e=>{let[t,i]=e;if(n&&n.connected instanceof HTMLElement){const[e]=$y[t];n.connected.removeEventListener(e,i)}}),t(e=>({events:(0,Oe.A)((0,Oe.A)({},e.events),{},{connected:void 0})})))}}}function tb(e,t){let n;return function(){for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];window.clearTimeout(n),n=window.setTimeout(()=>e(...r),t)}}function nb(){let{debounce:e,scroll:t,polyfill:n,offsetSize:r}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{debounce:0,scroll:!1,offsetSize:!1};const s=n||("undefined"==typeof window?class{}:window.ResizeObserver);if(!s)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[a,o]=(0,i.useState)({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),l=(0,i.useRef)({element:null,scrollContainers:null,resizeObserver:null,lastBounds:a,orientationHandler:null}),c=e?"number"==typeof e?e:e.scroll:null,u=e?"number"==typeof e?e:e.resize:null,h=(0,i.useRef)(!1);(0,i.useEffect)(()=>(h.current=!0,()=>{h.current=!1}));const[d,f,p]=(0,i.useMemo)(()=>{const e=()=>{if(!l.current.element)return;const{left:e,top:t,width:n,height:i,bottom:s,right:a,x:c,y:u}=l.current.element.getBoundingClientRect(),d={left:e,top:t,width:n,height:i,bottom:s,right:a,x:c,y:u};l.current.element instanceof HTMLElement&&r&&(d.height=l.current.element.offsetHeight,d.width=l.current.element.offsetWidth),Object.freeze(d),h.current&&!sb(l.current.lastBounds,d)&&o(l.current.lastBounds=d)};return[e,u?tb(e,u):e,c?tb(e,c):e]},[o,r,c,u]);function m(){l.current.scrollContainers&&(l.current.scrollContainers.forEach(e=>e.removeEventListener("scroll",p,!0)),l.current.scrollContainers=null),l.current.resizeObserver&&(l.current.resizeObserver.disconnect(),l.current.resizeObserver=null),l.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",l.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",l.current.orientationHandler))}function g(){l.current.element&&(l.current.resizeObserver=new s(p),l.current.resizeObserver.observe(l.current.element),t&&l.current.scrollContainers&&l.current.scrollContainers.forEach(e=>e.addEventListener("scroll",p,{capture:!0,passive:!0})),l.current.orientationHandler=()=>{p()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",l.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",l.current.orientationHandler))}return function(e,t){(0,i.useEffect)(()=>{if(t){const t=e;return window.addEventListener("scroll",t,{capture:!0,passive:!0}),()=>{window.removeEventListener("scroll",t,!0)}}},[e,t])}(p,!!t),function(e){(0,i.useEffect)(()=>{const t=e;return window.addEventListener("resize",t),()=>{window.removeEventListener("resize",t)}},[e])}(f),(0,i.useEffect)(()=>{m(),g()},[t,p,f]),(0,i.useEffect)(()=>m,[]),[e=>{!e||e===l.current.element||(m(),l.current.element=e,l.current.scrollContainers=ib(e),g())},a,d]}function ib(e){const t=[];if(!e||e===document.body)return t;const{overflow:n,overflowX:i,overflowY:r}=window.getComputedStyle(e);return[n,i,r].some(e=>"auto"===e||"scroll"===e)&&t.push(e),[...t,...ib(e.parentElement)]}const rb=["x","y","top","bottom","left","right","width","height"],sb=(e,t)=>rb.every(n=>e[n]===t[n]);var ab,ob,lb=Object.defineProperty,cb=Object.defineProperties,ub=Object.getOwnPropertyDescriptors,hb=Object.getOwnPropertySymbols,db=Object.prototype.hasOwnProperty,fb=Object.prototype.propertyIsEnumerable,pb=(e,t,n)=>t in e?lb(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,mb=(e,t)=>{for(var n in t||(t={}))db.call(t,n)&&pb(e,n,t[n]);if(hb)for(var n of hb(t))fb.call(t,n)&&pb(e,n,t[n]);return e};"undefined"===typeof window||!(null==(ab=window.document)?void 0:ab.createElement)&&"ReactNative"!==(null==(ob=window.navigator)?void 0:ob.product)?i.useEffect:i.useLayoutEffect;function gb(e,t,n){if(!e)return;if(!0===n(e))return e;let i=t?e.return:e.child;for(;i;){const e=gb(i,t,n);if(e)return e;i=t?null:i.sibling}}function vb(e){try{return Object.defineProperties(e,{_currentRenderer:{get:()=>null,set(){}},_currentRenderer2:{get:()=>null,set(){}}})}catch(t){return e}}const yb=console.error;console.error=function(){const e=[...arguments].join("");if(!(null==e?void 0:e.startsWith("Warning:"))||!e.includes("useContext"))return yb.apply(this,arguments);console.error=yb};const bb=vb(i.createContext(null));class xb extends i.Component{render(){return i.createElement(bb.Provider,{value:this._reactInternals},this.props.children)}}function _b(){const e=i.useContext(bb);if(null===e)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const t=i.useId();return i.useMemo(()=>{for(const n of[e,null==e?void 0:e.alternate]){if(!n)continue;const e=gb(n,!1,e=>{let n=e.memoizedState;for(;n;){if(n.memoizedState===t)return!0;n=n.next}});if(e)return e}},[e,t])}function Sb(){const e=function(){const e=_b(),[t]=i.useState(()=>new Map);t.clear();let n=e;for(;n;){if(n.type&&"object"===typeof n.type){const e=void 0===n.type._context&&n.type.Provider===n.type?n.type:n.type._context;e&&e!==bb&&!t.has(e)&&t.set(e,i.useContext(vb(e)))}n=n.return}return t}();return i.useMemo(()=>Array.from(e.keys()).reduce((t,n)=>r=>{return i.createElement(t,null,i.createElement(n.Provider,(s=mb({},r),a={value:e.get(n)},cb(s,ub(a)))));var s,a},e=>i.createElement(xb,mb({},e))),[e])}const Eb=["children","fallback","resize","style","gl","events","eventSource","eventPrefix","shadows","linear","flat","legacy","orthographic","frameloop","dpr","performance","raycaster","camera","scene","onPointerMissed","onCreated"],Tb=i.forwardRef(function(t,n){let{children:r,fallback:s,resize:a,style:o,gl:l,events:c=eb,eventSource:u,eventPrefix:h,shadows:d,linear:f,flat:p,legacy:m,orthographic:g,frameloop:v,dpr:y,performance:b,raycaster:x,camera:_,scene:S,onPointerMissed:E,onCreated:T}=t,w=Fe(t,Eb);i.useMemo(()=>{return t=e,void Object.assign(Xv,t);var t},[]);const A=Sb(),[M,R]=nb((0,Oe.A)({scroll:!0,debounce:{scroll:50,resize:0}},a)),C=i.useRef(null),L=i.useRef(null);i.useImperativeHandle(n,()=>C.current);const I=ey(E),[P,k]=i.useState(!1),[D,N]=i.useState(!1);if(P)throw P;if(D)throw D;const O=i.useRef(null);$v(()=>{const e=C.current;R.width>0&&R.height>0&&e&&(O.current||(O.current=Zy(e)),O.current.configure({gl:l,events:c,shadows:d,linear:f,flat:p,legacy:m,orthographic:g,frameloop:v,dpr:y,performance:b,raycaster:x,camera:_,scene:S,size:R,onPointerMissed:function(){return null==I.current?void 0:I.current(...arguments)},onCreated:e=>{var t;null==e.events.connect||e.events.connect(u?(t=u)&&t.hasOwnProperty("current")?u.current:u:L.current),h&&e.setEvents({compute:(e,t)=>{const n=e[h+"X"],i=e[h+"Y"];t.pointer.set(n/t.size.width*2-1,-i/t.size.height*2+1),t.raycaster.setFromCamera(t.pointer,t.camera)}}),null==T||T(e)}}),O.current.render((0,ke.jsx)(A,{children:(0,ke.jsx)(ny,{set:N,children:(0,ke.jsx)(i.Suspense,{fallback:(0,ke.jsx)(ty,{set:k}),children:null!=r?r:null})})})))}),i.useEffect(()=>{const e=C.current;if(e)return()=>Qy(e)},[]);const F=u?"none":"auto";return(0,ke.jsx)("div",(0,Oe.A)((0,Oe.A)({ref:L,style:(0,Oe.A)({position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:F},o)},w),{},{children:(0,ke.jsx)("div",{ref:M,style:{width:"100%",height:"100%"},children:(0,ke.jsx)("canvas",{ref:C,style:{display:"block"},children:s})})}))}),wb=i.forwardRef(function(e,t){return(0,ke.jsx)(xb,{children:(0,ke.jsx)(Tb,(0,Oe.A)((0,Oe.A)({},e),{},{ref:t}))})}),Ab=(()=>parseInt(Ue.replace(/\D+/g,"")))();class Mb extends Yo{constructor(){super({uniforms:{time:{value:0},fade:{value:1}},vertexShader:"\n      uniform float time;\n      attribute float size;\n      varying vec3 vColor;\n      void main() {\n        vColor = color;\n        vec4 mvPosition = modelViewMatrix * vec4(position, 0.5);\n        gl_PointSize = size * (30.0 / -mvPosition.z) * (3.0 + sin(time + 100.0));\n        gl_Position = projectionMatrix * mvPosition;\n      }",fragmentShader:"\n      uniform sampler2D pointTexture;\n      uniform float fade;\n      varying vec3 vColor;\n      void main() {\n        float opacity = 1.0;\n        if (fade == 1.0) {\n          float d = distance(gl_PointCoord, vec2(0.5, 0.5));\n          opacity = 1.0 / (1.0 + exp(16.0 * (d - 0.25)));\n        }\n        gl_FragColor = vec4(vColor, opacity);\n\n        #include <tonemapping_fragment>\n\t      #include <".concat(Ab>=154?"colorspace_fragment":"encodings_fragment",">\n      }")})}}const Rb=e=>(new ss).setFromSpherical(new Hf(e,Math.acos(1-2*Math.random()),2*Math.random()*Math.PI)),Cb=i.forwardRef((e,t)=>{let{radius:n=100,depth:r=50,count:s=5e3,saturation:a=0,factor:o=4,fade:l=!1,speed:c=1}=e;const u=i.useRef(),[h,d,f]=i.useMemo(()=>{const e=[],t=[],i=Array.from({length:s},()=>(.5+.5*Math.random())*o),l=new Za;let c=n+r;const u=r/s;for(let n=0;n<s;n++)c-=u*Math.random(),e.push(...Rb(c).toArray()),l.setHSL(n/s,a,.9),t.push(l.r,l.g,l.b);return[new Float32Array(e),new Float32Array(t),new Float32Array(i)]},[s,r,o,n,a]);By(e=>u.current&&(u.current.uniforms.time.value=e.clock.elapsedTime*c));const[p]=i.useState(()=>new Mb);return i.createElement("points",{ref:t},i.createElement("bufferGeometry",null,i.createElement("bufferAttribute",{attach:"attributes-position",args:[h,3]}),i.createElement("bufferAttribute",{attach:"attributes-color",args:[d,3]}),i.createElement("bufferAttribute",{attach:"attributes-size",args:[f,1]})),i.createElement("primitive",{ref:u,object:p,attach:"material",blending:et,"uniforms-fade-value":l,depthWrite:!1,transparent:!0,vertexColors:!0}))});function Lb(){return Lb=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Lb.apply(null,arguments)}var Ib=Object.defineProperty,Pb=(e,t,n)=>(((e,t,n)=>{t in e?Ib(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!==typeof t?t+"":t,n),n);class kb{constructor(){Pb(this,"_listeners")}addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const n=this._listeners[e];if(void 0!==n){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const n=t.slice(0);for(let t=0,i=n.length;t<i;t++)n[t].call(this,e);e.target=null}}}var Db=Object.defineProperty,Nb=(e,t,n)=>(((e,t,n)=>{t in e?Db(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!==typeof t?t+"":t,n),n);const Ob=new ia,Fb=new ic,Ub=Math.cos(Math.PI/180*70),Bb=(e,t)=>(e%t+t)%t;class zb extends kb{constructor(e,t){super(),Nb(this,"object"),Nb(this,"domElement"),Nb(this,"enabled",!0),Nb(this,"target",new ss),Nb(this,"minDistance",0),Nb(this,"maxDistance",1/0),Nb(this,"minZoom",0),Nb(this,"maxZoom",1/0),Nb(this,"minPolarAngle",0),Nb(this,"maxPolarAngle",Math.PI),Nb(this,"minAzimuthAngle",-1/0),Nb(this,"maxAzimuthAngle",1/0),Nb(this,"enableDamping",!1),Nb(this,"dampingFactor",.05),Nb(this,"enableZoom",!0),Nb(this,"zoomSpeed",1),Nb(this,"enableRotate",!0),Nb(this,"rotateSpeed",1),Nb(this,"enablePan",!0),Nb(this,"panSpeed",1),Nb(this,"screenSpacePanning",!0),Nb(this,"keyPanSpeed",7),Nb(this,"zoomToCursor",!1),Nb(this,"autoRotate",!1),Nb(this,"autoRotateSpeed",2),Nb(this,"reverseOrbit",!1),Nb(this,"reverseHorizontalOrbit",!1),Nb(this,"reverseVerticalOrbit",!1),Nb(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),Nb(this,"mouseButtons",{LEFT:Be.ROTATE,MIDDLE:Be.DOLLY,RIGHT:Be.PAN}),Nb(this,"touches",{ONE:ze.ROTATE,TWO:ze.DOLLY_PAN}),Nb(this,"target0"),Nb(this,"position0"),Nb(this,"zoom0"),Nb(this,"_domElementKeyEvents",null),Nb(this,"getPolarAngle"),Nb(this,"getAzimuthalAngle"),Nb(this,"setPolarAngle"),Nb(this,"setAzimuthalAngle"),Nb(this,"getDistance"),Nb(this,"getZoomScale"),Nb(this,"listenToKeyEvents"),Nb(this,"stopListenToKeyEvents"),Nb(this,"saveState"),Nb(this,"reset"),Nb(this,"update"),Nb(this,"connect"),Nb(this,"dispose"),Nb(this,"dollyIn"),Nb(this,"dollyOut"),Nb(this,"getScale"),Nb(this,"setScale"),this.object=e,this.domElement=t,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>c.phi,this.getAzimuthalAngle=()=>c.theta,this.setPolarAngle=e=>{let t=Bb(e,2*Math.PI),i=c.phi;i<0&&(i+=2*Math.PI),t<0&&(t+=2*Math.PI);let r=Math.abs(t-i);2*Math.PI-r<r&&(t<i?t+=2*Math.PI:i+=2*Math.PI),u.phi=t-i,n.update()},this.setAzimuthalAngle=e=>{let t=Bb(e,2*Math.PI),i=c.theta;i<0&&(i+=2*Math.PI),t<0&&(t+=2*Math.PI);let r=Math.abs(t-i);2*Math.PI-r<r&&(t<i?t+=2*Math.PI:i+=2*Math.PI),u.theta=t-i,n.update()},this.getDistance=()=>n.object.position.distanceTo(n.target),this.listenToKeyEvents=e=>{e.addEventListener("keydown",Z),this._domElementKeyEvents=e},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",Z),this._domElementKeyEvents=null},this.saveState=()=>{n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=()=>{n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(i),n.update(),o=a.NONE},this.update=(()=>{const t=new ss,r=new ss(0,1,0),s=(new rs).setFromUnitVectors(e.up,r),f=s.clone().invert(),p=new ss,m=new rs,g=2*Math.PI;return function(){const v=n.object.position;s.setFromUnitVectors(e.up,r),f.copy(s).invert(),t.copy(v).sub(n.target),t.applyQuaternion(s),c.setFromVector3(t),n.autoRotate&&o===a.NONE&&R(2*Math.PI/60/60*n.autoRotateSpeed),n.enableDamping?(c.theta+=u.theta*n.dampingFactor,c.phi+=u.phi*n.dampingFactor):(c.theta+=u.theta,c.phi+=u.phi);let y=n.minAzimuthAngle,b=n.maxAzimuthAngle;isFinite(y)&&isFinite(b)&&(y<-Math.PI?y+=g:y>Math.PI&&(y-=g),b<-Math.PI?b+=g:b>Math.PI&&(b-=g),c.theta=y<=b?Math.max(y,Math.min(b,c.theta)):c.theta>(y+b)/2?Math.max(y,c.theta):Math.min(b,c.theta)),c.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,c.phi)),c.makeSafe(),!0===n.enableDamping?n.target.addScaledVector(d,n.dampingFactor):n.target.add(d),n.zoomToCursor&&T||n.object.isOrthographicCamera?c.radius=F(c.radius):c.radius=F(c.radius*h),t.setFromSpherical(c),t.applyQuaternion(f),v.copy(n.target).add(t),n.object.matrixAutoUpdate||n.object.updateMatrix(),n.object.lookAt(n.target),!0===n.enableDamping?(u.theta*=1-n.dampingFactor,u.phi*=1-n.dampingFactor,d.multiplyScalar(1-n.dampingFactor)):(u.set(0,0,0),d.set(0,0,0));let x=!1;if(n.zoomToCursor&&T){let i=null;if(n.object instanceof Jo&&n.object.isPerspectiveCamera){const e=t.length();i=F(e*h);const r=e-i;n.object.position.addScaledVector(S,r),n.object.updateMatrixWorld()}else if(n.object.isOrthographicCamera){const e=new ss(E.x,E.y,0);e.unproject(n.object),n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/h)),n.object.updateProjectionMatrix(),x=!0;const r=new ss(E.x,E.y,0);r.unproject(n.object),n.object.position.sub(r).add(e),n.object.updateMatrixWorld(),i=t.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),n.zoomToCursor=!1;null!==i&&(n.screenSpacePanning?n.target.set(0,0,-1).transformDirection(n.object.matrix).multiplyScalar(i).add(n.object.position):(Ob.origin.copy(n.object.position),Ob.direction.set(0,0,-1).transformDirection(n.object.matrix),Math.abs(n.object.up.dot(Ob.direction))<Ub?e.lookAt(n.target):(Fb.setFromNormalAndCoplanarPoint(n.object.up,n.target),Ob.intersectPlane(Fb,n.target))))}else n.object instanceof Dd&&n.object.isOrthographicCamera&&(x=1!==h,x&&(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/h)),n.object.updateProjectionMatrix()));return h=1,T=!1,!!(x||p.distanceToSquared(n.object.position)>l||8*(1-m.dot(n.object.quaternion))>l)&&(n.dispatchEvent(i),p.copy(n.object.position),m.copy(n.object.quaternion),x=!1,!0)}})(),this.connect=e=>{n.domElement=e,n.domElement.style.touchAction="none",n.domElement.addEventListener("contextmenu",J),n.domElement.addEventListener("pointerdown",Y),n.domElement.addEventListener("pointercancel",q),n.domElement.addEventListener("wheel",K)},this.dispose=()=>{var e,t,i,r,s,a;n.domElement&&(n.domElement.style.touchAction="auto"),null==(e=n.domElement)||e.removeEventListener("contextmenu",J),null==(t=n.domElement)||t.removeEventListener("pointerdown",Y),null==(i=n.domElement)||i.removeEventListener("pointercancel",q),null==(r=n.domElement)||r.removeEventListener("wheel",K),null==(s=n.domElement)||s.ownerDocument.removeEventListener("pointermove",X),null==(a=n.domElement)||a.ownerDocument.removeEventListener("pointerup",q),null!==n._domElementKeyEvents&&n._domElementKeyEvents.removeEventListener("keydown",Z)};const n=this,i={type:"change"},r={type:"start"},s={type:"end"},a={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let o=a.NONE;const l=1e-6,c=new Hf,u=new Hf;let h=1;const d=new ss,f=new is,p=new is,m=new is,g=new is,v=new is,y=new is,b=new is,x=new is,_=new is,S=new ss,E=new is;let T=!1;const w=[],A={};function M(){return Math.pow(.95,n.zoomSpeed)}function R(e){n.reverseOrbit||n.reverseHorizontalOrbit?u.theta+=e:u.theta-=e}function C(e){n.reverseOrbit||n.reverseVerticalOrbit?u.phi+=e:u.phi-=e}const L=(()=>{const e=new ss;return function(t,n){e.setFromMatrixColumn(n,0),e.multiplyScalar(-t),d.add(e)}})(),I=(()=>{const e=new ss;return function(t,i){!0===n.screenSpacePanning?e.setFromMatrixColumn(i,1):(e.setFromMatrixColumn(i,0),e.crossVectors(n.object.up,e)),e.multiplyScalar(t),d.add(e)}})(),P=(()=>{const e=new ss;return function(t,i){const r=n.domElement;if(r&&n.object instanceof Jo&&n.object.isPerspectiveCamera){const s=n.object.position;e.copy(s).sub(n.target);let a=e.length();a*=Math.tan(n.object.fov/2*Math.PI/180),L(2*t*a/r.clientHeight,n.object.matrix),I(2*i*a/r.clientHeight,n.object.matrix)}else r&&n.object instanceof Dd&&n.object.isOrthographicCamera?(L(t*(n.object.right-n.object.left)/n.object.zoom/r.clientWidth,n.object.matrix),I(i*(n.object.top-n.object.bottom)/n.object.zoom/r.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}})();function k(e){n.object instanceof Jo&&n.object.isPerspectiveCamera||n.object instanceof Dd&&n.object.isOrthographicCamera?h=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function D(e){k(h/e)}function N(e){k(h*e)}function O(e){if(!n.zoomToCursor||!n.domElement)return;T=!0;const t=n.domElement.getBoundingClientRect(),i=e.clientX-t.left,r=e.clientY-t.top,s=t.width,a=t.height;E.x=i/s*2-1,E.y=-r/a*2+1,S.set(E.x,E.y,1).unproject(n.object).sub(n.object.position).normalize()}function F(e){return Math.max(n.minDistance,Math.min(n.maxDistance,e))}function U(e){f.set(e.clientX,e.clientY)}function B(e){g.set(e.clientX,e.clientY)}function z(){if(1==w.length)f.set(w[0].pageX,w[0].pageY);else{const e=.5*(w[0].pageX+w[1].pageX),t=.5*(w[0].pageY+w[1].pageY);f.set(e,t)}}function j(){if(1==w.length)g.set(w[0].pageX,w[0].pageY);else{const e=.5*(w[0].pageX+w[1].pageX),t=.5*(w[0].pageY+w[1].pageY);g.set(e,t)}}function G(){const e=w[0].pageX-w[1].pageX,t=w[0].pageY-w[1].pageY,n=Math.sqrt(e*e+t*t);b.set(0,n)}function V(e){if(1==w.length)p.set(e.pageX,e.pageY);else{const t=$(e),n=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);p.set(n,i)}m.subVectors(p,f).multiplyScalar(n.rotateSpeed);const t=n.domElement;t&&(R(2*Math.PI*m.x/t.clientHeight),C(2*Math.PI*m.y/t.clientHeight)),f.copy(p)}function H(e){if(1==w.length)v.set(e.pageX,e.pageY);else{const t=$(e),n=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);v.set(n,i)}y.subVectors(v,g).multiplyScalar(n.panSpeed),P(y.x,y.y),g.copy(v)}function W(e){const t=$(e),i=e.pageX-t.x,r=e.pageY-t.y,s=Math.sqrt(i*i+r*r);x.set(0,s),_.set(0,Math.pow(x.y/b.y,n.zoomSpeed)),D(_.y),b.copy(x)}function Y(e){var t,i;!1!==n.enabled&&(0===w.length&&(null==(t=n.domElement)||t.ownerDocument.addEventListener("pointermove",X),null==(i=n.domElement)||i.ownerDocument.addEventListener("pointerup",q)),function(e){w.push(e)}(e),"touch"===e.pointerType?function(e){switch(Q(e),w.length){case 1:switch(n.touches.ONE){case ze.ROTATE:if(!1===n.enableRotate)return;z(),o=a.TOUCH_ROTATE;break;case ze.PAN:if(!1===n.enablePan)return;j(),o=a.TOUCH_PAN;break;default:o=a.NONE}break;case 2:switch(n.touches.TWO){case ze.DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;n.enableZoom&&G(),n.enablePan&&j(),o=a.TOUCH_DOLLY_PAN;break;case ze.DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;n.enableZoom&&G(),n.enableRotate&&z(),o=a.TOUCH_DOLLY_ROTATE;break;default:o=a.NONE}break;default:o=a.NONE}o!==a.NONE&&n.dispatchEvent(r)}(e):function(e){let t;switch(e.button){case 0:t=n.mouseButtons.LEFT;break;case 1:t=n.mouseButtons.MIDDLE;break;case 2:t=n.mouseButtons.RIGHT;break;default:t=-1}switch(t){case Be.DOLLY:if(!1===n.enableZoom)return;!function(e){O(e),b.set(e.clientX,e.clientY)}(e),o=a.DOLLY;break;case Be.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===n.enablePan)return;B(e),o=a.PAN}else{if(!1===n.enableRotate)return;U(e),o=a.ROTATE}break;case Be.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===n.enableRotate)return;U(e),o=a.ROTATE}else{if(!1===n.enablePan)return;B(e),o=a.PAN}break;default:o=a.NONE}o!==a.NONE&&n.dispatchEvent(r)}(e))}function X(e){!1!==n.enabled&&("touch"===e.pointerType?function(e){switch(Q(e),o){case a.TOUCH_ROTATE:if(!1===n.enableRotate)return;V(e),n.update();break;case a.TOUCH_PAN:if(!1===n.enablePan)return;H(e),n.update();break;case a.TOUCH_DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;!function(e){n.enableZoom&&W(e),n.enablePan&&H(e)}(e),n.update();break;case a.TOUCH_DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;!function(e){n.enableZoom&&W(e),n.enableRotate&&V(e)}(e),n.update();break;default:o=a.NONE}}(e):function(e){if(!1===n.enabled)return;switch(o){case a.ROTATE:if(!1===n.enableRotate)return;!function(e){p.set(e.clientX,e.clientY),m.subVectors(p,f).multiplyScalar(n.rotateSpeed);const t=n.domElement;t&&(R(2*Math.PI*m.x/t.clientHeight),C(2*Math.PI*m.y/t.clientHeight)),f.copy(p),n.update()}(e);break;case a.DOLLY:if(!1===n.enableZoom)return;!function(e){x.set(e.clientX,e.clientY),_.subVectors(x,b),_.y>0?D(M()):_.y<0&&N(M()),b.copy(x),n.update()}(e);break;case a.PAN:if(!1===n.enablePan)return;!function(e){v.set(e.clientX,e.clientY),y.subVectors(v,g).multiplyScalar(n.panSpeed),P(y.x,y.y),g.copy(v),n.update()}(e)}}(e))}function q(e){var t,i,r;!function(e){delete A[e.pointerId];for(let t=0;t<w.length;t++)if(w[t].pointerId==e.pointerId)return void w.splice(t,1)}(e),0===w.length&&(null==(t=n.domElement)||t.releasePointerCapture(e.pointerId),null==(i=n.domElement)||i.ownerDocument.removeEventListener("pointermove",X),null==(r=n.domElement)||r.ownerDocument.removeEventListener("pointerup",q)),n.dispatchEvent(s),o=a.NONE}function K(e){!1===n.enabled||!1===n.enableZoom||o!==a.NONE&&o!==a.ROTATE||(e.preventDefault(),n.dispatchEvent(r),function(e){O(e),e.deltaY<0?N(M()):e.deltaY>0&&D(M()),n.update()}(e),n.dispatchEvent(s))}function Z(e){!1!==n.enabled&&!1!==n.enablePan&&function(e){let t=!1;switch(e.code){case n.keys.UP:P(0,n.keyPanSpeed),t=!0;break;case n.keys.BOTTOM:P(0,-n.keyPanSpeed),t=!0;break;case n.keys.LEFT:P(n.keyPanSpeed,0),t=!0;break;case n.keys.RIGHT:P(-n.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),n.update())}(e)}function J(e){!1!==n.enabled&&e.preventDefault()}function Q(e){let t=A[e.pointerId];void 0===t&&(t=new is,A[e.pointerId]=t),t.set(e.pageX,e.pageY)}function $(e){const t=e.pointerId===w[0].pointerId?w[1]:w[0];return A[t.pointerId]}this.dollyIn=function(){N(arguments.length>0&&void 0!==arguments[0]?arguments[0]:M()),n.update()},this.dollyOut=function(){D(arguments.length>0&&void 0!==arguments[0]?arguments[0]:M()),n.update()},this.getScale=()=>h,this.setScale=e=>{k(e),n.update()},this.getZoomScale=()=>M(),void 0!==t&&this.connect(t),this.update()}}const jb=["makeDefault","camera","regress","domElement","enableDamping","keyEvents","onChange","onStart","onEnd"],Gb=i.forwardRef((e,t)=>{let{makeDefault:n,camera:r,regress:s,domElement:a,enableDamping:o=!0,keyEvents:l=!1,onChange:c,onStart:u,onEnd:h}=e,d=Fe(e,jb);const f=Uy(e=>e.invalidate),p=Uy(e=>e.camera),m=Uy(e=>e.gl),g=Uy(e=>e.events),v=Uy(e=>e.setEvents),y=Uy(e=>e.set),b=Uy(e=>e.get),x=Uy(e=>e.performance),_=r||p,S=a||g.connected||m.domElement,E=i.useMemo(()=>new zb(_),[_]);return By(()=>{E.enabled&&E.update()},-1),i.useEffect(()=>(l&&E.connect(!0===l?S:l),E.connect(S),()=>{E.dispose()}),[l,S,s,E,f]),i.useEffect(()=>{const e=e=>{f(),s&&x.regress(),c&&c(e)},t=e=>{u&&u(e)},n=e=>{h&&h(e)};return E.addEventListener("change",e),E.addEventListener("start",t),E.addEventListener("end",n),()=>{E.removeEventListener("start",t),E.removeEventListener("end",n),E.removeEventListener("change",e)}},[c,u,h,E,f,v]),i.useEffect(()=>{if(n){const e=b().controls;return y({controls:E}),()=>y({controls:e})}},[n,E]),i.createElement("primitive",Lb({ref:t,object:E,enableDamping:o},d))});function Vb(e){let{color:t,size:n,distance:r,speed:s,ring:a}=e;const o=(0,i.useRef)(),l=(0,i.useRef)(),[c]=a?Gy(Ed,[a.textureUrl]):[null];return By(e=>{let{clock:t}=e;const n=t.getElapsedTime();l.current.rotation.y=n*s,o.current.rotation.y+=.01}),(0,ke.jsxs)(ke.Fragment,{children:[(0,ke.jsxs)("mesh",{"rotation-x":Math.PI/2,children:[(0,ke.jsx)("ringGeometry",{args:[r-.02,r+.02,128]}),(0,ke.jsx)("meshBasicMaterial",{color:"#404040",side:Je})]}),(0,ke.jsxs)("group",{ref:l,children:[(0,ke.jsxs)("mesh",{ref:o,position:[r,0,0],castShadow:!0,receiveShadow:!0,children:[(0,ke.jsx)("sphereGeometry",{args:[n,32,32]}),(0,ke.jsx)("meshStandardMaterial",{color:t,roughness:.5,metalness:.1})]}),a&&c&&(0,ke.jsxs)("mesh",{position:[r,0,0],"rotation-x":Math.PI/2,children:[(0,ke.jsx)("ringGeometry",{args:[a.innerRadius,a.outerRadius,64]}),(0,ke.jsx)("meshBasicMaterial",{map:c,side:Je,transparent:!0,opacity:.8})]})]})]})}function Hb(){const e=(0,i.useRef)(),t=(0,i.useMemo)(()=>{const e=[];for(let t=0;t<1500;t++){const t=ns.randFloat(10,11),n=Math.random()*Math.PI*2,i=Math.cos(n)*t,r=Math.sin(n)*t,s=ns.randFloatSpread(.5);e.push({x:i,y:s,z:r})}return e},[]);return By(()=>{e.current.rotation.y+=.001}),(0,ke.jsx)("group",{ref:e,children:t.map((e,t)=>(0,ke.jsxs)("mesh",{position:[e.x,e.y,e.z],castShadow:!0,children:[(0,ke.jsx)("icosahedronGeometry",{args:[ns.randFloat(.01,.05),0]}),(0,ke.jsx)("meshStandardMaterial",{color:"#5c5c5c"})]},t))})}function Wb(){const e=(0,i.useRef)(),[t]=Gy(Ed,["/assets/textures/istockphoto-186019678-612x612.jpg"]);return By(t=>{let{clock:n}=t;e.current.rotation.y+=.002}),(0,ke.jsxs)("mesh",{ref:e,castShadow:!0,children:[(0,ke.jsx)("sphereGeometry",{args:[2.5,32,32]}),(0,ke.jsx)("meshStandardMaterial",{map:t,emissiveMap:t,emissive:16729344,emissiveIntensity:1.4})]})}function Yb(){return(0,ke.jsxs)(i.Fragment,{children:[(0,ke.jsx)("color",{attach:"background",args:["#000000"]}),(0,ke.jsx)(Cb,{radius:300,depth:50,count:2e4,factor:7,saturation:0,fade:!0,speed:.5}),(0,ke.jsx)("ambientLight",{intensity:.2}),(0,ke.jsx)("pointLight",{position:[0,0,0],intensity:2,color:16729344,distance:100,castShadow:!0}),(0,ke.jsx)(Wb,{}),(0,ke.jsx)(Hb,{}),[{name:"Mercury",color:"#8c8c8c",size:.38,distance:4,speed:.2},{name:"Venus",color:"#f0e6d2",size:.95,distance:5.5,speed:.15},{name:"Earth",color:"#6b93d6",size:1,distance:7,speed:.125},{name:"Mars",color:"#c1440e",size:.53,distance:8.5,speed:.1},{name:"Jupiter",color:"#d8ca9d",size:2.2,distance:12,speed:.075},{name:"Saturn",color:"#f0e5a5",size:1.8,distance:16,speed:.05},{name:"Uranus",color:"#aadae1",size:1.4,distance:19,speed:.04},{name:"Neptune",color:"#3f54ba",size:1.3,distance:22,speed:.03}].map(e=>(0,ke.jsx)(Vb,{color:e.color,size:e.size,distance:e.distance,speed:e.speed,ring:e.ring},e.name)),(0,ke.jsx)(Gb,{enableZoom:!0})]})}const Xb=function(){return(0,ke.jsx)(wb,{camera:{position:[0,10,20],fov:60},children:(0,ke.jsx)(i.Suspense,{fallback:null,children:(0,ke.jsx)(Yb,{})})})};if("undefined"!==typeof document){const e=document.createElement("style");e.type="text/css",e.innerText="\n  @keyframes swing {\n    0%, 100% { transform: rotate(0deg); }\n    25% { transform: rotate(3deg); }\n    75% { transform: rotate(-3deg); }\n  }\n  \n  @keyframes float {\n    0%, 100% { transform: translateY(0px); }\n    50% { transform: translateY(-10px); }\n  }\n\n  @keyframes scroll-text {\n    from { transform: translateX(50%); }\n    to { transform: translateX(-50%); }\n  }\n\n  .scroll-container {\n    overflow: hidden;\n  }\n\n  .scroll-text {\n    animation: scroll-text 30s linear infinite;\n  }\n",document.head.appendChild(e)}const qb=function(){const e=re();return(0,ke.jsxs)("div",{className:"min-h-screen",style:{position:"relative",overflow:"hidden"},children:[(0,ke.jsx)("div",{className:"fixed top-0 left-0 w-full h-full z-0",children:(0,ke.jsx)(i.Suspense,{fallback:null,children:(0,ke.jsx)(Xb,{})})}),(0,ke.jsxs)("div",{className:"relative z-10",children:[(0,ke.jsx)(De,{}),(0,ke.jsx)("section",{className:"text-white py-20",children:(0,ke.jsx)("div",{className:"container mx-auto px-4",children:(0,ke.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-12 items-center",children:[(0,ke.jsxs)("div",{className:"space-y-8",children:[(0,ke.jsxs)("div",{className:"space-y-4 scroll-container",children:[(0,ke.jsx)("div",{className:"scroll-text whitespace-nowrap",children:(0,ke.jsxs)("h1",{className:"text-4xl md:text-6xl font-bold leading-tight inline-block",children:["Create & Send",(0,ke.jsx)("span",{className:"block text-yellow-300",children:"Amazing Greetings"})]})}),(0,ke.jsx)("div",{className:"scroll-container",children:(0,ke.jsx)("p",{className:"text-xl text-purple-100 leading-relaxed scroll-text whitespace-nowrap inline-block",children:"Design personalized greeting cards with AI assistance and send them instantly via Email or WhatsApp to make every occasion memorable."})})]}),(0,ke.jsx)("div",{className:"flex flex-col sm:flex-row gap-4",children:(0,ke.jsx)("button",{onClick:()=>e("/cards"),className:"bg-yellow-400 text-gray-900 px-8 py-4 rounded-xl text-lg font-bold hover:bg-yellow-300 transform hover:scale-105 transition-all duration-300 shadow-lg",children:"\ud83c\udfa8 Create Cards Now"})}),(0,ke.jsxs)("div",{className:"flex space-x-8 pt-8",children:[(0,ke.jsxs)("div",{className:"text-center",children:[(0,ke.jsx)("div",{className:"text-3xl font-bold text-yellow-300",children:"50K+"}),(0,ke.jsx)("div",{className:"text-sm text-purple-200",children:"Cards Sent"})]}),(0,ke.jsxs)("div",{className:"text-center",children:[(0,ke.jsx)("div",{className:"text-3xl font-bold text-yellow-300",children:"100+"}),(0,ke.jsx)("div",{className:"text-sm text-purple-200",children:"Templates"})]}),(0,ke.jsxs)("div",{className:"text-center",children:[(0,ke.jsx)("div",{className:"text-3xl font-bold text-yellow-300",children:"24/7"}),(0,ke.jsx)("div",{className:"text-sm text-purple-200",children:"Available"})]})]})]}),(0,ke.jsxs)("div",{className:"relative",children:[(0,ke.jsxs)("div",{className:"bg-white/10 backdrop-blur-sm rounded-3xl p-6 border border-white/20",children:[(0,ke.jsx)("h3",{className:"text-white text-xl font-bold mb-6 text-center",children:"Featured Templates"}),(0,ke.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,ke.jsxs)("div",{className:"space-y-4",children:[(0,ke.jsxs)("div",{className:"bg-white rounded-xl p-4 shadow-lg hover:scale-105 transform transition-all duration-300 cursor-pointer animate-bounce",style:{animationDelay:"0s",animationDuration:"3s"},onClick:()=>e("/cards"),children:[(0,ke.jsx)("div",{className:"w-full h-24 bg-gradient-to-br from-pink-400 to-red-400 rounded-lg flex items-center justify-center mb-3",children:(0,ke.jsx)("span",{className:"text-2xl",children:"\ud83c\udf82"})}),(0,ke.jsx)("p",{className:"text-xs text-gray-600 text-center font-medium",children:"Birthday Cards"})]}),(0,ke.jsxs)("div",{className:"bg-white rounded-xl p-4 shadow-lg hover:scale-105 transform transition-all duration-300 cursor-pointer",style:{animation:"swing 4s ease-in-out infinite",animationDelay:"1s"},onClick:()=>e("/cards"),children:[(0,ke.jsx)("div",{className:"w-full h-32 bg-gradient-to-br from-green-500 to-red-500 rounded-lg flex items-center justify-center mb-3",children:(0,ke.jsx)("span",{className:"text-2xl",children:"\ud83c\udf84"})}),(0,ke.jsx)("p",{className:"text-xs text-gray-600 text-center font-medium",children:"Christmas Cards"})]})]}),(0,ke.jsxs)("div",{className:"space-y-4",children:[(0,ke.jsxs)("div",{className:"bg-white rounded-xl p-4 shadow-lg hover:scale-105 transform transition-all duration-300 cursor-pointer",style:{animation:"float 3.5s ease-in-out infinite",animationDelay:"0.5s"},onClick:()=>e("/cards"),children:[(0,ke.jsx)("div",{className:"w-full h-32 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center mb-3",children:(0,ke.jsx)("span",{className:"text-2xl",children:"\ud83c\udf8a"})}),(0,ke.jsx)("p",{className:"text-xs text-gray-600 text-center font-medium",children:"New Year Cards"})]}),(0,ke.jsxs)("div",{className:"bg-white rounded-xl p-4 shadow-lg hover:scale-105 transform transition-all duration-300 cursor-pointer animate-pulse",style:{animationDuration:"2.5s"},onClick:()=>e("/cards"),children:[(0,ke.jsx)("div",{className:"w-full h-24 bg-gradient-to-br from-pink-500 to-red-600 rounded-lg flex items-center justify-center mb-3",children:(0,ke.jsx)("span",{className:"text-2xl",children:"\ud83d\udc95"})}),(0,ke.jsx)("p",{className:"text-xs text-gray-600 text-center font-medium",children:"Valentine Cards"})]})]})]}),(0,ke.jsx)("div",{className:"text-center mt-6",children:(0,ke.jsx)("button",{onClick:()=>e("/cards"),className:"bg-white/20 hover:bg-white/30 text-white px-6 py-2 rounded-lg font-semibold transition-colors text-sm",children:"View All Cards \u2192"})})]}),(0,ke.jsx)("div",{className:"absolute -top-4 -right-4 w-20 h-20 bg-yellow-400 rounded-full opacity-20 animate-pulse"}),(0,ke.jsx)("div",{className:"absolute -bottom-4 -left-4 w-16 h-16 bg-pink-400 rounded-full opacity-20 animate-bounce"})]})]})})}),(0,ke.jsx)("section",{className:"py-16",children:(0,ke.jsxs)("div",{className:"container mx-auto px-4",children:[(0,ke.jsxs)("div",{className:"text-center mb-12",children:[(0,ke.jsx)("h2",{className:"text-3xl md:text-4xl font-bold text-white mb-4",children:"Popular Greeting Categories"}),(0,ke.jsx)("p",{className:"text-xl text-gray-300",children:"Choose from our most loved greeting card collections"})]}),(0,ke.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-6",children:[{name:"Birthday",emoji:"\ud83c\udf82",count:"25+ Cards",color:"from-pink-400 to-red-400"},{name:"Christmas",emoji:"\ud83c\udf84",count:"30+ Cards",color:"from-green-400 to-red-400"},{name:"New Year",emoji:"\u2728",count:"20+ Cards",color:"from-blue-400 to-purple-400"},{name:"Diwali",emoji:"\ud83e\ude94",count:"15+ Cards",color:"from-yellow-400 to-orange-400"},{name:"Valentine",emoji:"\ud83d\udc95",count:"18+ Cards",color:"from-pink-400 to-red-500"}].map((t,n)=>(0,ke.jsxs)("div",{className:"bg-white/10 backdrop-blur-sm rounded-2xl p-6 shadow-lg hover:shadow-2xl transform hover:-translate-y-2 transition-all duration-300 cursor-pointer group",onClick:()=>e("/cards"),children:[(0,ke.jsx)("div",{className:"w-16 h-16 bg-gradient-to-br ".concat(t.color," rounded-2xl flex items-center justify-center text-2xl mb-4 mx-auto group-hover:scale-110 transition-transform"),children:t.emoji}),(0,ke.jsx)("h3",{className:"text-lg font-bold text-white text-center mb-2",children:t.name}),(0,ke.jsx)("p",{className:"text-sm text-gray-300 text-center",children:t.count})]},n))})]})}),(0,ke.jsx)("section",{className:"py-16",children:(0,ke.jsxs)("div",{className:"container mx-auto px-4",children:[(0,ke.jsxs)("div",{className:"text-center mb-12",children:[(0,ke.jsx)("h2",{className:"text-3xl md:text-4xl font-bold text-white mb-4",children:"How It Works"}),(0,ke.jsx)("p",{className:"text-xl text-gray-300",children:"Create and send beautiful greetings in just 3 simple steps"})]}),(0,ke.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8 text-white",children:[{step:"1",title:"Choose Template",desc:"Select from our beautiful collection of greeting card templates",icon:"\ud83c\udfa8"},{step:"2",title:"Personalize",desc:"Add your message, customize with AI assistance, and make it unique",icon:"\u270f\ufe0f"},{step:"3",title:"Send Instantly",desc:"Share via Email or WhatsApp with just one click",icon:"\ud83d\udce4"}].map((e,t)=>(0,ke.jsxs)("div",{className:"text-center relative",children:[(0,ke.jsx)("div",{className:"w-20 h-20 bg-gradient-to-br from-purple-500 to-pink-500 rounded-full flex items-center justify-center text-3xl text-white mx-auto mb-6 shadow-lg",children:e.icon}),(0,ke.jsx)("div",{className:"absolute top-8 left-1/2 transform -translate-x-1/2 w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center text-sm font-bold text-purple-600",children:e.step}),(0,ke.jsx)("h3",{className:"text-xl font-bold text-white mb-3",children:e.title}),(0,ke.jsx)("p",{className:"text-gray-300",children:e.desc}),t<2&&(0,ke.jsx)("div",{className:"hidden md:block absolute top-10 left-full w-full h-0.5 bg-gradient-to-r from-purple-200 to-transparent"})]},t))})]})}),(0,ke.jsx)(Ne,{}),(0,ke.jsx)("section",{className:"py-16",children:(0,ke.jsxs)("div",{className:"container mx-auto px-4",children:[(0,ke.jsxs)("div",{className:"text-center mb-12",children:[(0,ke.jsx)("h2",{className:"text-3xl md:text-4xl font-bold text-white mb-4",children:"Why Choose Greetins?"}),(0,ke.jsx)("p",{className:"text-xl text-gray-300",children:"The most advanced greeting card platform with AI-powered features"})]}),(0,ke.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8",children:[{icon:"\ud83c\udfa8",title:"Beautiful Templates",desc:"Stunning designs for every occasion"},{icon:"\u26a1",title:"Instant Delivery",desc:"Send greetings in seconds"},{icon:"\ud83d\udcf1",title:"Multi-Channel",desc:"Email & WhatsApp delivery"},{icon:"\ud83e\udd16",title:"AI-Powered",desc:"Smart message suggestions"}].map((e,t)=>(0,ke.jsxs)("div",{className:"bg-white/10 backdrop-blur-sm rounded-2xl p-8 shadow-lg hover:shadow-2xl transform hover:-translate-y-2 transition-all duration-300 group",children:[(0,ke.jsx)("div",{className:"text-4xl mb-4 group-hover:scale-110 transition-transform",children:e.icon}),(0,ke.jsx)("h3",{className:"text-xl font-bold text-white mb-3",children:e.title}),(0,ke.jsx)("p",{className:"text-gray-300",children:e.desc})]},t))})]})}),(0,ke.jsx)("section",{className:"py-20",children:(0,ke.jsxs)("div",{className:"container mx-auto px-4 text-center bg-black/30 backdrop-blur-sm py-12 rounded-3xl",children:[(0,ke.jsx)("h2",{className:"text-3xl md:text-4xl font-bold text-white mb-6",children:"Ready to Spread Some Joy?"}),(0,ke.jsx)("p",{className:"text-xl text-purple-100 mb-8 max-w-2xl mx-auto",children:"Join thousands of users who trust Greetins to make their special moments even more memorable."}),(0,ke.jsx)("button",{onClick:()=>e("/cards"),className:"bg-white text-purple-600 px-10 py-4 rounded-2xl text-lg font-bold hover:shadow-2xl transform hover:scale-105 transition-all duration-300",children:"Get Started Now \ud83d\ude80"})]})}),(0,ke.jsx)("footer",{className:"text-white py-12",children:(0,ke.jsxs)("div",{className:"container mx-auto px-4",children:[(0,ke.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[(0,ke.jsxs)("div",{children:[(0,ke.jsx)("h3",{className:"text-2xl font-bold text-purple-400 mb-4",children:"Greetins"}),(0,ke.jsx)("p",{className:"text-gray-400",children:"AI-Enhanced greeting cards for every special moment."})]}),(0,ke.jsxs)("div",{children:[(0,ke.jsx)("h4",{className:"text-lg font-semibold mb-4",children:"Quick Links"}),(0,ke.jsxs)("div",{className:"space-y-2",children:[(0,ke.jsx)("div",{className:"text-gray-400 hover:text-white cursor-pointer",children:"Templates"}),(0,ke.jsx)("div",{className:"text-gray-400 hover:text-white cursor-pointer",children:"About"}),(0,ke.jsx)("div",{className:"text-gray-400 hover:text-white cursor-pointer",children:"Contact"})]})]}),(0,ke.jsxs)("div",{children:[(0,ke.jsx)("h4",{className:"text-lg font-semibold mb-4",children:"Support"}),(0,ke.jsxs)("div",{className:"space-y-2",children:[(0,ke.jsx)("div",{className:"text-gray-400 hover:text-white cursor-pointer",children:"Help Center"}),(0,ke.jsx)("div",{className:"text-gray-400 hover:text-white cursor-pointer",children:"Privacy Policy"}),(0,ke.jsx)("div",{className:"text-gray-400 hover:text-white cursor-pointer",children:"Terms of Service"})]})]})]}),(0,ke.jsxs)("div",{className:"border-t border-gray-800 mt-8 pt-8 text-center text-gray-400",children:[(0,ke.jsx)("div",{className:"mb-4",children:(0,ke.jsx)("a",{href:"https://risinternational.com",target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:text-blue-300 transition-colors",children:"www.risinternational.com"})}),(0,ke.jsxs)("div",{className:"flex justify-center gap-6 mb-4",children:[(0,ke.jsx)("a",{href:"https://www.facebook.com/share/1FmZVWtD9n/",target:"_blank",rel:"noopener noreferrer",className:"text-gray-400 hover:text-blue-500 transition-colors",children:(0,ke.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:(0,ke.jsx)("path",{d:"M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"})})}),(0,ke.jsx)("a",{href:"https://x.com/retouchin_it",target:"_blank",rel:"noopener noreferrer",className:"text-gray-400 hover:text-white transition-colors",children:(0,ke.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:(0,ke.jsx)("path",{d:"M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"})})}),(0,ke.jsx)("a",{href:"https://www.instagram.com/risinternational_services?igsh=bnd2MHl5c2s3eDA0",target:"_blank",rel:"noopener noreferrer",className:"text-gray-400 hover:text-pink-500 transition-colors",children:(0,ke.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:(0,ke.jsx)("path",{d:"M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"})})}),(0,ke.jsx)("a",{href:"https://youtube.com/@risinternational-net?si=thU1_Kr2dw0lvyC6",target:"_blank",rel:"noopener noreferrer",className:"text-gray-400 hover:text-red-500 transition-colors",children:(0,ke.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:(0,ke.jsx)("path",{d:"M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"})})})]}),(0,ke.jsx)("p",{children:"\xa9 2025 Greetins. All rights reserved."})]})]})})]}),"    "]})};var Kb=n(788);const Zb=["unsuspend","start","hls","crossOrigin","muted","loop","playsInline","onVideoFrame"],Jb=((e,t)=>"undefined"!==typeof window&&"function"===typeof(null==(e=window.document)?void 0:e.createElement)&&"string"===typeof(null==(t=window.navigator)?void 0:t.userAgent))();let Qb=null;function $b(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{unsuspend:r="loadedmetadata",start:s=!0,hls:a={},crossOrigin:o="anonymous",muted:l=!0,loop:c=!0,playsInline:u=!0,onVideoFrame:h}=t,d=Fe(t,Zb);const f=Uy(e=>e.gl),p=(0,i.useRef)(null),m=Fv(()=>new Promise(async t=>{let i,s;"string"===typeof e?i=e:s=e;const h=Object.assign(document.createElement("video"),(0,Oe.A)({src:i,srcObject:s,crossOrigin:o,loop:c,muted:l,playsInline:u},d));if(i&&Jb&&i.endsWith(".m3u8")){const e=p.current=await async function(){var e;null!==(e=Qb)&&void 0!==e||(Qb=await Promise.resolve().then(n.bind(n,788)));const t=Qb.default;if(t.isSupported()){for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return new t(...r)}return null}(a);e&&(e.on(Kb.Events.MEDIA_ATTACHED,()=>{e.loadSource(i)}),e.attachMedia(h))}const m=new Jc(h);"colorSpace"in m?m.colorSpace=f.outputColorSpace:m.encoding=f.outputEncoding,h.addEventListener(r,()=>t(m))}),[e]),g=m.source.data;return ex(g,h),(0,i.useEffect)(()=>(s&&m.image.play(),()=>{p.current&&(p.current.destroy(),p.current=null)}),[m,s]),m}const ex=(e,t)=>{(0,i.useEffect)(()=>{if(!t)return;if(!e.requestVideoFrameCallback)return;let n;const i=function(){t(...arguments),n=e.requestVideoFrameCallback(i)};return e.requestVideoFrameCallback(i),()=>e.cancelVideoFrameCallback(n)},[e,t])},tx=["args","children"];function nx(e,t){const n=e+"Geometry";return i.forwardRef((e,r)=>{let{args:s,children:a}=e,o=Fe(e,tx);const l=i.useRef(null);return i.useImperativeHandle(r,()=>l.current),i.useLayoutEffect(()=>{null==t||t(l.current)}),i.createElement("mesh",Lb({ref:l},o),i.createElement(n,{attach:"geometry",args:s}),a)})}const ix=nx("plane");function rx(){const{viewport:e}=Uy(),t=$b("/Video.mp4"),n=(0,i.useRef)();return By((e,t)=>{n.current&&(n.current.rotation.z+=.05*t,n.current.scale.lerp({x:1.2,y:1.2,z:1},.5*t))}),(0,ke.jsx)(ix,{ref:n,args:[1,1],scale:[e.width,e.height,1],children:(0,ke.jsx)("meshBasicMaterial",{map:t,toneMapped:!1})})}const sx=function(){var e;const t=re(),[n,r]=(0,i.useState)("all"),s=[{id:"birthday",name:"Birthday",emoji:"\ud83c\udf82",count:156,color:"from-pink-400 to-red-400"},{id:"anniversary",name:"Anniversary",emoji:"\ud83d\udc8d",count:89,color:"from-purple-400 to-pink-400"},{id:"wedding",name:"Wedding",emoji:"\ud83d\udc92",count:124,color:"from-rose-400 to-pink-500"},{id:"baby",name:"New Baby",emoji:"\ud83d\udc76",count:67,color:"from-blue-300 to-cyan-400"},{id:"graduation",name:"Graduation",emoji:"\ud83c\udf93",count:45,color:"from-indigo-400 to-blue-500"},{id:"thankyou",name:"Thank You",emoji:"\ud83d\ude4f",count:78,color:"from-green-400 to-teal-400"},{id:"getwell",name:"Get Well",emoji:"\ud83c\udf38",count:34,color:"from-yellow-300 to-orange-400"},{id:"sympathy",name:"Sympathy",emoji:"\ud83d\udd4a\ufe0f",count:23,color:"from-gray-400 to-slate-500"},{id:"christmas",name:"Christmas",emoji:"\ud83c\udf84",count:198,color:"from-green-500 to-red-500"},{id:"newyear",name:"New Year",emoji:"\ud83c\udf8a",count:87,color:"from-blue-500 to-purple-600"},{id:"valentine",name:"Valentine",emoji:"\ud83d\udc95",count:145,color:"from-pink-500 to-red-600"},{id:"mothersday",name:"Mother's Day",emoji:"\ud83c\udf39",count:92,color:"from-pink-400 to-rose-500"}],a=[{id:"all",name:"All Categories",count:s.reduce((e,t)=>e+t.count,0)},{id:"holidays",name:"Holidays",count:482},{id:"personal",name:"Personal Events",count:381},{id:"special",name:"Special Occasions",count:267}],o=e=>{t("/templates",{state:{selectedCategory:e}})};return(0,ke.jsxs)("div",{className:"category-page-container",children:[(0,ke.jsx)("div",{className:"background-canvas",children:(0,ke.jsx)(wb,{children:(0,ke.jsx)(i.Suspense,{fallback:null,children:(0,ke.jsx)(rx,{})})})}),(0,ke.jsx)("div",{className:"content-overlay",children:(0,ke.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,ke.jsx)(De,{}),(0,ke.jsxs)("div",{className:"flex gap-8",children:[(0,ke.jsxs)("div",{className:"w-64 flex-shrink-0 flex flex-col gap-6 items-stretch",children:[(0,ke.jsxs)("div",{className:"bg-black/30 backdrop-blur-md rounded-2xl shadow-lg p-6 border border-white/10",children:[(0,ke.jsx)("h3",{className:"text-lg font-semibold text-white mb-4",children:"Categories"}),(0,ke.jsx)("div",{className:"space-y-2",children:a.map(e=>(0,ke.jsx)("button",{onClick:()=>r(e.id),className:"w-full text-left px-3 py-2 rounded-md text-sm transition-colors ".concat(n===e.id?"bg-purple-500/20 text-purple-200 font-medium":"text-gray-300 hover:bg-white/10"),children:(0,ke.jsxs)("div",{className:"flex justify-between items-center",children:[(0,ke.jsx)("span",{children:e.name}),(0,ke.jsxs)("span",{className:"text-xs text-gray-400",children:["(",e.count,")"]})]})},e.id))})]}),(0,ke.jsxs)("div",{className:"bg-black/30 backdrop-blur-md rounded-2xl shadow-lg p-6 border border-white/10",children:[(0,ke.jsx)("h3",{className:"text-lg font-semibold text-white mb-4",children:"Popular"}),(0,ke.jsx)("div",{className:"space-y-3",children:s.slice(0,4).map(e=>(0,ke.jsxs)("button",{onClick:()=>o(e.id),className:"w-full flex items-center space-x-3 p-2 rounded-md hover:bg-white/10 transition-colors",children:[(0,ke.jsx)("span",{className:"text-lg",children:e.emoji}),(0,ke.jsxs)("div",{className:"text-left",children:[(0,ke.jsx)("div",{className:"text-sm font-medium text-white",children:e.name}),(0,ke.jsxs)("div",{className:"text-xs text-gray-400",children:[e.count," cards"]})]})]},e.id))})]})]}),(0,ke.jsxs)("div",{className:"flex-1",children:[(0,ke.jsxs)("div",{className:"mb-6 p-4 rounded-lg bg-black/20",children:[(0,ke.jsx)("h1",{className:"text-2xl font-bold text-white mb-2",children:(null===(e=a.find(e=>e.id===n))||void 0===e?void 0:e.name)||"All Categories"}),(0,ke.jsxs)("p",{className:"text-gray-300",children:["Choose from ",s.length," different card categories"]})]}),(0,ke.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6",children:s.map(e=>(0,ke.jsxs)("div",{className:"bg-black/30 backdrop-blur-md rounded-2xl shadow-lg border border-white/10 hover:shadow-purple-500/20 transition-shadow cursor-pointer overflow-hidden",onClick:()=>o(e.id),children:[(0,ke.jsx)("div",{className:"bg-gradient-to-br ".concat(e.color," h-32 flex items-center justify-center"),children:(0,ke.jsx)("span",{className:"text-4xl",children:e.emoji})}),(0,ke.jsxs)("div",{className:"p-4",children:[(0,ke.jsx)("h3",{className:"font-semibold text-white mb-1",children:e.name}),(0,ke.jsxs)("p",{className:"text-sm text-gray-400",children:[e.count," cards available"]})]})]},e.id))})]})]})]})})]})},ax={birthday:["https://images.unsplash.com/photo-1558636508-e0db3814a4ad?w=400&h=500&fit=crop","https://images.unsplash.com/photo-1558636508-e0db3814a4ad?w=400&h=500&fit=crop","https://images.unsplash.com/photo-1565958011504-98d3aeb64033?w=400&h=500&fit=crop","https://images.unsplash.com/photo-1599515669200-49acba011f5d?w=400&h=500&fit=crop","https://images.pexels.com/photos/1729797/pexels-photo-1729797.jpeg","https://images.pexels.com/photos/1729798/pexels-photo-1729798.jpeg","https://images.pexels.com/photos/1729799/pexels-photo-1729799.jpeg","https://images.pexels.com/photos/264887/pexels-photo-264887.jpeg","https://images.pexels.com/photos/587741/pexels-photo-587741.jpeg","https://images.pexels.com/photos/1729800/pexels-photo-1729800.jpeg","https://images.pexels.com/photos/1729801/pexels-photo-1729801.jpeg","https://images.pexels.com/photos/1729802/pexels-photo-1729802.jpeg"],anniversary:["https://images.pexels.com/photos/265856/pexels-photo-265856.jpeg","https://images.pexels.com/photos/265857/pexels-photo-265857.jpeg","https://images.pexels.com/photos/265858/pexels-photo-265858.jpeg","https://images.pexels.com/photos/265859/pexels-photo-265859.jpeg","https://images.pexels.com/photos/265860/pexels-photo-265860.jpeg","https://images.pexels.com/photos/265861/pexels-photo-265861.jpeg","https://images.pexels.com/photos/265862/pexels-photo-265862.jpeg","https://images.pexels.com/photos/265863/pexels-photo-265863.jpeg"],wedding:["https://images.pexels.com/photos/1024993/pexels-photo-1024993.jpeg","https://images.pexels.com/photos/1024994/pexels-photo-1024994.jpeg","https://images.pexels.com/photos/1024995/pexels-photo-1024995.jpeg","https://images.pexels.com/photos/1024996/pexels-photo-1024996.jpeg","https://images.pexels.com/photos/1024997/pexels-photo-1024997.jpeg","https://images.pexels.com/photos/1024998/pexels-photo-1024998.jpeg","https://images.pexels.com/photos/1024999/pexels-photo-1024999.jpeg","https://images.pexels.com/photos/1025000/pexels-photo-1025000.jpeg"],christmas:["/assets/christmas/Christmas 1.png","/assets/christmas/Christams 2.png","/assets/christmas/Christmas 3.png","/assets/christmas/Merry Christmas 4.png","/assets/christmas/Merry Christmas 6.png","/assets/christmas/Merry Christmas 7.png","/assets/christmas/Merry Christmas 8.png","/assets/christmas/Merry Christmas 9.png"],newyear:["/assets/newyear/_Happy New Year Poster 1.png","/assets/newyear/_New Year's 2 .png","/assets/newyear/_New Year's 3 .png","/assets/newyear/New Year 4.png","/assets/newyear/New Year 5.png","/assets/newyear/New Year 6.png","/assets/newyear/New Year 7.png","/assets/newyear/New Year 8.png"],valentine:["https://images.pexels.com/photos/6798404/pexels-photo-6798404.jpeg","https://images.pexels.com/photos/3927280/pexels-photo-3927280.jpeg","https://images.pexels.com/photos/6708918/pexels-photo-6708918.jpeg","https://images.pexels.com/photos/6709026/pexels-photo-6709026.jpeg","https://images.pexels.com/photos/6694112/pexels-photo-6694112.jpeg","https://images.pexels.com/photos/6708759/pexels-photo-6708759.jpeg"],"mothers-day":["https://images.pexels.com/photos/1257110/pexels-photo-1257110.jpeg","https://images.pexels.com/photos/1257111/pexels-photo-1257111.jpeg","https://images.pexels.com/photos/1257112/pexels-photo-1257112.jpeg","https://images.pexels.com/photos/1257113/pexels-photo-1257113.jpeg","https://images.pexels.com/photos/1257114/pexels-photo-1257114.jpeg","https://images.pexels.com/photos/1257115/pexels-photo-1257115.jpeg"],"fathers-day":["https://images.pexels.com/photos/1257116/pexels-photo-1257116.jpeg","https://images.pexels.com/photos/1257117/pexels-photo-1257117.jpeg","https://images.pexels.com/photos/1257118/pexels-photo-1257118.jpeg","https://images.pexels.com/photos/1257119/pexels-photo-1257119.jpeg","https://images.pexels.com/photos/1257120/pexels-photo-1257120.jpeg","https://images.pexels.com/photos/1257121/pexels-photo-1257121.jpeg"],graduation:["https://images.pexels.com/photos/267885/pexels-photo-267885.jpeg","https://images.pexels.com/photos/267886/pexels-photo-267886.jpeg","https://images.pexels.com/photos/267887/pexels-photo-267887.jpeg","https://images.pexels.com/photos/267888/pexels-photo-267888.jpeg","https://images.pexels.com/photos/267889/pexels-photo-267889.jpeg","https://images.pexels.com/photos/267890/pexels-photo-267890.jpeg"],"baby-shower":["https://images.pexels.com/photos/1257122/pexels-photo-1257122.jpeg","https://images.pexels.com/photos/1257123/pexels-photo-1257123.jpeg","https://images.pexels.com/photos/1257124/pexels-photo-1257124.jpeg","https://images.pexels.com/photos/1257125/pexels-photo-1257125.jpeg","https://images.pexels.com/photos/1257126/pexels-photo-1257126.jpeg","https://images.pexels.com/photos/1257127/pexels-photo-1257127.jpeg"],"thank-you":["https://images.pexels.com/photos/1257128/pexels-photo-1257128.jpeg","https://images.pexels.com/photos/1257129/pexels-photo-1257129.jpeg","https://images.pexels.com/photos/1257130/pexels-photo-1257130.jpeg","https://images.pexels.com/photos/1257131/pexels-photo-1257131.jpeg","https://images.pexels.com/photos/1257132/pexels-photo-1257132.jpeg","https://images.pexels.com/photos/1257133/pexels-photo-1257133.jpeg"],"get-well":["https://images.pexels.com/photos/1257134/pexels-photo-1257134.jpeg","https://images.pexels.com/photos/1257135/pexels-photo-1257135.jpeg","https://images.pexels.com/photos/1257136/pexels-photo-1257136.jpeg","https://images.pexels.com/photos/1257137/pexels-photo-1257137.jpeg","https://images.pexels.com/photos/1257138/pexels-photo-1257138.jpeg","https://images.pexels.com/photos/1257139/pexels-photo-1257139.jpeg"],congratulations:["https://images.pexels.com/photos/1257140/pexels-photo-1257140.jpeg","https://images.pexels.com/photos/1257141/pexels-photo-1257141.jpeg","https://images.pexels.com/photos/1257142/pexels-photo-1257142.jpeg","https://images.pexels.com/photos/1257143/pexels-photo-1257143.jpeg","https://images.pexels.com/photos/1257144/pexels-photo-1257144.jpeg","https://images.pexels.com/photos/1257145/pexels-photo-1257145.jpeg"],sympathy:["https://images.pexels.com/photos/1257146/pexels-photo-1257146.jpeg","https://images.pexels.com/photos/1257147/pexels-photo-1257147.jpeg","https://images.pexels.com/photos/1257148/pexels-photo-1257148.jpeg","https://images.pexels.com/photos/1257149/pexels-photo-1257149.jpeg","https://images.pexels.com/photos/1257150/pexels-photo-1257150.jpeg","https://images.pexels.com/photos/1257151/pexels-photo-1257151.jpeg"],diwali:["https://images.pexels.com/photos/3946680/pexels-photo-3946680.jpeg","https://images.pexels.com/photos/3962320/pexels-photo-3962320.jpeg","https://images.pexels.com/photos/3962310/pexels-photo-3962310.jpeg","https://images.pexels.com/photos/3962315/pexels-photo-3962315.jpeg","https://images.pexels.com/photos/3945680/pexels-photo-3945680.jpeg","https://images.pexels.com/photos/3962325/pexels-photo-3962325.jpeg"]},ox={},lx=e=>{let t=e?e.toLowerCase().trim():"birthday";t={birthday:"birthday",christmas:"christmas","new year":"newyear",newyear:"newyear",diwali:"diwali",valentine:"valentine",valentines:"valentine","valentines day":"valentine",anniversary:"anniversary",wedding:"wedding","mothers-day":"mothers-day","mothers day":"mothers-day","fathers-day":"fathers-day","fathers day":"fathers-day",graduation:"graduation","baby-shower":"baby-shower","baby shower":"baby-shower","thank-you":"thank-you","thank you":"thank-you","get-well":"get-well","get well":"get-well",congratulations:"congratulations",sympathy:"sympathy"}[t]||"birthday";const n=ax[t];if(!n||0===n.length)return console.warn("[WARNING] No images for ".concat(e)),ax.birthday[0];ox[t]||(ox[t]=new Set);const i=n.filter(e=>!ox[t].has(e));0===i.length&&(ox[t].clear(),i.push(...n));const r=i[Math.floor(Math.random()*i.length)];return ox[t].add(r),console.log("[OK] ".concat(t.toUpperCase()," image loaded")),r},cx=e=>lx(e);function ux(){const e=$b("/Video.mp4"),t=(0,i.useRef)();return By(()=>{t.current&&(t.current.rotation.z+=5e-4)}),(0,ke.jsx)(ix,{ref:t,args:[1,1],scale:[16,9,1],children:(0,ke.jsx)("meshBasicMaterial",{map:e,toneMapped:!1})})}const hx=[{id:"all",name:"All Cards",count:150},{id:"birthday",name:"Birthday",count:25},{id:"anniversary",name:"Anniversary",count:18},{id:"wedding",name:"Wedding",count:22},{id:"christmas",name:"Christmas",count:20},{id:"newyear",name:"New Year",count:15},{id:"valentine",name:"Valentine's Day",count:16},{id:"mothers-day",name:"Mother's Day",count:12},{id:"fathers-day",name:"Father's Day",count:10},{id:"graduation",name:"Graduation",count:14},{id:"baby-shower",name:"Baby Shower",count:13},{id:"thank-you",name:"Thank You",count:18},{id:"get-well",name:"Get Well Soon",count:8},{id:"congratulations",name:"Congratulations",count:16},{id:"sympathy",name:"Sympathy",count:6}];const dx=function(){var e;const t=re(),[n,r]=(0,i.useState)("birthday"),[s,a]=(0,i.useState)([]),[o,l]=(0,i.useState)(!0);return(0,i.useEffect)(()=>{l(!0),setTimeout(()=>{const e=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:24;const n=[],i="all"===e?"birthday":e;for(let r=1;r<=t;r++)n.push({id:"".concat(e,"-").concat(r),title:"".concat(e.charAt(0).toUpperCase()+e.slice(1).replace("-"," ")," Card ").concat(r),image:lx(i),category:e});return n}(n);a(e),l(!1)},300)},[n]),(0,ke.jsxs)("div",{className:"cards-page-container",children:[(0,ke.jsx)("div",{className:"background-canvas",children:(0,ke.jsx)(wb,{children:(0,ke.jsx)(i.Suspense,{fallback:null,children:(0,ke.jsx)(ux,{})})})}),(0,ke.jsxs)("div",{className:"content-overlay",children:[(0,ke.jsx)(De,{}),(0,ke.jsx)("div",{className:"container mx-auto px-4 py-6",children:(0,ke.jsxs)("div",{className:"flex gap-6",children:[(0,ke.jsx)("div",{className:"w-72 flex-shrink-0",children:(0,ke.jsxs)("div",{className:"bg-black/30 backdrop-blur-md rounded-2xl shadow-lg border border-white/10",children:[(0,ke.jsx)("div",{className:"p-6 border-b border-white/10",children:(0,ke.jsx)("h2",{className:"text-xl font-semibold text-white",children:"Categories"})}),(0,ke.jsx)("div",{className:"p-4",children:hx.map(e=>(0,ke.jsxs)("button",{onClick:()=>r(e.id),className:"w-full text-left px-4 py-3 rounded-lg mb-2 transition-all duration-200 flex justify-between items-center ".concat(n===e.id?"bg-purple-500/20 text-purple-200":"hover:bg-white/10 text-gray-300"),children:[(0,ke.jsx)("span",{className:"font-medium",children:e.name}),(0,ke.jsx)("span",{className:"text-sm px-2 py-1 rounded-full ".concat(n===e.id?"bg-purple-500/30 text-purple-200":"bg-white/10 text-gray-400"),children:e.count})]},e.id))})]})}),(0,ke.jsx)("div",{className:"flex-1",children:(0,ke.jsxs)("div",{className:"bg-black/30 backdrop-blur-md rounded-2xl shadow-lg border border-white/10",children:[(0,ke.jsx)("div",{className:"p-6 border-b border-white/10",children:(0,ke.jsxs)("div",{className:"flex justify-between items-center",children:[(0,ke.jsx)("h1",{className:"text-2xl font-bold text-white",children:(null===(e=hx.find(e=>e.id===n))||void 0===e?void 0:e.name)||"All Cards"}),(0,ke.jsxs)("div",{className:"text-sm text-gray-400",children:[s.length," cards available"]})]})}),(0,ke.jsxs)("div",{className:"p-6",children:[o?(0,ke.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6",children:[...Array(12)].map((e,t)=>(0,ke.jsxs)("div",{className:"animate-pulse",children:[(0,ke.jsx)("div",{className:"bg-white/10 aspect-[3/4] rounded-lg mb-3"}),(0,ke.jsx)("div",{className:"bg-white/10 h-4 rounded mb-2"}),(0,ke.jsx)("div",{className:"bg-white/10 h-3 rounded w-2/3"})]},t))}):(0,ke.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6",children:s.map(e=>(0,ke.jsxs)("div",{onClick:()=>(e=>{t("/send/".concat(e.id),{state:{templateImage:e.image,templateCaption:"Beautiful ".concat(e.category," greeting card"),occasion:e.category}})})(e),className:"group cursor-pointer bg-black/20 rounded-lg border border-white/10 hover:shadow-purple-500/20 transition-all duration-300 overflow-hidden",children:[(0,ke.jsxs)("div",{className:"relative aspect-[3/4] overflow-hidden",children:[(0,ke.jsx)("img",{src:e.image,alt:e.title,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"}),(0,ke.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-all duration-300"})]}),(0,ke.jsxs)("div",{className:"p-4",children:[(0,ke.jsx)("h3",{className:"font-medium text-white group-hover:text-purple-300 transition-colors duration-200 truncate",children:e.title}),(0,ke.jsx)("p",{className:"text-sm text-gray-400 mt-1 capitalize",children:e.category.replace("-"," ")})]})]},e.id))}),!o&&0===s.length&&(0,ke.jsxs)("div",{className:"text-center py-12",children:[(0,ke.jsx)("div",{className:"text-gray-400 text-6xl mb-4",children:"\ud83d\udcdd"}),(0,ke.jsx)("h3",{className:"text-xl font-medium text-gray-300 mb-2",children:"No cards found"}),(0,ke.jsx)("p",{className:"text-gray-400",children:"Try selecting a different category"})]})]})]})})]})})]})]})},fx=[{id:"all",name:"All Cards",icon:"\ud83c\udf89"},{id:"birthday",name:"Birthday",icon:"\ud83c\udf82"},{id:"christmas",name:"Christmas",icon:"\ud83c\udf84"},{id:"new year",name:"New Year",icon:"\u2728"},{id:"diwali",name:"Diwali",icon:"\ud83e\ude94"},{id:"valentine",name:"Valentine",icon:"\ud83d\udc9d"}];const px=function(e){let{activeCategory:t,onCategoryChange:n}=e;return(0,ke.jsx)("div",{className:"flex flex-wrap gap-3 mb-8",children:fx.map(e=>(0,ke.jsxs)("button",{onClick:()=>n(e.id),className:"flex items-center space-x-2 px-4 py-2 rounded-full transition-all ".concat(t===e.id?"bg-purple-600 text-white shadow-lg":"bg-white text-gray-600 hover:bg-purple-50 border"),children:[(0,ke.jsx)("span",{children:e.icon}),(0,ke.jsx)("span",{className:"font-medium",children:e.name})]},e.id))})};const mx=function(e){let{template:t,onTemplateClick:n}=e;const[r,s]=(0,i.useState)(!1);return(0,ke.jsx)("div",{className:"group cursor-pointer transform transition-all duration-300 hover:scale-105",onClick:()=>{n&&n(t.id)},children:(0,ke.jsxs)("div",{className:"bg-white rounded-xl shadow-lg overflow-hidden",children:[(0,ke.jsxs)("div",{className:"h-48 relative overflow-hidden",children:[t.image&&!r?(0,ke.jsx)("img",{src:t.image,alt:t.title,className:"w-full h-full object-cover group-hover:scale-110 transition-transform duration-300",onError:()=>s(!0)}):(0,ke.jsx)("div",{className:"".concat(t.gradient," h-full flex items-center justify-center"),children:(0,ke.jsxs)("div",{className:"text-white text-center",children:[(0,ke.jsxs)("div",{className:"text-4xl mb-2",children:["Christmas"===t.occasion&&"\ud83c\udf84","New Year"===t.occasion&&"\u2728","Birthday"===t.occasion&&"\ud83c\udf82","Diwali"===t.occasion&&"\ud83e\ude94","Valentine"===t.occasion&&"\ud83d\udc95","Wedding"===t.occasion&&"\ud83d\udc92"]}),(0,ke.jsx)("h3",{className:"text-lg font-semibold",children:t.title})]})}),(0,ke.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-20 group-hover:bg-opacity-10 transition-all duration-300"}),(0,ke.jsxs)("div",{className:"absolute bottom-4 left-4 text-white",children:[(0,ke.jsx)("h3",{className:"text-xl font-semibold drop-shadow-lg",children:t.title}),(0,ke.jsx)("p",{className:"text-sm opacity-90 drop-shadow",children:t.category})]})]}),(0,ke.jsxs)("div",{className:"p-4",children:[t.preview&&(0,ke.jsx)("p",{className:"text-sm text-gray-600 mb-3",children:t.preview}),(0,ke.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ke.jsx)("span",{className:"text-sm text-gray-500",children:t.occasion}),(0,ke.jsx)("button",{className:"bg-purple-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-purple-700 transition-colors",children:"Use Template"})]})]})]})})},gx=(e,t)=>{const n={Christmas:["\ud83c\udf84 May your Christmas be merry and bright with love and laughter!","\u2728 Wishing you magical moments and cherished memories this Christmas!","\ud83c\udf85 Sending warm Christmas wishes filled with joy and peace!","\ud83c\udf81 May the spirit of Christmas bring you happiness and wonder!"],Birthday:["\ud83c\udf82 Another year of amazing adventures and beautiful memories awaits!","\ud83c\udf89 Celebrating you and all the joy you bring to the world!","\u2728 May this new year of life be your best one yet!","\ud83c\udf88 Wishing you endless happiness on your special day!"],"New Year":["\u2728 New year, new dreams, new possibilities ahead!","\ud83c\udf86 Cheers to fresh starts and exciting adventures!","\ud83c\udf89 May this year bring you success and happiness!","\u2728 Here's to making this year absolutely amazing!"],Diwali:["\ud83e\ude94 May the festival of lights brighten your path to success!","\u2728 Wishing you prosperity and joy this Diwali!","\ud83c\udf86 May your life be as colorful as the Diwali celebrations!","\ud83d\udd6f\ufe0f Light up your world with happiness and love!"]},i=n[e]||n.Birthday;return i[Math.floor(Math.random()*i.length)]},vx=[{id:"birthday-1",title:"Happy Birthday",occasion:"Birthday",category:"Personal"},{id:"christmas-1",title:"Merry Christmas",occasion:"Christmas",category:"Festival"},{id:"newyear-1",title:"Happy New Year",occasion:"New Year",category:"Celebration"},{id:"diwali-1",title:"Happy Diwali",occasion:"Diwali",category:"Festival"},{id:"valentine-1",title:"Valentine's Day",occasion:"Valentine",category:"Love"}];const yx=function(){const e=re(),[t,n]=(0,i.useState)("all"),[r,s]=(0,i.useState)([]);(0,i.useEffect)(()=>{const e=vx.map(e=>{return t=e.id,n=e.title,i=e.occasion,r=e.category,{id:t,title:n,category:r,occasion:i,gradient:"bg-gradient-to-br from-purple-500 to-pink-500",image:lx(i.toLowerCase()),preview:gx(i)};var t,n,i,r});s(e)},[]);const a=t=>{const n=r.find(e=>e.id===t);if(n){const i=lx(n.occasion),r=gx(n.occasion,n.title);console.log("Generated image:",i),console.log("Generated caption:",r),e("/send/".concat(t),{state:{templateImage:i,templateCaption:r,occasion:n.occasion}})}},o="all"===t?r:r.filter(e=>e.occasion.toLowerCase()===t);return(0,ke.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,ke.jsx)(De,{}),(0,ke.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,ke.jsxs)("div",{className:"flex gap-8",children:[(0,ke.jsx)("div",{className:"w-64 flex-shrink-0",children:(0,ke.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[(0,ke.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Categories"}),(0,ke.jsx)(px,{activeCategory:t,onCategoryChange:n})]})}),(0,ke.jsxs)("div",{className:"flex-1",children:[(0,ke.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6",children:o.map(e=>(0,ke.jsx)(mx,{template:e,onTemplateClick:a},e.id))}),0===o.length&&(0,ke.jsx)("div",{className:"text-center py-12",children:(0,ke.jsx)("p",{className:"text-gray-500 text-lg",children:"No cards found in this category"})})]})]})})]})},bx=()=>{const e=ne(),t=re(),{template:n,croppedImage:r}=e.state||{},[s,a]=(0,i.useState)(""),[o,l]=(0,i.useState)(""),[c,u]=(0,i.useState)(""),[h,d]=(0,i.useState)(null),[f,p]=(0,i.useState)(!1),m=(0,i.useRef)(null);(0,i.useEffect)(()=>{n&&fetch("http://localhost:8000/api/v1/greetings/templates/".concat(n)).then(e=>e.json()).then(e=>d(e)).catch(e=>console.error("Error fetching template data:",e))},[n]),(0,i.useEffect)(()=>{if("Christmas"===(null===h||void 0===h?void 0:h.occasion)&&!o&&!f){const e=async()=>{try{p(!0);const e=await fetch("http://localhost:8000/api/v1/greetings/ai/generate-greeting",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({occasion:h.occasion,recipient_name:"a loved one",tone:"warm"})});if(!e.ok)throw new Error("Failed to generate AI wish");const t=await e.json();l(t.wish)}catch(Vr){console.error("Error auto-generating AI message:",Vr)}finally{p(!1)}};e()}},[h,o,f]);if(!h)return(0,ke.jsx)("div",{children:"Loading..."});const g=(0,Oe.A)((0,Oe.A)({},h.styles.card),{},{backgroundImage:"url(".concat(r||h.card_image,")")}),v=e=>{const t=h.styles[e];if(t&&t.fontFamily){const e="font-link-".concat(t.fontFamily.replace(/\s+/g,"-"));if(!document.getElementById(e)){const n=document.createElement("link");n.id=e,n.href="https://fonts.googleapis.com/css2?family=".concat(t.fontFamily.replace(/\s+/g,"+"),":wght@400;700&display=swap"),n.rel="stylesheet",document.head.appendChild(n)}}return t};return(0,ke.jsxs)("div",{className:"personalize-container",children:[(0,ke.jsx)("div",{className:"card-preview",ref:m,children:(0,ke.jsx)("div",{className:"card",style:g,children:(0,ke.jsxs)("div",{className:"card-content",children:[(0,ke.jsx)("h1",{className:"recipient-name",style:v("recipient"),children:s||"Recipient's Name"}),(0,ke.jsx)("p",{className:"message",style:v("message"),children:o||"Your personal message will appear here."}),(0,ke.jsx)("p",{className:"sender-name",style:v("sender"),children:c||"Your Name"})]})})}),(0,ke.jsxs)("div",{className:"form-container",children:[(0,ke.jsx)("h2",{children:"Personalize Your Card"}),(0,ke.jsxs)("p",{className:"template-occasion",children:["You've selected a ",(0,ke.jsx)("strong",{children:h.occasion})," card."]}),(0,ke.jsxs)("div",{className:"form-group",children:[(0,ke.jsx)("label",{htmlFor:"recipientName",children:"Recipient's Name"}),(0,ke.jsx)("input",{type:"text",id:"recipientName",value:s,onChange:e=>a(e.target.value),placeholder:"E.g., Jane Doe"})]}),(0,ke.jsxs)("div",{className:"form-group",children:[(0,ke.jsx)("label",{htmlFor:"message",children:"Your Message"}),(0,ke.jsx)("textarea",{id:"message",value:o,onChange:e=>l(e.target.value),placeholder:"Write your heartfelt message here...",rows:"6"})]}),(0,ke.jsxs)("div",{className:"form-group",children:[(0,ke.jsx)("label",{htmlFor:"senderName",children:"Your Name"}),(0,ke.jsx)("input",{type:"text",id:"senderName",value:c,onChange:e=>u(e.target.value),placeholder:"E.g., John Smith"})]}),(0,ke.jsxs)("div",{className:"button-group",children:[(0,ke.jsx)("button",{onClick:()=>{t(-1)},className:"btn-secondary",children:"Back"}),(0,ke.jsx)("button",{onClick:()=>{a(""),l(""),u("")},className:"btn-secondary",children:"Clear"}),(0,ke.jsx)("button",{onClick:async()=>{if(s.trim()){p(!0);try{const e=await fetch("http://localhost:8000/api/v1/greetings/ai/generate-greeting",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({occasion:null===h||void 0===h?void 0:h.occasion,recipient_name:s,tone:"warm"})});if(!e.ok)throw new Error("Failed to generate AI message");const t=await e.json();l(t.wish)}catch(Vr){console.error("Error generating AI message:",Vr),alert("Could not generate AI message. Please try again.")}finally{p(!1)}}else alert("Please enter the recipient's name first.")},className:"btn-secondary",disabled:f,children:f?"Generating...":"AI Generate Wish"}),(0,ke.jsx)("button",{onClick:()=>{if(!s||!o||!c)return void alert("Please fill in all fields before sending.");let e;"Christmas"===(null===h||void 0===h?void 0:h.occasion)?(e={subject:"\ud83c\udf84 Merry Christmas Wishes!"},e=(0,Oe.A)((0,Oe.A)({},e),{},{recipient_name:s,message:"Wishing you joy, peace, and happiness this Christmas \ud83c\udf85",sender_name:c,card_image:r||(null===h||void 0===h?void 0:h.card_image)})):e={recipient_name:s,message:o,sender_name:c,card_image:r||(null===h||void 0===h?void 0:h.card_image)},fetch("http://localhost:8000/api/v1/greetings/send-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>{e.ok?(alert("Greeting card sent successfully!"),t("/")):alert("Failed to send greeting card.")}).catch(e=>{console.error("Error sending email:",e),alert("An error occurred while sending the card.")})},className:"btn-primary",children:"Send via Mail"})]})]})]})};var xx=n(722);const _x="https://greetins-backend.onrender.com/api/v1";const Sx=function(e){let{label:t,type:n="text",placeholder:i,value:r,onChange:s,required:a=!1,rows:o}=e;const l="w-full p-4 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all";return(0,ke.jsxs)("div",{className:"space-y-2",children:[(0,ke.jsxs)("label",{className:"block text-sm font-medium text-gray-700",children:[t," ",a&&(0,ke.jsx)("span",{className:"text-red-500",children:"*"})]}),o?(0,ke.jsx)("textarea",{placeholder:i,value:r,onChange:s,required:a,rows:o,className:l}):(0,ke.jsx)("input",{type:n,placeholder:i,value:r,onChange:s,required:a,className:l})]})};const Ex=function(){return(0,ke.jsx)("div",{className:"flex items-center justify-center",children:(0,ke.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"})})};function Tx(){const e=(0,i.useRef)(),{viewport:t}=Uy(),[n,r]=(0,i.useState)(null);return(0,i.useEffect)(()=>{let e=!0;const t=document.createElement("video");t.src="/assets/textures/animated-background.mp4",t.crossOrigin="anonymous",t.loop=!0,t.muted=!0,t.playsInline=!0;const n=new Jc(t);return r(n),t.play().catch(e=>{"AbortError"!==e.name&&console.error("Video play failed:",e)}),()=>{e=!1,t.pause(),t.removeAttribute("src"),t.load(),n.dispose()}},[]),(0,ke.jsxs)("mesh",{ref:e,scale:[t.width,t.height,1],children:[(0,ke.jsx)("planeGeometry",{}),n&&(0,ke.jsx)("meshBasicMaterial",{map:n})]})}function wx(){return(0,ke.jsx)(wb,{camera:{position:[0,0,1]},children:(0,ke.jsx)(Tx,{})})}const Ax=function(){var e,t,n,r,s,a;const{templateId:o}=function(){let{matches:e}=i.useContext($),t=e[e.length-1];return t?t.params:{}}(),l=re(),c=ne(),u=c.state,h=null===u||void 0===u?void 0:u.templateData,[d,f]=(0,i.useState)({sender_name:"",sender_email:"",recipient_name:"",sender_whatsapp:"",recipient_email:"",recipient_whatsapp:"",message:(null===(e=c.state)||void 0===e?void 0:e.aiGeneratedMessage)||(null===(t=c.state)||void 0===t?void 0:t.message)||""});(0,i.useEffect)(()=>{var e,t;null!==(e=c.state)&&void 0!==e&&e.aiGeneratedMessage&&d.message!==c.state.aiGeneratedMessage?f(e=>(0,Oe.A)((0,Oe.A)({},e),{},{message:c.state.aiGeneratedMessage})):null!==(t=c.state)&&void 0!==t&&t.message&&f(e=>(0,Oe.A)((0,Oe.A)({},e),{},{message:c.state.message}))},[null===(n=c.state)||void 0===n?void 0:n.aiGeneratedMessage,null===(r=c.state)||void 0===r?void 0:r.message,d.message]);const p=(null===u||void 0===u?void 0:u.uploadedImage)||(null===(s=c.state)||void 0===s?void 0:s.cardImage)||(null===(a=c.state)||void 0===a?void 0:a.templateImage),m=()=>{return null!==h&&void 0!==h&&h.title?h.title:"ai-generated"===o?(null===(e=c.state)||void 0===e?void 0:e.occasion)||"AI Generated Greeting":o.replace("-"," ");var e},[g,v]=(0,i.useState)(""),[y,b]=(0,i.useState)(!1),[x,_]=(0,i.useState)("email"),[S,E]=(0,i.useState)(!1),T={backgroundColor:"rgba(10, 10, 10, 0.4)",backgroundImage:"\n      radial-gradient(at 10% 20%, hsla(260, 40%, 25%, 0.3) 0px, transparent 50%),\n      radial-gradient(at 80% 85%, hsla(300, 35%, 20%, 0.4) 0px, transparent 50%)\n    "};return(0,ke.jsxs)("div",{className:"min-h-screen bg-black",style:{position:"relative",overflow:"hidden"},children:[(0,ke.jsx)("style",{children:"\n        .form-card-section input,\n        .form-card-section textarea {\n          background-color: rgba(255, 255, 255, 0.05) !important;\n          border-color: rgba(255, 255, 255, 0.2) !important;\n          color: white !important;\n          backdrop-filter: blur(10px) !important;\n        }\n        .form-card-section input::placeholder,\n        .form-card-section textarea::placeholder {\n          color: rgba(255, 255, 255, 0.5) !important;\n        }\n        .form-card-section label {\n          color: #d1d5db !important; /* text-gray-300 */\n        }\n        header {\n          background-color: rgba(255, 255, 255, 0.05) !important;\n          backdrop-filter: blur(10px) !important;\n        }\n      "}),(0,ke.jsx)("div",{className:"fixed top-0 left-0 w-full h-full z-0",children:(0,ke.jsx)(wx,{})}),(0,ke.jsxs)("div",{className:"relative z-10",children:[(0,ke.jsx)(De,{}),(0,ke.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,ke.jsxs)("button",{onClick:()=>l("/"),className:"mb-6 flex items-center text-purple-300 hover:text-purple-100 transition-colors",children:[(0,ke.jsx)("span",{className:"mr-2",children:"\u2190"})," Back to Home"]}),(0,ke.jsxs)("div",{className:"max-w-4xl mx-auto grid grid-cols-1 lg:grid-cols-2 gap-8 items-stretch",children:[(0,ke.jsxs)("div",{style:T,className:"rounded-2xl shadow-lg p-8 border border-white/10",children:[(0,ke.jsxs)("div",{className:"bg-white/10 rounded-2xl shadow-2xl overflow-hidden",children:[(0,ke.jsx)("div",{className:"h-64 overflow-hidden",children:p?(0,ke.jsx)("img",{src:p,alt:m(),className:"w-full h-full object-cover"}):(0,ke.jsx)("div",{className:"bg-gradient-to-br from-purple-500 to-pink-500 h-full flex items-center justify-center",children:(0,ke.jsx)("div",{className:"text-white text-6xl",children:(()=>{var e,t,n;const i=(null===h||void 0===h||null===(e=h.occasion)||void 0===e?void 0:e.toLowerCase())||(null===(t=c.state)||void 0===t||null===(n=t.occasion)||void 0===n?void 0:n.toLowerCase())||o.toLowerCase();return i.includes("christmas")?"\ud83c\udf84":i.includes("birthday")?"\ud83c\udf82":i.includes("new year")?"\u2728":i.includes("diwali")?"\ud83e\ude94":i.includes("valentine")?"\ud83d\udc95":i.includes("wedding")?"\ud83d\udc92":"\ud83e\udd16"})()})})}),(0,ke.jsxs)("div",{className:"p-6",children:[(0,ke.jsx)("div",{className:"bg-black/20 rounded-lg p-4 mb-4",children:(0,ke.jsx)("p",{className:"text-gray-200 text-base leading-relaxed",children:d.message||"Your personalized AI-generated message will appear here..."})}),(0,ke.jsxs)("div",{className:"text-sm text-gray-400",children:["From: ",d.sender_name||"Your Name"]})]})]}),(0,ke.jsx)("div",{className:"mt-6",children:(0,ke.jsx)("button",{onClick:async()=>{E(!0),v("");try{var e;const t=await fetch("http://localhost:8000/api/v1/greetings/ai/generate-greeting",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({occasion:(null===h||void 0===h?void 0:h.occasion)||(null===(e=c.state)||void 0===e?void 0:e.occasion)||"greeting",recipient_name:d.recipient_name||"a loved one",tone:"warm"})});if(!t.ok){const e=await t.json().catch(()=>null),n=(null===e||void 0===e?void 0:e.detail)||"Failed to generate AI message (Status: ".concat(t.status,")");return v({type:"error",message:n}),void console.error("AI Generation Error:",e||t.statusText)}const n=await t.json();f(e=>(0,Oe.A)((0,Oe.A)({},e),{},{message:n.wish}))}catch(Vr){console.error("Network or other error generating AI message:",Vr),v({type:"error",message:"A network error occurred. Please check your connection."})}finally{E(!1)}},className:"w-full bg-white/10 text-white font-semibold py-3 px-6 rounded-lg border-2 border-white/20 hover:bg-white/20 transition-all duration-300 flex items-center justify-center gap-2",disabled:S,children:S?(0,ke.jsx)(Ex,{}):"\ud83e\udd16 AI Generate Wishes"})}),(0,ke.jsx)("div",{className:"mt-4 p-3 bg-black/20 rounded-lg",children:(0,ke.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-300",children:[(0,ke.jsx)("span",{children:"email"===x?"\ud83d\udce7 Email":"\ud83d\udcac WhatsApp"}),(0,ke.jsx)("span",{children:o})]})})]}),(0,ke.jsxs)("div",{style:T,className:"form-card-section rounded-2xl shadow-lg p-8 border border-white/10",children:[(0,ke.jsx)("h2",{className:"text-2xl font-bold text-white mb-6",children:"Send Your Greeting"}),(0,ke.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),!d.sender_name.trim())return void v({type:"error",message:"Please enter your name"});if(!d.sender_email.trim())return void v({type:"error",message:"Please enter your email"});if("email"===x&&!d.recipient_email.trim())return void v({type:"error",message:"Please enter recipient email"});if("whatsapp"===x&&!d.recipient_whatsapp.trim())return void v({type:"error",message:"Please enter recipient WhatsApp number"});const t=d.message.trim()||m();b(!0);try{let e=p;if(console.log("Original cardImage:",p?p.substring(0,100):"NO IMAGE"),p&&p.startsWith("/assets/")){console.log("Converting local asset to base64...");const t=await(async e=>{try{const t=await fetch(e),n=await t.blob();return new Promise((e,t)=>{const i=new FileReader;i.onloadend=()=>e(i.result),i.onerror=t,i.readAsDataURL(n)})}catch(Vr){return console.error("Error converting image to base64:",Vr),null}})(p);t?(e=t,console.log("Image converted to base64 successfully, length:",t.length)):console.log("Failed to convert image to base64")}else p&&p.startsWith("data:image")&&console.log("Image is already base64, length:",p.length);console.log("Final imageToSend:",e?e.substring(0,100):"NO IMAGE");const n=await(async e=>{try{console.log("[API] Sending greeting to:","".concat(_x,"/greetings/send")),console.log("[API] Payload:",e);const t=await xx.A.post("".concat(_x,"/greetings/send"),e);return console.log("[API] Response received:",t.data),t.data}catch(Vr){var t,n;throw console.error("[API] Error sending greeting:"),console.error("[API] Status:",null===(t=Vr.response)||void 0===t?void 0:t.status),console.error("[API] Data:",null===(n=Vr.response)||void 0===n?void 0:n.data),console.error("[API] Message:",Vr.message),console.error("[API] Full error:",Vr),Vr}})({sender_name:d.sender_name,sender_email:d.sender_email,sender_whatsapp:d.sender_whatsapp,recipient_email:d.recipient_email,recipient_whatsapp:d.recipient_whatsapp,greeting_template_id:o||"birthday-1",message:t,card_image:e});n.success?v({type:"success",message:n.message}):v({type:"error",message:n.message||"Failed to send greeting"})}catch(Vr){var n,i,r,s,a;console.error("Full error object:",Vr);let t="Network Error - Unable to send greeting";if(Vr.response)if(500===(null===(n=Vr.response)||void 0===n?void 0:n.status)){var l,c;t=(null===(l=Vr.response)||void 0===l||null===(c=l.data)||void 0===c?void 0:c.detail)||"Server Error - Please try again later"}else if(null!==(i=Vr.response)&&void 0!==i&&null!==(r=i.data)&&void 0!==r&&r.message)t=Vr.response.data.message;else if(null!==(s=Vr.response)&&void 0!==s&&null!==(a=s.data)&&void 0!==a&&a.detail){const n=Vr.response.data.detail;Array.isArray(n)?t=n.map(e=>e.msg||JSON.stringify(e)).join(", "):"string"===typeof n?t=n:"object"===typeof n&&(t=JSON.stringify(n))}else Vr.message&&(t=Vr.message);else t="Network Error: Unable to connect to server. Please check your internet connection and try again.",console.error("Network error details:",Vr.message);v({type:"error",message:t})}b(!1)},className:"space-y-6 mt-6",children:[(0,ke.jsx)(Sx,{label:"Your Name",placeholder:"Enter your full name",value:d.sender_name,onChange:e=>f((0,Oe.A)((0,Oe.A)({},d),{},{sender_name:e.target.value})),required:!0}),(0,ke.jsx)(Sx,{label:"Your Email",type:"email",placeholder:"your.email@example.com",value:d.sender_email,onChange:e=>f((0,Oe.A)((0,Oe.A)({},d),{},{sender_email:e.target.value})),required:!0}),(0,ke.jsx)(Sx,{label:"Recipient Name",placeholder:"Enter recipient's name",value:d.recipient_name,onChange:e=>f((0,Oe.A)((0,Oe.A)({},d),{},{recipient_name:e.target.value})),required:!0}),(0,ke.jsx)(Sx,{label:"Recipient Email",type:"email",placeholder:"recipient@example.com",value:d.recipient_email,onChange:e=>f((0,Oe.A)((0,Oe.A)({},d),{},{recipient_email:e.target.value})),required:!0}),(0,ke.jsx)(Sx,{label:"Personal Message (Optional - will use card title if empty)",placeholder:"Write your heartfelt message here...",value:d.message,onChange:e=>f((0,Oe.A)((0,Oe.A)({},d),{},{message:e.target.value})),rows:4}),(0,ke.jsx)("button",{type:"submit",disabled:y,className:"w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white p-4 rounded-xl hover:from-purple-700 hover:to-pink-700 disabled:opacity-50 transition-all font-semibold text-lg",children:y?(0,ke.jsx)(Ex,{}):"Send via ".concat("email"===x?"Email":"WhatsApp")})]}),g&&(0,ke.jsxs)("div",{className:"mt-6 p-4 rounded-lg ".concat("success"===g.type?"bg-green-50 text-green-800 border border-green-200":"bg-red-50 text-red-800 border border-red-200"),children:["success"===g.type?"\u2705":"\u274c"," ",String(g.message)]})]})]})]})]})]})};const Mx=function(){const e=re(),[t,r]=(0,i.useState)({occasion:"",recipientName:"",relationship:"",tone:"friendly",language:"english"}),[s,a]=(0,i.useState)(""),[o,l]=(0,i.useState)(!1),[c,u]=(0,i.useState)(""),h=async()=>{l(!0);try{const{generateAIGreeting:e}=await n.e(242).then(n.bind(n,242)),i=await e(t);a(i.message);const r=cx(t.occasion);u(r)}catch(Vr){console.error("Error generating greeting:",Vr),a("Dear ".concat(t.recipientName,", sending you warm wishes and positive vibes! May your day be filled with happiness and joy. You're truly special! \ud83d\udcab"));const n=cx(t.occasion||"birthday");u(n)}l(!1)};return(0,ke.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,ke.jsx)(De,{}),(0,ke.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,ke.jsxs)("button",{onClick:()=>e("/"),className:"mb-6 flex items-center text-purple-600 hover:text-purple-800 transition-colors",children:[(0,ke.jsx)("span",{className:"mr-2",children:"\u2190"})," Back to Home"]}),(0,ke.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,ke.jsxs)("div",{className:"text-center mb-12",children:[(0,ke.jsx)("h1",{className:"text-4xl font-bold text-gray-800 mb-4",children:"\ud83e\udd16 AI Greeting Generator"}),(0,ke.jsx)("p",{className:"text-xl text-gray-600",children:"Let AI create the perfect personalized greeting for you"})]}),(0,ke.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[(0,ke.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg p-8",children:[(0,ke.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-6",children:"Tell us about your greeting"}),(0,ke.jsxs)("div",{className:"space-y-6",children:[(0,ke.jsxs)("div",{children:[(0,ke.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:["Occasion ",(0,ke.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,ke.jsx)("div",{className:"grid grid-cols-2 gap-2",children:["Birthday","Christmas","New Year","Diwali","Valentine","Anniversary","Graduation","Wedding","Thank You","Get Well Soon"].map(e=>(0,ke.jsx)("button",{type:"button",onClick:()=>r((0,Oe.A)((0,Oe.A)({},t),{},{occasion:e})),className:"p-3 rounded-lg border-2 transition-all text-sm ".concat(t.occasion===e?"border-purple-500 bg-purple-50 text-purple-700":"border-gray-200 hover:border-gray-300"),children:e},e))})]}),(0,ke.jsx)(Sx,{label:"Recipient Name",placeholder:"Enter recipient's name",value:t.recipientName,onChange:e=>r((0,Oe.A)((0,Oe.A)({},t),{},{recipientName:e.target.value})),required:!0}),(0,ke.jsxs)("div",{children:[(0,ke.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Your Relationship"}),(0,ke.jsxs)("select",{value:t.relationship,onChange:e=>r((0,Oe.A)((0,Oe.A)({},t),{},{relationship:e.target.value})),className:"w-full p-4 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[(0,ke.jsx)("option",{value:"",children:"Select relationship"}),["Friend","Family Member","Colleague","Boss","Partner","Child","Parent","Sibling","Neighbor","Teacher"].map(e=>(0,ke.jsx)("option",{value:e,children:e},e))]})]}),(0,ke.jsxs)("div",{children:[(0,ke.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Tone of Message"}),(0,ke.jsx)("div",{className:"grid grid-cols-1 gap-2",children:[{value:"friendly",label:"\ud83d\ude0a Friendly"},{value:"formal",label:"\ud83c\udfa9 Formal"},{value:"funny",label:"\ud83d\ude04 Funny"},{value:"romantic",label:"\ud83d\udc95 Romantic"},{value:"inspirational",label:"\u2728 Inspirational"}].map(e=>(0,ke.jsx)("button",{type:"button",onClick:()=>r((0,Oe.A)((0,Oe.A)({},t),{},{tone:e.value})),className:"p-3 rounded-lg border-2 transition-all text-left ".concat(t.tone===e.value?"border-purple-500 bg-purple-50 text-purple-700":"border-gray-200 hover:border-gray-300"),children:e.label},e.value))})]}),(0,ke.jsx)("button",{onClick:h,disabled:!t.occasion||!t.recipientName||o,className:"w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white p-4 rounded-xl hover:from-purple-700 hover:to-pink-700 disabled:opacity-50 transition-all font-semibold text-lg",children:o?(0,ke.jsx)(Ex,{}):"\u2728 Generate AI Greeting"})]})]}),(0,ke.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg p-8",children:[(0,ke.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-6",children:"Your AI-Generated Greeting"}),!s&&!o&&(0,ke.jsxs)("div",{className:"text-center py-12",children:[(0,ke.jsx)("div",{className:"text-6xl mb-4",children:"\ud83e\udd16"}),(0,ke.jsx)("p",{className:"text-gray-500 text-lg",children:'Fill out the form and click "Generate" to create your personalized greeting!'})]}),o&&(0,ke.jsxs)("div",{className:"text-center py-12",children:[(0,ke.jsx)(Ex,{}),(0,ke.jsx)("p",{className:"text-gray-500 mt-4",children:"AI is crafting your perfect greeting..."})]}),s&&(0,ke.jsxs)("div",{className:"space-y-6",children:[(0,ke.jsx)("div",{className:"bg-gradient-to-br from-purple-50 to-pink-50 rounded-xl p-6 border-2 border-purple-200",children:(0,ke.jsx)("p",{className:"text-gray-800 text-lg leading-relaxed",children:s})}),(0,ke.jsx)("div",{className:"mb-6",children:(0,ke.jsxs)("div",{className:"bg-white rounded-xl shadow-lg overflow-hidden",children:[(0,ke.jsx)("div",{className:"h-48 overflow-hidden",children:c?(0,ke.jsx)("img",{src:c,alt:t.occasion,className:"w-full h-full object-cover"}):(0,ke.jsx)("div",{className:"bg-gradient-to-br from-purple-500 to-pink-500 h-full flex items-center justify-center",children:(0,ke.jsxs)("div",{className:"text-white text-4xl",children:["Christmas"===t.occasion&&"\ud83c\udf84","Birthday"===t.occasion&&"\ud83c\udf82","New Year"===t.occasion&&"\u2728","Diwali"===t.occasion&&"\ud83e\ude94","Valentine"===t.occasion&&"\ud83d\udc95",!t.occasion&&"\ud83e\udd16"]})})}),(0,ke.jsxs)("div",{className:"p-4",children:[(0,ke.jsx)("h4",{className:"text-lg font-bold text-gray-800 mb-2",children:t.occasion||"AI Greeting"}),(0,ke.jsx)("div",{className:"bg-gray-50 rounded-lg p-3",children:(0,ke.jsx)("p",{className:"text-gray-700 text-sm",children:s?s.substring(0,80)+"...":"AI-generated message will appear here"})}),(0,ke.jsx)("div",{className:"text-xs text-gray-500 mt-2",children:"From: You"})]})]})}),(0,ke.jsxs)("div",{className:"flex space-x-4",children:[(0,ke.jsx)("button",{onClick:()=>{e("/send/ai-generated",{state:{message:s,occasion:t.occasion,cardImage:c}})},className:"flex-1 bg-green-600 text-white p-3 rounded-xl hover:bg-green-700 transition-colors font-semibold",children:"\u2705 Use This Greeting"}),(0,ke.jsx)("button",{onClick:h,className:"flex-1 bg-gray-600 text-white p-3 rounded-xl hover:bg-gray-700 transition-colors font-semibold",children:"\ud83d\udd04 Generate New"})]}),(0,ke.jsx)("div",{className:"text-center",children:(0,ke.jsx)("p",{className:"text-sm text-gray-500",children:"\ud83d\udca1 Tip: You can edit this message when sending your greeting"})})]})]})]})]})]})]})};const Rx=function(){return(0,ke.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,ke.jsx)(De,{}),(0,ke.jsx)("div",{className:"container mx-auto px-4 py-12",children:(0,ke.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,ke.jsxs)("div",{className:"text-center mb-12",children:[(0,ke.jsx)("h1",{className:"text-4xl font-bold text-gray-800 mb-4",children:"About Greetins"}),(0,ke.jsx)("p",{className:"text-xl text-gray-600",children:"AI-Enhanced Greeting Card Platform"})]}),(0,ke.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 mb-12",children:[(0,ke.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg p-8",children:[(0,ke.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"\ud83c\udfa8 Beautiful Templates"}),(0,ke.jsx)("p",{className:"text-gray-600",children:"Choose from our curated collection of stunning greeting card templates for every occasion - birthdays, holidays, celebrations, and more."})]}),(0,ke.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg p-8",children:[(0,ke.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"\ud83d\udcf1 Multi-Channel Delivery"}),(0,ke.jsx)("p",{className:"text-gray-600",children:"Send your personalized greetings via email or WhatsApp with just a few clicks. Reach your loved ones wherever they are."})]}),(0,ke.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg p-8",children:[(0,ke.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"\ud83e\udd16 AI-Powered"}),(0,ke.jsx)("p",{className:"text-gray-600",children:"Our AI helps you craft the perfect message and ensures your greetings are delivered beautifully formatted and on time."})]}),(0,ke.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg p-8",children:[(0,ke.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"\u26a1 Instant Delivery"}),(0,ke.jsx)("p",{className:"text-gray-600",children:"No waiting, no delays. Your greeting cards are processed and delivered instantly to make every moment special."})]})]}),(0,ke.jsxs)("div",{className:"bg-gradient-to-r from-purple-600 to-pink-600 rounded-2xl p-8 text-white text-center",children:[(0,ke.jsx)("h2",{className:"text-3xl font-bold mb-4",children:"Ready to Send Some Joy?"}),(0,ke.jsx)("p",{className:"text-xl mb-6",children:"Start creating beautiful greeting cards today!"}),(0,ke.jsx)("button",{onClick:()=>window.location.href="/",className:"bg-white text-purple-600 px-8 py-3 rounded-xl font-semibold hover:bg-gray-100 transition-colors",children:"Browse Templates"})]})]})})]})};const Cx=function(){const e=re();return(0,ke.jsxs)("div",{className:"min-h-screen bg-white",children:[(0,ke.jsx)(De,{}),(0,ke.jsx)("section",{className:"pt-32 pb-20 px-4 bg-gradient-to-br from-purple-50 to-pink-50",children:(0,ke.jsxs)("div",{className:"container mx-auto max-w-6xl text-center",children:[(0,ke.jsx)("h1",{className:"text-5xl md:text-6xl font-bold text-gray-900 mb-6",children:"Our Services"}),(0,ke.jsx)("p",{className:"text-xl text-gray-600 max-w-3xl mx-auto mb-8",children:"Comprehensive greeting card solutions powered by AI technology"}),(0,ke.jsx)("button",{onClick:()=>e("/contact"),className:"bg-gradient-to-r from-purple-600 to-pink-600 text-white px-10 py-4 rounded-lg text-lg font-semibold hover:shadow-xl transform hover:scale-105 transition-all",children:"Get Started Today"})]})}),(0,ke.jsx)("section",{className:"py-20 px-4",children:(0,ke.jsx)("div",{className:"container mx-auto max-w-7xl",children:(0,ke.jsx)("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-8",children:[{icon:"\ud83c\udfa8",title:"Greeting Card Design",description:"Professional greeting card templates for every occasion. Birthdays, holidays, celebrations, and more - beautifully designed and ready to personalize."},{icon:"\ud83e\udd16",title:"AI-Powered Messages",description:"Smart AI generates heartfelt, personalized messages tailored to your occasion and recipient. Save time while expressing genuine emotions."},{icon:"\ud83d\udce7",title:"Email Delivery Service",description:"Send stunning greeting cards directly to any email address worldwide. Professional formatting ensures perfect display in all email clients."},{icon:"\ud83d\udcac",title:"WhatsApp Integration",description:"Share greetings instantly via WhatsApp. Connect with loved ones on their preferred messaging platform with one-click sharing."},{icon:"\u2728",title:"Custom Personalization",description:"Add your personal touch with custom messages, photos, and styling. Make every card uniquely yours with our easy-to-use editor."},{icon:"\u26a1",title:"Instant Delivery",description:"Real-time processing and instant delivery. Your greetings reach recipients in seconds, perfect for last-minute celebrations."}].map((t,n)=>(0,ke.jsxs)("div",{className:"group bg-white border border-gray-200 rounded-xl p-8 hover:shadow-2xl hover:border-purple-300 transition-all duration-300",children:[(0,ke.jsx)("div",{className:"text-5xl mb-6",children:t.icon}),(0,ke.jsx)("h3",{className:"text-2xl font-bold text-gray-900 mb-4",children:t.title}),(0,ke.jsx)("p",{className:"text-gray-600 leading-relaxed mb-6",children:t.description}),(0,ke.jsxs)("button",{onClick:()=>e("/cards"),className:"text-purple-600 font-semibold hover:text-purple-700 transition-colors inline-flex items-center",children:["Learn More",(0,ke.jsx)("svg",{className:"w-5 h-5 ml-2 group-hover:translate-x-1 transition-transform",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,ke.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})]},n))})})}),(0,ke.jsx)("section",{className:"py-20 px-4 bg-gray-50",children:(0,ke.jsxs)("div",{className:"container mx-auto max-w-6xl",children:[(0,ke.jsxs)("div",{className:"text-center mb-16",children:[(0,ke.jsx)("h2",{className:"text-4xl font-bold text-gray-900 mb-4",children:"Why Choose Greetins"}),(0,ke.jsx)("p",{className:"text-xl text-gray-600",children:"The complete solution for digital greeting cards"})]}),(0,ke.jsxs)("div",{className:"grid md:grid-cols-3 gap-8",children:[(0,ke.jsxs)("div",{className:"text-center",children:[(0,ke.jsx)("div",{className:"w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center text-3xl mx-auto mb-4",children:"\ud83c\udfaf"}),(0,ke.jsx)("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"Easy to Use"}),(0,ke.jsx)("p",{className:"text-gray-600",children:"Intuitive interface designed for everyone"})]}),(0,ke.jsxs)("div",{className:"text-center",children:[(0,ke.jsx)("div",{className:"w-16 h-16 bg-pink-100 rounded-full flex items-center justify-center text-3xl mx-auto mb-4",children:"\ud83d\ude80"}),(0,ke.jsx)("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"Fast Delivery"}),(0,ke.jsx)("p",{className:"text-gray-600",children:"Instant sending to email and WhatsApp"})]}),(0,ke.jsxs)("div",{className:"text-center",children:[(0,ke.jsx)("div",{className:"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center text-3xl mx-auto mb-4",children:"\ud83d\udc8e"}),(0,ke.jsx)("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"Premium Quality"}),(0,ke.jsx)("p",{className:"text-gray-600",children:"Professional designs and AI-powered content"})]})]})]})}),(0,ke.jsx)("section",{className:"py-20 px-4 bg-white",children:(0,ke.jsxs)("div",{className:"container mx-auto max-w-6xl",children:[(0,ke.jsxs)("div",{className:"text-center mb-12",children:[(0,ke.jsx)("h2",{className:"text-4xl font-bold text-gray-900 mb-4",children:"Meet Our Team"}),(0,ke.jsx)("p",{className:"text-xl text-gray-600",children:"The talented people behind Greetins"})]}),(0,ke.jsx)(Ne,{})]})}),(0,ke.jsx)("section",{className:"py-20 px-4",children:(0,ke.jsxs)("div",{className:"container mx-auto max-w-4xl text-center",children:[(0,ke.jsx)("h2",{className:"text-4xl font-bold text-gray-900 mb-6",children:"Ready to Get Started?"}),(0,ke.jsx)("p",{className:"text-xl text-gray-600 mb-8",children:"Create beautiful greeting cards in minutes"}),(0,ke.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[(0,ke.jsx)("button",{onClick:()=>e("/cards"),className:"bg-gradient-to-r from-purple-600 to-pink-600 text-white px-10 py-4 rounded-lg text-lg font-semibold hover:shadow-xl transform hover:scale-105 transition-all",children:"Start Creating Now"}),(0,ke.jsx)("button",{onClick:()=>e("/contact"),className:"bg-white border-2 border-purple-600 text-purple-600 px-10 py-4 rounded-lg text-lg font-semibold hover:bg-purple-50 transform hover:scale-105 transition-all",children:"Get Started Today"})]})]})})]})};const Lx=function(){const[e,t]=(0,i.useState)({name:"",email:"",phone:"",subject:"",message:""}),[n,r]=(0,i.useState)({type:"",message:""}),[s,a]=(0,i.useState)(!1),[o,l]=(0,i.useState)(!1);return(0,ke.jsxs)("div",{className:"min-h-screen bg-white",children:[(0,ke.jsx)(De,{}),(0,ke.jsx)("section",{className:"pt-32 pb-20 px-4 bg-gradient-to-br from-purple-50 to-pink-50",children:(0,ke.jsxs)("div",{className:"container mx-auto max-w-6xl text-center",children:[(0,ke.jsx)("h1",{className:"text-5xl md:text-6xl font-bold text-gray-900 mb-6",children:"Contact Us"}),(0,ke.jsx)("p",{className:"text-xl text-gray-600 max-w-3xl mx-auto",children:"Have questions? We'd love to hear from you. Send us a message and we'll respond as soon as possible."})]})}),(0,ke.jsx)("section",{className:"py-20 px-4",children:(0,ke.jsx)("div",{className:"container mx-auto max-w-6xl",children:(0,ke.jsxs)("div",{className:"grid md:grid-cols-2 gap-12",children:[(0,ke.jsxs)("div",{className:"bg-white border border-gray-200 rounded-xl p-8",children:[(0,ke.jsx)("h2",{className:"text-3xl font-bold text-gray-900 mb-6",children:"Send us a Message"}),(0,ke.jsxs)("form",{onSubmit:async n=>{n.preventDefault(),a(!0),r({type:"",message:""});try{const n=await fetch("http://localhost:8000/api/v1/contact/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),i=await n.json();n.ok?(r({type:"success",message:i.message}),l(!0),t({name:"",email:"",phone:"",subject:"",message:""})):(r({type:"error",message:i.detail||"Failed to send message"}),l(!0))}catch(Vr){r({type:"error",message:"Network error. Please try again."}),l(!0)}finally{a(!1)}},className:"space-y-6",children:[(0,ke.jsxs)("div",{children:[(0,ke.jsx)("label",{className:"block text-gray-700 font-medium mb-2",children:"Your Name"}),(0,ke.jsx)("input",{type:"text",required:!0,value:e.name,onChange:n=>t((0,Oe.A)((0,Oe.A)({},e),{},{name:n.target.value})),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"John Doe"})]}),(0,ke.jsxs)("div",{children:[(0,ke.jsx)("label",{className:"block text-gray-700 font-medium mb-2",children:"Email Address"}),(0,ke.jsx)("input",{type:"email",required:!0,value:e.email,onChange:n=>t((0,Oe.A)((0,Oe.A)({},e),{},{email:n.target.value})),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"john@example.com"})]}),(0,ke.jsxs)("div",{children:[(0,ke.jsx)("label",{className:"block text-gray-700 font-medium mb-2",children:"Phone Number"}),(0,ke.jsx)("input",{type:"tel",value:e.phone,onChange:n=>t((0,Oe.A)((0,Oe.A)({},e),{},{phone:n.target.value})),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"+91 98765 43210"})]}),(0,ke.jsxs)("div",{children:[(0,ke.jsx)("label",{className:"block text-gray-700 font-medium mb-2",children:"Subject"}),(0,ke.jsx)("input",{type:"text",required:!0,value:e.subject,onChange:n=>t((0,Oe.A)((0,Oe.A)({},e),{},{subject:n.target.value})),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"How can we help?"})]}),(0,ke.jsxs)("div",{children:[(0,ke.jsx)("label",{className:"block text-gray-700 font-medium mb-2",children:"Message"}),(0,ke.jsx)("textarea",{required:!0,rows:"5",value:e.message,onChange:n=>t((0,Oe.A)((0,Oe.A)({},e),{},{message:n.target.value})),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"Tell us more about your inquiry..."})]}),(0,ke.jsx)("button",{type:"submit",disabled:s,className:"w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-4 rounded-lg font-semibold hover:shadow-xl transform hover:scale-105 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:s?"Sending...":"Send Message"})]}),n.message&&(0,ke.jsxs)("div",{className:"mt-4 p-4 rounded-lg ".concat("success"===n.type?"bg-green-50 text-green-800 border border-green-200":"bg-red-50 text-red-800 border border-red-200"),children:["success"===n.type?"\u2705":"\u274c"," ",n.message]})]}),(0,ke.jsxs)("div",{children:[(0,ke.jsx)("h2",{className:"text-3xl font-bold text-gray-900 mb-6",children:"Get in Touch"}),(0,ke.jsx)("p",{className:"text-gray-600 mb-8",children:"We're here to help and answer any question you might have. We look forward to hearing from you!"}),(0,ke.jsxs)("div",{className:"space-y-6",children:[(0,ke.jsxs)("div",{className:"flex items-start gap-4",children:[(0,ke.jsx)("div",{className:"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center flex-shrink-0",children:(0,ke.jsx)("svg",{className:"w-6 h-6 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,ke.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})})}),(0,ke.jsxs)("div",{children:[(0,ke.jsx)("h3",{className:"font-bold text-gray-900 mb-1",children:"Email"}),(0,ke.jsx)("p",{className:"text-gray-600",children:"support@greetins.com"}),(0,ke.jsx)("p",{className:"text-gray-600",children:"info@greetins.com"})]})]}),(0,ke.jsxs)("div",{className:"flex items-start gap-4",children:[(0,ke.jsx)("div",{className:"w-12 h-12 bg-pink-100 rounded-lg flex items-center justify-center flex-shrink-0",children:(0,ke.jsx)("svg",{className:"w-6 h-6 text-pink-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,ke.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})})}),(0,ke.jsxs)("div",{children:[(0,ke.jsx)("h3",{className:"font-bold text-gray-900 mb-1",children:"Phone"}),(0,ke.jsx)("p",{className:"text-gray-600",children:"+91 98765 43210"}),(0,ke.jsx)("p",{className:"text-gray-600",children:"Mon-Fri 9am-6pm IST"})]})]}),(0,ke.jsxs)("div",{className:"flex items-start gap-4",children:[(0,ke.jsx)("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0",children:(0,ke.jsxs)("svg",{className:"w-6 h-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,ke.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),(0,ke.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]})}),(0,ke.jsxs)("div",{children:[(0,ke.jsx)("h3",{className:"font-bold text-gray-900 mb-1",children:"Address"}),(0,ke.jsx)("p",{className:"text-gray-600",children:"Ground Floor, Camelot, 6, 1st Main Rd,"}),(0,ke.jsx)("p",{className:"text-gray-600",children:"Plot No. 6, Road No. 10,"}),(0,ke.jsx)("p",{className:"text-gray-600",children:"KIADB Export Promotion Industrial Area,"}),(0,ke.jsx)("p",{className:"text-gray-600",children:"Whitefield, Bengaluru, Karnataka 560066"})]})]})]}),(0,ke.jsxs)("div",{className:"mt-8",children:[(0,ke.jsx)("h3",{className:"font-bold text-gray-900 mb-4",children:"Follow Us"}),(0,ke.jsxs)("div",{className:"flex gap-4",children:[(0,ke.jsx)("a",{href:"https://www.facebook.com/share/1FmZVWtD9n/",target:"_blank",rel:"noopener noreferrer",className:"w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center hover:bg-purple-100 transition-colors",children:(0,ke.jsx)("svg",{className:"w-5 h-5 text-gray-600",fill:"currentColor",viewBox:"0 0 24 24",children:(0,ke.jsx)("path",{d:"M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"})})}),(0,ke.jsx)("a",{href:"https://x.com/retouchin_it",target:"_blank",rel:"noopener noreferrer",className:"w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center hover:bg-purple-100 transition-colors",children:(0,ke.jsx)("svg",{className:"w-5 h-5 text-gray-600",fill:"currentColor",viewBox:"0 0 24 24",children:(0,ke.jsx)("path",{d:"M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"})})}),(0,ke.jsx)("a",{href:"https://www.instagram.com/risinternational_services?igsh=bnd2MHl5c2s3eDA0",target:"_blank",rel:"noopener noreferrer",className:"w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center hover:bg-purple-100 transition-colors",children:(0,ke.jsx)("svg",{className:"w-5 h-5 text-gray-600",fill:"currentColor",viewBox:"0 0 24 24",children:(0,ke.jsx)("path",{d:"M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"})})}),(0,ke.jsx)("a",{href:"https://youtube.com/@risinternational-net?si=thU1_Kr2dw0lvyC6",target:"_blank",rel:"noopener noreferrer",className:"w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center hover:bg-purple-100 transition-colors",children:(0,ke.jsx)("svg",{className:"w-5 h-5 text-gray-600",fill:"currentColor",viewBox:"0 0 24 24",children:(0,ke.jsx)("path",{d:"M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"})})})]})]})]})]})})}),(0,ke.jsx)("section",{className:"py-20 px-4 bg-gray-50",children:(0,ke.jsxs)("div",{className:"container mx-auto max-w-6xl",children:[(0,ke.jsxs)("div",{className:"text-center mb-12",children:[(0,ke.jsx)("h2",{className:"text-4xl font-bold text-gray-900 mb-4",children:"Our Global Presence"}),(0,ke.jsx)("p",{className:"text-xl text-gray-600",children:"Serving customers worldwide with excellence"})]}),(0,ke.jsxs)("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-8",children:[(0,ke.jsxs)("div",{className:"bg-white rounded-xl p-8 shadow-lg hover:shadow-xl transition-shadow",children:[(0,ke.jsx)("div",{className:"w-20 h-20 mx-auto mb-4 rounded-full overflow-hidden border-4 border-gray-100",children:(0,ke.jsx)("img",{src:"https://flagcdn.com/w320/in.png",alt:"India",className:"w-full h-full object-cover"})}),(0,ke.jsx)("h3",{className:"text-xl font-bold text-gray-900 mb-2 text-center",children:"India"}),(0,ke.jsx)("p",{className:"text-gray-600 text-center",children:"Bengaluru, Karnataka"})]}),(0,ke.jsxs)("div",{className:"bg-white rounded-xl p-8 shadow-lg hover:shadow-xl transition-shadow",children:[(0,ke.jsx)("div",{className:"w-20 h-20 mx-auto mb-4 rounded-full overflow-hidden border-4 border-gray-100",children:(0,ke.jsx)("img",{src:"https://flagcdn.com/w320/us.png",alt:"United States",className:"w-full h-full object-cover"})}),(0,ke.jsx)("h3",{className:"text-xl font-bold text-gray-900 mb-2 text-center",children:"United States"}),(0,ke.jsx)("p",{className:"text-gray-600 text-center",children:"New York, NY"})]}),(0,ke.jsxs)("div",{className:"bg-white rounded-xl p-8 shadow-lg hover:shadow-xl transition-shadow",children:[(0,ke.jsx)("div",{className:"w-20 h-20 mx-auto mb-4 rounded-full overflow-hidden border-4 border-gray-100",children:(0,ke.jsx)("img",{src:"https://flagcdn.com/w320/gb.png",alt:"United Kingdom",className:"w-full h-full object-cover"})}),(0,ke.jsx)("h3",{className:"text-xl font-bold text-gray-900 mb-2 text-center",children:"United Kingdom"}),(0,ke.jsx)("p",{className:"text-gray-600 text-center",children:"London, UK"})]}),(0,ke.jsxs)("div",{className:"bg-white rounded-xl p-8 shadow-lg hover:shadow-xl transition-shadow",children:[(0,ke.jsx)("div",{className:"w-20 h-20 mx-auto mb-4 rounded-full overflow-hidden border-4 border-gray-100",children:(0,ke.jsx)("img",{src:"https://flagcdn.com/w320/ca.png",alt:"Canada",className:"w-full h-full object-cover"})}),(0,ke.jsx)("h3",{className:"text-xl font-bold text-gray-900 mb-2 text-center",children:"Canada"}),(0,ke.jsx)("p",{className:"text-gray-600 text-center",children:"Toronto, ON"})]}),(0,ke.jsxs)("div",{className:"bg-white rounded-xl p-8 shadow-lg hover:shadow-xl transition-shadow",children:[(0,ke.jsx)("div",{className:"w-20 h-20 mx-auto mb-4 rounded-full overflow-hidden border-4 border-gray-100",children:(0,ke.jsx)("img",{src:"https://flagcdn.com/w320/ng.png",alt:"Nigeria",className:"w-full h-full object-cover"})}),(0,ke.jsx)("h3",{className:"text-xl font-bold text-gray-900 mb-2 text-center",children:"Nigeria"}),(0,ke.jsx)("p",{className:"text-gray-600 text-center",children:"Lagos"})]}),(0,ke.jsxs)("div",{className:"bg-white rounded-xl p-8 shadow-lg hover:shadow-xl transition-shadow",children:[(0,ke.jsx)("div",{className:"w-20 h-20 mx-auto mb-4 rounded-full overflow-hidden border-4 border-gray-100",children:(0,ke.jsx)("img",{src:"https://flagcdn.com/w320/ph.png",alt:"Philippines",className:"w-full h-full object-cover"})}),(0,ke.jsx)("h3",{className:"text-xl font-bold text-gray-900 mb-2 text-center",children:"Philippines"}),(0,ke.jsx)("p",{className:"text-gray-600 text-center",children:"Manila"})]})]})]})}),(0,ke.jsx)("section",{className:"py-20 px-4",children:(0,ke.jsx)("div",{className:"container mx-auto max-w-4xl",children:(0,ke.jsxs)("div",{className:"bg-gradient-to-r from-purple-600 to-pink-600 rounded-3xl p-12 text-center text-white",children:[(0,ke.jsx)("h2",{className:"text-3xl md:text-4xl font-bold mb-4",children:"Need Professional Image Editing?"}),(0,ke.jsx)("p",{className:"text-xl mb-6 opacity-90",children:"Visit ReTouch for expert photo editing and retouching services"}),(0,ke.jsx)("a",{href:"https://risinternational.net",target:"_blank",rel:"noopener noreferrer",className:"inline-block bg-white text-purple-600 px-10 py-4 rounded-lg text-lg font-semibold hover:bg-gray-100 transform hover:scale-105 transition-all",children:"Visit ReTouch \u2192"})]})})}),o&&(0,ke.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,ke.jsx)("div",{className:"bg-white rounded-2xl p-8 max-w-md w-full shadow-2xl transform transition-all",children:(0,ke.jsxs)("div",{className:"text-center",children:[(0,ke.jsx)("div",{className:"w-20 h-20 mx-auto mb-4 rounded-full flex items-center justify-center ".concat("success"===n.type?"bg-green-100":"bg-red-100"),children:"success"===n.type?(0,ke.jsx)("svg",{className:"w-10 h-10 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,ke.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}):(0,ke.jsx)("svg",{className:"w-10 h-10 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,ke.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,ke.jsx)("h3",{className:"text-2xl font-bold mb-2 ".concat("success"===n.type?"text-green-600":"text-red-600"),children:"success"===n.type?"Message Sent!":"Error"}),(0,ke.jsx)("p",{className:"text-gray-600 mb-6",children:n.message}),(0,ke.jsx)("button",{onClick:()=>l(!1),className:"bg-gradient-to-r from-purple-600 to-pink-600 text-white px-8 py-3 rounded-lg font-semibold hover:shadow-lg transition-all",children:"Close"})]})})})]})};const Ix=function(){return(0,ke.jsx)(Me,{children:(0,ke.jsxs)(_e,{children:[(0,ke.jsx)(be,{path:"/",element:(0,ke.jsx)(qb,{})}),(0,ke.jsx)(be,{path:"/categories",element:(0,ke.jsx)(sx,{})}),(0,ke.jsx)(be,{path:"/cards",element:(0,ke.jsx)(dx,{})}),(0,ke.jsx)(be,{path:"/templates",element:(0,ke.jsx)(yx,{})}),(0,ke.jsx)(be,{path:"/personalize/:templateId",element:(0,ke.jsx)(bx,{})}),(0,ke.jsx)(be,{path:"/send-greeting",element:(0,ke.jsx)(Ax,{})}),(0,ke.jsx)(be,{path:"/send/:templateId",element:(0,ke.jsx)(Ax,{})}),(0,ke.jsx)(be,{path:"/ai-greeting",element:(0,ke.jsx)(Mx,{})}),(0,ke.jsx)(be,{path:"/about",element:(0,ke.jsx)(Rx,{})}),(0,ke.jsx)(be,{path:"/services",element:(0,ke.jsx)(Cx,{})}),(0,ke.jsx)(be,{path:"/contact",element:(0,ke.jsx)(Lx,{})})]})})};s.createRoot(document.getElementById("root")).render((0,ke.jsx)(Ix,{}))})()})();
//# sourceMappingURL=main.db80772e.js.map